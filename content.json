{"pages":[{"title":"è¯·å¤šå¤šæŒ‡æ•™","text":"","link":"/guestbook/index.html"},{"title":"","text":"var a_idx = 0; jQuery(document).ready(function($) { $(\"body\").click(function(e) { var a = new Array (\"å¯Œå¼º\", \"æ°‘ä¸»\", \"æ–‡æ˜\", \"å’Œè°\", \"è‡ªç”±\", \"å¹³ç­‰\", \"å…¬æ­£\", \"æ³•æ²»\", \"çˆ±å›½\", \"æ•¬ä¸š\", \"è¯šä¿¡\", \"å‹å–„\"); var $i = $(\"\").text(a[a_idx]); a_idx = (a_idx + 1) % a.length; var x = e.pageX, y = e.pageY; $i.css({ \"z-index\": 5, \"top\": y - 20, \"left\": x, \"position\": \"absolute\", \"font-weight\": \"bold\", \"color\": \"#FF0000\" }); $(\"body\").append($i); $i.animate({ \"top\": y - 180, \"opacity\": 0 }, 3000, function() { $i.remove(); }); }); setTimeout('delay()', 2000); }); function delay() { $(\".buryit\").removeAttr(\"onclick\"); }","link":"/js/click_show_text.js"}],"posts":[{"title":"Docker-alpineé•œåƒå¯¼è‡´çš„é—®é¢˜","text":"å‰æ®µæ—¶é—´æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°†ç°æœ‰çš„ä¸€ä¸ªé¡¹ç›®å®¹å™¨åŒ–éƒ¨ç½²ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„æŠ˜è…¾ï¼Œæ€»ç®—æˆåŠŸçš„è·‘èµ·æ¥äº†ã€‚ä½†æ˜¯æœ€è¿‘å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå›¾å½¢éªŒè¯ç æ²¡æ³•æ˜¾ç¤ºäº†ã€‚ é€šè¿‡æŸ¥æ‰¾æ—¥å¿—å‘ç°ä»¥ä¸‹å¼‚å¸¸å †æ ˆï¼š 12345678910111213141516171819202122java.lang.NullPointerException: null at sun.awt.X11FontManager.getDefaultPlatformFont(X11FontManager.java:779) at sun.font.SunFontManager$2.run(SunFontManager.java:433) at java.security.AccessController.doPrivileged(Native Method) at sun.font.SunFontManager.&lt;init&gt;(SunFontManager.java:376) at sun.awt.X11FontManager.&lt;init&gt;(X11FontManager.java:32) at sun.reflect.GeneratedConstructorAccessor62.newInstance(Unknown Source) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:526) at java.lang.Class.newInstance(Class.java:383) at sun.font.FontManagerFactory$1.run(FontManagerFactory.java:83) at java.security.AccessController.doPrivileged(Native Method) at sun.font.FontManagerFactory.getInstance(FontManagerFactory.java:74) at java.awt.Font.getFont2D(Font.java:490) at java.awt.Font.access$000(Font.java:224) at java.awt.Font$FontAccessImpl.getFont2D(Font.java:228) at sun.font.FontUtilities.getFont2D(FontUtilities.java:180) at sun.java2d.SunGraphics2D.checkFontInfo(SunGraphics2D.java:645) at sun.java2d.SunGraphics2D.getFontInfo(SunGraphics2D.java:806) at sun.java2d.pipe.GlyphListPipe.drawString(GlyphListPipe.java:50) at sun.java2d.SunGraphics2D.drawString(SunGraphics2D.java:2887)... ç»“åˆæºç å‘ç°ï¼Œåº”è¯¥æ˜¯æ— æ³•è·å–åˆ°å­—ä½“å¯¼è‡´çš„å¼‚å¸¸ï¼š 1graphics.setFont(new Font(&quot;Default&quot;, Font.PLAIN, fsize)); ç”±äºä»£ç æ²¡æœ‰åšå‡ºè¿‡å˜æ›´ï¼Œæ‰€ä»¥æ¯«æ— ç–‘é—®ï¼Œåº”è¯¥æ˜¯ç¯å¢ƒçš„é—®é¢˜äº†ã€‚ äºæ˜¯æˆ‘è¿›å…¥Dokcerå®¹å™¨æŸ¥çœ‹ç›¸å…³å­—ä½“ï¼š 12docker exec -it containerId bashfc-list å‘ç°æ— ä»»ä½•å†…å®¹è¾“å‡ºã€‚ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ï¼š è¿›å…¥å®¹å™¨å®‰è£…å­—ä½“ï¼ˆåªèƒ½ä¸´æ—¶è§£å†³ï¼Œå½“é‡æ–°æ„å»ºåï¼Œå­—ä½“ä¼šä¸¢å¤±ï¼‰ 1apk add --update ttf-dejavu fontconfig &amp;&amp; rm -rf /var/cache/apk/* ä¿®æ”¹Dockerfile åœ¨æ„å»ºé•œåƒæ—¶å®‰è£…å­—ä½“ï¼ˆä¼šå½±å“æ„å»ºé€Ÿåº¦ï¼Œå®‰è£…å­—ä½“æ¯”è¾ƒæ…¢ï¼‰ 1RUN apk add --update ttf-dejavu fontconfig &amp;&amp; rm -rf /var/cache/apk/* æ›´æ”¹åŸºç¡€é•œåƒï¼ˆæ¨èï¼‰ æˆ‘è¿™è¾¹å‡ºé—®é¢˜çš„å®¹å™¨æ˜¯åŸºäºtomcat:8.0-jre7-alpineæ„å»ºçš„ï¼Œalpine tagçš„é•œåƒæ¯”è¾ƒå°ï¼Œæ¯”è¾ƒå¹²å‡€ã€‚ æˆ‘åˆ°docker hubä¸Šæ‰¾åˆ°äº†ç±»ä¼¼çš„é•œåƒï¼Œslim tagçš„ã€‚ ä¿®æ”¹Dockerfileï¼Œå°†FROM tomcat:8.0-jre7-alpine æ”¹ä¸º FROM tomcat:8.0-jre7-slimå³å¯ã€‚","link":"/archives/f3674cca.html"},{"title":"Dockerä½¿ç”¨overlayç½‘ç»œé‡åˆ°çš„é—®é¢˜","text":"ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨Overlayç½‘ç»œéƒ½æ˜¯æ¶‰åŠåˆ°å¤šå°ä¸»æœºä¸­çš„Dockerå®¹å™¨é€šä¿¡é—®é¢˜ã€‚ Docker Overlay ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œä½¿ç”¨docker-compose å¯åŠ¨å®¹å™¨ã€‚ åœ¨ä¸€ä¸ªä¸šåŠ¡æœåŠ¡çš„å®¹å™¨æ—¥å¿—é‡Œé¢å‘ç°æ— æ³•è¿æ¥çš„Zookeeperï¼Œé”™è¯¯æ˜¯ï¼š 1java.net.NoRouteToHostException: No route to host åœ¨å®¹å™¨ä¸­å°è¯•ping 10.0.0.3 å®¹å™¨ï¼Œå‘ç°ä¸é€šï¼š 1234PING zookeeper (10.0.0.3) 56(84) bytes of data.From 85789ac6e6a8 (10.0.0.8) icmp_seq=1 Destination Host UnreachableFrom 85789ac6e6a8 (10.0.0.8) icmp_seq=2 Destination Host UnreachableFrom 85789ac6e6a8 (10.0.0.8) icmp_seq=3 Destination Host Unreachable åˆšå¼€å§‹æŸ¥è¯¢äº†ä¸€äº›èµ„æ–™åï¼Œä»¥ä¸ºæ˜¯é˜²ç«å¢™(CentOS7)é—®é¢˜ï¼Œäºæ˜¯æŸ¥çœ‹äº†é˜²ç«å¢™çŠ¶æ€ï¼š 1firewall-cmd --state ç»“æœé˜²ç«å¢™å‹æ ¹æ²¡å¼€ï¼š 1not running ç”±äºä¹‹å‰æ²¡æœ‰è¯¦ç»†æŸ¥çœ‹docker overlayç½‘ç»œçš„ä½¿ç”¨é™åˆ¶ï¼Œä¸€ç›´ä»¥ä¸ºåªè¦dockerçš„ç‰ˆæœ¬ä¿æŒåœ¨1.9.1+å°±å¯ä»¥äº†ã€‚åæ¥åˆæŸ¥äº†ä¸‹ï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªé™åˆ¶ï¼šå†…æ ¸ç‰ˆæœ¬å¤§äºç­‰äº3.16ã€‚äºæ˜¯èµ¶ç´§æŸ¥çœ‹äº†ä¸‹å†…æ ¸ç‰ˆæœ¬ï¼š 12# uname -r3.10.0-514.10.2.el7.x86_64 æœç„¶å†…æ ¸ç‰ˆæœ¬ä½äº†ï¼Œäºæ˜¯å¼€å§‹å‡çº§å†…æ ¸ã€‚ å¯¼å…¥elrepoçš„keyï¼Œç„¶åå®‰è£…elrepoçš„yumæºï¼š 12sudo rpm -import https://www.elrepo.org/RPM-GPG-KEY-elrepo.orgsudo rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm åˆ—å‡ºå¯ç”¨çš„å†…æ ¸ç›¸å…³åŒ…ï¼š 1yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list available ltä¸ºé•¿æœŸç»´æŠ¤ç‰ˆæœ¬ï¼Œmtä¸ºç¨³å®šç‰ˆæœ¬ï¼Œå¯ä»¥çœ‹åˆ°æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸ºï¼š 15.2.10-1.el7.elrepo å¼€å§‹å‡çº§å†…æ ¸ï¼ˆä»¥åå¯ä»¥ç›´æ¥æ‰§è¡Œè¿™å¥ï¼‰ï¼š 1sudo yum -y --enablerepo=elrepo-kernel install kernel-ml.x86_64 kernel-ml-devel.x86_64 å‡çº§å®Œåéœ€è¦é‡å¯ä¸€ä¸‹ï¼š 1reboot å†æ¬¡æŸ¥çœ‹å†…æ ¸ï¼š 12uname -r3.10.0-514.10.2.el7.x86_64 WTFï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è€çš„?åŸæ¥æ˜¯å¯åŠ¨çš„æ—¶å€™è¿˜æ˜¯é»˜è®¤é€‰æ‹©äº†è€çš„å†…æ ¸ï¼Œè¿™é‡Œéœ€è¦é‡æ–°è®¾ç½®ä¸€ä¸‹å¯åŠ¨æ—¶çš„é»˜è®¤å†…æ ¸ï¼š é¦–å…ˆæŸ¥çœ‹å½“å‰éƒ½æœ‰å“ªäº›å¯åŠ¨é¡¹ï¼š 1234cat /boot/grub2/grub.cfg |grep menuentrymenuentry 'CentOS Linux (5.2.10-1.el7.elrepo.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-514.6.2.el7.x86_64-advanced-07151862-c2b9-45dc-bf7a-af8d2a6fa6c1' {menuentry 'CentOS Linux (3.10.0-514.10.2.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-514.6.2.el7.x86_64-advanced-07151862-c2b9-45dc-bf7a-af8d2a6fa6c1' { è®¾ç½®é»˜è®¤é€‰é¡¹ï¼ˆéœ€è¦å‡çº§ä¸ºrootç”¨æˆ·ï¼‰ï¼š 1grub2-set-default 'CentOS Linux (5.2.10-1.el7.elrepo.x86_64) 7 (Core)' å†æ¬¡é‡å¯ï¼Œé‡å¯åæŸ¥çœ‹å†…æ ¸ï¼š 12uname -r5.2.10-1.el7.elrepo.x86_64 OKï¼Œå†…æ ¸æˆåŠŸå‡çº§ï¼Œå†æ¬¡å¯åŠ¨Dockerè¯•è¯•ï¼ˆåˆ«å¿˜äº†å¯åŠ¨æœåŠ¡å‘ç°ï¼Œæˆ‘è¿™é‡Œæ˜¯ETCDï¼‰: ETCDå¯åŠ¨: 1./etcd --name docker-node3 --initial-advertise-peer-urls http://10.208.10.17:2380 --listen-peer-urls http://10.208.10.17:2380 --listen-client-urls http://10.208.10.17:2379,http://127.0.0.1:2379 --advertise-client-urls http://10.208.10.17:2379 --initial-cluster-token etcd-cluster --initial-cluster docker-node1=http://10.208.10.14:2380,docker-node2=http://10.208.10.16:2380,docker-node3=http://10.208.10.17:2380 --initial-cluster-state new &amp; Docker å¯åŠ¨ï¼š 1sudo /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://10.208.10.14:2379 --cluster-advertise=10.208.10.14:2375 &amp; å½“æ‰€æœ‰ä¸»æœºéƒ½å®Œæˆä¸Šè¿°æ“ä½œæ—¶ï¼Œå‘ç°å®¹å™¨é—´æ€»ç®—å¯ä»¥äº’é€šäº†ã€‚ å…¶ä»–é—®é¢˜ï¼š 1error locating sandbox id c43437e6300a0c6ea20d2d9f95bbe318e557d1eedfa585ab5218345eeef32a36: sandbox c43437e6300a0c6ea20d2d9f95bbe318e557d1eedfa585ab5218345eeef32a36 not found 1could not get network sandbox (oper true): failed get network namespace &quot;&quot; æœ€å¥½åˆ é™¤ä¹‹å‰åˆ›å»ºçš„networkå’Œcontainerï¼Œå¦åˆ™å¯èƒ½å‡ºç°å…¶ä»–é—®é¢˜ã€‚ ä¸åŒä¸»æœºä¸Šçš„å®¹å™¨é—´ä½¿ç”¨hostnameæˆ–è€…container nameé€šä¿¡å¥½åƒæœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨docker swarmæ¥è§£å†³ã€‚ å‚è€ƒèµ„æ–™ï¼š https://www.centos.bz/2017/08/upgrade-centos-7-6-kernel-to-4-12-4/","link":"/archives/1c99e54f.html"},{"title":"Dockerå¤šä¸»æœºå®¹å™¨é—´pingä¸é€šçš„é—®é¢˜","text":"ä¹‹å‰è®°å½•è¿‡ä¸€ä¸ªå› ä¸ºå†…æ ¸ç‰ˆæœ¬è¿‡ä½å¯¼è‡´Docker overlayç½‘ç»œä¸é€šçš„é—®é¢˜ã€‚åæ¥åˆé‡åˆ°ä¸€ä¸ªç”±äºç²—å¿ƒå¯¼è‡´çš„ç½‘ç»œä¸é€šçš„é—®é¢˜ã€‚ é—®é¢˜çš„ç°è±¡æ˜¯è¿™æ ·çš„ï¼Œåˆ›å»ºäº†overlayç½‘ç»œåï¼ŒåŒä¸€å°ä¸»æœºä¸Šçš„å®¹å™¨é—´å¯ä»¥pingé€šã€‚è€Œä¸åŒä¸»æœºä¸Šçš„å®¹å™¨pingçš„ç»“æœæ˜¯ï¼š 1234PING zookeeper (10.0.0.3) 56(84) bytes of data.From 85789ac6e6a8 (10.0.0.8) icmp_seq=1 Destination Host UnreachableFrom 85789ac6e6a8 (10.0.0.8) icmp_seq=2 Destination Host UnreachableFrom 85789ac6e6a8 (10.0.0.8) icmp_seq=3 Destination Host Unreachable Googleä¸€é€šä¹‹åï¼Œæœªæ‰¾åˆ°æ»¡æ„ç­”æ¡ˆï¼Œè§‰å¾—å¾ˆæ˜¯å¥‡æ€ªï¼Œçµå…‰ä¸€ç°æŸ¥çœ‹ etcd ä¸Šçš„èŠ‚ç‚¹ï¼š 1etcdctl ls /docker/nodes å‘ç°åªæœ‰ä¸€ä¸ªï¼š 1/docker/nodes/10.208.10.14:2375 åæ¥æƒ³èµ·æ¥äº†åŸæ¥åœ¨å¯åŠ¨dockerçš„æ—¶å€™ï¼Œä½¿ç”¨çš„å‘½ä»¤å¿˜äº†æ”¹ â€“cluster-advertise â€“cluster-advertiseï¼šå‘ŠçŸ¥é›†ç¾¤å½“å‰çš„è¿æ¥åœ°å€ 1sudo /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://10.208.10.14:2379 --cluster-advertise=å½“å‰host:2375 &amp;","link":"/archives/d7132b2f.html"},{"title":"Go Module å¼•å…¥æœ¬åœ°è‡ªå®šä¹‰åŒ…","text":"æ–‡ç« è½¬è½½è‡³ å°ä¸€è¾ˆæ— äº§é˜¶çº§ç å†œ æœ€è¿‘ç”±äºé¡¹ç›®è¦æ±‚ï¼Œéœ€è¦å¯¹ IPFS æºç è¿›è¡Œä¿®æ”¹ï¼Œç”±äºè‡ªå·±åœ¨æ­¤ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ Go è¯­è¨€ï¼Œåœ¨ä½¿ç”¨ go mod å¯¼å…¥æœ¬åœ°è‡ªå·±å¼€å‘çš„å·¥å…·åŒ…çš„æ—¶å€™æŠ˜è…¾äº†å¥½ä¹…æ‰æå®šã€‚ è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡åæœŸæŸ¥é˜…ã€‚ Go è¯­è¨€çš„ Module æ–°ç‰¹æ€§æ˜¯åœ¨ go1.11 çš„å‘å¸ƒä¹‹åæ‰æ”¯æŒçš„ï¼Œè¿™æ˜¯ Go è¯­è¨€æ–°çš„ä¸€å¥—ä¾èµ–ç®¡ç†ç³»ç»Ÿã€‚ æ–‡ç« å¯¼è¯» 1. å¯ç”¨ Go Module 2. åˆ›å»º Go Module 3. Go Module ç‰ˆæœ¬è§„åˆ™ 4. å¼•å…¥æœ¬åœ°ä¾èµ–åŒ… 5. ä½¿ç”¨ replace å°†è¿œç¨‹åŒ…æ›¿æ¢ä¸ºæœ¬åœ°åŒ…æœåŠ¡ 1. å¯ç”¨ Go Moduleé¦–å…ˆåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ$GOPATH é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸æ”¯æŒ go mudules çš„ï¼Œå½“ä½ æ‰§è¡Œ go mod init çš„æ—¶å€™ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š go: modules disabled inside GOPATH/src by GO111MODULE=auto; see â€˜go help modulesâ€™ æˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œ go mod å‘½ä»¤ä¹‹å‰ï¼Œå¯¼å‡º GO111MODULE ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥ç›´æ¥ä¸´æ—¶ä¸€æ¬¡æ€§å¯¼å‡ºï¼Œ ä¸ºäº†åé¢æ–¹ä¾¿ï¼Œå»ºè®®ç›´æ¥åœ¨ ~/.bashrc æ–‡ä»¶ä¸­å¯¼å‡ºï¼Œ åœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥ï¼š 1export GO111MODULE=on Bash ä»è¿™ä¹Ÿè¡¨æ˜äº† go å°†æ¥æ˜¯è¦åˆ©ç”¨ modules æœºåˆ¶å»æ¶ˆç­ $GOPATH çš„ã€‚ 2. åˆ›å»º Go Moduleæˆ‘ä»¬ç°åœ¨ $GOPATH ä¸‹é¢å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶åˆå§‹åŒ– module 1234mkdir $GOPATH/src/gitee.com/rockyang/testmod -pcd $GOPATH/src/gitee.com/rockyang/test-gomodgo mod init gitee.com/rockyang/test-gomodgo: creating new go.mod: module gitee.com/rockyang/testmod Bash è¿™æ—¶ï¼Œæˆ‘ä»¬æ–°å»ºçš„é¡¹ç›®å·²ç»æˆä¸ºäº†ä¸€ä¸ª module äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­éšä¾¿å†™å‡ ä¸ªå‡½æ•°å¯¼å‡ºæµ‹è¯•ã€‚ Note: æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ç äº‘åšé¡¹ç›®æ‰˜ç®¡ï¼Œæ²¡æœ‰ä½¿ç”¨ githubï¼Œå›½å†…ç äº‘ç¡®å®æ¯” github å¿«å¾—å¤šã€‚ æ¥ä¸‹æ¥ä½ å¯ä»¥é€‰æ‹©æŠŠé¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚æœä½ çš„ä»“åº“æ˜¯å…¬å¼€çš„è¯ï¼Œåˆ«äººå°±æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ go get å‘½ä»¤å»ä¸‹è½½ä½ çš„é¡¹ç›®äº†ã€‚ å¦‚æœæ˜¯ç§æœ‰é¡¹ç›®åªæƒ³ç»™å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™ä½ å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢çš„åšæ³•ã€‚Go Module ä½¿ç”¨ç§æœ‰ä»“åº“ä½œä¸ºé¡¹ç›®ä¾èµ–åŒ… 3. Go Module ç‰ˆæœ¬è§„åˆ™go modules æ˜¯ä¸€ä¸ªç‰ˆæœ¬åŒ–ä¾èµ–ç®¡ç†ç³»ç»Ÿï¼Œç‰ˆæœ¬éœ€è¦éµå¾ªä¸€äº›è§„åˆ™ï¼Œæ‰“å¼€ä¸€ä¸ª go.mod æ–‡ä»¶ï¼Œä½ ä¼šå‘ç°ç±»ä¼¼ä¸‹é¢çš„ä¾èµ–è§„åˆ™ï¼š 12345678require ( github.com/filecoin-project/go-leb128 v0.0.0-20190212224330-8d79a5489543 github.com/golang/mock v1.2.0 // indirect github.com/ipfs/go-bitswap v0.0.2 github.com/libp2p/go-stream-muxer v0.0.1 github.com/minio/blake2b-simd v0.0.0-20160723061019-3f5f724cb5b1 gotest.tools v2.2.0+incompatible // indirect) Bash ä¾èµ–è§„åˆ™ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå‰é¢ä¸€éƒ¨åˆ†æ˜¯åŒ…è·¯å¾„ï¼Œåé¢ä¸€éƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯ç‰ˆæœ¬å·ã€‚ ä½ ä¼šå‘ç°æœ‰ä¸¤ç§ç‰ˆæœ¬å·ï¼Œä¸€ç§æ˜¯æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„ git æ ‡ç­¾ï¼Œæ¯”å¦‚ v0.0.2ï¼Œå¦ä¸€ç§å°±æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œå®ƒæ˜¯ï¼šç‰ˆæœ¬å· + æ—¶é—´æˆ³ +hash æ¯”å¦‚ï¼šv0.0.0-20190212224330-8d79a5489543ï¼Œå®ƒå…¶å®æ˜¯ç²¾å‡†çš„å¯¹åº”ç€ä¸€ä¸ª git log è®°å½•ï¼Œåé¢çš„å“ˆå¸Œæ˜¯å»æäº¤å“ˆå¸Œçš„å‰ 12 ä½ã€‚ æ¯”å¦‚æˆ‘å½“å‰çš„æäº¤è®°å½•æ˜¯è¿™æ ·çš„ï¼š 1234$ git log commit 4c55783279db32be4f02e193713d5a862b96db85 (HEAD -&gt; master, origin/master)Author: yangjian &lt;yangjian102621@gmail.com&gt;Date: Mon Jun 10 18:34:14 2019 +0800 Bash åˆ™æˆ‘çš„æœ€æ–°ç‰ˆæœ¬å·åº”è¯¥ä¸º v0.0.0-20190610103414-4c55783279db 4. å¼•å…¥æœ¬åœ°ä¾èµ–åŒ…å‰é¢é“ºå«äº†è¿™ä¹ˆå¤šï¼Œæ¥ä¸‹æ¥å›åˆ°æˆ‘ä»¬çš„ä¸»é¢˜ï¼Œæˆ‘è¯¥æ€æ ·ä½¿ç”¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„å·¥å…·åŒ…å‘¢ï¼Ÿ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„é¡¹ç›® testmod-demoï¼Œç°åœ¨æƒ³è¦åœ¨æ–°çš„é¡¹ç›®ä¸­ä½¿ç”¨ testmod ä¸­çš„å·¥å…·åŒ…ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ go mod åˆå§‹åŒ–è¯¥é¡¹ç›®ï¼š 12cd testmod-demogo mod init gitee.com/rockyang/testmod-demo Bash åˆå§‹åŒ–ä¹‹åä¼šåœ¨å½“å‰é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ª go.modï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å»å¼•å…¥ testmod åŒ…ï¼Œä¸€ç§æ˜¯ç›´æ¥ä¿®æ”¹ go.mod æ–‡ä»¶ï¼Œåœ¨ require é…ç½®ä¸­æ·»åŠ ä¸Š 1gitee.com/rockyang/testmod v0.0.0-20190610103414-4c55783279db Bash æˆ–è€…ä½¿ç”¨ go mod edit å‘½ä»¤ä¿®æ”¹ä¾èµ– 12go mod edit -require=&quot;gitee.com/rockyang/testmod@v0.0.0-20190610103414-4c55783279db&quot;go mod tidy # æ•´ç†ä¾èµ–åŒ… Bash 5. ä½¿ç”¨ replace å°†è¿œç¨‹åŒ…æ›¿æ¢ä¸ºæœ¬åœ°åŒ…æœåŠ¡è¿™æ—¶å¦‚æœä½ æ‰§è¡Œ go build çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œæç¤ºæ‰¾ä¸åˆ° gitee.com/rockyang/testmodï¼Œæ˜¯å› ä¸ºä½ æ²¡æœ‰æŠŠä»“åº“æ¨é€åˆ°è¿œç¨‹ï¼Œæ‰€ä»¥æ— æ³•ä¸‹è½½ã€‚ go module æä¾›äº†å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆ, ä½¿ç”¨ replace, ç¼–è¾‘ go.mod æ–‡ä»¶ï¼Œåœ¨æœ€åé¢æ·»åŠ ï¼šreplace gitee.com/rockyang/testmod =&gt; /gopath/src/gitee.com/rockyang/testmod 1234567891011module gitee.com/rockyang/testmod-demogo 1.12require ( github.com/gin-gonic/gin v1.3.0 gitee.com/rockyang/testmod@v0.0.0-20190610103414-4c55783279db golang.org/x/net v0.0.0-20190320064053-1272bf9dcd53 // indirect)replace gitee.com/rockyang/testmod =&gt; /gopath/src/gitee.com/rockyang/testmod Bash è¿™é‡Œçš„ /gopath/src/gitee.com/rockyang/testmod æ˜¯æœ¬åœ°çš„åŒ…è·¯å¾„ ç„¶åå†æ‰§è¡Œ go build ä½ ä¼šçœ‹åˆ°ä½ æƒ³è¦çš„ç»“æœã€‚ ä»¥ä¸Šä¸ºåŸä½œè€…åŸæ–‡ï¼Œè½¬è½½è¿™ç¯‡æ–‡ç« çš„åŸå› æ˜¯å› ä¸ºGolang1.13å‘å¸ƒäº†ï¼Œçœ‹åˆ°äº†å…¶ä¸­ä¸€ä¸ªæ–°ç‰¹æ–°GOPRIVATE å¯ä»¥æ­é… GOPROXY å¯¹ç§æœ‰æ¨¡å—æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚","link":"/archives/c8d527a1.html"},{"title":"Golangä¸­ä¸€äº›è®¾å®š","text":"æ ¼å¼åŒ–æ—¶é—´ä¸æ˜¯ç”¨yyyy MM DD HH mm ss sssç­‰åœ¨å…¶ä»–è¯­è¨€ä¸­å¸¸è§çš„ç¬¦å·ã€‚è€Œæ˜¯ï¼š2006-01-02 15:04:05 123now := time.Now()nowRight := now.Format(&quot;2006-01-02 15:04:05&quot;) å®Œæ•´UTCä¸ºï¼š2006-01-02T15:04:05-07:00 map æ¯æ¬¡éå†éƒ½æ˜¯æ— åºçš„ã€‚æ®è¯´æ˜¯ä¸ºäº†è®©å¼€å‘è€…ä¸è¦ä¾èµ–ä¸æ˜¯å¾ˆå¯é çš„mapæœ‰åºéå†ï¼Œç´¢æ€§æ”¹æˆäº†æ— åºçš„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯è·å–åˆ°keyï¼Œç„¶åæ’åºkeyï¼Œç„¶ååœ¨éå†mapï¼š 12345678var keys []intfor k,_ :=range map{ keys = append(keys, k)}sort.Ints(keys)for _,v:=range keys{ fmt.Printf(&quot;%d-%d\\n&quot;,v,aa[v])} slice ä¸åˆå§‹åŒ–ä¸èƒ½èµ‹å€¼ï¼Œä½†æ˜¯ç”¨appendå¯ä»¥ 12345var s []ints[0]=100//æŠ¥é”™ï¼Œruntime error: index out of ranges=append(s,100)//æ­£ç¡®é€šè¿‡ï¼Œappendé‡Œé¢å¯èƒ½å¯¹såšçš„åˆå§‹åŒ– go get [-u -v]go build : ç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶go install : go build + æŠŠç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°GOPATH/binç›®å½•ä¸‹go get : git clone + go install Golangä¸æ”¯æŒå‡½æ•°çš„é‡è½½ å¯ä»¥å¤šä¸ªå˜é‡ä¸€èµ·èµ‹å€¼ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å¾ˆç®€å•çš„å®ç°æ–æ³¢æ‹‰å¥‘æ•°åˆ— 123456a:=1b:=1for i:=0;i&lt;10;i++{fmt.Println(a)a,b=b,a+b} Golangä¸­çš„æ–¹æ³•ä¸å…¶å®ƒè¯­è¨€ä¸­ä¸ä¸€æ ·ï¼Œå…¶å®ƒè¯­è¨€ä¸€èˆ¬ç›´æ¥å®šä¹‰åœ¨Class æˆ–è€…structä¸­ï¼Œåœ¨Golangä¸­æ˜¯åˆ†ç¦»çš„ã€‚ 12345678910func (recevier type) methodName(å‚æ•°åˆ—è¡¨)(è¿”å›å€¼åˆ—è¡¨){}recevier type æ˜¯ä¸æ˜¯æŒ‡é’ˆä¹Ÿæœ‰å¾ˆå¤§å½±å“func (i *integer) set(val integer){ *i = val}var j integerj.set(10) è¯»å–chançš„ä¸¤ç§æ–¹å¼ 1234567891011121314close(ch)//ç¬¬ä¸€ç§ï¼š for{ b,ok:=&lt;-ch if !ok{ fmt.Println(&quot;chan is closed!&quot;) break } fmt.Println(b)}//ç¬¬äºŒç§ï¼šfor v:=range ch { fmt.Println(v)} go ä¸æ”¯æŒä¸‰ç›®(ä¸‰å…ƒ)è¿ç®—ç¬¦","link":"/archives/f11a2580.html"},{"title":"golangå†™æ–‡ä»¶å¼‚å¸¸invalid argument","text":"123dst, err := os.OpenFile(path, os.O_CREATE|os.O_APPEND|os.O_RDWR, 0644)defer dst.Close()n, err := dst.Write(buffer.Buffer[0:n]) ä¸Šé¢æ˜¯ä¸€æ®µå¾ˆç®€å•çš„ä»£ç ï¼Œä½†æ˜¯åœ¨é¢‘ç¹è°ƒç”¨çš„æ—¶å€™æŠ¥é”™äº†äº†:invalid argument è¿™ä¸ªé”™è¯¯ç€å®å¤ªè¯¯å¯¼äººäº†ï¼Œè®©æˆ‘ä»¥ä¸ºæ˜¯ä½¿ç”¨çš„å§¿åŠ¿ä¸å¯¹ï¼Œåæ¥å‘ç°æ²¡æœ‰é—®é¢˜ï¼Œäºæ˜¯å¼€å§‹debugï¼Œåæ¥åœ¨ä¸‹é¢ä¸€æ®µä»£ç ä¸­å‘ç°äº†çœŸæ­£çš„é—®é¢˜ï¼š 12345678910111213func CreateFile(name *uint16, access uint32, mode uint32, sa *SecurityAttributes, createmode uint32, attrs uint32, templatefile int32) (handle Handle, err error) { r0, _, e1 := Syscall9(procCreateFileW.Addr(), 7, uintptr(unsafe.Pointer(name)), uintptr(access), uintptr(mode), uintptr(unsafe.Pointer(sa)), uintptr(createmode), uintptr(attrs), uintptr(templatefile), 0, 0) handle = Handle(r0) if handle == InvalidHandle { if e1 != 0 { err = errnoErr(e1) } else { err = EINVAL } } return} è¿™é‡Œç»™å‡ºäº†çœŸæ­£çš„åŸå› ï¼š 1err = errnoErr(e1)//è¿™ä¸ªåœ°æ–¹ç»™å‡ºäº†çœŸæ­£çš„é”™è¯¯ï¼šERROR_SHARING_VIOLATION (32) æŸ¥è¯¢å¾®è½¯https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-æ–‡æ¡£ï¼Œ è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºï¼š 1The process cannot access the file because it is being used by another process. ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨OpenFileä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œä¹‹å‰ä½¿ç”¨çš„è¿™ä¸ªæ–‡ä»¶çš„file descriptor å¹¶çœŸæ­£æ²¡æœ‰é‡Šæ”¾ï¼Œæ‰€ä»¥å‡ºé”™äº†ã€‚ è€ŒGolangä¸Šå±‚çš„é”™è¯¯å¹¶æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„é”™è¯¯ã€‚","link":"/archives/848ae75e.html"},{"title":"Golangå¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åŒ…","text":"Mysql Drivergo get -u github.com/go-sql-driver/mysql SQL Librarygo get github.com/jmoiron/sqlx Redis Librarygo get github.com/gomodule/redigo/redis Kafka Librarygo get github.com/Shopify/sarama Etcd Librarygo get go.etcd.io/etcd/client TOML Library go get github.com/BurntSushi/toml tomlä¸€ä¸ªæ¯”yamlæ›´ç®€æ´æ›´æ–¹ä¾¿çš„ä¸€ç§é…ç½®æ–‡ä»¶æ ¼å¼ æœªå®Œå¾…ç»­â€¦ 2019/08/19 æœ€è¿‘å‘ç°githubä¸Šä¸€ä¸ªåº“æ•´ç†çš„æ¯”è¾ƒå…¨ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://github.com/avelino/awesome-goå¯¹åº”ä¸­æ–‡ç‰ˆï¼šhttps://github.com/jobbole/awesome-go-cn","link":"/archives/4c4ac8cd.html"},{"title":"Visual Studio Code Golangç¯å¢ƒé…ç½®","text":"å‰ææ˜¯å·²ç»è£…å¥½äº†Goï¼Œå¹¶ä¸”æ­£ç¡®é…ç½®äº†GOROOTã€GOPATHã€‚ä¸çŸ¥é“è¿™ä¸¤ä¸ªæ˜¯ä»€ä¹ˆä¸œè¥¿çš„ï¼Œå»ºè®®å…ˆææ˜ç™½ã€‚ 1.Visual Studio Code å®‰è£…Golangæ‰©å±• 2.å®‰è£…Golangæ‰€éœ€æ’ä»¶Ctrl+Shift+P é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶ï¼ˆä¸»è¦æ˜¯ä»£ç æç¤ºï¼Œä»£ç è§„èŒƒç­‰æ’ä»¶ï¼‰ï¼Œå¯å…¨é€‰ ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒï¼Œå°±ç®—ä½ FQï¼Œè¿™ä¸€æ­¥ä¹Ÿä¸ä¸€å®šèƒ½å¤Ÿå®‰è£…æˆåŠŸã€‚ æ‰€ä»¥ä¸€èˆ¬é‡‡å–å¦‚ä¸‹æ–¹å¼ï¼šcd %GOPATH%\\src\\github.com\\golangå¦‚æœsrcç›®å½•ä¸‹é¢æ²¡æœ‰github.com\\golangè¯·è‡ªè¡Œåˆ›å»ºæ‰§è¡Œï¼š 1git clone [https://github.com/golang/tools.git](https://github.com/golang/tools.git) tools å½“ä¸‹è½½å®Œæˆåï¼Œä½ ä¼šå‘ç°%GOPATH%\\src\\github.com\\golangå¤šäº†ä¸€ä¸ªtoolsç›®å½•éœ€è¦æŠŠtoolsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‹·è´åˆ°%GOPATH%\\src\\golang.org\\x\\toolsä¸‹ï¼Œå¦‚æœæ²¡æœ‰è‡ªè¡Œåˆ›å»º ä¸‹é¢å®‰è£…æ— æ³•å®‰è£…çš„æ’ä»¶ï¼ˆå¯ä»¥å…ˆé€šè¿‡vscodeå®‰è£…ï¼Œç„¶åå°†ä¸æˆåŠŸçš„å†æŒ‰ç…§æ­¤æ–¹æ³•å®‰è£…ï¼‰å¼€å§‹å®‰è£…ï¼šåˆ‡æ¢åˆ°GOPATHç›®å½•ä¸‹ï¼Œæ‰§è¡Œç›¸å…³çš„go install å‘½ä»¤go install github.com/mdempsky/gocodego install github.com/uudashr/gopkgs/cmd/gopkgsgo install github.com/fatih/gomodifytagsgo install github.com/haya14busa/goplay/cmd/goplaygo install github.com/derekparker/delve/cmd/dlvgo install github.com/ramya-rao-a/go-outlinego install github.com/acroca/go-symbolsgo install golang.org/x/tools/cmd/gurugo install golang.org/x/tools/cmd/gorenamego install github.com/josharian/implgo install github.com/rogpeppe/godefgo install github.com/sqs/goreturnsgo install github.com/golang/lint/golintgo install github.com/cweill/gotests/gotests ä¸Šé¢çš„åŒ…æœ‰å¯èƒ½å­˜åœ¨æ›´æ–°ï¼Œä»¥å®é™…cloneä¸‹æ¥çš„ä¸ºå‡†ã€‚","link":"/archives/bbb37996.html"},{"title":"ä¸€å¼ å›¾è¯´æ˜Golangçš„å¹¶å‘æ¨¡å‹MPG","text":"Golang å¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼ŒGoroutineæ˜¯Go æœ€å¸å¼•äººçš„åœ°æ–¹ï¼Œé‡‡ç”¨çš„æ˜¯CSPå¹¶å‘é€šä¿¡æ¨¡å‹ã€‚åˆ°åº•Goæ˜¯æ€ä¹ˆæ”¯æŒé«˜å¹¶å‘çš„å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦è¯´ä¸€è¯´Golang çš„MPGæ¨¡å‹ã€‚ M ä»£è¡¨ç€ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ ï¼Œä¸€ä¸ªMå°±æ˜¯ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œgoroutineå°±æ˜¯è·‘åœ¨Mä¹‹ä¸Šçš„ P ä»£è¡¨ç€(Processor)å¤„ç†å™¨ï¼Œ å®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯ç”¨æ¥æ‰§è¡Œgoroutineçš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªå¯è¿è¡Œçš„goroutineé˜Ÿåˆ—ï¼Œå’Œè‡ªç”±çš„goroutineé˜Ÿåˆ—ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰éœ€è¦å®ƒæ¥æ‰§è¡Œçš„goroutineã€‚ G ä»£è¡¨ç€goroutine å®é™…çš„æ•°æ®ç»“æ„ï¼Œå¹¶ç»´æŠ¤è€…goroutine éœ€è¦çš„æ ˆã€ç¨‹åºè®¡æ•°å™¨ä»¥åŠå®ƒæ‰€åœ¨çš„Mç­‰ä¿¡æ¯ã€‚ Sched ä»£è¡¨ç€ä¸€ä¸ªè°ƒåº¦å™¨ å®ƒç»´æŠ¤æœ‰å­˜å‚¨ç©ºé—²çš„Mé˜Ÿåˆ—å’Œç©ºé—²çš„Pé˜Ÿåˆ—ï¼Œå¯è¿è¡Œçš„Gé˜Ÿåˆ—ï¼Œè‡ªç”±çš„Gé˜Ÿåˆ—ä»¥åŠè°ƒåº¦å™¨çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ç­‰ã€‚ ä¸€å¼ å›¾å°±å¯ä»¥è¯´æ˜MPGæ¨¡å‹ï¼š å›¾ä¸­çš„â€œåœŸæ‹¨é¼ â€ä»£è¡¨çš„å°±æ˜¯Mï¼Œâ€œæ¨è½¦â€ä»£è¡¨çš„æ˜¯Pï¼Œâ€œæœ¨å—â€ä»£è¡¨çš„å°±æ˜¯Gã€‚åœ¨è¿™å¼ å›¾å¤–è¿˜å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„â€åœŸæ‹¨é¼ â€œè¿™ä¸ªâ€åœŸæ‹¨é¼ â€œå°±æ˜¯â€åŒ…å·¥å¤´â€œSchedã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°â€œåœŸæ‹¨é¼ â€œä¸åœåœ°å°†â€œæœ¨å—â€œæ¬è¿åˆ°â€œæ¨è½¦â€œä¸Šï¼Œç„¶åæ¨å»çƒ§ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°â€œåœŸæ‹¨é¼ â€œå› ä¸ºç´¯åäº†ï¼Œè€Œå¤„ç†çš„é€Ÿåº¦å˜æ…¢çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™â€œåŒ…å·¥å¤´â€œå°±å‡ºç°äº†ï¼Œâ€œåŒ…å·¥å¤´â€œéå¸¸ä½“è´´çš„å°†è¿™ä¸ªâ€œåœŸæ‹¨é¼ â€œçš„â€œæ¨è½¦â€œäº¤ç»™å…¶ä»–â€œåœŸæ‹¨é¼ â€œå»å¤„ç†ã€‚å¦‚æœä¸€ä¸ªâ€œåœŸæ‹¨é¼ â€œçš„â€œæ¨è½¦â€œé‡Œé¢çš„â€œæœ¨å—â€œè£…çš„å¤ªå¤šï¼Œâ€œåŒ…å·¥å¤´â€œä¹Ÿä¼šè®©å…¶å®ƒçš„â€œåœŸæ‹¨é¼ â€œå»å¸®å¿™æ‹¿å‡ºä¸€äº›æ¥ã€‚å½“â€œåŒ…å·¥å¤´â€œå‘ç°ç°æœ‰çš„â€œåœŸæ‹¨é¼ â€œå·²ç»å¿™ä¸è¿‡æ¥çš„æ—¶å€™ï¼Œå°±å›å»æ‰¾ä¸€äº›æ–°çš„â€œåœŸæ‹¨é¼ â€œè¿‡æ¥ï¼Œå¹¶ç»™ä»–ä»¬é…å‘â€œæ¨è½¦â€œã€‚ç›´åˆ°æ‰€æœ‰çš„â€œæœ¨å—â€œéƒ½çƒ§å®Œä¸ºæ­¢ã€‚ ä¸Šé¢è¯´åˆ°çš„å‡ ç§æƒ…å†µï¼š â€œåœŸæ‹¨é¼ â€ç´¯åäº†ï¼Œå½¢å®¹çš„æ˜¯IOç­‰è€—æ—¶çš„æ“ä½œã€‚ å…¶ä»–â€œåœŸæ‹¨é¼ â€å¸®å¿™ï¼Œå½¢å®¹çš„æ˜¯å·¥ä½œçªƒå–ç®—æ³•ï¼ˆwork stealingï¼‰ï¼Œè¿™ä¸ªç®—æ³•åœ¨å¾ˆå¤šè¯­è¨€ä¸­éƒ½æœ‰åº”ç”¨ï¼Œä¾‹å¦‚Javaä¸­çš„Fork/Foinã€‚ åœ¨Golangä¸­åœŸæ‹¨é¼ é»˜è®¤çš„æ•°é‡æ˜¯CPUçš„æ ¸æ•°ï¼ŒåœŸæ‹¨é¼ é€šè¿‡CSPæ¨¡å‹æ²Ÿé€šã€‚ å‚è€ƒèµ„æ–™ï¼š https://zhuanlan.zhihu.com/p/22352969","link":"/archives/79f4a57c.html"},{"title":"ä¼ é€’å€¼ä¸ä¼ é€’æŒ‡é’ˆ","text":"å‡å¦‚æœ‰ä¸€ä¸ªå˜é‡ï¼š 1var a int = 0 è¿™æ—¶è¦é€šè¿‡ä¸€ä¸ªå‡½æ•°setæ”¹å˜açš„å€¼: 123func set (a int){ a = 1} åœ¨mainå‡½æ•°ä¸­è°ƒç”¨ï¼š 12345func main(){ var a int = 0 set(a) fmt.Println(a)} æœ€ç»ˆaçš„ç»“æœè¿˜æ˜¯0ã€‚è¿™æ˜¯å› ä¸ºä¼ é€’åˆ°setæ–¹æ³•ä¸­çš„æ˜¯aå˜é‡å€¼å¾—æ‹·è´ï¼š 12345678910var a int = 0//å‡è®¾aå˜é‡åœ°å€ä¸º 0xc00005e1b0set(a)//è¿™é‡Œå®é™…ä¼ é€’çš„æ˜¯set(0)//åœ¨setå‡½æ•°ä¸­func set (a int){ //açš„å˜é‡åœ°å€ä¸º0xc00005e1d1ï¼Œæ³¨æ„ä¸å¤–é¢çš„aä¸æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè¿™æ˜¯ä¸¤ä¸ªå˜é‡ //è¿™ä¸€è¡Œæ”¹å˜çš„å®é™…ä¸Šæ˜¯0xc00005e1d1 è¿™ä¸ªåœ°å€çš„å€¼ a = 1} çœ‹çœ‹å†…å­˜ä¸­çš„æƒ…å†µï¼š å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿåœ¨Golangä¸­åªéœ€è¦ä¼ é€’æŒ‡é’ˆå³å¯ï¼Œå¯¹ä¸Šé¢çš„ä»£ç åšå‡ºä¿®æ”¹ï¼š 12345var a int = 0set(&amp;a) //è¿™é‡Œå˜æˆ&amp;afunc set(a *int){//è¿™é‡Œå˜æˆa *int*a = 1//è¿™é‡Œå˜æˆ*a=1} å†æ¥çœ‹çœ‹å†…å­˜ä¸­çš„æƒ…å†µï¼š æ³¨æ„ï¼šä¸€å®šè¦æ˜¯*a =1è¿™æ‰æ„å‘³ç€æ”¹å˜çš„æ˜¯aå¯¹åº”åœ°å€æŒ‡å‘çš„å€¼å¦‚æœæ˜¯a =1é¦–å…ˆè‚¯å®šç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºaå˜é‡éœ€è¦æŒ‡å‘çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè€Œ1ä¸æ˜¯åœ°å€ã€‚å…¶æ¬¡å¦‚æœa(é‡Œé¢çš„)=å¦å¤–ä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆå¤–é¢aè¿˜æ˜¯ä¸ä¼šå˜åŒ–ï¼š ä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ç»†èŠ‚ï¼Œä¸€ä¸ç•™ç¥å°±å‡ºé—®é¢˜ã€‚ åŸåˆ›ï¼Œå¦‚æœ‰é›·åŒçº¯å±å¶åˆã€‚","link":"/archives/ffe16d99.html"},{"title":"è·Ÿç€Bç«™å­¦Golang(admin-ep-saga)","text":"æœ¬æ–‡å®Œå…¨å‡ºäºå­¦ä¹ çš„ç›®çš„ï¼Œå¦‚æœ‰å¼‚è®®ï¼Œè¯·è”ç³»åˆ é™¤ã€‚ ä¹‹å‰XLäº‹ä»¶æµå‡ºçš„ä¼˜ç§€ä»£ç å¤ªå¤šäº†ï¼Œè¿™æ¬¡é€‰æ‹©çš„æ˜¯ä¸€ä¸ªå¥½åƒä¸å…·ä½“ä¸šåŠ¡æ— å…³çš„æ¨¡å—(admin-ep-saga)æ¥è¿›è¡Œå­¦ä¹ ã€‚ é¦–å…ˆçœ‹çœ‹ç›®å½•ç»“æ„ï¼š è¿™ä¹ˆå¤šå…ˆçœ‹å“ªä¸€ä¸ªå‘¢ï¼Ÿåœ¨ä¸çŸ¥é“å…·ä½“æ¯ä¸ªåŒ…æ˜¯å¹²ä»€ä¹ˆçš„æƒ…å†µä¸‹ï¼Œåªå¥½ä¸€ä¸ªä¸€ä¸ªçš„çœ‹äº†ã€‚ å…ˆçœ‹çœ‹apiä¸‹æœ‰äº›ä»€ä¹ˆï¼š ä¸å¾—ä¸è¯´è¿™ä¸ªç›®å½•çš„ç»“æ„ç›¸å½“è§„èŒƒå‘€ï¼Œè™½ç„¶æˆ‘æ²¡æœ‰ç‚¹å¼€å…·ä½“æ–‡ä»¶ï¼Œä½†æ˜¯ä»…ä»…ä»ç›®å½•åå’Œæ–‡ä»¶åå°±èƒ½çŒœå‡ºè¿™ä¸ªç›®å½•ä¸‹æ˜¯å¹²ä»€ä¹ˆçš„ï¼š åº”è¯¥æ˜¯ä½¿ç”¨äº†grpcæ¡†æ¶å’Œprotobufåè®®å®šä¹‰çš„æ¥å£ã€‚è¿™ä¸ªæš‚æ—¶å…ˆæ”¾ä¸€è¾¹ï¼Œæˆ‘éœ€è¦å…ˆæ‰¾åˆ°ç¨‹åºå…¥å£ï¼Œè¿™æ ·æ‰èƒ½ä¸€æ­¥ä¸€æ­¥çš„å­¦ä¹ ä¼˜ç§€ä»£ç æ˜¯å¦‚ä½•ç¼–å†™çš„ã€‚ æ¥ä¸‹æ¥æ‰“å¼€cmd: è¿™ä¸ªç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š BUILDçœ‹ç€åº”è¯¥æ˜¯ç”¨æ¥åšæ„å»ºç”¨çš„ï¼Œè¿™ä¸æ˜¯æˆ‘è¿™æ¬¡å­¦ä¹ çš„é‡ç‚¹ï¼Œå…ˆè·³è¿‡ã€‚ saga-admin-test.toml æˆ‘æ‰“å¼€çœ‹äº†ä¸€çœ¼ï¼Œæ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä»åå­—å¯ä»¥çœ‹å‡ºåº”è¯¥æ˜¯æµ‹è¯•ç”¨çš„é…ç½®é¡¹ï¼Œåé¢è¿˜ä¼šç¢°åˆ°ã€‚ main.go å¦‚æœä¸å‡ºæ„å¤–ï¼Œè¿™ä¸ªåº”è¯¥å°±æ˜¯ç¨‹åºå…¥å£äº†ï¼Œè¿æ°”è¿˜ä¸é”™ï¼Œç¬¬äºŒä¸ªç›®å½•å°±æ‰¾åˆ°äº†å…¥å£ã€‚ æ¥ä¸‹æ¥è¯¦ç»†çš„çœ‹çœ‹main.goåšäº†äº›ä»€ä¹ˆäº‹æƒ…ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/*è¿™é‡Œæˆ‘å¿½ç•¥äº†ä¸€äº›åŒ…å¯¼å…¥ï¼Œä»¥åŠä¸€äº›å¸¸é‡å› ä¸ºå¦‚æœæ¯ä¸ªå¯¼å…¥çš„åŒ…éƒ½è¦çœ‹çš„è¯ï¼Œä¼šè¶Šé™·è¶Šæ·±ã€‚*/func main() { //è§£æå‘½ä»¤è¡Œå‚æ•° flag.Parse() //åˆå§‹åŒ–é…ç½® if err := conf.Init(); err != nil { log.Error(&quot;conf.Init() error(%v)&quot;, err) panic(err) } //åˆå§‹åŒ–Log log.Init(conf.Conf.Log) defer log.Close() log.Info(&quot;saga-admin start&quot;) //å¯åŠ¨ä¸€ä¸ªæœåŠ¡ s := service.New() http.Init(s) //å¯åŠ¨ä¸€ä¸ªgrpcæœåŠ¡ grpcsvr, err := grpc.New(nil, s.Wechat()) if err != nil { panic(err) } //åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º1çš„os.Signalç±»å‹çš„channel c := make(chan os.Signal, 1) //é€šçŸ¥ signal.Notify(c, syscall.SIGHUP, syscall.SIGQUIT, syscall.SIGTERM, syscall.SIGINT) for { //ä»å‰é¢åˆ›å»ºçš„channelä¸­è¯»å–signal si := &lt;-c log.Info(&quot;saga-admin get a signal %s&quot;, si.String()) switch si { //å¦‚æœæ˜¯SIGQUITã€SIGTERMã€SIGINTåˆ™å…³é—­ç›¸å…³æœåŠ¡ï¼Œç„¶åé€€å‡º case syscall.SIGQUIT, syscall.SIGTERM, syscall.SIGINT: grpcsvr.Shutdown(context.Background()) log.Info(&quot;saga-admin exit&quot;) s.Close() time.Sleep(_durationForClosingServer * time.Second) return case syscall.SIGHUP: default: return } }} ç²—ç•¥çš„çœ‹äº†ä¸€ä¸‹ä»£ç åï¼Œå¸¦ç€ç–‘é—®ï¼Œä¸€è¡Œä¸€è¡Œçš„æ¥åˆ†æï¼Œé¦–å…ˆç¬¬ä¸€è¡Œï¼š 1flag.Parse() ä½œä¸ºGolangå°ç™½ï¼Œæˆ‘çŸ¥é“è¿™ä¸ªåº”è¯¥æ˜¯ä½¿ç”¨åœ¨flag.StringVarè¿™æ ·çš„ä»£ç åé¢ï¼Œå®šä¹‰éœ€è¦è·å–çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ ä½†æ˜¯flag.Parse()ä½œä¸ºç¬¬ä¸€è¡Œä»£ç å‰é¢å¹¶æ²¡æœ‰flag.StringVarç±»ä¼¼è¿™æ ·çš„ä»£ç å‘€ï¼Œç„¶åæˆ‘æƒ³åˆ°äº†Golangä¸­initå‡½æ•°çš„ä½œç”¨ã€‚äºæ˜¯æˆ‘å¼€å§‹æ‰¾main.goä¸­å¯¼å…¥çš„å…¶ä»–åŒ…ä¸­æœ‰æ²¡æœ‰å®šä¹‰initå‡½æ•°ï¼Œæœä¸å…¶ç„¶ï¼Œåœ¨saga/conf/conf.goä¸­æˆ‘æ‰¾åˆ°äº†ï¼š 123456func init() { //å®šä¹‰ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œç”¨æ¥æ¥æ”¶é…ç½®æ–‡ä»¶è·¯å¾„ flag.StringVar(&amp;confPath, &quot;conf&quot;, &quot;&quot;, &quot;config path&quot;) //è¿™ä¸ªreloadåé¢å†è®² reload = make(chan bool, 10)} å›åˆ°main.goæ¥çœ‹ä¸‹é¢å‡ è¡Œä»£ç ï¼š 1234if err := conf.Init(); err != nil { log.Error(&quot;conf.Init() error(%v)&quot;, err) panic(err)} å¿½ç•¥é”™è¯¯åˆ¤æ–­ä»¥åŠæ—¥å¿—æ‰“å°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™å‡ è¡Œä¸­æœ€å…³é”®çš„ä»£ç å°±æ˜¯conf.Init()ï¼Œè¿™ä¸ªä»£ç åšäº†äº›ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿæ¥ä¸‹æ¥è¿›å…¥saga/conf/conf.goï¼š 1234567891011121314func Init() (err error) { //åˆ¤æ–­å¦‚æœé…ç½®æ–‡ä»¶çš„è·¯å¾„ä¸ºç©ºï¼Œåˆ™æ‰§è¡ŒconfigCenter()æ–¹æ³• if confPath == &quot;&quot; { return configCenter() } //å¦‚æœé…ç½®æ–‡ä»¶è·¯å¾„ä¸ä¸ºç©ºé€šè¿‡toml.DecodeFile(confPath, &amp;Conf)è§£æé…ç½®åˆ°&amp;Confä¸­ if _, err = toml.DecodeFile(confPath, &amp;Conf); err != nil { log.Error(&quot;toml.DecodeFile(%s) err(%+v)&quot;, confPath, err) return } //å•ç‹¬è§£æTeamInfoç›¸å…³é…ç½® Conf = parseTeamInfo(Conf) return} é¦–å…ˆçœ‹ï¼š 123if confPath == &quot;&quot; { return configCenter()} ä»å‡½æ•°åå¯ä»¥çœ‹å‡ºï¼Œå½“æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„æ˜¯ï¼Œèµ°é…ç½®ä¸­å¿ƒè§£æé…ç½®ã€‚configCenteræˆ‘ä»¬å…ˆæ”¾ä¸€æ”¾ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼š 1234if _, err = toml.DecodeFile(confPath, &amp;Conf); err != nil { log.Error(&quot;toml.DecodeFile(%s) err(%+v)&quot;, confPath, err) return} è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å¿½ç•¥é”™è¯¯å’Œæ—¥å¿—å¤„ç†ï¼Œå¯ä»¥çœ‹åˆ°è¿™å‡ è¡Œå…³é”®ä»£ç æ˜¯toml.DecodeFile(confPath, &amp;Conf)ï¼Œ tomlè¿™ä¸ªçœ‹ç€æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Œä¹‹å‰åœ¨cmdåŒ…ä¸‹æˆ‘ä»¬çœ‹åˆ°è¿‡ä¸€ä¸ªè¿™ä¸ªæ ¼å¼çš„æ–‡ä»¶saga-admin-test.tomlï¼Œè¿™æ˜¯ä¸€ä¸ªç”±GitHubè”åˆåˆ›å§‹äººTom Preston-Werner æå‡ºçš„æç®€é…ç½®æ–‡ä»¶æ ¼å¼ã€‚å„ä¸ªè¯­è¨€éƒ½æœ‰ç›¸å…³å®ç°ï¼ŒBZè¿™é‡Œä½¿ç”¨çš„æ˜¯github.com/BurntSushi/tomlè¿™ä¸ªåº“ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œè¿™å‡ è¡Œä»£ç æ— éå°±æ˜¯è§£æé…ç½®æ–‡ä»¶ã€‚ ç»§ç»­å¾€ä¸‹çœ‹: 1Conf = parseTeamInfo(Conf) å•ç‹¬ç”¨äº†ä¸€ä¸ªæ–¹æ³•æ¥è§£æTeamInfoè¯´æ˜tomlæ ‡å‡†çš„DecodeFileè§£æä¸äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆäº‹æƒ…ï¼š 123456789101112131415161718192021222324252627282930313233343536/*è¿™ä¸ªæ–¹æ³•åšçš„äº‹æƒ…æ¯”è¾ƒç®€å•ï¼Œç›´æ¥é‡‡ç”¨æ³¨é‡Šçš„æ–¹æ³•è®²è§£*/func parseTeamInfo(c *Config) *Config { /* strings.Fieldsï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¿™ä¸ªæ˜¯æ ¹æ®å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼æˆ–è€…ä¸€äº›ä¸ªç‰¹æ®Šç¬¦å·æ¥æ‹†åˆ†å­—ç¬¦ä¸²ä¸ºArrayçš„æ–¹æ³•ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹ä¹‹å‰æåˆ°çš„saga-admin-test.tomlä¸­c.Property.Department å®šä¹‰çš„æ˜¯ä»€ä¹ˆï¼š [property.department] label = &quot;ä¸»ç«™ ç›´æ’­ bplus å¼€æ”¾å¹³å° åˆ›ä½œä¸­å¿ƒ å•†ä¸šäº§å“ æ•°æ®ä¸­å¿ƒ è§†é¢‘äº‘ æ¸¸æˆ ç«é¸Ÿ&quot; value = &quot;mainsite live bplus openplatform creative advertising datacenter videocloud game firebird&quot; */ DeLabel := strings.Fields(c.Property.Department.Label) DeValue := strings.Fields(c.Property.Department.Value) for i := 0; i &lt; len(DeLabel); i++ { /* æ‰€ä»¥è¿™å‡ è¡Œä»£ç ï¼Œå¾ˆæ˜¾è€Œæ˜“è§äº†ï¼Œå°±æ˜¯å°†ä¸Šè¿°çš„label å’Œvalueç»„åˆæˆkey-valueçš„å½¢å¼ç„¶åappendåˆ°å¦å¤–ä¸€ä¸ª(DeInfo)Arrayä¸­ */ info := &amp;model.PairKey{ Label: DeLabel[i], Value: DeValue[i], } c.Property.DeInfo = append(c.Property.DeInfo, info) } //ä¸‹é¢å‡ è¡Œä»£ç åŒä¸Šï¼Œå°±ä¸åœ¨èµ˜è¿° buLabel := strings.Fields(c.Property.Business.Label) buValue := strings.Fields(c.Property.Business.Value) for i := 0; i &lt; len(buLabel); i++ { info := &amp;model.PairKey{ Label: buLabel[i], Value: buValue[i], } c.Property.BuInfo = append(c.Property.BuInfo, info) } return c} è¯è¯´ï¼Œä¸Šé¢çš„Businesså’ŒDepartmentå¤„ç†è¿‡ç¨‹ä¸€æ ·ï¼Œä¸ºå•¥ä¸å°†è¿™ä¸ªè¿‡ç¨‹æå–æˆä¸€ä¸ªå‡½æ•°å‘¢ï¼Ÿæ¥è‡ªå°ç™½çš„ç–‘é—®ã€‚ è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è·³è¿‡ä¸€ä¸ªå‡½æ•°configCenter()å—ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ï¼š 1234567891011121314151617181920212223242526func configCenter() (err error) { //è¿™é‡Œçš„confåº”è¯¥æ˜¯BZä¸€ä¸ªå…¬å…±ç»„ä»¶ï¼Œè¿™é‡Œåšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªé…ç½®ä¸­å¿ƒçš„client if client, err = conf.New(); err != nil { panic(err) } //è¿™é‡Œè°ƒç”¨äº†loadå‡½æ•° if err = load(); err != nil { return } //è¿™é‡Œåº”è¯¥æ˜¯æ·»åŠ äº†ä¸€ä¸ªé…ç½®ä¸­å¿ƒçš„ç›‘å¬ client.WatchAll() //èµ·ä¸€ä¸ªgoroute go func() { //è·å–äº‹ä»¶ï¼Œå¦‚æœé…ç½®ä¸­å¿ƒçš„é…ç½®å­˜åœ¨ä¿®æ”¹é‡æ–°è°ƒç”¨loadå‡½æ•° for range client.Event() { log.Info(&quot;config reload&quot;) if load() != nil { log.Error(&quot;config reload error (%v)&quot;, err) } else { //loadæˆåŠŸå¾€reload chanå†™å…¥ä¸€ä¸ªæ•°æ®ï¼Œè¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œç­‰åé¢å†è¯´ reload &lt;- true } } }() return} å¿½ç•¥å…¶å®ƒä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢å®ç°é…ç½®ä¸­å¿ƒé…ç½®åŠ è½½çš„åº”è¯¥æ˜¯loadå‡½æ•°ï¼š 123456789101112131415161718192021func load() (err error) { //å®šä¹‰ä¸€ç»„å±€éƒ¨å˜é‡ var ( s string ok bool tmpConf *Config ) //é€šè¿‡é…ç½®ä¸­å¿ƒçš„clientè·å–é…ç½®ï¼Œè¿™é‡Œçš„_configkeyæ˜¯å¸¸é‡ï¼š&quot;saga-admin.toml&quot; if s, ok = client.Value(_configKey); !ok { err = errors.Errorf(&quot;load config center error [%s]&quot;, _configKey) return } //è·Ÿä¹‹å‰ä¸€æ ·é€šè¿‡tomlè§£æé…ç½® if _, err = toml.Decode(s, &amp;tmpConf); err != nil { err = errors.Wrapf(err, &quot;could not decode config err(%+v)&quot;, err) return } //è·Ÿä¹‹å‰ä¸€æ ·å•ç‹¬è§£æTeamInfo Conf = parseTeamInfo(tmpConf) return} åˆ°è¿™é‡Œæˆ‘ä»¬å·®ä¸å¤šåˆšåˆšçœ‹å®Œmain.goä¸­conf.Init()çš„è°ƒç”¨ï¼Œæ¥ä¸‹æ¥å›åˆ°main.goï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼š æˆ‘ä»¬è·³è¿‡Logçš„åˆå§‹åŒ–ï¼Œç›´æ¥çœ‹ï¼š 1234//è°ƒç”¨/saga/serviceä¸­çš„Newå‡½æ•°s := service.New()//è°ƒç”¨/saga/httpä¸­çš„Initå‡½æ•°http.Init(s) è·³è½¬åˆ°Newå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬çœ‹çœ‹åšäº†äº›ä»€ä¹ˆï¼š 1234567891011121314151617181920212223242526272829303132333435func New() (s *Service) { var ( err error ) s = &amp;Service{ dao: dao.New(), cron: cron.New(), } if err = s.cron.AddFunc(conf.Conf.Property.SyncProject.CheckCron, s.collectprojectproc); err != nil { panic(err) } if err = s.cron.AddFunc(conf.Conf.Property.Git.CheckCron, s.alertProjectPipelineProc); err != nil { panic(err) } if err = s.cron.AddFunc(conf.Conf.Property.SyncData.CheckCron, s.syncdataproc); err != nil { panic(err) } if err = s.cron.AddFunc(conf.Conf.Property.SyncData.CheckCronAll, s.syncalldataproc); err != nil { panic(err) } if err = s.cron.AddFunc(conf.Conf.Property.SyncData.CheckCronWeek, s.syncweekdataproc); err != nil { panic(err) } s.cron.Start() // init gitlab client s.gitlab = gitlab.New(conf.Conf.Property.Gitlab.API, conf.Conf.Property.Gitlab.Token) // init online gitlab client s.git = gitlab.New(conf.Conf.Property.Git.API, conf.Conf.Property.Git.Token) // init wechat client s.wechat = wechat.New(s.dao) return} ä¸Šé¢ä»£ç å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨åšå®šæ—¶ä»»åŠ¡çš„åˆ›å»ºï¼Œcronä½¿ç”¨çš„æ˜¯&quot;github.com/robfig/cron&quot;è¿™ä¸ªåº“ï¼Œæˆ‘ä»¬æŒ‘ä¸€ä¸ªçœ‹çœ‹ï¼š 123if err = s.cron.AddFunc(conf.Conf.Property.SyncProject.CheckCron, s.collectprojectproc); err != nil { panic(err)} conf.Conf.Property.SyncProject.CheckCron æ˜¯é…ç½®ä¸­çš„cronè¡¨è¾¾å¼ï¼Œåœ¨saga-admin-test.tomlä¸­çœ‹åˆ°æ˜¯ * */15 * * * ? ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªä»»åŠ¡æ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚ s.collectprojectproc æ˜¯è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹è¿™ä¸ªä»»åŠ¡åšäº†ä»€ä¹ˆäº‹æƒ…ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142func (s *Service) collectprojectproc() { var err error //å¯ä»¥çœ‹åˆ°å®é™…è°ƒç”¨çš„æ˜¯CollectProjectï¼Œè¿™é‡Œçš„context.TODO()è¡¨ç¤ºcontextè¿˜æœªå®ç°ï¼Œè¿™é‡Œä»…ä»…ç”¨ä½œå ä½ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ if err = s.CollectProject(context.TODO()); err != nil { log.Error(&quot;s.CollectProject err (%+v)&quot;, err) }}func (s *Service) CollectProject(c context.Context) (err error) { //è¿™æ˜¯ä¸€ç»„å±€éƒ¨å˜é‡ var ( projects []*gitlab.Project total = 0 page = 1 ) log.Info(&quot;Collect Project start&quot;) //è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªmagic numberï¼Œ1000 for page &lt;= 1000 { //è°ƒç”¨gitlabæ¥å£è·å–æŒ‡å®šé¡µç çš„é¡¹ç›®åˆ—è¡¨ï¼Œè¿™é‡Œçš„s.gitlabæ˜¯åœ¨service.New()ä¸­å®ä¾‹åŒ–çš„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ã€‚ if projects, err = s.gitlab.ListProjects(page); err != nil { return } num := len(projects) if num &lt;= 0 { break } total = total + num //å°†è·å–åˆ°çš„é¡¹ç›®ä¿å­˜åˆ°dbä¸­ï¼Œè¿™ä¸ªinsertDBå°±ä¸å±•å¼€è®²äº†ï¼Œè¿™é‡Œé¢åšçš„å¤§æ¦‚å°±æ˜¯saveOrUpdateçš„äº‹æƒ…ã€‚ for _, p := range projects { if err = s.insertDB(p); err != nil { return } } page = page + 1 } log.Info(&quot;Collect Project end, find %d projects&quot;, total) return} åœ¨service.New()ä¸­å…¶ä»–çš„cronä¹Ÿå·®ä¸å¤šæ˜¯åšç€ç±»ä¼¼çš„äº‹æƒ…ï¼Œç”±äºå¤ªå¤šï¼Œå°±ä¸åœ¨è¿™é‡Œä¸€ä¸€å±•å¼€ã€‚åˆšåˆšè¯´åˆ° s.gitlab.ListProjects(page);æˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼Œæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çœ‹è¿™é‡Œï¼š 12345678s.cron.Start()// init gitlab clients.gitlab = gitlab.New(conf.Conf.Property.Gitlab.API, conf.Conf.Property.Gitlab.Token)// init online gitlab clients.git = gitlab.New(conf.Conf.Property.Git.API, conf.Conf.Property.Git.Token)// init wechat clients.wechat = wechat.New(s.dao) å¯ä»¥å‘ç°cronçš„startæ˜¯åœ¨gitlabã€gitã€wechatå®ä¾‹åŒ–ä¹‹å‰ï¼Œè€Œcronç›¸å…³çš„ä»»åŠ¡ä¸­åˆä¾èµ–äº†è¿™äº›clientï¼Œé‚£æœ‰æ²¡æœ‰è¿™ä¹ˆä¸€ç§å¯èƒ½ï¼šè¿™ä¸ªç¨‹åºå¯åŠ¨çš„æ—¶å€™æ­£å¥½ç¢°ä¸Šcronè§¦å‘ï¼Œè€Œgitlabï¼Œwechatè¿™äº›clientè¿˜æ²¡æœ‰å®ä¾‹åŒ–ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰å¯èƒ½å‡ºç°panicï¼Ÿå½“ç„¶äº†ï¼Œè¿™ä¸ªå¯èƒ½æ€§å¾ˆå°ã€‚ è®©æˆ‘ä»¬å†æ¬¡å›åˆ°main.goä¸­ï¼š 12//åˆå§‹åŒ–ä¸€ä¸ªhttpæœåŠ¡http.Init(s) è¿›å…¥Init: 123456789101112131415// Init initfunc Init(s *service.Service) { //è¿™ä¸ªsrvå¾ˆé‡è¦ï¼Œè¿™æ˜¯åœ¨ä¸Šé¢service.New()æœ€åè¿”å›çš„å®ä¾‹ï¼Œåœ¨åé¢ç»å¸¸ç”¨åˆ° srv = s //è¿™ä¸ªpermitæ˜¯go-common/library/net/http/blademaster ä¸­çš„ç»„ä»¶ï¼Œåº”è¯¥æ˜¯ç”¨æ¥åšæ¥å£è®¤è¯çš„ authSvc = permit.New2(nil) //ä¸‹é¢å°±æ˜¯å¯åŠ¨http engineäº†ï¼Œè¿™ä¸ªengineå°±æ˜¯ä¸Šé¢æåˆ°çš„è¿™ä¸ªblademaster engine := bm.DefaultServer(conf.Conf.BM) engine.Ping(ping) initRouter(engine) if err := engine.Start(); err != nil { log.Error(&quot;engine.Start error(%v)&quot;, err) panic(err) }} ç”±äºè¿™ä¸ªhttpæœåŠ¡æ˜¯ä¾èµ–çš„BZå…¬å…±çš„ç»„ä»¶ï¼Œå°±ä¸ç»§ç»­æ·±å…¥äº†ï¼Œæˆ‘æ€•å‡ºä¸æ¥äº†ã€‚æˆ‘ä»¬çœ‹çœ‹initRouterä¸­å®šä¹‰çš„Routerï¼Œç”±äºå¤ªé•¿ï¼Œæˆ‘åªé€‰æ‹©å¼€å§‹ä¸€æ®µï¼š 123456789version := e.Group(&quot;/ep/admin/saga/v1&quot;, authSvc.Permit2(&quot;&quot;)) { project := version.Group(&quot;/projects&quot;) { project.GET(&quot;/favorite&quot;, favoriteProjects) project.POST(&quot;/favorite/edit&quot;, editFavorite) project.GET(&quot;/common&quot;, queryCommonProjects) }... è¿™å°±æ˜¯å¾ˆå¸¸è§çš„url-mappingäº†ï¼Œè¿™é‡Œçš„favoriteProjectsã€editFavoriteã€queryCommonProjects éƒ½æ˜¯å®šä¹‰åœ¨å½“å‰httpåŒ…ä¸‹çš„å‡½æ•°ï¼Œæˆ‘ä»¬é€‰æ‹©favoriteProjectsçœ‹ä¸‹ï¼š 12345678910111213141516171819func favoriteProjects(ctx *bm.Context) { var ( req = &amp;model.Pagination{} err error userName string ) //è¿™é‡Œåº”è¯¥æ˜¯è§£æè¯·æ±‚å‚æ•°åˆ°reqå˜é‡ä¸­ if err = ctx.Bind(req); err != nil { ctx.JSON(nil, err) return } //è¿™é‡Œæ˜¯è°ƒç”¨å‡½æ•°è·å–å½“å‰ç”¨æˆ·å if userName, err = getUsername(ctx); err != nil { ctx.JSON(nil, err) return } //æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œæœ€ç»ˆå›åˆ°äº†srvä¸Šï¼Œè°ƒç”¨äº†å®é™…çš„å¤„ç†æ–¹æ³•ã€‚è¿™é‡Œçš„FavoriteProjectså®é™…å°±æ˜¯é€šè¿‡dbæŸ¥è¯¢å½“å‰ç”¨æˆ·æ”¶è—çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°±ä¸ç»§ç»­æ·±å…¥äº†ã€‚ ctx.JSON(srv.FavoriteProjects(ctx, req, userName))} ä¸Šé¢çš„æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆåœ¨httpåŒ…ä¸­å°†å‚æ•°ç­‰ä¸€äº›ä¿¡æ¯è¿›è¡Œè§£æï¼Œæœ€åè°ƒç”¨åˆ°äº†serviceä¸­çš„æ–¹æ³•ã€‚è¿™ä¸ªå°±å¾ˆåƒJavaä¸­æµè¡Œçš„å†™æ³•ï¼šä»Controlleråˆ°Serviceï¼Œç¬¦åˆMVCåˆ†å±‚çš„æ€æƒ³ã€‚ æœ€åè¿˜æœ‰ä¸€ä¸ªgrpcï¼Œæˆ‘å¤§æ¦‚çœ‹äº†ä¸‹ï¼Œåº”è¯¥æ˜¯ç”¨æ¥ä¼ä¸šå¾®ä¿¡å‘æ¶ˆæ¯çš„ã€‚ æ€»ç»“ï¼š è¿™åº”è¯¥æ˜¯ç”¨æ¥åšgitlab ciå‘Šè­¦ä¹‹ç±»çš„projectï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªprojectå±‚æ¬¡å¾ˆåˆ†æ˜ï¼Œä»£ç çœ‹è¿‡å»ä¸€ç›®äº†ç„¶ã€‚ æœ€åï¼Œä¹‹å‰è¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼Œå°±æ˜¯reloadè¿™ä¸ªå˜é‡ï¼Œåœ¨åˆå§‹åŒ–æ—¶æ˜¯æœ‰é•¿åº¦çš„ï¼š 1reload = make(chan bool, 10) é•¿åº¦ä¸º10ï¼Œåœ¨æ¯æ¬¡é…ç½®æ–‡ä»¶ä¿®æ”¹åï¼Œgoroute watchåˆ°eventä¹‹åä¼šå¾€è¿™ä¸ªchannelå†™å…¥ä¸€ä¸ªtrueï¼Œä½†æ˜¯çœ‹å®Œæ•´ä¸ªä»£ç ä¹‹åï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°æœ‰åœ°æ–¹ä»è¿™ä¸ªchannelå–å‡ºæ•°æ®ï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘æ¼çœ‹äº†ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¿®æ”¹10æ¬¡ä¹‹åï¼Œè¿™ä¸ªåœ°æ–¹ï¼š 1reload &lt;- true å°±ä¼šé˜»å¡ï¼Œä»è€Œå¯¼è‡´è¿™ä¸ªgorouteæ— å“åº”ï¼Ÿ ç å­—ä¸æ˜“ï¼Œä¸”è½¬ä¸”çæƒœã€‚","link":"/archives/f11de5dd.html"},{"title":"Pythonä¸­çš„ä¸€äº›è¯­æ³•ç³–","text":"ä¸‰å…ƒè¿ç®—ç¬¦ 1c = a if a&gt;b else b åœ¨Javaä¸­çš„å†™æ³•ä¸ºï¼š 1c = a&gt;b ? a : b è€ŒGolangåˆ™æ˜¯ä¸æ”¯æŒ å¾ªç¯ Pythonä¸­å¸¸ç”¨çš„whileã€for Javaä¸­æ”¯æŒwhileã€doâ€¦whileã€forã€foreach Golang ä¸‡èƒ½çš„forï¼Œfor range in â€‹ è¯­å¥ Pythonè¿˜æ”¯æŒå¾ªç¯elseï¼Œwhile â€¦else ã€for â€¦else ,è¡¨ç¤ºå¾ªç¯æ­£å¸¸ç»“æŸåæ‰§è¡Œçš„ä»£ç å—ã€‚ åˆ‡ç‰‡(slice) 123str1 = &quot;abcdefg&quot;print(str1[0])print(str1[0:3]) Golangç±»ä¼¼ï¼ŒJavaä¸­æ²¡æœ‰åˆ‡ç‰‡çš„æ¦‚å¿µ å¤åˆ¶è¿ç®— 12345print('a'*5) # aaaaab = [1]print(b*5) # [1, 1, 1, 1, 1]å¤åˆ¶è¿ç®—ä¸æ”¯æŒå­—å…¸dict","link":"/archives/d5c5a3fa.html"},{"title":"Pythonå®ç°å›¾åƒæ–‡å­—è¯†åˆ«","text":"ä½¿ç”¨çš„å®é™…æ˜¯tesseractè¿™ä¸ªOCRå¼•æ“ã€‚å¦‚æœè¯†åˆ«çš„æœ‰ä¸­æ–‡ï¼Œéœ€è¦æ·»åŠ ä¸­æ–‡çš„chi_sim.traineddataã€‚ æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯windowsï¼Œä¸‹è½½æ˜¯Windows Installer made with MinGW-w64ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­æ³¨æ„æœ‰ä¸ªé€‰é¡¹ï¼Œå±•å¼€å¯ä»¥çœ‹åˆ°å„ç§è¯­è¨€çš„æ•°æ®ï¼Œå‹¾ä¸Šchi_sim.traineddataå³å¯ã€‚ æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯Python3.7ï¼Œé¦–å…ˆå®‰è£…å¿…å¤‡çš„ä¾èµ– 12pip install pytesseractpip install pillow æˆ‘ä½¿ç”¨çš„Pycharmï¼Œç›´æ¥Alt+Enterå¯¼å…¥ã€‚ å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š 123456import pytesseractfrom PIL import Imageimage = Image.open(&quot;../pic/c.png&quot;)code = pytesseract.image_to_string(image,lang=&quot;chi_sim&quot;,config=&quot;-psm 6&quot;)print(code) ç›´æ¥è¿è¡Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œä¼šæç¤ºtesseractè¯†åˆ«ä¸äº†ï¼Œæˆ‘çœ‹åˆ°å…¶ä»–äººéƒ½æ˜¯ç›´æ¥ä¿®æ”¹pytesseractæºæ–‡ä»¶ 1tesseract_cmd = 'C:\\Program Files (x86)\\Tesseract-OCR\\tesseract.exe' æˆ‘è¿™é‡Œçš„åšæ³•æ˜¯å°†C:\\Program Files (x86)\\Tesseract-OCR\\æ·»åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­ã€‚ æœ‰å¯èƒ½ä¸ä¼šç”Ÿæ•ˆï¼Œéœ€è¦é‡å¯Pycharmã€‚ OCRè¯†åˆ«ä¸æ˜¯100%å‡†ç¡®ï¼Œæˆ‘è¿™é‡Œæµ‹è¯•çš„ç»“æœæ˜¯ï¼Œå¯èƒ½ä¼šå¤šæˆ–è€…å°‘ä¸€äº›å­—ç¬¦ã€‚ å‚è€ƒèµ„æ–™ï¼š https://blog.csdn.net/github_33304260/article/details/79155154","link":"/archives/99680cca.html"},{"title":"ä½¿ç”¨Pythonè„šæœ¬è‡ªåŠ¨è®¢é¤","text":"å…¬å¸å‘˜å·¥é¤é€‰ç”¨çš„ç¾é¤å¹³å°ï¼Œä½†æ˜¯ç»å¸¸ç”±äºå¤ªå¿™å¿˜è®°ç‚¹é¤ï¼Œå¯¼è‡´é¥¿ç€è‚šå­åŠ ç­ã€‚åæ­£èœå“çš„å¯é€‰é¡¹æ¯”è¾ƒå°‘ï¼Œæƒ³ç€è¦æ˜¯èƒ½è‡ªåŠ¨ç‚¹ä¸€ä¸ªå°±å¥½äº†ã€‚äºæ˜¯æœ‰äº†ä»¥ä¸‹è„šæœ¬ã€‚ æ¥å£åˆ†æå‚æ•°åˆ†æè‡ªåŠ¨ç‚¹é¤æ— éå°±æ˜¯æ¨¡æ‹Ÿäººçš„è¡Œä¸ºï¼Œè‡ªåŠ¨è¯·æ±‚ä¸€äº›å…³é”®æ¥å£ã€‚äºæ˜¯åˆ†æäº†ä¸€ä¸‹ç¾é¤ç½‘çš„webç«¯æ¥å£ï¼Œå‘ç°å…³é”®æ¥å£å¦‚ä¸‹ï¼š è·å–èœå•æ¥å£ï¼šhttps://meican.com/preorder/api/v2.1/restaurants/show?tabUniqueId=???&amp;targetTime=???&amp;restaurantUniqueId=???&amp;client_id=???&amp;client_secret=??? ä¸‹å•æ¥å£ï¼šhttps://meican.com/preorder/api/v2.1/orders/add?client_id=???&amp;client_secret=??? æœ‰äº†æ¥å£åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥å¼€å§‹åˆ†æã€å°è¯•æ¥å£çš„å“ªäº›å‚æ•°æ˜¯é™æ€çš„ï¼Œå“ªäº›æ˜¯åŠ¨æ€çš„ã€‚ é¦–å…ˆé€šè¿‡å¤šä¸ªè¯·æ±‚ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œä¸Šè¿°ä¸¤ä¸ªå…³é”®æ¥å£ä¸­çš„client_idã€client_secretæ˜¯é™æ€çš„å›ºå®šä¸å˜çš„ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯webç«¯çš„èº«ä»½ã€‚ ç„¶åç¬¬ä¸€ä¸ªæ¥å£ä¸­çš„restaurantUniqueIdå¯ä»¥å‘ç°å¤šæ¬¡è¯·æ±‚å¹¶æ²¡å‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸”é€šè¿‡å‘½ååŸºæœ¬å¯ä»¥å¾—å‡ºï¼Œåº”è¯¥æ˜¯ç±»ä¼¼ä¼ä¸šé£Ÿå ‚åœ¨ç¾é¤é‚£è¾¹çš„ä¸€ä¸ªå”¯ä¸€idã€‚ ç¬¬ä¸€ä¸ªæ¥å£ä¸­çš„targetTimeï¼Œé€šè¿‡æ•°æ®æ ·ä¾‹åˆ†æï¼Œä»¥åŠå¯¹æ¯”å…¶ä»–éå…³é”®æ¥å£æ•°æ®ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œåº”è¯¥æ˜¯ä¼ä¸šåœ¨ç¾é¤ç½‘è®¾ç½®çš„ç‚¹é¤æˆªæ­¢æ—¶é—´ã€‚ä¾‹å¦‚æˆ‘ä»¬å…¬å¸é…ç½®çš„æ˜¯æ—©é¤6:00æˆªæ­¢ç‚¹é¤ï¼Œé‚£ä¹ˆè¿™ä¸ªtargetTimeå°±æ˜¯ yyyy-MM-dd +06:00ã€‚ æœ€åç¬¬ä¸€ä¸ªæ¥å£è¿˜æœ‰ä¸€ä¸ªå‚æ•°tabUniqueId ï¼Œæœ€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯å®Œå…¨é™æ€çš„ï¼Œåé¢é€šè¿‡è¸©å‘å¾—çŸ¥ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯ä»£è¡¨æ¯ä¸€é¤çš„å”¯ä¸€idï¼Œæ—©ã€ä¸­ã€æ™šå‡ä¸ä¸€æ ·ã€‚ å“åº”åˆ†æç¬¬ä¸€ä¸ªæ¥å£æ‹¿åˆ°çš„å…³é”®å“åº”å¦‚ä¸‹(å¿½ç•¥äº†ä¸€äº›)ï¼š 1234567891011121314151617181920212223242526272829&quot;dishList&quot;: [ { &quot;dishSectionId&quot;: xxxx, &quot;id&quot;: xxxx, &quot;isSection&quot;: true, &quot;name&quot;: &quot;æ™šé¤&quot;, &quot;originalPriceInCent&quot;: 0, &quot;priceInCent&quot;: 0, &quot;priceString&quot;: &quot;&quot; }, { &quot;dishSectionId&quot;: xxxx, &quot;id&quot;: y1, &quot;isSection&quot;: false, &quot;name&quot;: &quot;å‘¨äº” æ°´é¥º&amp;èŠ±ç”Ÿç±³æ‹Œé»„ç“œ&quot;, &quot;originalPriceInCent&quot;: 1100, &quot;priceInCent&quot;: 1100, &quot;priceString&quot;: &quot;11&quot; }, { &quot;dishSectionId&quot;: xxxx, &quot;id&quot;: y2, &quot;isSection&quot;: false, &quot;name&quot;: &quot;å‘¨äº” Aå¥—é¤ å°é¸¡ç‚–è˜‘è‡&amp;å¹²ç‚¸å°é»„é±¼&amp;è‚‰æ²«è±†è…&amp;åœŸè±†ç‰‡ç‚’è‚‰&quot;, &quot;originalPriceInCent&quot;: 1100, &quot;priceInCent&quot;: 1100, &quot;priceString&quot;: &quot;11&quot; } ] è¿™ä¸ªéœ€è¦ç»“åˆç¬¬äºŒä¸ªæ¥å£å‚æ•°æ¥åˆ†æï¼Œå“ªäº›æ˜¯æœ‰ç”¨çš„ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªæ¥å£çš„è¯·æ±‚å‚æ•°å¦‚ä¸‹ï¼š 1{&quot;corpAddressRemark&quot;:&quot;&quot;,&quot;corpAddressUniqueId&quot;:&quot;xxxx&quot;,&quot;order&quot;:orderP,&quot;remarks&quot;:remarkP,&quot;tabUniqueId&quot;:uu['tab'],&quot;targetTime&quot;:targetTime,&quot;userAddressUniqueId&quot;:&quot;xxxx&quot;} å…¶ä¸­targetTimeåº”è¯¥ä¸ç¬¬ä¸€ä¸ªæ¥å£çš„ä¸€è‡´ã€‚remarksæ²¡æ‡‚åˆ°åº•æœ‰æ²¡æœ‰ç”¨ï¼ŒtabUniqueIdè·Ÿä¸Šä¸ªæ¥å£ä¹Ÿæ˜¯ä¸€è‡´ã€‚æœ€åorderæ˜¯è·Ÿç¬¬ä¸€ä¸ªæ¥å£å“åº”æœ‰å…³çš„ï¼Œå¦‚ä¸‹ï¼š 1[{&quot;count&quot;:1,&quot;dishId&quot;:y1}] å…¶ä¸­dishIdå°±æ˜¯ç¬¬ä¸€ä¸ªæ¥å£dishListä¸­çš„idã€‚å¥½äº†å…³é”®ä¿¡æ¯æœ‰äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹ç¼–å†™è„šæœ¬äº†ã€‚ è„šæœ¬ç¼–å†™è„šæœ¬å°±ä¸åºŸè¯äº†ï¼Œç”±äºPythonä¸æ˜¯ä¸»åŠ›è¯­è¨€ï¼Œå¹³æ—¶å†™çš„å°‘ï¼Œè€Œä¸”ç”±äºæ˜¯æ‘¸é±¼æ—¶é—´ğŸŸæ¥å†™çš„ï¼Œæ‰€ä»¥å†™çš„æ¯”è¾ƒç²—ç³™å’Œä¸è§„èŒƒã€‚ğŸ¤¦â€â™‚ï¸ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869#!/usr/bin/python# -*- coding: UTF-8 -*-import timeimport sysimport requestsimport jsonimport datetimetomorrow = (datetime.datetime.now()+datetime.timedelta(days=1)).strftime(&quot;%Y-%m-%d&quot;)print(&quot;tomorrow:&quot;, tomorrow)headers={}headers1={}headers2={}headers3={}user1={'headers':headers,'phone':'xxxxx','tab':''}user2={'headers':headers1,'phone':'xxxxx','tab':''}user3={'headers':headers2,'phone':'xxxxx','tab':''}user4={'headers':headers3,'phone':'xxxxx','tab':''}users=[user1,user2,user3,user4]add_url=&quot;https://meican.com/preorder/api/v2.1/orders/add?client_id=xxxx&amp;client_secret=xxxx&quot;count=0for i in range(0, len(users)): try: count=count+1 uu = users[i] url = &quot;https://meican.com/preorder/api/v2.1/restaurants/show?tabUniqueId=&quot;+uu['tab']+&quot;&amp;targetTime=&quot; + tomorrow + &quot;+06:00&amp;restaurantUniqueId=xxxx&amp;client_id=xxxx&amp;client_secret=xxxx&quot; r = requests.get(url, headers=uu['headers']) data = json.loads(r.content) if 'dishList' in data: bData = data['dishList'][1]['name'] aAata = data['dishList'][2]['name'] if count==1: # å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥ print(&quot;å‘é€šçŸ¥&quot;) botData=json.dumps({&quot;msgtype&quot;:&quot;text&quot;,&quot;text&quot;:{&quot;content&quot;:&quot;æ˜æ—¥æ—©é¤ï¼š\\r\\n&quot;+bData+&quot;\\r\\n&quot;+aAata,&quot;mentioned_list&quot;:[&quot;@all&quot;]}}) botR = requests.post(url='https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx', data=botData, headers={&quot;Content-Type&quot;:&quot;application/json;charset=utf-8&quot;}) print(botR.content) print(&quot;menu: &quot;, aAata, bData) bDataId=str(data['dishList'][1]['id']) targetTime = tomorrow + ' 06:00'; orderP = &quot;[{\\&quot;count\\&quot;:1,\\&quot;dishId\\&quot;:&quot;+bDataId+&quot;}]&quot; remarkP = &quot;[{\\&quot;dishId\\&quot;:\\&quot;&quot;+bDataId+&quot;\\&quot;,\\&quot;remark\\&quot;:\\&quot;\\&quot;}]&quot; postData = {&quot;corpAddressRemark&quot;:&quot;&quot;,&quot;corpAddressUniqueId&quot;:&quot;xxxxx&quot;,&quot;order&quot;:orderP,&quot;remarks&quot;:remarkP,&quot;tabUniqueId&quot;:uu['tab'],&quot;targetTime&quot;:targetTime,&quot;userAddressUniqueId&quot;:&quot;xxxxx&quot;} print('å½“å‰ç”¨æˆ·:',uu['phone']) ar = requests.post(url=add_url, data=postData, headers=uu['headers']) print(ar.content) data2 = json.loads(ar.content) if 'status' in data2: if 'SUCCESSFUL'==data2['status']: botData2 = json.dumps({&quot;msgtype&quot;: &quot;text&quot;, &quot;text&quot;: {&quot;content&quot;: &quot;å·²ä¸ºå°Šè´µçš„ä¼šå‘˜ç‚¹é¤æˆåŠŸ&quot;, &quot;mentioned_mobile_list&quot;: [uu['phone']]}}) print(&quot;æˆåŠŸé€šçŸ¥ï¼š&quot;, botData2) # å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥ botR2 = requests.post(url='https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxx',data=botData2, headers={&quot;Content-Type&quot;: &quot;application/json;charset=utf-8&quot;}) print(botR2.content) print(&quot;ç‚¹é¤æˆåŠŸï¼&quot;) else: print(&quot;ç‚¹é¤å¤±è´¥ï¼&quot;) else: print(&quot;ç‚¹é¤å¤±è´¥ï¼&quot;) else: print('æ— å¯ç”¨ä¿¡æ¯:', data) except Exception: print('err')print(&quot;Good bye!&quot;) å®šæ—¶ä»»åŠ¡æœ€åç”±äºæœ¬äººç”¨çš„Macï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨äº†launchctlã€‚ å®šä¹‰ä»»åŠ¡é¦–å…ˆè¿›å…¥~/Library/LaunchAgents,åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶com.meican.plist: 123456789101112131415161718192021222324252627282930313233&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt; &lt;dict&gt; &lt;key&gt;Label&lt;/key&gt; &lt;string&gt;com.meican.plist&lt;/string&gt; &lt;key&gt;ProgramArguments&lt;/key&gt; &lt;array&gt; &lt;string&gt;/Users/zhaojingzhou/workspace/sources/meican.sh&lt;/string&gt; &lt;/array&gt; &lt;key&gt;StartCalendarInterval&lt;/key&gt; &lt;dict&gt; &lt;key&gt;Minute&lt;/key&gt; &lt;integer&gt;00&lt;/integer&gt; &lt;key&gt;Hour&lt;/key&gt; &lt;integer&gt;16&lt;/integer&gt; &lt;!-- &lt;key&gt;Day&lt;/key&gt; &lt;integer&gt;*&lt;/integer&gt; --&gt; &lt;key&gt;Weekday&lt;/key&gt; &lt;array&gt; &lt;integer&gt;1&lt;/integer&gt; &lt;integer&gt;2&lt;/integer&gt; &lt;integer&gt;3&lt;/integer&gt; &lt;integer&gt;4&lt;/integer&gt; &lt;integer&gt;7&lt;/integer&gt; &lt;/array&gt; &lt;/dict&gt; &lt;key&gt;StandardOutPath&lt;/key&gt; &lt;string&gt;/Users/zhaojingzhou/workspace/sources/stdout&lt;/string&gt; &lt;key&gt;StandardErrorPath&lt;/key&gt; &lt;string&gt;/Users/zhaojingzhou/workspace/sources/error&lt;/string&gt; &lt;/dict&gt;&lt;/plist&gt; ProgramArgumentsä»»åŠ¡æ‰§è¡Œçš„è„šæœ¬ï¼Œæˆ‘è¿™é‡Œç”¨shell å°†ä¸Šé¢å†™çš„Pythonè„šæœ¬åŒ…äº†ä¸€ä¸‹ï¼š 1/usr/local/bin/python3.9 /Users/zhaojingzhou/workspace/sources/meican.py è„šæœ¬ä¸€å®šè¦ç»™æ‰§è¡Œæƒé™å•Š 1chmod 775 xxx.sh StartCalendarIntervalæˆ‘è¿™é‡Œå®šä¹‰çš„æ˜¯å‘¨1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ7ä¸‹åˆ16:00æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯0ï¼Œ7éƒ½ä»£è¡¨å‘¨æ—¥ã€‚ OutPathStandardOutPathï¼ŒStandardErrorPath ä»£è¡¨æ ‡å‡†è¾“å‡ºï¼Œå’Œé”™è¯¯è¾“å‡ºï¼Œç”¨æ¥æ’æŸ¥è„šæœ¬é”™è¯¯ã€‚ åŠ è½½ä»»åŠ¡æ‰€æœ‰çš„çš„éƒ½å‡†å¤‡å¥½äº†ä¹‹åæ‰§è¡Œï¼š 1launchctl load -w com.meican.plist å¦‚æœä¿®æ”¹äº†ä»»åŠ¡å®šä¹‰éœ€è¦unloadä¹‹ååœ¨loadï¼Œunloadï¼š 1launchctl unload com.meican.plist å¦‚æœæƒ³ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼š 1launchctl start com.meican.plist æœ€åç›®å‰è·‘äº†ä¸€æ®µæ—¶é—´ä¸‹æ¥ï¼Œæ„Ÿè§‰è¿˜è¡Œï¼Œå†ä¹Ÿä¸ç”¨é¥¿è‚šå­å•¦ã€‚ã€‚ã€‚ å¸Œæœ›ç¾é¤åˆ«è°ƒæ•´æ¥å£ã€‚ã€‚ã€‚ ç å­—ä¸æ˜“ï¼Œä¸”çœ‹ä¸”çæƒœ","link":"/archives/5f3e8b9e.html"},{"title":"åŒºå—é“¾ã€æ¯”ç‰¹å¸å­¦ä¹ ç¬”è®°","text":"å­¦ä¹ åŒºå—é“¾ã€æ¯”ç‰¹å¸éœ€è¦å…ˆææ˜ç™½hashã€éå¯¹ç§°åŠ å¯†ã€BASE64/58ã€‚æ¯”ç‰¹å¸ä¸­ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µå°±æ˜¯UTXOï¼ˆæœªèŠ±è´¹è¾“å‡ºï¼‰ï¼Œä½ æœ‰å¤šå°‘ä¸ªæ¯”ç‰¹å¸å°±æ˜¯æ ¹æ®è¿™ä¸ªå¾—æ¥çš„ã€‚ æŒ–çŸ¿å¾—æ¥çš„æ¯”ç‰¹å¸ç§°ä¸ºcoinbaseï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¼šäº§ç”Ÿä¸€ç¬”äº¤æ˜“çš„ï¼Œä½†æ˜¯è¿™ä¸ªäº¤æ˜“æ²¡æœ‰è¾“å…¥ï¼Œåªæœ‰è¾“å‡ºã€‚æ¯”ç‰¹å¸ä¼šäº§ç”Ÿåˆ†å‰ï¼Œæœ‰å¯èƒ½æ˜¯ä¸´æ—¶åˆ†å‰ï¼Œå› ä¸ºä¸¤ä¸ªäººåŒæ—¶è®¡ç®—å‡ºäº†Nonceï¼ŒåŒæ—¶æ‰“åŒ…äº†åŒºå—ï¼Œè¿™æ—¶å°±è¦çœ‹å“ªä¸€ä¸ªé“¾æ¡å¢é•¿çš„æ›´é•¿ï¼Œå½“è¶…è¿‡6ä¸ªåŒºå—æ—¶ï¼Œå¦å¤–ä¸€ä¸ªåŒºå—å°±ä½œåºŸï¼Œæ‰€æœ‰çš„äº¤æ˜“å°±å¤±æ•ˆã€‚æ‰€ä»¥åˆ«äººç»™ä½ è½¬æ¯”ç‰¹å¸æ—¶ï¼Œéœ€è¦ç­‰å¾…è‡³å°‘6ä¸ªåŒºå—çš„ç¡®è®¤ï¼Œå¦è€…ä½ ä¼šäººè´¢ä¸¤ç©ºã€‚æ¯”ç‰¹å¸ä¹Ÿä¼šäº§ç”Ÿç¡¬åˆ†å‰ï¼Œå°±æ˜¯åŒæ—¶å­˜åœ¨ä¸¤ä¸ªé“¾æ¡ï¼Œè¿™ä¸ªä¸ä¸´æ—¶åˆ†å‰ä¸åŒï¼Œè¿™ä¸¤ä¸ªåˆ†å‰è°ä¹Ÿä¸èƒ½å¹²æ‰è°ï¼Œæ¯”å¦‚æ–°çš„åˆ†å‰BCCï¼ŒBCHã€‚äº§ç”Ÿç¡¬åˆ†å‰çš„åŸå› å…¶å®æ˜¯äººä¸ºçš„ï¼Œå› ä¸ºç°åœ¨ç»´æŠ¤æ¯”ç‰¹å¸çš„æ˜¯core å›¢é˜Ÿï¼Œcoreå›¢é˜Ÿæå‡ºçš„ä¸€äº›æ„è§ï¼ˆéš”ç¦»è§è¯ã€é—ªç”µç½‘ç»œï¼‰ï¼Œå¾—ä¸åˆ°æ—·å·¥å›¢é˜Ÿçš„è®¤å¯ï¼Œæˆ–è€…è¯´æ˜¯åˆ©ç›Šé—®é¢˜ã€‚äºæ˜¯å°±äº§ç”Ÿäº†ç»“æ„ä¸åŒçš„åŒºå—ï¼Œè¿™æ ·å°±åˆ†å‰äº†ã€‚æŒ–çŸ¿ï¼ˆpowï¼‰çš„è¿‡ç¨‹å…¶å®æ˜¯è®¡ç®—ä¸€é“é¢˜:ç›®æ ‡å€¼=æœ€å¤§ç›®æ ‡å€¼/éš¾åº¦å€¼ é€šè¿‡è°ƒæ•´éš¾åº¦å€¼æ¥è°ƒæ•´ç›®æ ‡å€¼çš„è®¡ç®—éš¾åº¦ éœ€ç”¨é€šè¿‡hashè¿ç®—ï¼Œä»¥åŠéšæœºæ”¹å˜çš„Nonceæ¥è®¡ç®—å‡ºä¸€ä¸ªhashå€¼ï¼Œä½¿è¿™ä¸ªå€¼å°äºç›®æ ‡å€¼ã€‚","link":"/archives/df4f5590.html"},{"title":"æ¯”ç‰¹å¸ã€åŒºå—é“¾ã€æŒ–çŸ¿æ˜¯ä»€ä¹ˆ","text":"æ¯”ç‰¹å¸è·Ÿäººæ°‘å¸ç¾å…ƒä¸ä¸€æ ·ï¼Œ ä¸æ˜¯é“¶è¡Œå¡é‡Œçš„ä¸€ä¸ªæ•°å­—ã€‚è€Œæ˜¯é€šè¿‡æ¯”ç‰¹å¸è´¦æœ¬è¿½æº¯è€Œæ¥ã€‚ ä½ å»æŸ¥è¯¢é“¶è¡Œå¡ä½™é¢ï¼ŒATMä¸Šå¾ˆå¯èƒ½æ˜¾ç¤ºï¼šä½™é¢5å…ƒã€‚è€Œè¦çœ‹æ¯”ç‰¹å¸ä½™é¢ï¼Œéœ€è¦ç¿»å¼€æ¯”ç‰¹å¸è´¦æœ¬ï¼šå¼ ä¸‰è½¬ç»™æå››5ä¸ªæ¯”ç‰¹å¸ï¼Œæå››è½¬ç»™ç‹äº”3ä¸ªæ¯”ç‰¹å¸ï¼Œç‹äº”è½¬ç»™ä½ 1ä¸ªæ¯”ç‰¹å¸ï¼Œäºæ˜¯ä½ æœ‰1ä¸ªæ¯”ç‰¹å¸ã€‚ é“¶è¡Œå¡é‡Œçš„ä½™é¢æ˜¯å¦å¯ä¿¡å®Œå…¨å–å†³äºä½ å¯¹é“¶è¡Œçš„ä¿¡ä»»ã€‚æ¯”ç‰¹å¸ä½™é¢æ˜¯ç»è¿‡è¿½æº¯æ¯æ¬¡åŠ è§£å¯†äº¤æ˜“è€Œå¾—æ¥ï¼Œå…·æœ‰æé«˜çš„å¯ä¿¡åº¦ã€‚ è½¬è´¦ä¿¡æ¯é‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆå…¬é’¥ã€ç§é’¥ï¼‰ï¼Œæ¯æ¬¡è½¬è´¦çš„ä¿¡æ¯å¤§æ¦‚åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼ˆä»¥æå››å‘ç‹äº”è½¬è´¦ä¸ºä¾‹ï¼‰ï¼šæå››çš„ä¿¡æ¯æ‘˜è¦è¢«ç§é’¥åŠ å¯†åçš„äº§ç‰©ã€ç‹äº”çš„å…¬é’¥ã€è½¬è´¦é‡‘é¢ã€è´¦å•ç¼–å·ã€è½¬è´¦é‡‘é¢æ¥æºçš„è´¦å•ç¼–å· ä¸ºä»€ä¹ˆè¦åŒ…å«ä»¥ä¸Šä¿¡æ¯å‘¢ï¼Ÿæ˜¯ä¿è¯äº†äº¤æ˜“çš„å¯è¿½æº¯æ€§å’ŒçœŸå®æ€§ã€‚é€šè¿‡æ¥æºçš„è´¦å•ç¼–å·ï¼Œå¯ä»¥æ‰¾åˆ°æå››çš„å…¬é’¥ï¼ˆå¼ ä¸‰å‘æå››è½¬è´¦ï¼‰ç„¶åéªŒè¯ï¼šï¼ˆäº¤æ˜“ä¿¡æ¯ï¼‰â€”â€”&gt;ï¼ˆäº¤æ˜“ä¿¡æ¯æ‘˜è¦ï¼‰â€”â€”&gt;ï¼ˆæå››ç§é’¥åŠ å¯†åçš„æ‘˜è¦ç»“æœï¼‰ 1.(æå››å…¬é’¥è§£å¯†ç§é’¥åŠ å¯†åçš„æ‘˜è¦ç»“æœ) å¾—åˆ°äº¤æ˜“ä¿¡æ¯æ‘˜è¦ 2.ï¼ˆäº¤æ˜“ä¿¡æ¯ï¼‰â€”â€”&gt;ï¼ˆäº¤æ˜“ä¿¡æ¯æ‘˜è¦ï¼‰å¯¹æ¯”è§£å¯†ç»“æœç‹äº”çš„å…¬é’¥å¯¹åº”çš„ç§é’¥åªæœ‰ä»–è‡ªå·±çŸ¥æ™“ã€‚æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒåˆ«äººè·å–è¿™ç¬”è½¬è´¦é‡‘é¢ã€‚ï¼ˆä¸‹æ¬¡ç‹äº”è½¬è´¦ç»™ä½ æ—¶ï¼Œä»–ä¹Ÿéœ€è¦å¸¦ä¸Šä»–çš„ç§é’¥åŠ å¯†åçš„æ‘˜è¦ç»“æœæ‰èƒ½éªŒè¯é€šè¿‡ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨è¿™ç¬”é’± è½¬è´¦ä¸€èˆ¬é€šè¿‡æ¯”ç‰¹å¸é’±åŒ…å®Œæˆï¼Œæ‰€æœ‰è£…æœ‰æ¯”ç‰¹å¸é’±åŒ…çš„è®¾å¤‡ï¼Œéƒ½å¯ä»¥æ”¶åˆ°è¿™ç¬”è½¬è´¦ä¿¡æ¯ï¼Œéƒ½çº·çº·å¼€å§‹è®°å½•ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªè®¾å¤‡èƒ½è®°å½•æˆåŠŸï¼ˆPowï¼‰ï¼Œèƒ½æˆåŠŸè®°å½•è¿™ç¬”è½¬è´¦ä¿¡æ¯ï¼Œå°±ä¼šè·å¾—æ¯”ç‰¹å¸çš„å¥–åŠ±ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæŒ–çŸ¿ã€‚è¿™ä¹Ÿæ˜¯æ¯”ç‰¹å¸çš„æ¥æºï¼ˆä¸äººæ°‘å¸æ˜¯å¤®è¡Œå‘è¡Œçš„ä¸åŒï¼‰ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹æ‰ç®—æˆåŠŸè®°å½•å‘¢ï¼ˆPowï¼‰ï¼Ÿè¿™ä¸€ç¬”ç¬”çš„è½¬è´¦è®°å½•ï¼Œéœ€è¦å­˜å‚¨èµ·æ¥ï¼Œå­˜åˆ°å“ªé‡Œå‘¢ï¼Ÿå›ç­”æ˜¯åŒºå—ä¸­ã€‚åŒºå—å°±æ˜¯ä¸€ä¸ªåŒ…å«äº†å¤šç¬”è½¬è´¦è®°å½•çš„å®¹å™¨ã€‚æ¯ä¸ªåŒºå—éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„æ ‡å¿—(HASH)ï¼Œä»¥åŠå‰ä¸€ä¸ªåŒºå—çš„æ ‡å¿—(HASH)ã€‚è¿™é‡Œçš„HASHæ˜¯é€šè¿‡ä¸€ä¸ªæå…¶éš¾çš„è®¡ç®—å¾—æ¥ï¼ˆé€šè¿‡è´¦å•ä¿¡æ¯ä»¥åŠä¸€ä¸ªNonceå¾—åˆ°ä¸€ä¸ªç¬¦åˆè®¾å®šè§„åˆ™çš„HASHï¼‰ã€‚åŒºå—å¯ä»¥å½¢è±¡çš„ç†è§£ä¸ºä¸€ä¸ªçº¸è´¨è´¦æœ¬çš„ä¸€é¡µã€‚å‰ä¸€ä¸ªåŒºå—å¯ä»¥ç†è§£ä¸ºå‰ä¸€é¡µã€‚è¿™ä¸€å—ä¸€å—çš„è¿èµ·æ¥å°±æ˜¯åŒºå—é“¾ï¼ˆè´¦æœ¬ï¼‰ã€‚ ä¸ªäººæµ…æ˜¾çš„ç†è§£ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯çš„åœ°æ–¹ã€‚","link":"/archives/838301b8.html"},{"title":"PDFè½¬EPUBå·¥å…·åˆ†äº«","text":"é¦–å…ˆè¯´ä¸‹ï¼Œæœ‰ç»æµæ¡ä»¶çš„è¿˜æ˜¯å»ºè®®è´­ä¹°çº¸è´¨ä¹¦é˜…è¯»å•Šï¼ å‰è¨€ç°åœ¨ç½‘ä¸Šå¾ˆå¤šèµ„æ–™éƒ½æ˜¯æœ‰åœ¨çº¿ç‰ˆçš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆ°ä¸€äº›ç½‘ç»œä¸å¥½çš„åœ°æ–¹å°±å¾ˆå°´å°¬äº†ã€‚ä¸è¿‡åŒæ—¶å¤§ä½¬ä»¬ä¹Ÿä¼šæä¾›PDFç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸ªäººè§‰å¾—PDFçš„é˜…è¯»ä½“éªŒå®åœ¨å¤ªå·®äº†ã€‚ æˆ‘ä¸€ç›´è§‰å¾—epubæ ¼å¼çš„é˜…è¯»ä½“éªŒä¸é”™ï¼Œé€‚é…å„ç§æ˜¾ç¤ºè®¾å¤‡ã€‚å…³äºepubæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥çœ‹çœ‹wikiä¸Šçš„ä»‹ç»ï¼š æ€»ä¹‹å€¼å¾—ä¸€è¯•ã€‚ä½†æ˜¯èµ„æ–™éƒ½æ˜¯pdfçš„ï¼Œæ‰¾ä¸åˆ°epubæ ¼å¼çš„å’‹åŠå‘¢ï¼Ÿ å¯ä»¥â€œç™¾åº¦â€æœç´¢ä¸€ä¸‹â€œpdfè½¬epubâ€ï¼Œç»“æœå¦‚ä¸‹ï¼š æ¨èä¸€ä¸ªä¸ªå°è¯•ä¸‹æ¥ï¼Œå‘ç°ä»¥ä¸‹ä¸¤ä¸ªè¿˜ç®—èƒ½ç”¨ï¼š https://www.online-convert.com/ é€‰æ‹©Convert to ePubå³å¯ã€‚ https://convertio.co/zh/pdf-epub/ ç›´æ¥é€‰æ‹©æ–‡ä»¶å³å¯ã€‚ æ•ˆæœPDF ePub æˆ‘æ˜¯ç”¨Macè‡ªå¸¦çš„â€œå›¾ä¹¦â€Appæ‰“å¼€çš„ï¼Œå¯ä»¥æ ‡æ³¨é‡ç‚¹ï¼Œåšç¬”è®°ç­‰ã€‚å¦å¤–è¿˜å¯ä»¥åŒæ­¥è¿›åº¦ã€é‡ç‚¹ã€ç¬”è®°åˆ°iPhoneä¸Šã€‚ é—®é¢˜å¦‚æœæ˜¯æ‰«æç‰ˆçš„PDFï¼Œé‚£ä¹ˆè½¬æ¢æ•ˆæœæ˜¯å¾ˆå·®çš„ï¼ŒåŸºæœ¬ä¸Šè·Ÿpdfä¸€æ ·ã€‚ æœ€åå¦‚æœæœ‰æ—¶é—´å¯ä»¥ç ”ç©¶ä¸€ä¸‹ï¼Œè‡ªå·±å†™ä¸ªè½¬æ¢å·¥å…·ã€‚","link":"/archives/760ddd3b.html"},{"title":"TypeSafe Config","text":"Typesafeçš„Configåº“ï¼Œçº¯Javaå†™æˆã€é›¶å¤–éƒ¨ä¾èµ–ã€ä»£ç ç²¾ç®€ã€åŠŸèƒ½çµæ´»ã€APIå‹å¥½ã€‚æ”¯æŒJava propertiesã€JSONã€JSONè¶…é›†æ ¼å¼HOCONä»¥åŠç¯å¢ƒå˜é‡ã€‚å®ƒä¹Ÿæ˜¯Akkaçš„é…ç½®ç®¡ç†åº“. é»˜è®¤åŠ è½½classpathä¸‹çš„application.conf,application.jsonå’Œapplication.propertiesæ–‡ä»¶ã€‚é€šè¿‡ConfigFactory.load()åŠ è½½ ä¹Ÿå¯æŒ‡å®šæ–‡ä»¶åœ°å€ï¼š 1ConfigFactory.load(confFileName) åˆå¹¶å¤šä¸ªæ–‡ä»¶ï¼š 12345ConfigfirstConfig=ConfigFactory.load(&quot;test1.conf&quot;);ConfigsecondConfig=ConfigFactory.load(&quot;test2.conf&quot;);//a.withFallback(b)aå’Œbåˆå¹¶ï¼Œå¦‚æœæœ‰ç›¸åŒçš„keyï¼Œä»¥aä¸ºå‡†ConfigfinalConfig=firstConfig.withOnlyPath(&quot;host&quot;).withFallback(secondConfig); æœªå®Œå¾…ç»­â€¦â€¦","link":"/archives/585899c0.html"},{"title":"AbstractQueuedSynchronizer-éšè®°","text":"å¸¸è§è¯¯åŒºï¼šLockï¼ˆä¹è§‚é”ï¼Œè‡ªæ—‹é”ï¼‰ä¸€å®šæ¯”Synchronizedå¥½ã€‚è¿™ä¸ªè¯´æ³•æ˜¯ä¸æ­£ç¡®çš„ã€‚è‡ªæ—‹é”é€‚åˆé”ç«äº‰ä¸æ˜¯å¾ˆæ¿€çƒˆçš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› ä¸ºå…¶ä½¿ç”¨äº†æ­»å¾ªç¯ï¼Œæ¯”è¾ƒæ¶ˆè€—CPUèµ„æºã€‚Synchronizedåœ¨JDK1.5åè¿›è¡Œäº†ä¼˜åŒ–ï¼Œé€šè¿‡é”å‡çº§(åå‘é”-&gt;è½»é‡çº§é”(é€šå¸¸æ˜¯è‡ªæ—‹)-&gt;é‡é‡çº§é”) æå‡äº†æ€§èƒ½ã€‚","link":"/archives/5e0e6b4c.html"},{"title":"CAPä¸ªäººæµ…æ˜¾çš„ç†è§£","text":"åˆ†å¸ƒå¼ç³»ç»Ÿä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œäºæ˜¯æˆ‘ä»¬å°†æ•°æ®åšäº†å¤šä¸ªå‰¯æœ¬æ”¾åœ¨äº†ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€Partition tolerance(åˆ†åŒºè€å—æ€§)ï¼š å¯é æ€§ï¼‰ã€‘ï¼Œå¹¶ä¸”ä¿æŒæ›´æ–°å¤šä¸ªå‰¯æœ¬ï¼Œä½†æ˜¯åœ¨æ›´æ–°å‰¯æœ¬çš„æ—¶å€™ï¼Œå¯èƒ½ç”±äºç½‘ç»œç­‰è¯¸å¤šåŸå› å¯¼è‡´å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬æ— æ³•æ›´æ–°ï¼Œæ­¤æ—¶å°±é¢ä¸´äº†ä¸€ä¸ªé€‰æ‹©ï¼šæ›´æ–°å‰©ä¸‹çš„å‰¯æœ¬ï¼Ÿor éƒ½ä¸æ›´æ–°äº†ï¼Ÿé€‰æ‹©æ›´æ–°å‰©ä¸‹çš„å‰¯æœ¬ï¼Œåˆ™æ˜¯é€‰æ‹©äº†ã€Availability(å¯ç”¨æ€§)ï¼š å¥½çš„å“åº”æ€§èƒ½ã€‘ï¼Œæ­¤ç±»å‹ç³»ç»Ÿä¿è¯äº†APã€‚é€‰æ‹©éƒ½ä¸æ›´æ–°äº†ï¼Œåˆ™æ˜¯é€‰æ‹©äº†ã€Consistency(ä¸€è‡´æ€§)ï¼š æ•°æ®ä¸€è‡´æ›´æ–°ã€‘ï¼Œæ­¤ç±»å‹ç³»ç»Ÿä¿è¯äº†CPã€‚ ä»¥ä¸Šä¸ºä¸ªäººç‰‡é¢ä¸”æµ…æ˜¾çš„ç†è§£ã€‚","link":"/archives/e8ec77e1.html"},{"title":"CountDownLatch-æ³¨æ„äº‹é¡¹","text":"å…ˆçœ‹ä¸€æ®µä»£ç ï¼š 1234567891011121314CountDownLatch countDownLatch = new CountDownLatch(params.size()); try { params.forEach(regionNameMapping -&gt; { CompletableFuture.runAsync(() -&gt; { Region region = this.getRegionById(regionNameMapping.getRegionId()); regionNameMapping.getRegionNameConsumer().accept(region.getName()); countDownLatch.countDown(); }); }); countDownLatch.await(); } catch (Exception e) { log.error(e.getMessage(), e); } ä¸Šé¢çš„ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œå¹¶å‘å»æ‰§è¡ŒgetRegionByIdè¿™ä¸ªæ–¹æ³•ã€‚ç„¶åawaitç­‰å¾…ç»“æœã€‚ä½†æ˜¯é‡Œé¢æœ‰ä¸€ä¸ªéšæ‚£ï¼Œå½“regionæŸ¥å‡ºæ¥ä¸ºnullæ—¶ï¼Œä¼šå‡ºç°NPEï¼Œå°±ä¼šå¯¼è‡´countDown()æ— æ³•è¢«æ‰§è¡Œï¼Œäºæ˜¯ç¨‹åºå°±ä¸€ç›´é˜»å¡åœ¨ 12countDownLatch.await(); æ­£ç¡®çš„å†™æ³•ï¼š 12345678910111213141516CountDownLatch countDownLatch = new CountDownLatch(params.size()); try { params.forEach(regionNameMapping -&gt; { CompletableFuture.runAsync(() -&gt; { try{ Region region = this.getRegionById(regionNameMapping.getRegionId()); regionNameMapping.getRegionNameConsumer().accept(region.getName()); }finally{ countDownLatch.countDown(); } }); }); countDownLatch.await(3,TimeUnit.SECONDS); } catch (Exception e) { log.error(e.getMessage(), e); } æ·»åŠ tryã€finallyï¼Œä¿è¯æœ€ç»ˆé”ä¼šè¢«é‡Šæ”¾ï¼Œä»¥åŠè®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œé¿å…ç¨‹åºæŒ‚æ‰ã€‚ æ‰€æœ‰ä½¿ç”¨AbstractQueuedSynchronizerå®ç°çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚Lockï¼ŒSemaphoreã€ç­‰éƒ½åº”è¯¥å¦‚æ­¤ã€‚","link":"/archives/20c5f4b2.html"},{"title":"Dubboè°ƒç”¨è¶…æ—¶é‚£äº›äº‹å„¿","text":"å…¶å®ä¹‹å‰å¾ˆæ—©å°±çœ‹è¿‡dubboæºç ä¸­å…³äºè¶…æ—¶è¿™éƒ¨åˆ†çš„å¤„ç†é€»è¾‘ï¼Œä½†æ˜¯æ²¡æœ‰è®°å½•ä¸‹æ¥ï¼Œæœ€è¿‘åœ¨æŸè„‰ä¸Šçœ‹åˆ°æœ‰äººé—®äº†è¿™ä¸ªé—®é¢˜ï¼Œæƒ³ç€å†å›é¡¾ä¸€ä¸‹ã€‚ å¼€å§‹ä»dubboçš„è¯·æ±‚å¼€å§‹ï¼Œçœ‹çœ‹dubboï¼ˆ2.6.6ï¼‰åœ¨è¶…æ—¶è¿™å—æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š 1234567891011121314151617181920com.alibaba.dubbo.remoting.exchange.support.header.HeaderExchangeChannel#request(java.lang.Object, int) @Override public ResponseFuture request(Object request, int timeout) throws RemotingException { if (closed) { throw new RemotingException(this.getLocalAddress(), null, &quot;Failed to send request &quot; + request + &quot;, cause: The channel &quot; + this + &quot; is closed!&quot;); } // create request. Request req = new Request(); req.setVersion(Version.getProtocolVersion()); req.setTwoWay(true); req.setData(request); DefaultFuture future = new DefaultFuture(channel, req, timeout); try { channel.send(req); } catch (RemotingException e) { future.cancel(); throw e; } return future; } DefaultFutureä»è¿”å›å€¼ResponseFutureç±»å‹å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼ˆä¸ç­‰åŒäºDubboçš„å¼‚æ­¥è°ƒç”¨ï¼‰ã€‚é‚£ä¹ˆè°ƒç”¨è¶…æ—¶çš„å…³é”®å¯ä»¥ä»ResponseFutureæ¥çœ‹ï¼š 12345678910public interface ResponseFuture { Object get() throws RemotingException; Object get(int timeoutInMillis) throws RemotingException; void setCallback(ResponseCallback callback); boolean isDone();} å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä»requestæ–¹æ³•å¯ä»¥å¾—çŸ¥å®ç°ç±»æ˜¯DefaultFutureï¼Œä»æ„é€ å‡½æ•°å…¥æ‰‹ï¼š 123456789 public DefaultFuture(Channel channel, Request request, int timeout) { this.channel = channel; this.request = request; this.id = request.getId(); this.timeout = timeout &gt; 0 ? timeout : channel.getUrl().getPositiveParameter(Constants.TIMEOUT_KEY, Constants.DEFAULT_TIMEOUT); // put into waiting map. FUTURES.put(id, this); CHANNELS.put(id, channel);} å¯ä»¥å¾—çŸ¥æ¯ä¸€ä¸ªDefaultFutureéƒ½æœ‰ä¸€ä¸ªidï¼Œå¹¶ä¸”ç­‰äºrequestIdï¼Œtimeoutæ˜¯ä»urlä¸­è·å–çš„é…ç½®ï¼Œæ²¡æœ‰æ—¶é»˜è®¤1000msã€‚ ä»ä»£ç çš„æ³¨é‡Šå¯ä»¥çœ‹åˆ°FUTURESè¿™ä¸ªmapåº”è¯¥å°±æ˜¯å…³é”®ï¼Œæ˜¯ä¸€ä¸ªwaiting mapã€‚ DefaultFutureä¸­è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼š 12345678910111213141516public static void received(Channel channel, Response response) { try { DefaultFuture future = FUTURES.remove(response.getId()); if (future != null) { future.doReceived(response); } else { logger.warn(&quot;The timeout response finally returned at &quot; + (new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;).format(new Date())) + &quot;, response &quot; + response + (channel == null ? &quot;&quot; : &quot;, channel: &quot; + channel.getLocalAddress() + &quot; -&gt; &quot; + channel.getRemoteAddress())); } } finally { CHANNELS.remove(response.getId()); } } å¯ä»¥çœ‹åˆ°è°ƒç”¨çš„åœ°æ–¹ä¸ºï¼š com.alibaba.dubbo.remoting.exchange.support.header.HeaderExchangeHandler#received 12345678@Override public void received(Channel channel, Object message) throws RemotingException { //çœç•¥ä¸€äº›ä»£ç  } else if (message instanceof Response) { handleResponse(channel, (Response) message); //çœç•¥ä¸€äº›ä»£ç  } } com.alibaba.dubbo.remoting.exchange.support.header.HeaderExchangeHandler#handleResponse 12345static void handleResponse(Channel channel, Response response) throws RemotingException { if (response != null &amp;&amp; !response.isHeartbeat()) { DefaultFuture.received(channel, response); } } å›åˆ°DefaultFuture.receivedï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡Response idä»FUTURESä¸­æ‹¿äº†ä¸€ä¸ªDefaultFutureå‡ºæ¥ï¼Œç„¶åè°ƒç”¨äº†doReceivedæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´Response idå’ŒRequest id ç›¸åŒã€‚ç»“ä¸‹æ¥çœ‹çœ‹doReceivedåšäº†ä»€ä¹ˆï¼š 1234567891011121314private void doReceived(Response res) { lock.lock(); try { response = res; if (done != null) { done.signal(); } } finally { lock.unlock(); } if (callback != null) { invokeCallback(callback); } } é¦–å…ˆæ˜¯åŠ é”ï¼Œç„¶åé€šè¿‡å”¤é†’äº†é˜»å¡åœ¨Conditionä¸Šçš„çº¿ç¨‹ã€‚çœ‹çœ‹ä»€ä¹ˆåœ°æ–¹ä¼šé˜»å¡åœ¨doneè¿™ä¸ªæ¡ä»¶ä¸Šï¼š 1234567891011121314151617181920212223242526@Override public Object get(int timeout) throws RemotingException { if (timeout &lt;= 0) { timeout = Constants.DEFAULT_TIMEOUT; } if (!isDone()) { long start = System.currentTimeMillis(); lock.lock(); try { while (!isDone()) { done.await(timeout, TimeUnit.MILLISECONDS); if (isDone() || System.currentTimeMillis() - start &gt; timeout) { break; } } } catch (InterruptedException e) { throw new RuntimeException(e); } finally { lock.unlock(); } if (!isDone()) { throw new TimeoutException(sent &gt; 0, channel, getTimeoutMessage(false)); } } return returnFromResponse(); } æ˜¯getæ–¹æ³•ï¼Œgetæ–¹æ³•ç¡®å®åœ¨requestè¯·æ±‚åè¢«è°ƒç”¨ï¼š 1(Result) currentClient.request(inv, timeout).get() å¯ä»¥çœ‹åˆ°getæ–¹æ³•çš„å¤§è‡´é€»è¾‘ä¸ºï¼Œå…ˆè·å–é”ï¼Œç„¶åå¾ªç¯åˆ¤æ–­isDoneï¼Œå¹¶é˜»å¡ç­‰åˆ°æ¡ä»¶ï¼Œå½“æ¡ä»¶è¶…æ—¶ï¼Œå¦‚æœä»»åŠ¡å®Œæˆï¼Œæˆ–è€…è¶…è¿‡timeoutç»“æŸå¾ªç¯ï¼Œæ¥ç€åˆ¤æ–­isDoneï¼Œå¦‚æœè¶…æ—¶æŠ›å‡ºTimeoutExceptionã€‚å¹¶ä¸”é€šè¿‡sentï¼ˆrequestè¯·æ±‚æ—¶é—´ï¼‰æ˜¯å¦&gt;0ï¼ˆï¼‰æ¥åˆ¤æ–­æ˜¯clientSideè¿˜æ˜¯serverSideè¶…æ—¶ã€‚ isDoneé€»è¾‘å¦‚ä¸‹ï¼š 1234@Override public boolean isDone() { return response != null; } å¦‚æœæ˜¯æ­£å¸¸Responseï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¶…æ—¶çš„ç°è±¡ï¼Œå¯ä»¥çœ‹åˆ°getæ–¹æ³•æœ€åè°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼š 12345678910111213private Object returnFromResponse() throws RemotingException { Response res = response; if (res == null) { throw new IllegalStateException(&quot;response cannot be null&quot;); } if (res.getStatus() == Response.OK) { return res.getResult(); } if (res.getStatus() == Response.CLIENT_TIMEOUT || res.getStatus() == Response.SERVER_TIMEOUT) { throw new TimeoutException(res.getStatus() == Response.SERVER_TIMEOUT, channel, res.getErrorMessage()); } throw new RemotingException(channel, res.getErrorMessage()); } TIMEOUT SIDESERVER_TIMEOUTï¼ˆæœåŠ¡ç«¯è¶…æ—¶ï¼‰ï¼š è¿™ä¸ªå°±æ˜¯æ­£å¸¸çš„æˆ‘ä»¬æ¶ˆè´¹ç«¯è¯·æ±‚ä¸€ä¸ªRPCæ¥å£ï¼ŒæœåŠ¡ç«¯ç”±äºæ€§èƒ½ç­‰ä¸€äº›åŸå› å¤„ç†æ—¶é—´è¶…è¿‡äº†timeouté…ç½®æ—¶é—´ã€‚ CLIENT_TIMEOUTï¼šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡sentè¿™ä¸ªæ¥åˆ¤æ–­æ˜¯å¦clientTimeoutï¼Œé‚£ä¹ˆè¿™ä¸ªsentä»€ä¹ˆæ—¶å€™æ”¹å˜å‘¢ï¼Ÿå°±åœ¨å‘é€è¯·æ±‚çš„åœ°æ–¹ï¼š 123456789101112131415161718192021222324252627282930@Override public void sent(Channel channel, Object message) throws RemotingException { Throwable exception = null; try { channel.setAttribute(KEY_WRITE_TIMESTAMP, System.currentTimeMillis()); ExchangeChannel exchangeChannel = HeaderExchangeChannel.getOrAddChannel(channel); try { handler.sent(exchangeChannel, message); } finally { HeaderExchangeChannel.removeChannelIfDisconnected(channel); } } catch (Throwable t) { exception = t; } if (message instanceof Request) { Request request = (Request) message; //è¿™é‡Œä¼šè®¾ç½®sent DefaultFuture.sent(channel, request); } if (exception != null) { if (exception instanceof RuntimeException) { throw (RuntimeException) exception; } else if (exception instanceof RemotingException) { throw (RemotingException) exception; } else { throw new RemotingException(channel.getLocalAddress(), channel.getRemoteAddress(), exception.getMessage(), exception); } } } ä¹Ÿå°±æ˜¯è¯´handler.sentä¸€æ—¦è°ƒç”¨æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆå°±ä¸ç®—clientSide Timeoutäº†ã€‚é‚£ä¹ˆCLIENT_TIMEOUTå¤§æ¦‚ç‡å°±æ˜¯ç”±äºclientç«¯ç½‘ç»œï¼Œç³»ç»Ÿç­‰åŸå› è¶…æ—¶ã€‚","link":"/archives/ae3bdc00.html"},{"title":"HashMapå’ŒConcurrentHashMapä¸­çš„initialCapacity","text":"HashMap é»˜è®¤æœ‰ä¸€ä¸ªåˆå§‹å¤§å°ï¼ˆinitialCapacityï¼‰ï¼Œè¿™ä¸ªåˆå§‹å¤§å°æ˜¯16ã€‚åœ¨å„ç§å¼€å‘è§„èŒƒæ‰‹å†Œä¸­éƒ½å¯ä»¥çœ‹åˆ°ä¼šå»ºè®®è®¾ç½®è¿™ä¸ªå¤§å°ã€‚ä¾‹å¦‚ï¼šnew HashMap(3);é‚£ä¹ˆæˆ‘ä»¬è®¾ç½®äº†åˆå§‹å®¹é‡ä¸º3ï¼ŒHashMapçš„å®¹é‡çœŸçš„ä¼šåˆå§‹åŒ–ä¸º3äº†å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚ä¸ºäº†æé«˜Hashæ•ˆç‡ï¼ŒJavaä¸­ä¼šé‡æ–°è®¡ç®—è¿™ä¸ªå€¼ï¼Œè·å¾—ä¸€ä¸ª&gt;3çš„æœ€å°2çš„Næ¬¡æ–¹ï¼Œå¤§äº3çš„æœ€å°2çš„Næ¬¡æ–¹å°±æ˜¯4(å…³äºä¸ºä»€ä¹ˆè¯·å‚ç…§https://www.zhihu.com/question/28562088/answer/111668116)ã€‚è¿™ä¸ª4æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ 1234567int n = cap - 1; n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; å—¯å“¼ï¼Ÿç¬¬ä¸€çœ¼çœ‹åˆ°è§‰å¾—è«åå¥‡å¦™ï¼Œä»”ç»†çœ‹çœ‹ï¼Œå°±ä¼šå¾ˆä½©æœäº†ï¼è¿™é‡Œä¸»è¦ç”¨åˆ°äº†ä¸¤ä¸ªè¿ç®—ï¼Œä½ç§»è¿ç®—ï¼ˆå‘å³æ— ç¬¦å·ï¼Œé«˜ä½è¡¥é›¶ï¼‰å’Œæˆ–è¿ç®—ã€‚ä¾‹å¦‚ï¼šcap=3ï¼Œå¥—å…¥ä¸Šé¢çš„å…¬å¼ï¼Œå¦‚ä¸‹ï¼š 1234int n = 3-1;//ç¬¬ä¸€æ­¥ä½ç§»è¿ç®—è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸ºï¼š10&gt;&gt;&gt;1 = 01//ç¬¬äºŒéƒ¨æˆ–è¿ç®—è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸ºï¼š10|=01 = 11n|=n&gt;&gt;&gt;1; æœ€ç»ˆn=11ï¼ˆäºŒè¿›åˆ¶ï¼‰æœ€ååŠ ä¸Š1 = 100ï¼ˆäºŒè¿›åˆ¶ï¼‰è½¬æ¢æˆ10è¿›åˆ¶å°±æ˜¯4å•¦ï¼éœ€è¦æ³¨æ„çš„æ˜¯ï¼šcap-1ï¼Œè¿™æ˜¯å› ä¸ºï¼Œå¦‚æœcapæœ¬èº«å°±æ˜¯2çš„æ¬¡æ–¹ï¼Œå¥—ç”¨ä¸Šé¢çš„å…¬å¼å¾—å‡ºæ¥çš„ç»“æœå°±ä¸æ˜¯æœ€å°çš„2çš„næ¬¡æ–¹äº†ã€‚ ä¸‹é¢æ¥è¯´ConcurrentHashMapä¸­çš„æœ€å°2çš„næ¬¡æ–¹æŠ€å·§ã€‚åº”è¯¥éƒ½çŸ¥é“ConcurrentHashMapæ˜¯é€šè¿‡åˆ†æ®µé”æ¥æé«˜æ•ˆç‡çš„ï¼Œå…¶ä¸­ä¸€ä¸ªsegmentå°±æ˜¯ä¸€ä¸ªé”ã€‚ä½†æ˜¯åˆå§‹åŒ–çš„æ—¶å€™åˆå§‹segmentæ•°ç»„å¤šå¤§åˆé€‚å‘¢ï¼Ÿsegmentå¤§å°è·ŸconcurrencyLevelæœ‰å…³ï¼Œæ±‚çš„æ˜¯å¤§äºconcurencyLevelçš„æœ€å°2çš„næ¬¡æ–¹ã€‚ 12345 int ssize = 1; while (ssize &lt; concurrencyLevel) { ++ sshift; ssize &lt;&lt;= 1; } è¿™é‡Œç”¨åˆ°çš„æ˜¯ä½ç§»è¿ç®—ï¼ˆå‘å·¦ï¼‰ã€‚ä¾‹å¦‚concurrencyLevel=5ï¼Œç¬¬ä¸€æ¬¡ssize&lt;&lt;=1 ç»“æœï¼š10ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œ2ï¼ˆ10è¿›åˆ¶ï¼‰ç¬¬äºŒæ¬¡ssize&lt;&lt;=1 ç»“æœï¼š100ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œ4ï¼ˆ10è¿›åˆ¶ï¼‰ç¬¬ä¸‰æ¬¡ssize&lt;&lt;=1 ç»“æœï¼š1000ï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼Œ8ï¼ˆ10è¿›åˆ¶ï¼‰è¿™æ—¶ç»“æœå·²ç»&gt;concurrencyLevelï¼Œwhileç»“æŸï¼Œäºæ˜¯æœ€ç»ˆç»“æœå°±æ˜¯8.æ‰€ä»¥æœ€ç»ˆsegment æ•°ç»„å¤§å°ä¼šè¢«åˆå§‹åŒ–ä¸º8.","link":"/archives/5536c54e.html"},{"title":"IDEA-Scratchesçš„ä¸€ä¸ªé—®é¢˜","text":"æ–°å»ºä¸€ä¸ªscratchï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š 12List&lt;String&gt; list = Arrays.asList(&quot;11 22&quot;,&quot;22 11&quot;,&quot;32 44&quot;); list.stream().map(item-&gt;item.split(&quot; &quot;)).flatMap(Arrays::stream).distinct().collect(Collectors.toList()).forEach(System.out::println); å…¶ä¸­Arrays::streamï¼Œç¼–è¯‘é”™è¯¯ï¼Œæç¤ºCannot resolve method â€˜streamâ€™åœ¨å·¥ç¨‹ä¸­ç¼–å†™åˆ™æ— æ­¤é”™è¯¯ã€‚ IDEAç‰ˆæœ¬ï¼š2018.3.2 UEç‰ˆJDKï¼šjdk1.8.0_121","link":"/archives/241ed4e3.html"},{"title":"Java å¯¼å‡ºPDF","text":"åºŸè¯å°‘è¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼š Maven: 12345&lt;dependency&gt; &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt; &lt;artifactId&gt;flying-saucer-pdf-itext5&lt;/artifactId&gt; &lt;version&gt;9.1.5&lt;/version&gt; &lt;/dependency&gt; Java: 123456789101112131415OutputStream os = null; try { os = new FileOutputStream(outputFile); ITextRenderer renderer = new ITextRenderer(); ITextFontResolver fontResolver = renderer.getFontResolver(); //ä¸­æ–‡é—®é¢˜è§£å†³ï¼Œå°†å­—ä½“æ–‡ä»¶simsun.ttc æ”¾åˆ°resources\\fonts ç›®å½•ä¸‹ fontResolver.addFont(App.class.getClassLoader().getResource(&quot;fonts\\\\simsun.ttc&quot;).toURI().toString(), BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);String htmlStr=&quot;è¿™é‡Œæ˜¯freemarkeræ¨¡æ¿å¼•æ“è§£æå‡ºæ¥çš„htmlä»£ç &quot;; renderer.setDocumentFromString(htmlStr);// å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜è§£å†³ï¼Œhtmlä»£ç ä¸­img src ç”¨ç›¸å¯¹è·¯å¾„ renderer.getSharedContext().setBaseURL(App.class.getClassLoader().getResource(&quot;&quot;).toURI().toString()); renderer.layout(); renderer.createPDF(os); //å®Œæˆåˆ›å»ºï¼Œè‡ªåŠ¨å…³é—­Documentèµ„æº renderer.finishPDF();","link":"/archives/30af2543.html"},{"title":"JavaåŒäº²å§”æ´¾æœºåˆ¶çš„å¦™ç”¨","text":"æœ€è¿‘åœ¨é¡¹ç›®ä¸­çœ‹åˆ°ä¸€æ®µé€šè¿‡easyexcelå¯¼å‡ºåŠ¨æ€è¡¨å¤´çš„å®ç°ï¼Œå¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯easyexcelå®˜æ–¹çš„å®ç°ï¼Œå…¶ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š 12345678//å°†åŠ¨æ€è¡¨å¤´ä¸Šä¼ è‡³ThreadLocalsaveToThreadLocal(clz, result);private &lt;T&gt; void saveToThreadLocal(Class&lt;T&gt; clz, List&lt;String&gt; result) { Map&lt;Class,List&lt;String&gt;&gt; paramMap = new ConcurrentHashMap&lt;&gt;(); paramMap.put(clz, result); ThreadLocalUtil.FIELD_CACHE_MAP.set(paramMap);} å…¶ä¸­resultæ˜¯é€šè¿‡æ¥å£æ‹¿åˆ°çš„ç”¨æˆ·è¡¨å¤´é…ç½®ï¼Œæˆ‘çœ‹åˆ°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿:ThreadLocalUtilï¼Œä»¥ä¸ºæ˜¯easyexcelçš„å®ç°ï¼Œåˆ°githubæŸ¥æ‰¾äº†ä¸€ç•ªï¼Œç»“æœä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç°ã€‚ideaç‚¹è¿›å»æŸ¥çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯å†…éƒ¨çš„ä¸€ä¸ªå®ç°ï¼š 123public class ThreadLocalUtil { public static ThreadLocal&lt;Map&lt;Class,List&lt;String&gt;&gt;&gt; FIELD_CACHE_MAP = new ThreadLocal(); public static ThreadLocal&lt;SoftReference&lt;FieldCache&gt;&gt; CACHE = new ThreadLocal();} åŒæ—¶è¿˜å‘ç°äº†ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè¿™å‡ ä¸ªæ–‡ä»¶åº”è¯¥æ˜¯easyexcelé¢„ç•™çš„æ‰©å±•ï¼Œåªéœ€è¦ç»§æ‰¿æŸäº›çˆ¶ç±»ï¼Œé‡å†™å‡ ä¸ªæ–¹æ³•å°±è¡Œäº†ã€‚ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œè‚¯å®šéœ€è¦æœ‰ä»€ä¹ˆåœ°æ–¹é…ç½®ï¼Œç±»ä¼¼SPIä¸€æ ·ã€‚äºæ˜¯æˆ‘é€šè¿‡ä¸Šé¢çš„æ–‡ä»¶ååœ¨é¡¹ç›®ä¸­æŸ¥æ‰¾ï¼Œç»“æœä»€ä¹ˆä¹Ÿæ²¡æœ‰æ‰¾åˆ°ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢å‡ ä¸ªæ–‡ä»¶è·Ÿeasyexcelå¹¶æ²¡æœ‰äº§ç”Ÿä»€ä¹ˆè”ç³»ã€‚é‚£ä¸ºä»€ä¹ˆé€šè¿‡è¿™å‡ ä¸ªæ–‡ä»¶å°±èƒ½å®ç°å¯¼å‡ºåŠ¨æ€è¡¨å¤´å‘¢ï¼Ÿæ²¡åŠæ³•ï¼Œåªèƒ½debugäº†ï¼Œè¿™æ—¶æˆ‘å‘ç°åœ¨easyexcelåŒ…ä¸­ä¹Ÿæœ‰ä¸€ä¸ªExcelHeadPropertyï¼Œè·Ÿä¸Šé¢è¯´çš„é‚£ä¸ªæ–‡ä»¶å¹¶ä¸æ˜¯åŒä¸€ä¸ªã€‚åœ¨ideaä¸­å¯¼èˆªåˆ°çš„æ˜¯easyexcelä¸­çš„classï¼Œä½†æ˜¯å®é™…æ‰§è¡Œçš„å´ä¸æ˜¯ã€‚ ä»”ç»†ä¸€çœ‹ï¼Œå‘ç°è¿™ä¸¤ä¸ªæ–‡ä»¶é™¤äº†å†…å®¹ä¸ä¸€æ ·ï¼ŒåŒ…åæ˜¯å®Œå…¨ä¸€æ ·çš„:com.alibaba.excel.metadata.propertyï¼Œè¿™æ—¶æˆ‘æƒ³åˆ°äº†Javaçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚è€Œé¡¹ç›®åˆå¹¶ä¸æ˜¯ç›´æ¥ä¾èµ–çš„easyexcelï¼Œæ˜¯é€šè¿‡é—´æ¥ä¾èµ–è¿›æ¥çš„ã€‚æ‰€ä»¥è¢«æ”¹å†™è¿‡çš„ExcelHeadProperty å…ˆäºeasyexcelæœ¬èº«çš„æ–‡ä»¶è¢«åŠ è½½ï¼Œç­‰åˆ°åŠ è½½easyexcelä¸­çš„ç›¸åŒclassæ—¶ï¼Œå‘ç°å·²ç»è¢«åŠ è½½è¿‡äº†ã€‚ä¸åœ¨åŠ è½½äº†ã€‚ ç„¶åæˆ‘åˆåœ¨é¡¹ç›®ä¸­åŠ äº†ä¸€ä¸ªç›¸åŒçš„æ–‡ä»¶ï¼Œç®€å•ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œå‘ç°é¡¹ç›®ä¸­çš„classåŠ è½½ä¼˜å…ˆçº§æ›´é«˜ï¼Œclassåˆä¸€æ¬¡è¢«æ”¹å†™äº†ï¼š ä¸å¾—ä¸è¯´ï¼Œå¦™å•Šï¼","link":"/archives/27ffa58c.html"},{"title":"Lambdaåº”ç”¨ä¸æµ…æ","text":"å¼•å…¥åœ¨Java8ä¹‹å‰åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å†™æ³•ï¼ˆä¹‹ä¸€ï¼‰ï¼š 123456789101112131415161718192021public class LambdaTest { public static void main(String[] args) { new Thread(new Runnable() { @Override public void run() { System.out.println(&quot;hello inner class!&quot;); } }); }} é€šè¿‡æŸ¥çœ‹ç¼–è¯‘åçš„ç”Ÿæˆçš„Classæ–‡ä»¶ï¼Œå¯ä»¥å¾—çŸ¥new Runnableè¿™å—ä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åç±»ï¼š æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415final class LambdaTest$1 implements Runnable { LambdaTest$1() { } public void run() { System.out.println(&quot;hello inner class!&quot;); }} åœ¨Java8å¼€å§‹ä¸€åˆ‡éƒ½å¼€å§‹å˜å¾—ä¸åŒï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 1234567891011public class LambdaTest { public static void main(String[] args) { new Thread(()-&gt;System.out.println(&quot;hello inner class!&quot;)); }} å…¶ä¸­()-&gt;System.out.println(&quot;hello inner class!&quot;)å°±æ˜¯ä»Šå¤©çš„ä¸»è§’lambdaè¡¨è¾¾å¼! ç®€ä»‹Lambdaè¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œä¸€å¼€å§‹åªæœ‰å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­æœ‰æ­¤åŠŸèƒ½ï¼Œä½†æ˜¯ç°åœ¨å·²ç»æœ‰è¶Šæ¥è¶Šå¤šçš„å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿæ”¯æŒäº†Lambdaè¡¨è¾¾å¼ã€‚ Lambdaè¡¨è¾¾å¼ä¸æ˜¯ä¸€ä¸ªæ–°é²œäº‹ï¼Œæœ€æ—©æ”¯æŒLambdaè¡¨è¾¾å¼çš„æ˜¯1958å‘å¸ƒçš„LISPè¯­è¨€ã€‚åœ¨Javaä¸­ä¹Ÿå­˜åœ¨äº†å¿«7-8å¹´æ—¶é—´ï¼ˆ2014å¹´å‘å¸ƒçš„Java8å¼€å§‹æ”¯æŒï¼‰ï¼Œç›®å‰Javaå·²ç»éƒ½å‘å¸ƒ16ã€‚ Lambdaè¡¨è¾¾å¼ç®€åŒ–åŒ¿åå†…éƒ¨ç±»çš„ä¹¦å†™ï¼Œä½†Lambdaè¡¨è¾¾å¼å¹¶ä¸èƒ½å–ä»£æ‰€æœ‰çš„åŒ¿åå†…éƒ¨ç±»ï¼Œåªèƒ½ç”¨æ¥å–ä»£å‡½æ•°æ¥å£ï¼ˆFunctional Interfaceï¼‰çš„ç®€å†™ã€‚ è¯´åˆ°å‡½æ•°æ¥å£ï¼Œé‚£ä¹ˆæ¥çœ‹ä¸‹ä»€ä¹ˆæ˜¯å‡½æ•°æ¥å£ï¼Œçœ‹çœ‹æœ€å¼€å§‹çš„ä¾‹å­é‡Œå‡ºç°çš„Runnable ï¼š 123456789@FunctionalInterfacepublic interface Runnable { public abstract void run();} å†çœ‹çœ‹å¦å¤–ä¸€ä¸ªComparable : 1234567public interface Comparable&lt;T&gt; { public int compareTo(T o);} å‘ç°äº†ä»€ä¹ˆï¼Ÿåªæœ‰ä¸€ä¸ª[æŠ½è±¡]æ–¹æ³•çš„æ¥å£å³æ˜¯å‡½æ•°æ¥å£ã€‚ @FunctionalInterface å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼ŒåŠ ä¸Šæ­¤æ³¨è§£å¯ä»¥è®©ç¼–è¯‘å™¨å¸®ä½ checkå½“å‰å®šä¹‰çš„æ˜¯ä¸æ˜¯æ­£ç¡®çš„å‡½æ•°æ¥å£ï¼š Java8 å¼•å…¥Lambdaè¡¨è¾¾å¼çš„åŒæ—¶ä¹Ÿå®šä¹‰äº†å¾ˆå¤šæ–°çš„å‡½æ•°æ¥å£ï¼Œé€‚ç”¨äºå¤§éƒ¨åˆ†åœºæ™¯ï¼š ä¹Ÿå°±æ˜¯è¯´Java8ä¸­çš„Lambdaè¡¨è¾¾å¼ä¸å¯ä»¥éšæ„ä¹±å†™ï¼Œå¿…é¡»æœ‰ä¸å…¶å¯¹åº”çš„å‡½æ•°æ¥å£å®šä¹‰ï¼Œä¾‹å¦‚ï¼š 1(a, b) -&gt; a + b; å¦‚æœåœ¨JDKä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„å‡½æ•°æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªï¼š 1234567@FunctionalInterfacepublic interface TwoParamsOneResultFunction { Integer get(Integer p1, Integer p2);} åº”ç”¨ä¸‹é¢æ¥é€šè¿‡ä¸€ä¸ªå®ä¾‹çœ‹çœ‹Lambdaè¡¨è¾¾å¼çš„åº”ç”¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859private static boolean sync2Es(List&lt;Long&gt; result, EsIndexEnum esIndexEnum, boolean isAsync) { log.info(&quot;åŒæ­¥{}è‡³ESï¼ŒidList:{},isAsync:{}&quot;, JSON.toJSONString(esIndexEnum), JSON.toJSONString(result), isAsync); if (esIndexEnum == null) { return false; } if (CollectionUtils.isEmpty(result)) { return true; } //esæœ€å¤šæ”¯æŒä¸€æ¬¡åŒæ­¥3000æ¡ï¼Œæ‰€ä»¥éœ€è¦æ‹†åˆ† List&lt;List&lt;Long&gt;&gt; partition = Lists.partition(StreamUtils.safeList(result), AssetsConstant.MAX_BATCH_SYNC_SIZE); //esæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ï¼ŒæŒ‰éœ€é€‰æ‹© EsSyncProcessorInstance instance = EsSyncProcessorFactory.getInstance(esIndexEnum.getIndexClass()); BiFunction&lt;EsSyncProcessorInstance, List&lt;Long&gt;, EsResult&lt;BulkMessage&gt;&gt; esFunction = getEsSyncFunction(isAsync); boolean esResult = StreamUtils.allMatch(StreamUtils.listToList(partition, ids -&gt; { EsResult&lt;BulkMessage&gt; bulkMessageEsResult = esFunction.apply(instance, ids); //eså¯èƒ½å¤±è´¥ï¼Œé‡è¯•ä¸€æ¬¡ï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œé‚£ä¼°è®¡å°±æ˜¯å¤§é—®é¢˜äº†ã€‚ if (!bulkMessageEsResult.isSuccess()) { log.error(&quot;åŒæ­¥ESå¤±è´¥:{},é‡è¯•ä¸€æ¬¡&quot;, JSON.toJSONString(bulkMessageEsResult)); bulkMessageEsResult = esFunction.apply(instance, StreamUtils.listToList(StreamUtils.safeGetField(bulkMessageEsResult.getValue(), BulkMessage::getFailIds), Long::valueOf)); if (!bulkMessageEsResult.isSuccess()) { log.error(&quot;åŒæ­¥ESé‡è¯•å†æ¬¡å¤±è´¥:{}&quot;, JSON.toJSONString(bulkMessageEsResult)); } } return bulkMessageEsResult.isSuccess(); }), Boolean::booleanValue); if (!esResult) { log.error(&quot;åŒæ­¥åˆ°ESå­˜åœ¨å¤±è´¥:{}&quot;, JSON.toJSONString(result)); } return esResult;} ä¸Šé¢è¿™ä¸€æ®µä»£ç ä¸»è¦æ˜¯åœ¨åšåŒæ­¥æ•°æ®ç»™ESçš„é€»è¾‘ï¼Œç”±äºESæä¾›äº†å¤šç§åŒæ­¥æ–¹å¼ï¼Œä¸æƒ³å°†ç»†èŠ‚æš´éœ²ç»™ä¸Šå±‚ï¼Œæ‰€ä»¥åšäº†ä¸€äº›å°è£…ã€‚ å…ˆçœ‹çœ‹è¿™ä¸€æ®µï¼š 1BiFunction&lt;EsSyncProcessorInstance, List&lt;Long&gt;, EsResult&lt;BulkMessage&gt;&gt; esFunction = getEsSyncFunction(isAsync); è°ƒç”¨äº†ï¼š 12345private static BiFunction&lt;EsSyncProcessorInstance, List&lt;Long&gt;, EsResult&lt;BulkMessage&gt;&gt; getEsSyncFunction(boolean isAsync) { return isAsync ? EsSyncProcessorInstance::syncByPrimaryKey : EsSyncProcessorInstance::syncByPrimaryKeyImmediate;} å…¶ä¸­å¯ä»¥çœ‹åˆ°ç±»ä¼¼EsSyncProcessorInstance::syncByPrimaryKeyè¿™ç§å†™æ³•ï¼Œè¿™ä¸ªå«æ–¹æ³•å¼•ç”¨ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§ç‰¹æ®Šçš„lambdaè¡¨è¾¾å¼ï¼ˆè¯­æ³•ç³–ï¼‰ï¼Œç›¸å½“äºç»™ä¸€æ®µå‡½æ•°å–äº†ä¸€ä¸ªåå­—ï¼Œç„¶åç›´æ¥å¼•ç”¨ï¼Œçœ‹çœ‹syncByPrimaryKeyï¼š 123456789101112131415161718192021public EsResult&lt;BulkMessage&gt; syncByPrimaryKey(List&lt;Long&gt; indexPrimaryKeyList) { String method = &quot;EsSyncProcessorInstance#syncByPrimaryKey&quot;; if (indexPrimaryKeyList != null &amp;&amp; indexPrimaryKeyList.size() &gt; 3000) { log.warn(&quot;{} allowable size exceeded, size={}, max={}&quot;, new Object[]{method, indexPrimaryKeyList.size(), 3000}); return null; } else { EsSyncLoopQuery query = this.newInstanceQuery(); query.setIdList(indexPrimaryKeyList); return this.synchronizeToEs(query, this.defaultConfig()); }} éœ€è¦ä¸€ä¸ªList å‚æ•°ï¼Œä¸€ä¸ªEsResultè¿”å›å€¼ï¼Œé‚£ä¸ºä»€ä¹ˆé€‚é…çš„å‡½æ•°æ¥å£æ˜¯BiFunctionï¼Ÿçœ‹çœ‹BiFunctionï¼š 12345678910111213@FunctionalInterfacepublic interface BiFunction&lt;T, U, R&gt; {//è¿™é‡Œéœ€è¦ä¸¤ä¸ªå‚æ•° R apply(T t, U u); ...} ç”±äºsyncByPrimaryKeyæ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡æ‰èƒ½è°ƒç”¨ï¼Œæ‰€ä»¥EsSyncProcessorInstance::syncByPrimaryKey ç›¸å½“äº(EsSyncProcessorInstance instance,List&lt;Long&gt; ids)-&gt;{...} å†ä¸€æ¬¡éªŒè¯ï¼Œlambdaè¡¨è¾¾å¼ä¸èƒ½éšæ„ä¹±å†™ï¼Œå¿…é¡»æœ‰å¯¹åº”çš„å‡½æ•°æ¥å£å¯¹åº”ã€‚ æ¥ä¸‹æ¥å†æ¥çœ‹çœ‹ï¼š 1StreamUtils.listToList(partition, ids -&gt; { è¿™æ˜¯å¯¹Java8 Stream+Lambdaçš„ä¸€å±‚å°è£…ï¼š 12345public static &lt;T, R&gt; List&lt;R&gt; listToList(List&lt;T&gt; list, Function&lt;T, R&gt; function) { return safeList(list).stream().map(function).filter(Objects::nonNull).collect(Collectors.toList());} å¯ä»¥çœ‹åˆ°stream().mapéœ€è¦ä¸€ä¸ªfunctionç”¨æ¥è½¬æ¢æ•°æ®ï¼Œè€Œå…¶ä»–çš„åŸºæœ¬éƒ½æ˜¯å›ºå®šå†™æ³•ï¼Œè¿™ä½“ç°äº†Lambdaçš„å¦å¤–ä¸€ä¸ªå¥½å¤„ï¼šæŠ½è±¡è¡Œä¸ºã€‚ è¿˜æœ‰å¾ˆå¤šç”¨æ³•ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚ åŸç†è¿™ä¹ˆğŸ‚ğŸºçš„Lambdaè¡¨è¾¾å¼Javaåº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿé¦–å…ˆå¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œä¸æ˜¯åŒ¿åå†…éƒ¨ç±»ï¼Œè¿˜æ˜¯æœ€å¼€å§‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ”¹æˆlambdaè¡¨è¾¾å¼åç¼–è¯‘çœ‹çœ‹ï¼š 1234567891011public class LambdaTest { public static void main(String[] args) { new Thread(()-&gt;System.out.println(&quot;hello lambda&quot;)); }} å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰åŒ¿åå†…éƒ¨ç±»ç”Ÿæˆï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹LambdaTest.classå­—èŠ‚ç (javap -c -p -v LambdaTest.class)ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225Classfile /Users/zhaojingzhou/workspace/larry/lambda/src/LambdaTest.class Last modified 2021-8-2; size 1047 bytes MD5 checksum 191cb67c3e5a457eb20b4c8a47f5a5d2 Compiled from &quot;LambdaTest.java&quot;public class LambdaTest minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPERConstant pool: #1 = Methodref #9.#19 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Class #20 // java/lang/Thread #3 = InvokeDynamic #0:#25 // #0:run:()Ljava/lang/Runnable; #4 = Methodref #2.#26 // java/lang/Thread.&quot;&lt;init&gt;&quot;:(Ljava/lang/Runnable;)V #5 = Fieldref #27.#28 // java/lang/System.out:Ljava/io/PrintStream; #6 = String #29 // hello inner class! #7 = Methodref #30.#31 // java/io/PrintStream.println:(Ljava/lang/String;)V #8 = Class #32 // LambdaTest #9 = Class #33 // java/lang/Object #10 = Utf8 &lt;init&gt; #11 = Utf8 ()V #12 = Utf8 Code #13 = Utf8 LineNumberTable #14 = Utf8 main #15 = Utf8 ([Ljava/lang/String;)V #16 = Utf8 lambda$main$0 #17 = Utf8 SourceFile #18 = Utf8 LambdaTest.java #19 = NameAndType #10:#11 // &quot;&lt;init&gt;&quot;:()V #20 = Utf8 java/lang/Thread #21 = Utf8 BootstrapMethods #22 = MethodHandle #6:#34 // invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #23 = MethodType #11 // ()V #24 = MethodHandle #6:#35 // invokestatic LambdaTest.lambda$main$0:()V #25 = NameAndType #36:#37 // run:()Ljava/lang/Runnable; #26 = NameAndType #10:#38 // &quot;&lt;init&gt;&quot;:(Ljava/lang/Runnable;)V #27 = Class #39 // java/lang/System #28 = NameAndType #40:#41 // out:Ljava/io/PrintStream; #29 = Utf8 hello inner class! #30 = Class #42 // java/io/PrintStream #31 = NameAndType #43:#44 // println:(Ljava/lang/String;)V #32 = Utf8 LambdaTest #33 = Utf8 java/lang/Object #34 = Methodref #45.#46 // java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #35 = Methodref #8.#47 // LambdaTest.lambda$main$0:()V #36 = Utf8 run #37 = Utf8 ()Ljava/lang/Runnable; #38 = Utf8 (Ljava/lang/Runnable;)V #39 = Utf8 java/lang/System #40 = Utf8 out #41 = Utf8 Ljava/io/PrintStream; #42 = Utf8 java/io/PrintStream #43 = Utf8 println #44 = Utf8 (Ljava/lang/String;)V #45 = Class #48 // java/lang/invoke/LambdaMetafactory #46 = NameAndType #49:#53 // metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #47 = NameAndType #16:#11 // lambda$main$0:()V #48 = Utf8 java/lang/invoke/LambdaMetafactory #49 = Utf8 metafactory #50 = Class #55 // java/lang/invoke/MethodHandles$Lookup #51 = Utf8 Lookup #52 = Utf8 InnerClasses #53 = Utf8 (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; #54 = Class #56 // java/lang/invoke/MethodHandles #55 = Utf8 java/lang/invoke/MethodHandles$Lookup #56 = Utf8 java/lang/invoke/MethodHandles{ public LambdaTest(); descriptor: ()V flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 9: 0 public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=3, locals=1, args_size=1 0: new #2 // class java/lang/Thread 3: dup 4: invokedynamic #3, 0 // InvokeDynamic #0:run:()Ljava/lang/Runnable; 9: invokespecial #4 // Method java/lang/Thread.&quot;&lt;init&gt;&quot;:(Ljava/lang/Runnable;)V 12: pop 13: return LineNumberTable: line 14: 0 line 19: 13 private static void lambda$main$0(); descriptor: ()V flags: ACC_PRIVATE, ACC_STATIC, ACC_SYNTHETIC Code: stack=2, locals=0, args_size=0 0: getstatic #5 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #6 // String hello inner class! 5: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return LineNumberTable: line 14: 0}SourceFile: &quot;LambdaTest.java&quot;InnerClasses: public static final #51= #50 of #54; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandlesBootstrapMethods: 0: #22 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; Method arguments: #23 ()V #24 invokestatic LambdaTest.lambda$main$0:()V #23 ()V å¾ˆå¤šä¿¡æ¯æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹é‡ç‚¹ï¼š 14: invokedynamic #3, 0 // InvokeDynamic #0:run:()Ljava/lang/Runnable; ç¬¬85è¡Œå¯ä»¥çœ‹åˆ°åŸlambdaè¡¨è¾¾å¼è¢«ç¼–è¯‘æˆäº†invokedynamic å­—èŠ‚ç ï¼Œè¿™ä¸ªæ˜¯Javaä¸­å¤šä¸ªè°ƒç”¨å­—èŠ‚ç ä¹‹ä¸€ï¼Œå…¶å®ƒçš„åˆ†åˆ«æ˜¯invokestaticã€invokevirtualã€invokespecialã€invokeinterfaceã€‚ä¹Ÿæ˜¯Java1.0ä»¥åç¬¬ä¸€ä¸ªè¢«æ–°å¢çš„è°ƒç”¨å­—èŠ‚ç ã€‚ æ¥ä¸‹æ¥çœ‹#3ï¼š 1#3 = InvokeDynamic #0:#25 // #0:run:()Ljava/lang/Runnable; #0: 1234567891011BootstrapMethods: 0: #22 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; Method arguments: #23 ()V #24 invokestatic LambdaTest.lambda$main$0:()V #23 ()V JVMè§„èŒƒè§„å®šï¼Œå¦‚æœç±»çš„å¸¸é‡æ± ä¸­å­˜åœ¨CONSTANT_InvokeDynamic_infoçš„è¯ï¼Œé‚£ä¹ˆattributesè¡¨ä¸­å°±å¿…å®šæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªBootstrapMethodså±æ€§ã€‚BootstrapMethodså±æ€§æ˜¯ä¸ªå˜é•¿çš„è¡¨ã€‚ å…¶ä¸­æ ¹æ®ç›¸å…³ä¿¡æ¯ä¼šåˆ›å»ºä¸€ä¸ªDynamicCallSiteåŠ¨æ€è°ƒç”¨ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•ä¸ºï¼š 12345678910111213141516171819202122invokestatic LambdaTest.lambda$main$0:()V private static void lambda$main$0(); descriptor: ()V flags: ACC_PRIVATE, ACC_STATIC, ACC_SYNTHETIC Code: stack=2, locals=0, args_size=0 0: getstatic #5 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #6 // String hello inner class! 5: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return LineNumberTable: line 14: 0 ä¹Ÿå°±æ˜¯è¯´Javaè™½ç„¶ä¸ä¼šå¯¹Lambdaè¡¨è¾¾å¼ç”ŸæˆåŒ¿åç±»ï¼Œä½†æ˜¯ä¼šç”ŸæˆåŒ¿åé™æ€æ–¹æ³•ã€‚ å¼•ç”¨https://segmentfault.com/a/1190000020607546 https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html https://stackoverflow.com/questions/30733557/what-is-a-bootstrap-method","link":"/archives/d53a1750.html"},{"title":"Maven Settings ä¸­çš„ä¸€äº›å®¹æ˜“æ··æ·†çš„æ¦‚å¿µ","text":"é¦–å…ˆæ˜¯repositoriesï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€äº›è¿œç¨‹ä»“åº“ï¼ˆç§æœï¼‰ã€‚æœ¬æ¥æ˜¯å¯ä»¥ç›´æ¥å®šä¹‰åœ¨POM.xml ï¼Œä½†æ˜¯ç”±äºä¸€ä¸ªå…¬å¸é€šå¸¸å¤šä¸ªé¡¹ç›®éƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªè¿œç¨‹ä»“åº“ï¼ˆç§æœï¼‰ã€‚ä¸ºäº†æ¯ä¸ªé¡¹ç›®ä¸é‡å¤å®šä¹‰ã€‚æ‰€ä»¥å¯ä»¥ç»Ÿä¸€é…ç½®åœ¨settings.xmlã€‚ç”±äºsettingsä¸‹ä¸èƒ½ç›´æ¥å®šä¹‰repositoriesæ‰€ä»¥é‡‡ç”¨äº†profilesã€‚åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨profilesåšä¸åŒç¯å¢ƒä¸‹çš„é…ç½®åˆ‡æ¢ã€‚ å®¹æ˜“æ··æ·†çš„æ˜¯mirrorsï¼Œé…ç½®å¤šä¸ªmirrorï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªéƒ½ä¼šç”Ÿæ•ˆï¼Œå§‹ç»ˆåªæœ‰ç¬¬ä¸€ä¸ªæœ‰ç”¨ã€‚å¦å¤–mirrors è·Ÿprofilesæ²¡æœ‰ä»€ä¹ˆç›´æ¥å…³ç³»ï¼Œæœ‰å…³ç³»çš„æ˜¯repositoryï¼ŒmirrorOf ä¸­é…ç½®çš„æ˜¯repository idï¼ˆæ”¯æŒè¡¨è¾¾å¼ï¼‰ã€‚ä¸€èˆ¬æˆ‘ä»¬mirrorçš„éƒ½æ˜¯centralè¿™ç±»å®˜æ–¹ï¼Œå› ä¸ºmirrorçš„ä¸»è¦ä½œç”¨å°±æ˜¯è§£å†³ä¸åŒç½‘ç»œç¯å¢ƒä¸‹ï¼Œè¿™ç§å®˜æ–¹çš„æˆ–è€…ç¬¬ä¸‰æ–¹çš„ä»“åº“é€Ÿåº¦é—®é¢˜ã€‚å¦‚æœä½ æœ‰ç§æœï¼Œç„¶åç›´æ¥mirrorOf * åˆ°äº†é˜¿é‡Œäº‘çš„é•œåƒåº“ï¼Œé‚£ä¹ˆä½ ç§æœçš„Jarå¯èƒ½å°±è®¿é—®ä¸åˆ°äº†ã€‚ mavenæ‰¾Jarçš„è·¯å¾„å¤§æ¦‚æ˜¯ï¼Œæœ¬åœ°ä»“åº“&gt;å„ä¸ªè¿œç¨‹åº“ï¼Œå¦‚æœé…ç½®äº†é•œåƒï¼Œåˆ™èµ°é•œåƒåº“ã€‚ serveré…ç½®çš„æ˜¯mavenç§æœè´¦å·å¯†ç ä¿¡æ¯ï¼Œç”¨äºåˆ†å‘jaråˆ°ç§æœæ—¶è®¤è¯ï¼Œé€šå¸¸åœ¨pomæ–‡ä»¶ä¸­ä¼šå®šä¹‰distributionManagement,å…¶ä¸­repository id å¿…é¡»å’Œserverçš„idä¸€è‡´ã€‚åˆ†å‘æŒ‡çš„æ˜¯deployã€‚installåªä¼šåœ¨æœ¬åœ°åº“ä¸­å­˜åœ¨ã€‚","link":"/archives/fb1fa3ca.html"},{"title":"Mybatis Mapper æºç åˆ†æ","text":"å¤©å¤©éƒ½åœ¨ç”¨çš„Mybatisï¼Œä¸ºå•¥è°ƒç”¨ä¸€ä¸ªMapperæ¥å£å°±èƒ½æ‰§è¡ŒSQLï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡è¿™ä¸ªé—®é¢˜ï¼Ÿ è¿™ä¸€åˆ‡éƒ½å¾—ä» @MapperScan è¿™ä¸ªæ³¨è§£å¼€å§‹è¯´èµ·ã€‚æ‰“å¼€è¿™ä¸ªæ³¨è§£å®šä¹‰å¯ä»¥çœ‹åˆ°ï¼š 1234@Retention(RetentionPolicy.RUNTIME)@Target({ElementType.TYPE})@Documented@Import({MapperScannerRegistrar.class}) ä¸Šé¢çš„å…ƒæ³¨è§£ä¸­é‡ç‚¹å…³æ³¨@Import(MapperScannerRegistrar.class)ï¼Œè¿™æ˜¯Springçš„ä¸€ä¸ªæ³¨è§£ï¼Œå…è®¸å¯¼å…¥@Configurationç±»ã€ ImportSelectorå’ŒImportBeanDefinitionRegistrarå®ç°ã€‚å¾ˆæ˜æ˜¾MapperScannerRegistrar.class åº”è¯¥æ˜¯ImportBeanDefinitionRegistrarçš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class MapperScannerRegistrar implements ImportBeanDefinitionRegistrar, ResourceLoaderAware { private ResourceLoader resourceLoader; /** * {@inheritDoc} */ @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) { AnnotationAttributes annoAttrs = AnnotationAttributes.fromMap(importingClassMetadata.getAnnotationAttributes(MapperScan.class.getName())); ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry); // this check is needed in Spring 3.1 if (resourceLoader != null) { scanner.setResourceLoader(resourceLoader); } Class&lt;? extends Annotation&gt; annotationClass = annoAttrs.getClass(&quot;annotationClass&quot;); if (!Annotation.class.equals(annotationClass)) { scanner.setAnnotationClass(annotationClass); } Class&lt;?&gt; markerInterface = annoAttrs.getClass(&quot;markerInterface&quot;); if (!Class.class.equals(markerInterface)) { scanner.setMarkerInterface(markerInterface); } Class&lt;? extends BeanNameGenerator&gt; generatorClass = annoAttrs.getClass(&quot;nameGenerator&quot;); if (!BeanNameGenerator.class.equals(generatorClass)) { scanner.setBeanNameGenerator(BeanUtils.instantiateClass(generatorClass)); } Class&lt;? extends MapperFactoryBean&gt; mapperFactoryBeanClass = annoAttrs.getClass(&quot;factoryBean&quot;); if (!MapperFactoryBean.class.equals(mapperFactoryBeanClass)) { scanner.setMapperFactoryBean(BeanUtils.instantiateClass(mapperFactoryBeanClass)); } scanner.setSqlSessionTemplateBeanName(annoAttrs.getString(&quot;sqlSessionTemplateRef&quot;)); scanner.setSqlSessionFactoryBeanName(annoAttrs.getString(&quot;sqlSessionFactoryRef&quot;)); List&lt;String&gt; basePackages = new ArrayList&lt;String&gt;(); for (String pkg : annoAttrs.getStringArray(&quot;value&quot;)) { if (StringUtils.hasText(pkg)) { basePackages.add(pkg); } } for (String pkg : annoAttrs.getStringArray(&quot;basePackages&quot;)) { if (StringUtils.hasText(pkg)) { basePackages.add(pkg); } } for (Class&lt;?&gt; clazz : annoAttrs.getClassArray(&quot;basePackageClasses&quot;)) { basePackages.add(ClassUtils.getPackageName(clazz)); } scanner.registerFilters(); scanner.doScan(StringUtils.toStringArray(basePackages)); } /** * {@inheritDoc} */ @Override public void setResourceLoader(ResourceLoader resourceLoader) { this.resourceLoader = resourceLoader; }} å¯ä»¥çœ‹åˆ°ä¸Šé¢ä»£ç åœ¨åšä¸€ä»¶äº‹ï¼Œå°±æ˜¯åˆå§‹åŒ–ClassPathMapperScannerï¼Œæœ€åè°ƒç”¨äº†doScanï¼š 12345678910111213public class ClassPathMapperScanner extends ClassPathBeanDefinitionScanner {public Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) { Set&lt;BeanDefinitionHolder&gt; beanDefinitions = super.doScan(basePackages); if (beanDefinitions.isEmpty()) { logger.warn(&quot;No MyBatis mapper was found in '&quot; + Arrays.toString(basePackages) + &quot;' package. Please check your configuration.&quot;); } else { processBeanDefinitions(beanDefinitions); } return beanDefinitions; } é¦–å…ˆè°ƒç”¨äº†çˆ¶ç±»çš„doScanï¼Œé‡Œé¢çš„ä¸»è¦é€»è¾‘æ˜¯æŸ¥æ‰¾æŒ‡å®šçš„basePackagesä¸‹çš„æ‰€æœ‰Componentsï¼Œå³å£°æ˜äº†@Componentä»¥åŠå°†@Componentä½œä¸ºå…ƒæ³¨è§£çš„æ³¨è§£ï¼Œä¾‹å¦‚@Repositoryï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ï¼š org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider#findCandidateComponents org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider#isCandidateComponent(org.springframework.core.type.classreading.MetadataReader) org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider#registerDefaultFilters org.springframework.core.type.filter.AnnotationTypeFilter#hasAnnotation org.springframework.core.annotation.AnnotationUtils#getAnnotation(java.lang.reflect.AnnotatedElement, java.lang.Class) æ¥ä¸‹æ¥è°ƒç”¨äº†processBeanDefinitions: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private void processBeanDefinitions(Set&lt;BeanDefinitionHolder&gt; beanDefinitions) { GenericBeanDefinition definition; for (BeanDefinitionHolder holder : beanDefinitions) { definition = (GenericBeanDefinition) holder.getBeanDefinition(); if (logger.isDebugEnabled()) { logger.debug(&quot;Creating MapperFactoryBean with name '&quot; + holder.getBeanName() + &quot;' and '&quot; + definition.getBeanClassName() + &quot;' mapperInterface&quot;); } // the mapper interface is the original class of the bean // but, the actual class of the bean is MapperFactoryBean definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName()); // issue #59 definition.setBeanClass(this.mapperFactoryBean.getClass()); definition.getPropertyValues().add(&quot;addToConfig&quot;, this.addToConfig); boolean explicitFactoryUsed = false; if (StringUtils.hasText(this.sqlSessionFactoryBeanName)) { definition.getPropertyValues().add(&quot;sqlSessionFactory&quot;, new RuntimeBeanReference(this.sqlSessionFactoryBeanName)); explicitFactoryUsed = true; } else if (this.sqlSessionFactory != null) { definition.getPropertyValues().add(&quot;sqlSessionFactory&quot;, this.sqlSessionFactory); explicitFactoryUsed = true; } if (StringUtils.hasText(this.sqlSessionTemplateBeanName)) { if (explicitFactoryUsed) { logger.warn(&quot;Cannot use both: sqlSessionTemplate and sqlSessionFactory together. sqlSessionFactory is ignored.&quot;); } definition.getPropertyValues().add(&quot;sqlSessionTemplate&quot;, new RuntimeBeanReference(this.sqlSessionTemplateBeanName)); explicitFactoryUsed = true; } else if (this.sqlSessionTemplate != null) { if (explicitFactoryUsed) { logger.warn(&quot;Cannot use both: sqlSessionTemplate and sqlSessionFactory together. sqlSessionFactory is ignored.&quot;); } definition.getPropertyValues().add(&quot;sqlSessionTemplate&quot;, this.sqlSessionTemplate); explicitFactoryUsed = true; } if (!explicitFactoryUsed) { if (logger.isDebugEnabled()) { logger.debug(&quot;Enabling autowire by type for MapperFactoryBean with name '&quot; + holder.getBeanName() + &quot;'.&quot;); } definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE); } } } é‡ç‚¹çœ‹çœ‹è¿™ä¸¤è¡Œä»£ç ï¼š 12definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName()); definition.setBeanClass(this.mapperFactoryBean.getClass()); ä¼¼ä¹å·²ç»å¯ä»¥çœ‹å‡ºç‚¹è››ä¸é©¬è¿¹ï¼Œè¿™é‡Œå°†Mapperçš„BeanDefinitionçš„BeanClassæ›¿æ¢ä¸ºäº†this.mapperFactoryBean.getClass(): 1private MapperFactoryBean&lt;?&gt; mapperFactoryBean = new MapperFactoryBean&lt;Object&gt;(); å¹¶ä¸”å°†åŸæœ¬çš„BeanClassæ·»åŠ ä¸ºäº†æ„é€ å‡½æ•°å‚æ•°ï¼š 1definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName()); ç†Ÿæ‚‰Springçš„åº”è¯¥éƒ½çŸ¥é“ï¼ŒSpringåŠ è½½å®ŒBeanDefinitionåä¼šé€šè¿‡BeanClassæ¥å»å®ä¾‹åŒ–Beanï¼Œè¿™é‡Œçš„BeanClassè¢«æ›¿æ¢ä¸ºäº†ä¸€ä¸ªFactoryBeanï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105public class MapperFactoryBean&lt;T&gt; extends SqlSessionDaoSupport implements FactoryBean&lt;T&gt; { private Class&lt;T&gt; mapperInterface; private boolean addToConfig = true; public MapperFactoryBean() { //intentionally empty } public MapperFactoryBean(Class&lt;T&gt; mapperInterface) { this.mapperInterface = mapperInterface; } /** * {@inheritDoc} */ @Override protected void checkDaoConfig() { super.checkDaoConfig(); notNull(this.mapperInterface, &quot;Property 'mapperInterface' is required&quot;); Configuration configuration = getSqlSession().getConfiguration(); if (this.addToConfig &amp;&amp; !configuration.hasMapper(this.mapperInterface)) { try { configuration.addMapper(this.mapperInterface); } catch (Exception e) { logger.error(&quot;Error while adding the mapper '&quot; + this.mapperInterface + &quot;' to configuration.&quot;, e); throw new IllegalArgumentException(e); } finally { ErrorContext.instance().reset(); } } } /** * {@inheritDoc} */ @Override public T getObject() throws Exception { return getSqlSession().getMapper(this.mapperInterface); } /** * {@inheritDoc} */ @Override public Class&lt;T&gt; getObjectType() { return this.mapperInterface; } /** * {@inheritDoc} */ @Override public boolean isSingleton() { return true; } //------------- mutators -------------- /** * Sets the mapper interface of the MyBatis mapper * * @param mapperInterface class of the interface */ public void setMapperInterface(Class&lt;T&gt; mapperInterface) { this.mapperInterface = mapperInterface; } /** * Return the mapper interface of the MyBatis mapper * * @return class of the interface */ public Class&lt;T&gt; getMapperInterface() { return mapperInterface; } /** * If addToConfig is false the mapper will not be added to MyBatis. This means * it must have been included in mybatis-config.xml. * &lt;p/&gt; * If it is true, the mapper will be added to MyBatis in the case it is not already * registered. * &lt;p/&gt; * By default addToCofig is true. * * @param addToConfig */ public void setAddToConfig(boolean addToConfig) { this.addToConfig = addToConfig; } /** * Return the flag for addition into MyBatis config. * * @return true if the mapper will be added to MyBatis in the case it is not already * registered. */ public boolean isAddToConfig() { return addToConfig; }} å¯ä»¥çœ‹åˆ°ä¹‹å‰é‚£ä¸ªè¢«æ³¨å†Œçš„æ„é€ å‡½æ•°å‚æ•°åº”è¯¥å°±æ˜¯åœ¨è¿™è¢«ä½¿ç”¨çš„ï¼š 123 public MapperFactoryBean(Class&lt;T&gt; mapperInterface) { this.mapperInterface = mapperInterface;} Spring å…³äºè¿™ä¸ªBeanæ„é€ å‡½æ•°çš„å¤„ç†ï¼š 123456789 org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#autowireConstructor// Need to determine the constructor... Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName); if (ctors != null || mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_CONSTRUCTOR || mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) { return autowireConstructor(beanName, mbd, ctors, args); } æ€»ä¹‹ï¼ŒSpringé€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ª MapperFactoryBean å¯¹è±¡ã€‚æ¥ä¸‹æ¥Springå»åˆå§‹åŒ–è¿™ä¸ªBeanï¼ŒSpringå¯¹FactoryBeanæœ‰ç‰¹æ®Šå¤„ç†ï¼Œå®é™…ä¼šè°ƒç”¨getObjectæ–¹æ³•è¿”å›å…·ä½“çš„Beanã€‚æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ï¼š 1org.springframework.beans.factory.support.FactoryBeanRegistrySupport#doGetObjectFromFactoryBean è¿™ä¸‹åˆå›åˆ°äº†MapperFactoryBeanä¸­ï¼Œæ¥çœ‹çœ‹getObjectï¼š 1234567/** * {@inheritDoc} */ @Override public T getObject() throws Exception { return getSqlSession().getMapper(this.mapperInterface); } è°ƒç”¨äº†çˆ¶ç±»getSqlSession()æ–¹æ³•è·å¾—SqlSessionï¼Œç„¶åè°ƒç”¨getMapperï¼Œä¼ å…¥äº†å½“å‰å®é™…çš„Mapperã€‚é€šè¿‡ï¼š org.apache.ibatis.session.SqlSessionFactoryBuilder#build(org.apache.ibatis.session.Configuration) org.apache.ibatis.session.defaults.DefaultSqlSessionFactory#openSessionFromDataSource å¯ä»¥çŸ¥é“SqlSessionå®é™…çš„ç±»å‹åº”è¯¥æ˜¯DefaultSqlSessionï¼Œçœ‹çœ‹getMapperï¼š 1234@Overridepublic &lt;T&gt; T getMapper(Class&lt;T&gt; type) { return configuration.&lt;T&gt;getMapper(type, this);} åˆè°ƒç”¨äº†configurationçš„getMapperï¼Œconfigurationåˆå§‹åŒ–å¯ä»¥çœ‹çœ‹org.mybatis.spring.SqlSessionFactoryBean#buildSqlSessionFactoryï¼Œæˆ‘ä»¬å†™çš„SQLå°±æ˜¯åœ¨è¿™ä¸ªé‡Œé¢è¢«è§£æçš„ã€‚åˆ°è¿™é‡Œå·²ç»åŸºæœ¬å¾ˆæ¸…æ™°äº†ã€‚æ¥ç€çœ‹ï¼š 123456789101112131415161718//configurationä¸­çš„getMapperpublic &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) { return mapperRegistry.getMapper(type, sqlSession);}//MapperRegistryä¸­çš„getMapperpublic &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) { final MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory&lt;T&gt;) knownMappers.get(type); if (mapperProxyFactory == null) { throw new BindingException(&quot;Type &quot; + type + &quot; is not known to the MapperRegistry.&quot;); } try { return mapperProxyFactory.newInstance(sqlSession); } catch (Exception e) { throw new BindingException(&quot;Error getting mapper instance. Cause: &quot; + e, e); }} å…³é”®å°±æ˜¯ MapperProxyFactoryäº†ï¼Œè¿™ä¸ªæ˜¯åœ¨ org.apache.ibatis.binding.MapperRegistry#addMapper æ—¶ä¼šä¸ºæ¯ä¸ªMapperç»‘å®šä¸€ä¸ªã€‚çœ‹newInstanceï¼š 1234567public T newInstance(SqlSession sqlSession) { final MapperProxy&lt;T&gt; mapperProxy = new MapperProxy&lt;T&gt;(sqlSession, mapperInterface, methodCache); return newInstance(mapperProxy);} protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) { return (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), new Class[] { mapperInterface }, mapperProxy); } ä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆMapperæ³¨å†Œåˆ°BeanFactoryä¸­çš„æ˜¯ä¸€ä¸ªä»£ç†ç±»MapperProxyï¼Œæˆ‘ä»¬çŸ¥é“è¢«ä»£ç†çš„æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°ä»£ç†ç±»çš„invokeæ–¹æ³•: 1234567891011121314@Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { try { if (Object.class.equals(method.getDeclaringClass())) { return method.invoke(this, args); } else if (isDefaultMethod(method)) { return invokeDefaultMethod(proxy, method, args); } } catch (Throwable t) { throw ExceptionUtil.unwrapThrowable(t); } final MapperMethod mapperMethod = cachedMapperMethod(method); return mapperMethod.execute(sqlSession, args); } å¦‚æœä¸æ˜¯Objectç±»çš„æ–¹æ³•ï¼Œä¹Ÿä¸æ˜¯Mapperæ¥å£çš„defaultï¼ˆé»˜è®¤ï¼‰æ–¹æ³•ï¼Œé‚£ä¹ˆè°ƒç”¨çš„æ˜¯mapperMethod.execute(sqlSession, args): 123456789101112131415161718192021222324252627282930313233343536373839404142434445public Object execute(SqlSession sqlSession, Object[] args) { Object result; switch (command.getType()) { case INSERT: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.insert(command.getName(), param)); break; } case UPDATE: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.update(command.getName(), param)); break; } case DELETE: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.delete(command.getName(), param)); break; } case SELECT: if (method.returnsVoid() &amp;&amp; method.hasResultHandler()) { executeWithResultHandler(sqlSession, args); result = null; } else if (method.returnsMany()) { result = executeForMany(sqlSession, args); } else if (method.returnsMap()) { result = executeForMap(sqlSession, args); } else if (method.returnsCursor()) { result = executeForCursor(sqlSession, args); } else { Object param = method.convertArgsToSqlCommandParam(args); result = sqlSession.selectOne(command.getName(), param); } break; case FLUSH: result = sqlSession.flushStatements(); break; default: throw new BindingException(&quot;Unknown execution method for: &quot; + command.getName()); } if (result == null &amp;&amp; method.getReturnType().isPrimitive() &amp;&amp; !method.returnsVoid()) { throw new BindingException(&quot;Mapper method '&quot; + command.getName() + &quot; attempted to return null from a method with a primitive return type (&quot; + method.getReturnType() + &quot;).&quot;); } return result; } åˆ°è¿™å°±å·®ä¸å¤šäº†å§ï¼Ÿåé¢å·²ç»æ²¡å•¥å¥½è¯´äº†ï¼ŒåŸºæœ¬å°±æ˜¯é€šè¿‡statement nameæ‰¾åˆ°MappedStatementç„¶åå»æ‰§è¡Œsqläº†ã€‚ å¦å¤–ä¸€ä¸ªå°çŸ¥è¯†ï¼ŒMybatisæ˜¯æ€ä¹ˆåœ¨æ’å…¥ä¹‹åè¿”å›è‡ªå¢ä¸»é”®çš„ï¼Ÿç­”æ¡ˆå°±åœ¨ï¼š org.apache.ibatis.executor.statement.PreparedStatementHandler#update org.apache.ibatis.executor.keygen.KeyGenerator#processAfter å†™åœ¨æœ€åSpringä»£ç å®åœ¨å¤ªéš¾çœ‹äº†ï¼Œä¸€ç¯å¥—ä¸€ç¯ï¼Œå„ç§é€’å½’ï¼Œå¿…é¡»debugæ‰èƒ½çœ‹æ¸…ã€‚","link":"/archives/fb5cf917.html"},{"title":"Nettyä¸­FastThreadLocalæºç è§£æ","text":"ç®€ä»‹ThreadLocalä¸€ä¸ªç‰¹æ®Šå˜ä½“ï¼Œå½“ä»FastThreadLocalThreadè®¿é—®æ—¶ï¼Œå¯è·å¾—æ›´é«˜çš„è®¿é—®æ€§èƒ½ã€‚åœ¨å†…éƒ¨ï¼Œ FastThreadLocalåœ¨æ•°ç»„ä¸­ä½¿ç”¨å¸¸é‡ç´¢å¼•æ¥æŸ¥æ‰¾å˜é‡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å“ˆå¸Œç å’Œå“ˆå¸Œè¡¨ã€‚ å°½ç®¡çœ‹ä¼¼éå¸¸å¾®å¦™ï¼Œä½†ä¸ä½¿ç”¨å“ˆå¸Œè¡¨ç›¸æ¯”ï¼Œå®ƒåœ¨æ€§èƒ½ä¸Šå´æœ‰ä¸€ç‚¹ä¼˜åŠ¿ï¼Œå¹¶ä¸”åœ¨ç»å¸¸è®¿é—®æ—¶å¾ˆæœ‰ç”¨ã€‚è¦åˆ©ç”¨æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ‚¨çš„çº¿ç¨‹å¿…é¡»æ˜¯FastThreadLocalThreadæˆ–å…¶å­ç±»å‹ã€‚ ç”±äºè¿™ä¸ªåŸå› ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ DefaultThreadFactoryåˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹å‡ä¸ºFastThreadLocalThread ã€‚è¯·æ³¨æ„ï¼Œåªæœ‰åœ¨æ‰©å±•FastThreadLocalThreadçº¿ç¨‹ä¸Šæ‰å¯ä»¥ä½¿ç”¨å¿«é€Ÿè·¯å¾„ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µæ¥å­˜å‚¨å¿…è¦çš„çŠ¶æ€ã€‚ ä»»ä½•å…¶ä»–ç±»å‹çš„çº¿ç¨‹çš„è®¿é—®éƒ½å›é€€åˆ°å¸¸è§„ThreadLocal ã€‚ ä¸Šé¢è¿™æ®µæè¿°æ¥è‡ªFastThreadLocalæºç ä¸­çš„æ–‡æ¡£ï¼Œä»ä¸­å¯ä»¥çŸ¥é“FastThreadLocalå¿…é¡»å’ŒFastThreadLocalThreadæˆ–å…¶å­ç±»å‹ä¸€èµ·ä½¿ç”¨æ‰å¯ä»¥è¾¾åˆ°Fastçš„æ•ˆæœã€‚ FastThreadLocalThreadæ—¢ç„¶å¿…é¡»è¦å’ŒFastThreadLocalThread ä¸€èµ·ä½¿ç”¨ï¼Œé‚£å°±æ¥çœ‹çœ‹FastThreadLocalThreadåˆ°åº•æœ‰ä»€ä¹ˆï¼š 123456789101112131415161718192021/** * A special {@link Thread} that provides fast access to {@link FastThreadLocal} variables. * ä¸€ç§ç‰¹æ®Šçš„{@link Thread}ï¼Œå¯ä»¥å¿«é€Ÿè®¿é—®{@link FastThreadLocal}å˜é‡ã€‚ */public class FastThreadLocalThread extends Thread { // This will be set to true if we have a chance to wrap the Runnable. private final boolean cleanupFastThreadLocals; private InternalThreadLocalMap threadLocalMap; public FastThreadLocalThread() { cleanupFastThreadLocals = false; } public FastThreadLocalThread(Runnable target) { super(FastThreadLocalRunnable.wrap(target)); cleanupFastThreadLocals = true; }â€¦â€¦ çœç•¥äº†ä¸€éƒ¨åˆ†ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°FastThreadLocalThreadç»§æ‰¿è‡ªThreadï¼Œé¢å¤–å¤šäº†ä¸€ä¸ªInternalThreadLocalMap threadLocalMapï¼Œä»docä¸­å¯ä»¥çœ‹å‡ºè¿™ä¸ªå˜é‡å°±æ˜¯å…³é”®ã€‚ InternalThreadLocalMap1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768/** * The internal data structure that stores the thread-local variables for Netty and all {@link FastThreadLocal}s. * Note that this class is for internal use only and is subject to change at any time. Use {@link FastThreadLocal} * unless you know what you are doing. */public final class InternalThreadLocalMap extends UnpaddedInternalThreadLocalMap { static final ThreadLocal&lt;InternalThreadLocalMap&gt; slowThreadLocalMap = new ThreadLocal&lt;InternalThreadLocalMap&gt;(); static final AtomicInteger nextIndex = new AtomicInteger(); /** Used by {@link FastThreadLocal} */ Object[] indexedVariables; public static final Object UNSET = new Object(); public static InternalThreadLocalMap get() { Thread thread = Thread.currentThread(); if (thread instanceof FastThreadLocalThread) { return fastGet((FastThreadLocalThread) thread); } else { return slowGet(); } } private static InternalThreadLocalMap fastGet(FastThreadLocalThread thread) { InternalThreadLocalMap threadLocalMap = thread.threadLocalMap(); if (threadLocalMap == null) { thread.setThreadLocalMap(threadLocalMap = new InternalThreadLocalMap()); } return threadLocalMap; } private static InternalThreadLocalMap slowGet() { ThreadLocal&lt;InternalThreadLocalMap&gt; slowThreadLocalMap = UnpaddedInternalThreadLocalMap.slowThreadLocalMap; InternalThreadLocalMap ret = slowThreadLocalMap.get(); if (ret == null) { ret = new InternalThreadLocalMap(); slowThreadLocalMap.set(ret); } return ret; } public static int nextVariableIndex() { int index = nextIndex.getAndIncrement(); if (index &lt; 0) { nextIndex.decrementAndGet(); throw new IllegalStateException(&quot;too many thread-local indexed variables&quot;); } return index; } /** * @return {@code true} if and only if a new thread-local variable has been created */ public boolean setIndexedVariable(int index, Object value) { Object[] lookup = indexedVariables; if (index &lt; lookup.length) { Object oldValue = lookup[index]; lookup[index] = value; return oldValue == UNSET; } else { expandIndexedVariableTableAndSet(index, value); return true; } } InternalThreadLocalMapç»§æ‰¿è‡ªUnpaddedInternalThreadLocalMapï¼Œä¸ºäº†å¥½çœ‹ä¸€ç‚¹æˆ‘æŠŠçˆ¶ç±»ä¸­çš„ç›¸å…³ä»£ç æ”¾åˆ°äº†ä¸€èµ·ï¼Œdubboå€Ÿé‰´nettyä»£ç ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ã€‚ FastThreadLocalæœ€åçœ‹çœ‹FastThreadLocalæ˜¯æ€ä¹ˆæŠŠè¿™å‡ ä¸ªæ ¸å¿ƒç±»ç»™ä¸²èµ·æ¥çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445public class FastThreadLocal&lt;V&gt; { private static final int variablesToRemoveIndex = InternalThreadLocalMap.nextVariableIndex(); private final int index; public FastThreadLocal() { index = InternalThreadLocalMap.nextVariableIndex(); } /** * Returns the current value for the current thread */ @SuppressWarnings(&quot;unchecked&quot;) public final V get() { InternalThreadLocalMap threadLocalMap = InternalThreadLocalMap.get(); Object v = threadLocalMap.indexedVariable(index); if (v != InternalThreadLocalMap.UNSET) { return (V) v; } return initialize(threadLocalMap); } private V initialize(InternalThreadLocalMap threadLocalMap) { V v = null; try { v = initialValue(); } catch (Exception e) { PlatformDependent.throwException(e); } threadLocalMap.setIndexedVariable(index, v); addToVariablesToRemove(threadLocalMap, this); return v; } /** * Returns the initial value for this thread-local variable. * è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬ä¼šæŠŠè¦†ç›– */ protected V initialValue() throws Exception { return null; } å…«å¦https://github.com/apache/dubbo/pull/1745","link":"/archives/4b47846d.html"},{"title":"MySQL äº‹åŠ¡æŸ¥è¯¢","text":"æŸ¥è¯¢äº‹åŠ¡SELECT * FROM information_schema.INNODB_TRX; æŸ¥è¯¢æ­£åœ¨é”çš„äº‹åŠ¡SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCKS; æŸ¥è¯¢ç­‰å¾…é”çš„äº‹åŠ¡SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITS; æŸ¥è¯¢è¿›ç¨‹show PROCESSLIST; æŸ¥è¯¢æ˜¯å¦é”è¡¨show OPEN TABLES where In_use &gt; 0;","link":"/archives/c1627f94.html"},{"title":"PriorityQueueè§£æ","text":"æœ¬æ–‡è½¬è½½è‡³githubï¼šhttps://github.com/CarpenterLee/JCFInternals/blob/master/markdown/8-PriorityQueue.md PriorityQueueæ€»ä½“ä»‹ç»å‰é¢ä»¥Java ArrayDequeä¸ºä¾‹è®²è§£äº†Stackå’ŒQueueï¼Œå…¶å®è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—å«åšPriorityQueueï¼Œå³ä¼˜å…ˆé˜Ÿåˆ—ã€‚ä¼˜å…ˆé˜Ÿåˆ—çš„ä½œç”¨æ˜¯èƒ½ä¿è¯æ¯æ¬¡å–å‡ºçš„å…ƒç´ éƒ½æ˜¯é˜Ÿåˆ—ä¸­æƒå€¼æœ€å°çš„ï¼ˆJavaçš„ä¼˜å…ˆé˜Ÿåˆ—æ¯æ¬¡å–æœ€å°å…ƒç´ ï¼ŒC++çš„ä¼˜å…ˆé˜Ÿåˆ—æ¯æ¬¡å–æœ€å¤§å…ƒç´ ï¼‰ã€‚è¿™é‡Œç‰µæ¶‰åˆ°äº†å¤§å°å…³ç³»ï¼Œå…ƒç´ å¤§å°çš„è¯„åˆ¤å¯ä»¥é€šè¿‡å…ƒç´ æœ¬èº«çš„è‡ªç„¶é¡ºåºï¼ˆnatural orderingï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ—¶ä¼ å…¥çš„æ¯”è¾ƒå™¨ï¼ˆComparatorï¼Œç±»ä¼¼äºC++çš„ä»¿å‡½æ•°ï¼‰ã€‚ Javaä¸­PriorityQueueå®ç°äº†Queueæ¥å£ï¼Œä¸å…è®¸æ”¾å…¥nullå…ƒç´ ï¼›å…¶é€šè¿‡å †å®ç°ï¼Œå…·ä½“è¯´æ˜¯é€šè¿‡å®Œå…¨äºŒå‰æ ‘ï¼ˆcomplete binary treeï¼‰å®ç°çš„å°é¡¶å †ï¼ˆä»»æ„ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„æƒå€¼ï¼Œéƒ½ä¸å¤§äºå…¶å·¦å³å­èŠ‚ç‚¹çš„æƒå€¼ï¼‰ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥é€šè¿‡æ•°ç»„æ¥ä½œä¸ºPriorityQueueçš„åº•å±‚å®ç°ã€‚ ä¸Šå›¾ä¸­æˆ‘ä»¬ç»™æ¯ä¸ªå…ƒç´ æŒ‰ç…§å±‚åºéå†çš„æ–¹å¼è¿›è¡Œäº†ç¼–å·ï¼Œå¦‚æœä½ è¶³å¤Ÿç»†å¿ƒï¼Œä¼šå‘ç°çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„ç¼–å·æ˜¯æœ‰è”ç³»çš„ï¼Œæ›´ç¡®åˆ‡çš„è¯´çˆ¶å­èŠ‚ç‚¹çš„ç¼–å·ä¹‹é—´æœ‰å¦‚ä¸‹å…³ç³»ï¼š leftNo = parentNo*2+1 rightNo = parentNo*2+2 parentNo = (nodeNo-1)/2 é€šè¿‡ä¸Šè¿°ä¸‰ä¸ªå…¬å¼ï¼Œå¯ä»¥è½»æ˜“è®¡ç®—å‡ºæŸä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä»¥åŠå­èŠ‚ç‚¹çš„ä¸‹æ ‡ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ç”¨æ•°ç»„æ¥å­˜å‚¨å †çš„åŸå› ã€‚ PriorityQueueçš„peek()å’Œelementæ“ä½œæ˜¯å¸¸æ•°æ—¶é—´ï¼Œadd(), offer(), æ— å‚æ•°çš„remove()ä»¥åŠpoll()æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯*log(N)*ã€‚ æ–¹æ³•å‰–æadd()å’Œoffer()add(E e)å’Œoffer(E e)çš„è¯­ä¹‰ç›¸åŒï¼Œéƒ½æ˜¯å‘ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ’å…¥å…ƒç´ ï¼Œåªæ˜¯Queueæ¥å£è§„å®šäºŒè€…å¯¹æ’å…¥å¤±è´¥æ—¶çš„å¤„ç†ä¸åŒï¼Œå‰è€…åœ¨æ’å…¥å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œååˆ™åˆ™ä¼šè¿”å›falseã€‚å¯¹äºPriorityQueueè¿™ä¸¤ä¸ªæ–¹æ³•å…¶å®æ²¡ä»€ä¹ˆå·®åˆ«ã€‚ æ–°åŠ å…¥çš„å…ƒç´ å¯èƒ½ä¼šç ´åå°é¡¶å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚ 123456789101112131415//offer(E e)public boolean offer(E e) { if (e == null)//ä¸å…è®¸æ”¾å…¥nullå…ƒç´  throw new NullPointerException(); modCount++; int i = size; if (i &gt;= queue.length) grow(i + 1);//è‡ªåŠ¨æ‰©å®¹ size = i + 1; if (i == 0)//é˜Ÿåˆ—åŸæ¥ä¸ºç©ºï¼Œè¿™æ˜¯æ’å…¥çš„ç¬¬ä¸€ä¸ªå…ƒç´  queue[0] = e; else siftUp(i, e);//è°ƒæ•´ return true;} ä¸Šè¿°ä»£ç ä¸­ï¼Œæ‰©å®¹å‡½æ•°grow()ç±»ä¼¼äºArrayListé‡Œçš„grow()å‡½æ•°ï¼Œå°±æ˜¯å†ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œå¹¶å°†åŸæ•°ç»„çš„å…ƒç´ å¤åˆ¶è¿‡å»ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯siftUp(int k, E x)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºæ’å…¥å…ƒç´ xå¹¶ç»´æŒå †çš„ç‰¹æ€§ã€‚ 123456789101112//siftUp()private void siftUp(int k, E x) { while (k &gt; 0) { int parent = (k - 1) &gt;&gt;&gt; 1;//parentNo = (nodeNo-1)/2 Object e = queue[parent]; if (comparator.compare(x, (E) e) &gt;= 0)//è°ƒç”¨æ¯”è¾ƒå™¨çš„æ¯”è¾ƒæ–¹æ³• break; queue[k] = e; k = parent; } queue[k] = x;} æ–°åŠ å…¥çš„å…ƒç´ xå¯èƒ½ä¼šç ´åå°é¡¶å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚è°ƒæ•´çš„è¿‡ç¨‹ä¸ºï¼šä»kæŒ‡å®šçš„ä½ç½®å¼€å§‹ï¼Œå°†xé€å±‚ä¸å½“å‰ç‚¹çš„parentè¿›è¡Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œç›´åˆ°æ»¡è¶³x &gt;= queue[parent]ä¸ºæ­¢ã€‚æ³¨æ„è¿™é‡Œçš„æ¯”è¾ƒå¯ä»¥æ˜¯å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¾é æ¯”è¾ƒå™¨çš„é¡ºåºã€‚ element()å’Œpeek()element()å’Œpeek()çš„è¯­ä¹‰å®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—ä¸­æƒå€¼æœ€å°çš„é‚£ä¸ªå…ƒç´ ï¼ŒäºŒè€…å”¯ä¸€çš„åŒºåˆ«æ˜¯å½“æ–¹æ³•å¤±è´¥æ—¶å‰è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåè€…è¿”å›nullã€‚æ ¹æ®å°é¡¶å †çš„æ€§è´¨ï¼Œå †é¡¶é‚£ä¸ªå…ƒç´ å°±æ˜¯å…¨å±€æœ€å°çš„é‚£ä¸ªï¼›ç”±äºå †ç”¨æ•°ç»„è¡¨ç¤ºï¼Œæ ¹æ®ä¸‹æ ‡å…³ç³»ï¼Œ0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ æ—¢æ˜¯å †é¡¶å…ƒç´ ã€‚æ‰€ä»¥ç›´æ¥è¿”å›æ•°ç»„0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å³å¯ã€‚ ä»£ç ä¹Ÿå°±éå¸¸ç®€æ´ï¼š 123456//peek()public E peek() { if (size == 0) return null; return (E) queue[0];//0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æœ€å°çš„é‚£ä¸ª} remove()å’Œpoll()remove()å’Œpoll()æ–¹æ³•çš„è¯­ä¹‰ä¹Ÿå®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼ŒåŒºåˆ«æ˜¯å½“æ–¹æ³•å¤±è´¥æ—¶å‰è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåè€…è¿”å›nullã€‚ç”±äºåˆ é™¤æ“ä½œä¼šæ”¹å˜é˜Ÿåˆ—çš„ç»“æ„ï¼Œä¸ºç»´æŠ¤å°é¡¶å †çš„æ€§è´¨ï¼Œéœ€è¦è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚ ä»£ç å¦‚ä¸‹ï¼š 123456789101112public E poll() { if (size == 0) return null; int s = --size; modCount++; E result = (E) queue[0];//0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æœ€å°çš„é‚£ä¸ª E x = (E) queue[s]; queue[s] = null; if (s != 0) siftDown(0, x);//è°ƒæ•´ return result;} ä¸Šè¿°ä»£ç é¦–å…ˆè®°å½•0ä¸‹æ ‡å¤„çš„å…ƒç´ ï¼Œå¹¶ç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢0ä¸‹æ ‡ä½ç½®çš„å…ƒç´ ï¼Œä¹‹åè°ƒç”¨siftDown()æ–¹æ³•å¯¹å †è¿›è¡Œè°ƒæ•´ï¼Œæœ€åè¿”å›åŸæ¥0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æœ€å°çš„é‚£ä¸ªå…ƒç´ ï¼‰ã€‚é‡ç‚¹æ˜¯siftDown(int k, E x)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯ä»kæŒ‡å®šçš„ä½ç½®å¼€å§‹ï¼Œå°†xé€å±‚å‘ä¸‹ä¸å½“å‰ç‚¹çš„å·¦å³å­©å­ä¸­è¾ƒå°çš„é‚£ä¸ªäº¤æ¢ï¼Œç›´åˆ°xå°äºæˆ–ç­‰äºå·¦å³å­©å­ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸ºæ­¢ã€‚ 123456789101112131415161718//siftDown()private void siftDown(int k, E x) { int half = size &gt;&gt;&gt; 1; while (k &lt; half) { //é¦–å…ˆæ‰¾åˆ°å·¦å³å­©å­ä¸­è¾ƒå°çš„é‚£ä¸ªï¼Œè®°å½•åˆ°cé‡Œï¼Œå¹¶ç”¨childè®°å½•å…¶ä¸‹æ ‡ int child = (k &lt;&lt; 1) + 1;//leftNo = parentNo*2+1 Object c = queue[child]; int right = child + 1; if (right &lt; size &amp;&amp; comparator.compare((E) c, (E) queue[right]) &gt; 0) c = queue[child = right]; if (comparator.compare(x, (E) c) &lt;= 0) break; queue[k] = c;//ç„¶åç”¨cå–ä»£åŸæ¥çš„å€¼ k = child; } queue[k] = x;} remove(Object o)remove(Object o)æ–¹æ³•ç”¨äºåˆ é™¤é˜Ÿåˆ—ä¸­è·Ÿoç›¸ç­‰çš„æŸä¸€ä¸ªå…ƒç´ ï¼ˆå¦‚æœæœ‰å¤šä¸ªç›¸ç­‰ï¼Œåªåˆ é™¤ä¸€ä¸ªï¼‰ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯Queueæ¥å£å†…çš„æ–¹æ³•ï¼Œè€Œæ˜¯Collectionæ¥å£çš„æ–¹æ³•ã€‚ç”±äºåˆ é™¤æ“ä½œä¼šæ”¹å˜é˜Ÿåˆ—ç»“æ„ï¼Œæ‰€ä»¥è¦è¿›è¡Œè°ƒæ•´ï¼›åˆç”±äºåˆ é™¤å…ƒç´ çš„ä½ç½®å¯èƒ½æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥è°ƒæ•´è¿‡ç¨‹æ¯”å…¶å®ƒå‡½æ•°ç¨åŠ ç¹çã€‚å…·ä½“æ¥è¯´ï¼Œremove(Object o)å¯ä»¥åˆ†ä¸º2ç§æƒ…å†µï¼š1. åˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç›´æ¥åˆ é™¤å³å¯ï¼Œä¸éœ€è¦è°ƒæ•´ã€‚2. åˆ é™¤çš„ä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»åˆ é™¤ç‚¹å¼€å§‹ä»¥æœ€åä¸€ä¸ªå…ƒç´ ä¸ºå‚ç…§è°ƒç”¨ä¸€æ¬¡siftDown()å³å¯ã€‚æ­¤å¤„ä¸å†èµ˜è¿°ã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617//remove(Object o)public boolean remove(Object o) { //é€šè¿‡éå†æ•°ç»„çš„æ–¹å¼æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³o.equals(queue[i])å…ƒç´ çš„ä¸‹æ ‡ int i = indexOf(o); if (i == -1) return false; int s = --size; if (s == i) //æƒ…å†µ1 queue[i] = null; else { E moved = (E) queue[s]; queue[s] = null; siftDown(i, moved);//æƒ…å†µ2 ...... } return true;}","link":"/archives/f50feeee.html"},{"title":"RocketMQ RMQ_SYS_TRANS_HALF_TOPIC çˆ†æ‰çš„é—®é¢˜","text":"ç°è±¡SaaSé¡¹ç›®ä¸œéƒ­ååº”ï¼Œé¡¹ç›®ä¸­å‘çš„äº‹åŠ¡æ¶ˆæ¯ä¸€ç›´åœ¨RMQ_SYS_TRANS_HALF_TOPICä¸­ï¼Œå¹¶ä¸”ä¸æ–­å¢é•¿ã€‚éšå³æˆ‘ä»¬æŸ¥çœ‹RocketMQæ—¥å¿—å‘ç°å¦‚ä¸‹æƒ…å†µï¼š è¿™ä¸ªæœ¬æ¥æ˜¯RocketMQæ­£å¸¸çš„é€»è¾‘ï¼Œå‘é€äº‹åŠ¡æ¶ˆæ¯åæ²¡æœ‰æäº¤çŠ¶æ€çš„è¯ï¼Œå½“è¾¾åˆ°è¶…æ—¶æ—¶é—´åï¼ŒRocketMQä¼šå›æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€ã€‚è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯å›æŸ¥çš„æ¬¡æ•°è¶…é™ï¼Œæ¶ˆæ¯è¢«ç§»åˆ°äº†TRANS_CHECK_MAXTIME_TOPICä¸­ã€‚ ä¸æ­£å¸¸çš„æ˜¯REAL_TOPICå˜æˆäº†RMQ_SYS_TRANS_HALF_TOPICï¼Œæ­£å¸¸åº”è¯¥æ˜¯åŸå§‹çš„ä¸šåŠ¡æ¶ˆæ¯TOPICæ‰å¯¹ã€‚äºæ˜¯æˆ‘ä»¬å¸¦ç€è¿™ä¸ªé—®é¢˜å¼€å§‹æ’æŸ¥èµ·æ¥ã€‚ è¿½è¸ªä¸€ã€æ’æŸ¥ä¸€å¼€å§‹æˆ‘ä»¬ä»¥ä¸ºæ˜¯Producerçš„é—®é¢˜ï¼Œå› ä¸ºå¾—åˆ°çš„åé¦ˆæ˜¯è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«â€œæ¶ˆè´¹â€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å§‹æ’æŸ¥Produceræ‰€åœ¨çš„é¡¹ç›®ã€‚å‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚åæ¥æˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸Šè¿°æ—¥å¿—ä¸­æœ‰ä¸€ä¸ªDELAY=3ï¼Œç»“åˆåœ¨ç½‘ä¸ŠæŸ¥è¯¢çš„èµ„æ–™ï¼Œè®¤ä¸ºå¯èƒ½æ˜¯è§¦å‘äº†RocketMQçš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡æ¶ˆæ¯è¿›è¡Œäº†å»¶è¿Ÿå‘é€ã€‚æˆ‘ä»¬ä»¥ä¸ºå¿«æ¥è¿‘çœŸç›¸äº†ï¼Œæˆ‘ä»¬å¼€å§‹æŸ¥æ‰¾Produceræ˜¯å¦åœ¨å‘é€äº‹åŠ¡æ¶ˆæ¯æ—¶è®¾ç½®äº†DELAYå‚æ•°ã€‚å¾ˆå¿«æˆ‘ä»¬å°±å¤±æœ›äº†ï¼ŒProduceræ²¡æœ‰ä»»ä½•åœ°æ–¹è®¾ç½®äº†DELAYå‚æ•°ã€‚ äºŒã€ç¿»é˜…æºç æˆ‘ä»¬å›å¤´å»çœ‹ä¸Šé¢é‚£ä¸ªæ—¥å¿—ï¼Œå‘ç°RECONSUME_TIME=1å¹¶ä¸”RETRY_TOPICä¹Ÿä¸ä¸ºç©ºï¼Œè¿™è¯´æ˜è¿™ä¸ªæ¶ˆæ¯è‚¯å®šæ˜¯è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°äº†ï¼Œä½†æ˜¯ç”±äºæŸç§åŸå› æ¶ˆè´¹å¤±è´¥äº†ï¼Œè§¦å‘äº†é‡è¯•ã€‚äºæ˜¯æˆ‘ä»¬å¼€å§‹çœ‹RocketMQé‡è¯•ç›¸å…³æºç ã€‚æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°äº†DELAY=3è¿™ä¸ªå‚æ•°çš„æ¥æºï¼š 123456789101112131415161718//åœ¨æˆ‘ä»¬çš„æ¶ˆè´¹è€…ä¸­è®¾ç½®äº†ConsumeConcurrentlyContext å»¶æ—¶çº§åˆ«context.setDelayLevelWhenNextConsume(getDelayLevelWhenNextConsume(reconsumeTimes));//å¯ä»¥çœ‹åˆ°è¿™ä¸ªdelayLevelæœ€ç»ˆæ˜¯ä¼šè¢«å‘é€åˆ°broker//org.apache.rocketmq.client.impl.consumer.ConsumeMessageConcurrentlyService#sendMessageBackpublic boolean sendMessageBack(final MessageExt msg, final ConsumeConcurrentlyContext context) { int delayLevel = context.getDelayLevelWhenNextConsume(); // Wrap topic with namespace before sending back message. msg.setTopic(this.defaultMQPushConsumer.withNamespace(msg.getTopic())); try { this.defaultMQPushConsumerImpl.sendMessageBack(msg, delayLevel, context.getMessageQueue().getBrokerName()); return true; } catch (Exception e) { log.error(&quot;sendMessageBack exception, group: &quot; + this.consumerGroup + &quot; msg: &quot; + msg.toString(), e); } return false;} æˆ‘ä»¬æ‰¾åˆ°å¯¹åº”brokerç‰ˆæœ¬(4.6.0)çš„æºç ä¸€æ­¥æ­¥æ‰¾åˆ°äº†è¿™é‡Œï¼š 12345678910111213141516171819202122//org.apache.rocketmq.store.CommitLog#putMessagefinal int tranType = MessageSysFlag.getTransactionValue(msg.getSysFlag());if (tranType == MessageSysFlag.TRANSACTION_NOT_TYPE || tranType == MessageSysFlag.TRANSACTION_COMMIT_TYPE) { // Delay Delivery if (msg.getDelayTimeLevel() &gt; 0) { if (msg.getDelayTimeLevel() &gt; this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()) { msg.setDelayTimeLevel(this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()); } topic = ScheduleMessageService.SCHEDULE_TOPIC; queueId = ScheduleMessageService.delayLevel2QueueId(msg.getDelayTimeLevel()); // Backup real topic, queueId MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_TOPIC, msg.getTopic()); MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msg.getQueueId())); msg.setPropertiesString(MessageDecoder.messageProperties2String(msg.getProperties())); msg.setTopic(topic); msg.setQueueId(queueId); }} å¯¹ç…§ä¹‹å‰æ—¥å¿—é‡Œçš„å‚æ•°ï¼ŒsysFlag=8,delay=3ï¼Œæˆ‘ä»¬è®¤ä¸ºå¾ˆå¯èƒ½èµ°äº†è¿™æ®µé€»è¾‘ï¼Œç„¶åè§¦å‘äº†äº‹åŠ¡æ¶ˆæ¯è¿›è¡Œäº†å»¶è¿Ÿå‘é€çš„é—®é¢˜ã€‚ç»§ç»­çœ‹äº†å»¶æ—¶æ¶ˆæ¯å‘é€çš„é€»è¾‘ï¼Œæ²¡æœ‰æ‰¾åˆ°é—®é¢˜ï¼Œè€Œä¸”è¿™ä¹Ÿè§£é‡Šä¸äº†ä¸ºä»€ä¹ˆREAL_TOPICå˜æˆäº†``RMQ_SYS_TRANS_HALF_TOPIC` ä¸‰ã€çœŸç›¸ä¸Šé¢è¿˜æåˆ°äº†ä¸€ä¸ªRETRY_TOPICï¼Œè¿™ä¸ªåœ¨ä¹‹å‰çš„æ’æŸ¥è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç°æœ‰ä»€ä¹ˆåœ°æ–¹è®¾ç½®ï¼Œäºæ˜¯æˆ‘ä»¬æœç´¢äº†ä¸€æŠŠï¼Œå‘ç°åœ¨è¿™é‡Œï¼š 123456789101112131415161718192021222324252627282930//org.apache.rocketmq.client.impl.consumer.DefaultMQPushConsumerImpl#sendMessageBackpublic void sendMessageBack(MessageExt msg, int delayLevel, final String brokerName) throws RemotingException, MQBrokerException, InterruptedException, MQClientException { try { String brokerAddr = (null != brokerName) ? this.mQClientFactory.findBrokerAddressInPublish(brokerName) : RemotingHelper.parseSocketAddressAddr(msg.getStoreHost()); this.mQClientFactory.getMQClientAPIImpl().consumerSendMessageBack(brokerAddr, msg, this.defaultMQPushConsumer.getConsumerGroup(), delayLevel, 5000, getMaxReconsumeTimes()); } catch (Exception e) { log.error(&quot;sendMessageBack Exception, &quot; + this.defaultMQPushConsumer.getConsumerGroup(), e); Message newMsg = new Message(MixAll.getRetryTopic(this.defaultMQPushConsumer.getConsumerGroup()), msg.getBody()); String originMsgId = MessageAccessor.getOriginMessageId(msg); MessageAccessor.setOriginMessageId(newMsg, UtilAll.isBlank(originMsgId) ? msg.getMsgId() : originMsgId); newMsg.setFlag(msg.getFlag()); MessageAccessor.setProperties(newMsg, msg.getProperties()); //è¿™é‡Œè®¾ç½®äº†RETRY_TOPIC MessageAccessor.putProperty(newMsg, MessageConst.PROPERTY_RETRY_TOPIC, msg.getTopic()); MessageAccessor.setReconsumeTime(newMsg, String.valueOf(msg.getReconsumeTimes() + 1)); MessageAccessor.setMaxReconsumeTimes(newMsg, String.valueOf(getMaxReconsumeTimes())); newMsg.setDelayTimeLevel(3 + msg.getReconsumeTimes()); this.mQClientFactory.getDefaultMQProducer().send(newMsg); } finally { msg.setTopic(NamespaceUtil.withoutNamespace(msg.getTopic(), this.defaultMQPushConsumer.getNamespace())); }} å¾ˆæ˜æ˜¾æ˜¯ä¸ªå¼‚å¸¸æµç¨‹ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆå¯¼è‡´äº†è¿™ä¸ªå¼‚å¸¸æµç¨‹å‘¢ï¼Ÿæ—¢ç„¶çŸ¥é“æ˜¯åœ¨æ¶ˆè´¹çš„æ—¶å€™å‡ºäº†å¼‚å¸¸ï¼Œäºæ˜¯æˆ‘ä»¬æ‰¾åˆ°å¯¹åº”çš„æ¶ˆè´¹è€…æ—¥å¿—ï¼Œå‘ç°å¦‚ä¸‹é”™è¯¯ï¼š è¿™é‡ŒBrokerè¿”å›çš„é”™è¯¯æ˜¯MESSAGE_ILIEGALï¼Œåœ¨å›è¿‡å¤´å»çœ‹é‡è¯•ç›¸å…³ä»£ç ï¼Œæœ‰äº†ä¹‹å‰çš„ç»éªŒè¿™æ¬¡å¾ˆå¿«å°±å®šä½åˆ°äº†å¯èƒ½æŠ¥è¿™ä¸ªé”™è¯¯çš„åœ°æ–¹ï¼š 12345678910111213//ç¬¬ä¸€å¤„ï¼šorg.apache.rocketmq.store.DefaultMessageStore#putMessage if (msg.getTopic().length() &gt; Byte.MAX_VALUE) { log.warn(&quot;putMessage message topic length too long &quot; + msg.getTopic().length()); return new PutMessageResult(PutMessageStatus.MESSAGE_ILLEGAL, null); }//ç¬¬äºŒå¤„ï¼šorg.apache.rocketmq.store.CommitLog.DefaultAppendMessageCallback#doAppend(long, java.nio.ByteBuffer, int, org.apache.rocketmq.store.MessageExtBrokerInner)if (propertiesLength &gt; Short.MAX_VALUE) { log.warn(&quot;putMessage message properties length too long. length={}&quot;, propertiesData.length); return new AppendMessageResult(AppendMessageStatus.PROPERTIES_SIZE_EXCEEDED);} case PROPERTIES_SIZE_EXCEEDED: beginTimeInLock = 0; return new PutMessageResult(PutMessageStatus.MESSAGE_ILLEGAL, result); æœæ–­æ‰¾è¿ç»´è¦äº†store.logï¼Œå‘ç°å¦‚ä¸‹é”™è¯¯ï¼š 1WARN SendMessageThread_1 - putMessage message topic length too long 149 æ‰€ä»¥åº”è¯¥å°±æ˜¯ç¬¬ä¸€å¤„çš„é—®é¢˜äº†ã€‚è‡³æ­¤é—®é¢˜çš„åŸå› åŸºæœ¬æ‰¾åˆ°äº†ï¼Œä½†è¿˜æœ‰ä»¥ä¸‹é—®é¢˜ï¼š ä¸ºä»€ä¹ˆTOPICä¼šè¶…é•¿ï¼Ÿ é‡è¯•çš„æ¶ˆæ¯TOPICè§„åˆ™ä¸º%RETRY%+consumerGroupï¼š 1MixAll.getRetryTopic(this.defaultMQPushConsumer.getConsumerGroup()) è€Œæˆ‘ä»¬çš„consumerGroupçš„è§„åˆ™ä¸ºï¼š 123public String getGroup() { return group + &quot;_&quot; + getTopic() + &quot;_&quot; + getTags();} æœ‰é—®é¢˜çš„consumerçš„tagsä¸ºï¼šSAAS_PURCHASE_PURCHASE_ORDER_UPDATE||SAAS_PURCHASE_PURCHASE_ORDER_OPEN_RECEVIED||SAAS_PURCHASE_PURCHASE_ORDER_COMPLETED_RECEVIED æ‰€ä»¥æœ€ç»ˆæ‹¼å‡ºæ¥çš„TOPICè¶…å‡ºäº†é•¿åº¦ã€‚ ä¸ºä»€ä¹ˆèµ°äº†Catché‡Œé¢çš„æµç¨‹å°±ä¼šå¯¼è‡´HALFé˜Ÿåˆ—çˆ†æ‰ï¼Ÿ è¿™æ˜¯ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„RocketMQ-clientç‰ˆæœ¬ä¸º4.5.0ï¼Œè¿™ä¸ªç‰ˆæœ¬Catché‡Œçš„ä»£ç æœ‰ä¸ªbugï¼Œæ²¡æœ‰æ¸…é™¤æ‰åŸå§‹æ¶ˆæ¯çš„äº‹åŠ¡æ¶ˆæ¯æ ‡å¿—TRANS_MSG=trueã€‚æ‰€ä»¥è¿™ä¸ªæ¶ˆæ¯å‘å‡ºå»ååœ¨brokerç«¯åˆä¼šèµ°äº‹åŠ¡æ¶ˆæ¯çš„æµç¨‹ï¼Œå¹¶ä¸”è¿˜æ˜¯å¸¦å»¶æ—¶çš„ã€‚è¿™ä¼šå¯¼è‡´çœŸå®çš„TOPICä¸¢æ‰ã€‚ ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ä¸€ä¸‹ï¼š äº‹åŠ¡æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œtopicè½¬ä¸º%RETRY%xxxxå‘é€åˆ°brokerï¼Œç”±äºäº‹åŠ¡æ¶ˆæ¯æ ‡å¿—æ²¡æœ‰è¢«æ¸…é™¤ï¼Œäºæ˜¯topicè½¬æˆäº†RMQ_SYS_TRANS_HALF_TOPICã€‚åˆç”±äºdelayå‚æ•°æ²¡æœ‰è¢«æ¸…é™¤ï¼Œtopicæœ€åè¢«è½¬ä¸ºäº†schedule_topic_xxxxã€‚ç­‰åˆ°scheduleæ‰§è¡Œæ—¶ï¼Œæ¶ˆæ¯ä¼šå‘åˆ°RMQ_SYS_TRANS_HALF_TOPICä¸­ã€‚ç”±äºä¸æ˜¯Producerå‘çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œæ‰€ä»¥æ‹¿ä¸åˆ°LocalTransactionStateã€‚åªèƒ½ç­‰å¾…äº‹åŠ¡æ¶ˆæ¯å›æŸ¥ã€‚ è¿™æ—¶åˆšå¥½åˆç¢°åˆ°æˆ‘ä»¬çš„LocalTransactionListenerçš„ä¸€ä¸ªé—®é¢˜ï¼š 1234567891011121314151617181920212223public LocalTransactionState checkLocalTransaction(MessageExt messageExt) { Object msg = HessianUtils.decode(messageExt.getBody()); String topic = messageExt.getTopic(); String tag = messageExt.getTags(); //ç”±äºæ‹¿ç€rmq_sys_trans_half_topicæ¥è·å–handleræ‰€ä»¥è‚¯å®šè·å–ä¸åˆ°ã€‚ LocalTransactionHandler localTransacationHandler = getLocalTransacationHandler(topic, tag); String msgId = messageExt.getMsgId(); if( localTransacationHandler == null ){ logger.error(&quot;localTransacationHandler is empty should never happened! msgId={}, arg={}&quot;, msgId, JSON.toJSONString(msg)); //äºæ˜¯è¿™ä¸ªåœ°æ–¹ä¼šè¿”å›COMMIT_MESSAGE return LocalTransactionState.COMMIT_MESSAGE; } boolean checkResult = false; try { checkResult = localTransacationHandler.localTransactionCheck(msgId, msg); } catch (Exception e) { logger.error(&quot;localTransacationCheck failed! msgId={}, arg={}&quot;, msgId, JSON.toJSONString(msg), e); checkResult = false; } return checkResult ? LocalTransactionState.COMMIT_MESSAGE : LocalTransactionState.ROLLBACK_MESSAGE;} Brokeræ”¶åˆ°COMMIT_MESSAGEåä¼šå°†æ¶ˆæ¯å†™å¾€REAL_TOPICä¸­ã€‚è€Œæ­¤æ—¶REAL_TOPICæ—©å·²å˜æˆäº†RMQ_SYS_TRANS_HALF_TOPICã€‚å°±è¿™æ ·ï¼ŒRMQ_SYS_TRANS_HALF_TOPIC çˆ†æ‰äº†ã€‚ è§£å†³ é¦–å…ˆæˆ‘ä»¬å°†handlerä¸ºç©ºæ—¶è¿”å›COMMIT_MESSAGEï¼Œæ”¹ä¸ºäº†ROLLBACK_MESSAGEã€‚ å‡çº§stoneä¸­RocketMQä¸º4.6.1ï¼Œå¯ä»¥çœ‹åˆ°åœ¨Catchä»£ç ä¸­å¤šäº†ä¸€è¡Œï¼š 1MessageAccessor.clearProperty(newMsg, &quot;TRAN_MSG&quot;); æœ‰é—®é¢˜çš„consumerå°†tagæ‹†åˆ† ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥åªèƒ½è§£å†³RMQ_SYS_TRANS_HALF_TOPICçˆ†æ‰çš„é—®é¢˜ã€‚ä½†æ˜¯topicè¶…é•¿è¿˜æ˜¯ä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥ç›®å‰æš‚æ—¶æ˜¯å°†consumerçš„tagæ‹†å¼€ã€‚","link":"/archives/cfa05355.html"},{"title":"Spring JPA è‡ªå®šä¹‰å…³è”åˆ†é¡µæŸ¥è¯¢ï¼ˆåŠ¨æ€æ¡ä»¶ï¼‰","text":"é€‚ç”¨äºå¤šå¼ è¡¨å…³è”ï¼Œæ¡ä»¶æ˜¯åŠ¨æ€çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263StringBuilder nativeSql = new StringBuilder(&quot;select o.* from t_order o,t_order_detail od,t_order_goods og where o.id = od.order_id and o.id = og.order_id and o.company_id=:companyId&quot;); StringBuilder countSql = new StringBuilder(&quot;select count(*) from t_order o,t_order_detail od,t_order_goods og where o.id = od.order_id and o.id = og.order_id and o.company_id=:companyId&quot;); if (StringUtils.isNotBlank(orderQueryVM.getGoodsName())) { nativeSql.append(&quot; and &quot;).append(&quot;og.goods_name like :goodsName&quot;); countSql.append(&quot; and &quot;).append(&quot;og.goods_name like :goodsName&quot;); } if (StringUtils.isNotBlank(orderQueryVM.getCustomerName())) { nativeSql.append(&quot; and &quot;).append(&quot;od.customer_name like :customerName&quot;); countSql.append(&quot; and &quot;).append(&quot;od.customer_name like :customerName&quot;); } if (orderQueryVM.getOrderStatus() != null) { nativeSql.append(&quot; and &quot;).append(&quot;o.order_status=:orderStatus&quot;); countSql.append(&quot; and &quot;).append(&quot;o.order_status=:orderStatus&quot;); } if (orderQueryVM.getSettleStatus() != null) { nativeSql.append(&quot; and &quot;).append(&quot;o.settle_status=:settleStatus&quot;); countSql.append(&quot; and &quot;).append(&quot;o.settle_status=:settleStatus&quot;); } if (orderQueryVM.getStartDate() != null &amp;&amp; orderQueryVM.getEndDate() != null) { nativeSql.append(&quot; and &quot;).append(&quot;o.order_date&lt;=:endDate&quot;); countSql.append(&quot; and &quot;).append(&quot;o.order_date&lt;=:endDate&quot;); nativeSql.append(&quot; and &quot;).append(&quot;o.order_date&gt;=:startDate&quot;); countSql.append(&quot; and &quot;).append(&quot;o.order_date&gt;=:startDate&quot;); } nativeSql.append(&quot; order by created_date desc &quot;); Pageable pageable = new PageRequest(page,pagesize,new Sort(Direction.DESC,&quot;created_date&quot;)) Query nativeQuery = em.createNativeQuery(nativeSql.toString(), Order.class); //è®¾ç½®åˆ†é¡µ nativeQuery.setFirstResult(pageable.getOffset()); nativeQuery.setMaxResults(pageable.getPageSize()); nativeQuery.setParameter(&quot;companyId&quot;, orderQueryVM.getCompanyId()); Query countQuery = em.createNativeQuery(countSql.toString()); countQuery.setParameter(&quot;companyId&quot;, orderQueryVM.getCompanyId()); if (StringUtils.isNotBlank(orderQueryVM.getGoodsName())) { nativeQuery.setParameter(&quot;goodsName&quot;, &quot;%&quot; + orderQueryVM.getGoodsName() + &quot;%&quot;); countQuery.setParameter(&quot;goodsName&quot;, &quot;%&quot; + orderQueryVM.getGoodsName() + &quot;%&quot;); } if (StringUtils.isNotBlank(orderQueryVM.getCustomerName())) { nativeQuery.setParameter(&quot;customerName&quot;, &quot;%&quot; + orderQueryVM.getCustomerName() + &quot;%&quot;); countQuery.setParameter(&quot;customerName&quot;, &quot;%&quot; + orderQueryVM.getCustomerName() + &quot;%&quot;); } if (orderQueryVM.getOrderStatus() != null) { nativeQuery.setParameter(&quot;orderStatus&quot;, orderQueryVM.getOrderStatus().name()); countQuery.setParameter(&quot;orderStatus&quot;, orderQueryVM.getOrderStatus().name()); } if (orderQueryVM.getSettleStatus() != null) { nativeQuery.setParameter(&quot;settleStatus&quot;, orderQueryVM.getSettleStatus().name()); countQuery.setParameter(&quot;settleStatus&quot;, orderQueryVM.getSettleStatus().name()); } if (orderQueryVM.getStartDate() != null &amp;&amp; orderQueryVM.getEndDate() != null) { nativeQuery.setParameter(&quot;endDate&quot;, orderQueryVM.getEndDate()); countQuery.setParameter(&quot;endDate&quot;, orderQueryVM.getEndDate()); nativeQuery.setParameter(&quot;startDate&quot;, orderQueryVM.getStartDate()); countQuery.setParameter(&quot;startDate&quot;, orderQueryVM.getStartDate()); } List&lt;Order&gt; orderList = nativeQuery.getResultList(); //è·å–æ€»æ•° BigInteger count = (BigInteger) countQuery.getSingleResult(); Page&lt;Order&gt; page = new PageImpl(orderList, pageable, count.intValue()); return page;","link":"/archives/4072076b.html"},{"title":"new Thread() å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¢«å›æ”¶","text":"åœ¨Javaä¸­ä»€ä¹ˆæ ·çš„å¯¹è±¡ä¼šè¢«å›æ”¶å‘¢ï¼Ÿ é€šè¿‡å¼•ç”¨è®¡æ•°åˆ¤æ–­ä¸å­˜åœ¨å¼•ç”¨çš„å¯¹è±¡ã€‚ é€šè¿‡éå†GC Rootæ¥åˆ¤æ–­ä¸å­˜åœ¨å¼•ç”¨çš„å¯¹è±¡ã€‚ å‡è®¾æœ‰å¦‚ä¸‹ä¸€æ®µä»£ç ï¼ˆæ¨èä½¿ç”¨çº¿ç¨‹æ± ï¼‰ï¼š1234567891011public void test(){ Thread thread = new Thread(new Runnable() { @Override public void run() { while(true){ //do something } } }); thread.start();} æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“test()æ–¹æ³•é€€å‡ºæ—¶ï¼Œè°ƒç”¨æ ˆä¸­æ ˆå¸§å†…å±€éƒ¨å˜é‡è¡¨ä¿å­˜çš„å±€éƒ¨å˜é‡(thread)éƒ½ä¼šè¢«é”€æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´new Thread()çš„å¼•ç”¨ä¸å­˜åœ¨äº†ï¼Œä½†æ˜¯æ‰§è¡ŒGCåï¼ˆæµ‹è¯•å¯ä½¿ç”¨System.gc())ï¼Œæˆ‘ä»¬å‘ç°çº¿ç¨‹è¿˜æ˜¯åœ¨è¿è¡Œçš„ã€‚æ¥çœ‹çœ‹çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå›¾ï¼ˆå›¾ç‰‡æ¥æºäº’è”ç½‘ï¼‰:ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰å½“runæ–¹æ³•ç»“æŸæ—¶ï¼Œçº¿ç¨‹æ‰ä¼šdeadã€‚ çŒœæµ‹ï¼šåœ¨runæ–¹æ³•ä¸­ï¼Œå…¶å®ä¼šæŒæœ‰çº¿ç¨‹å¯¹è±¡çš„thiså¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªçº¿ç¨‹å¯¹è±¡å…¶å®æ˜¯å­˜åœ¨GC Root å¼•ç”¨çš„ï¼Œæ‰€ä»¥æ²¡æœ‰è¢«GCã€‚","link":"/archives/e6a5a040.html"},{"title":"Streamçš„TerminalOpæ‰§è¡ŒåŸç†","text":"Streamåœ¨æ‰§è¡Œintermediate(ä¾‹å¦‚ mapã€filter)æ“ä½œæ—¶ï¼Œä¼šå½¢æˆreferencePipeline åŒå‘é“¾è¡¨ã€‚ TermianlOpæ‰§è¡Œæ—¶éå†é“¾è¡¨ï¼š 123for ( AbstractPipeline p=AbstractPipeline.this; p.depth &gt; 0; p=p.previousStage) { sink = p.opWrapSink(p.previousStage.combinedFlags, sink);} æ‰§è¡ŒStatelessOp ä¸­Sinkçš„OnWrapSinkã€‚(é€šè¿‡Sink ä¸­ChainedReference ç¿»è½¬) æ‰€ä»¥Streamä¸­çš„å…ƒç´ æ˜¯ä¾æ¬¡åº”ç”¨intermediateæ“ä½œã€‚å¹¶ä¸æ˜¯æ‰€æœ‰å…ƒç´ åº”ç”¨å®Œç¬¬ä¸€ä¸ªintermediateæ“ä½œï¼Œåœ¨åº”ç”¨ä¸‹ä¸€ä¸ªã€‚ PS:ä½¿ç”¨Streamæ—¶ï¼Œé¦–å…ˆä¼šæ„å»ºä¸€ä¸ªHEAD-æºé˜¶æ®µï¼ˆStream()ï¼‰ï¼Œç„¶åç»å†StatelessOp-ä¸­é—´é˜¶æ®µï¼ˆmapã€filterï¼‰ï¼Œæœ€ç»ˆé€šè¿‡TermianlOpï¼ˆreduceç­‰ï¼‰","link":"/archives/2c656d9.html"},{"title":"tk.mybatisä¸Activitiå…±å­˜é—®é¢˜è§£å†³","text":"ç”±äºtk.mybatisä¾èµ–äº†persistence-apiï¼Œä¼šè®©Activitiè£…é…JpaProcessEngineAutoConfigurationï¼Œå› ä¸ºå…¶@conditonalOnclass(name = â€œjavax.persistence.EntityManagerFactoryâ€)ã€‚ ä½†å®é™…æ²¡æœ‰ä½¿ç”¨JPAï¼Œå¯¼è‡´å¯åŠ¨æŠ¥é”™ã€‚å¦‚æœæ’é™¤persistence-apiï¼Œåˆä¼šå¯¼è‡´tk.mybatisæŠ¥é”™ã€‚ å‚è€ƒäº†ä¸€ç•ªå…¶å®ƒçš„äººåšæ³•ï¼Œæ— è®ºæ˜¯å„ç§æ’é™¤è¿˜æ˜¯æ·»åŠ ä¾èµ–éƒ½æ— æ•ˆã€‚ æœ€ç»ˆè‡ªå·±çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š é¦–å…ˆæ’é™¤activiti jpaçš„è‡ªåŠ¨è£…é…ï¼š 1@SpringBootApplication(exclude={JpaProcessEngineAutoConfiguration.class})ã€‚ ç„¶åæ‰¾åˆ°activitiä¸­çš„DataSourceProcessEngineAutoConfiguration.class å¤åˆ¶å‡ºæºç ï¼Œåœ¨è‡ªå·±çš„é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªåŒåæ–‡ä»¶ï¼ˆä¸åŒåä¹Ÿè¡Œï¼‰ã€‚ç„¶åç²˜è´´å†…å®¹åˆ°æ–°å»ºçš„æ–‡ä»¶ä¸­ã€‚æœ€ååˆ æ‰ï¼š 1@ConditionalOnMissionClass(name = &quot;javax.persistence.EntityManagerFactory&quot;) Ok,æå®šï¼","link":"/archives/7008e148.html"},{"title":"ä¸ºä»€ä¹ˆé˜¿é‡Œç¦æ­¢é€šè¿‡Executorsåˆ›å»ºçº¿ç¨‹æ± ","text":"Executorsæ˜¯é€šè¿‡newä¸€ä¸ªThreadPoolExecutoræ¥åˆ›å»ºçš„çº¿ç¨‹æ± ã€‚æ¥çœ‹çœ‹ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ï¼š 12345678public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue) { this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, Executors.defaultThreadFactory(), defaultHandler); } æ–¹æ³•ä¸Šçš„Javadocï¼š 1234567891011* @param corePoolSize the number of threads to keep in the pool, even* if they are idle, unless {@code allowCoreThreadTimeOut} is set* @param maximumPoolSize the maximum number of threads to allow in the* pool* @param keepAliveTime when the number of threads is greater than* the core, this is the maximum time that excess idle threads* will wait for new tasks before terminating.* @param unit the time unit for the {@code keepAliveTime} argument* @param workQueue the queue to use for holding tasks before they are* executed. This queue will hold only the {@code Runnable}* tasks submitted by the {@code execute} method. è§£é‡Šä¸€ä¸‹ï¼šcorePoolSize ï¼šä¿æŒåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå“ªæ€•è¿™å‡ ä¸ªçº¿ç¨‹æ˜¯ç©ºé—²çš„ã€‚é™¤éè®¾ç½®äº†allowCoreThreadTimeOutã€‚maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çš„çº¿ç¨‹æ•°é‡ã€‚keepAliveTimeï¼šå¤šä½™corePoolSize è®¾ç½®çš„çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼ˆæ¯”å¦‚corePoolSize 3ï¼ŒmaximumPoolSize 10ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„7ä¸ªçº¿ç¨‹å°†åªèƒ½å­˜æ´»keepAliveTimeï¼‰ã€‚unit ï¼škeepAliveTimeçš„æ—¶é—´å•ä½workQueueï¼šä¿å­˜corePoolSize çº¿ç¨‹å¤„ç†ä¸äº†çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚corePoolSize 3ï¼Œä½†æ˜¯æœ‰10ä¸ªä»»åŠ¡è¦å¤„ç†ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„7ä¸ªä»»åŠ¡å°†å­˜å‚¨åœ¨workQueueä¸­ï¼‰ã€‚å½“æ­¤é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œä¼šå†æ¬¡åˆ›å»ºä¸è¶…è¿‡maximumPoolSizeå¤§å°çš„çº¿ç¨‹æ¥å¤„ç†ã€‚ å¥½ï¼Œçœ‹å®Œäº†ThreadPoolExecutoræ„é€ å‡½æ•°ï¼Œå†æ¥çœ‹çœ‹Executorsæ˜¯æ€ä¹ˆè®¾ç½®è¿™äº›å‚æ•°åˆ›å»ºçº¿ç¨‹æ± çš„ï¼Œä»¥åŠä¼šå¸¦æ¥å“ªäº›é—®é¢˜ã€‚ çœ‹çœ‹Executorsåˆ›å»ºçº¿ç¨‹æ± çš„æºç ï¼š newFixedThreadPool12345 public static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());} corePoolSizeã€maximumPoolSize è®¾ç½®ä¸ºç›¸åŒ(nThreads)å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªçº¿ç¨‹æ± å†…éƒ¨ä¼šä¸€ç›´å­˜åœ¨nThreadsæ•°é‡çš„çº¿ç¨‹ã€‚å¹¶ä¸”ç”±äºcorePoolSizeå’ŒmaximumPoolSize ç›¸åŒï¼ŒkeepAliveTimeä¹Ÿå°±æ— æ„ä¹‰äº†ï¼Œæ‰€ä»¥è®¾ç½®ä¸º0Lã€‚è¿™ä¸ªçº¿ç¨‹æ± ä½¿ç”¨çš„æ˜¯LinkedBlockingQueueï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰æ¥å­˜corePoolSizeçº¿ç¨‹æ— æ³•å¤„ç†çš„ä»»åŠ¡ã€‚é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹æ± é—®é¢˜åœ¨å“ªé‡Œå‘¢ï¼Ÿæœ€å¤§çš„é—®é¢˜åœ¨äºworkQueueä½¿ç”¨äº†æ— ç•Œé˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡æ•°å¤šåˆ°çº¿ç¨‹æ± å¤„ç†ä¸è¿‡æ¥æ—¶ï¼Œä»»åŠ¡å…¨éƒ¨è¿›å…¥workQueueï¼Œä¼šæ¶ˆè€—å¾ˆå¤§çš„å†…å­˜ï¼Œç”šè‡³OOMã€‚ newSingleThreadExecutor123456public static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()));} å¯ä»¥å‘ç°newSingleThreadExecutor æ˜¯ newFixedThreadPoolçš„ä¸€ä¸ªå…·åŒ–ç‰ˆæœ¬ã€‚æŒ‡å®šäº†å›ºå®šçš„nThreadsï¼š1ã€‚æ‰€ä»¥è¿™ä¸ªçº¿ç¨‹æ± çš„é—®é¢˜è·ŸnewFixedThreadPoolä¸€æ ·ã€‚å½“ä»»åŠ¡è¿‡å¤šæ—¶ï¼Œå¯èƒ½å‡ºç°OOMã€‚ newCachedThreadPool12345public static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;()); } corePoolSize è®¾ç½®ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤è¿™ä¸ªçº¿ç¨‹æ± ä¸­ä¸ä¼šæœ‰çº¿ç¨‹åˆ›å»ºã€‚ ä½¿ç”¨çš„workQueueæ˜¯SynchronousQueueï¼Œåªæœ‰è¢«æ¶ˆè´¹æ‰èƒ½ç»§ç»­ç”Ÿäº§ã€‚æ­¤æ—¶æ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œå‘ç°æ²¡æœ‰çº¿ç¨‹æ¥æ¶ˆè´¹ï¼Œäºæ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ¶ˆè´¹ã€‚å¹¶ä¸”è¿™ä¸ªçº¿ç¨‹åœ¨å®Œæˆä»»åŠ¡åæœ€å¤šå­˜æ´»60ç§’ã€‚å¦‚æœæ­¤æ—¶æ¥äº†å¾ˆå¤šä»»åŠ¡ã€‚é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹æœ€å¤§å¯åˆ›å»ºInteger.MAX_VALUEä¸ªçº¿ç¨‹ã€‚è¿™å°±æ˜¯è¿™ä¸ªçº¿ç¨‹æ± çš„é—®é¢˜æ‰€åœ¨äº†ï¼Œçº¿ç¨‹æ•°é‡å¯ä»¥åŸºæœ¬ä¸Šè¯´æ˜¯æ— é™åˆ¶ï¼Œå¯èƒ½å¯¼è‡´èµ„æºè€—å°½ã€‚ Executorsä¸­è¿˜æœ‰å¾ˆå¤šåˆ›å»ºçº¿ç¨‹æ± çš„å·¥å‚æ–¹æ³•ï¼Œæˆ–å¤šæˆ–å°‘éƒ½å­˜åœ¨ä¸Šè¿°é—®é¢˜ã€‚é€šè¿‡ä¸Šé¢çš„é—®é¢˜å¯ä»¥å‘ç°ï¼Œè¦åˆ›å»ºä¸€ä¸ªå¯é çš„çº¿ç¨‹æ± ï¼Œæœ€å¥½è¿˜æ˜¯æ‰‹åŠ¨åˆ›å»ºï¼Œå¹¶ä¸”åˆç†æŒ‡å®šcorePoolSizeã€maximumPoolSize ã€workQueueç­‰å‚æ•°ã€‚ ä¾‹å¦‚ï¼šä¸ºäº†é¿å…OOMï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ArrayBlockingQueueæ¥æ›¿ä»£æ— ç•Œé˜Ÿåˆ—ã€‚ä¸ºäº†é¿å…çº¿ç¨‹è¿‡å¤šèµ„æºè€—å°½ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆå®é™…æƒ…å†µæ¥æŒ‡å®šä¸€ä¸ªmaximumPoolSizeï¼Œè€Œä¸æ˜¯ç²—æš´çš„è®¾ç½®ä¸ºInteger.MAX_VALUEã€‚ 12345678new ThreadPoolExecutor( 2, 8, 30L, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;&gt;(1000), Executors.defaultThreadFactory(), new AbortPolicy()); ä¸Šé¢è¿™ä¸ªçº¿ç¨‹æ± ï¼Œå½“æ·»åŠ è¿›ä»»åŠ¡æ—¶ï¼Œé»˜è®¤åˆ›å»º2ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚å¦‚æœåˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ArrayBlockingQueueï¼ˆworkQueueï¼‰æ’é˜Ÿï¼Œå½“workQueueæ»¡äº†ï¼ˆ1000ä¸ªä»»åŠ¡ï¼‰ä¼šåœ¨åˆ›å»º6ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚å¦‚æœæ­¤æ—¶è¿˜æœ‰ä»»åŠ¡æ·»åŠ è¿›æ¥ï¼Œåˆ™ä¼šæ‰§è¡ŒAbortPolicyç­–ç•¥ï¼Œé»˜è®¤æ˜¯æ‹’ç»æ·»åŠ ã€‚å½“æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæˆåï¼Œè¿™6ä¸ªçº¿ç¨‹åœ¨ç©ºé—²30ç§’åå°†ä¼šè¢«é”€æ¯ã€‚ å®é™…ä½¿ç”¨æ—¶åº”è¯¥ç»“åˆå®é™…æƒ…å†µè°ƒæ•´ï¼Œå¹¶ä¸”è‡ªå®šä¹‰ThreadFactoryä»¥è¾¾åˆ°è®¾ç½®çº¿ç¨‹åç§°çš„ç›®çš„ã€‚ åŸåˆ›ï¼Œå¦‚æœ‰é›·åŒçº¯å±å·§åˆã€‚","link":"/archives/3223999.html"},{"title":"ä»å­—èŠ‚ç æ¥è¯´æ˜i++ä¸++iåˆ°åº•æœ‰ä»€ä¹ˆä¸åŒ","text":"çœ‹å­—èŠ‚ç ä¹‹å‰éœ€è¦å…ˆäº†è§£ç›¸å…³æ¦‚å¿µï¼Œå¦‚æ ˆå¸§ã€æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨ã€‚æ ˆå¸§æ˜¯JVMä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå› ä¸ºJVMæ˜¯åŸºäºæ ˆçš„æ¶æ„ã€‚ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨å…¶å®å°±æ˜¯æ ˆå¸§å…¥æ ˆå‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ ˆé¡¶æ ˆå¸§å°±æ˜¯å½“å‰æ–¹æ³•è°ƒç”¨ã€‚ä¸€ä¸ªæ ˆå¸§ä¸­åŒ…å«ï¼š å±€éƒ¨å˜é‡è¡¨ æ“ä½œæ•°æ ˆ åŠ¨æ€é“¾æ¥ æ–¹æ³•è¿”å›åœ°å€ è¿™é‡Œi++ã€ ++iæ¶‰åŠåˆ°çš„å°±æ˜¯å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆã€‚å…·ä½“ä¿¡æ¯å¯å‚è€ƒï¼šã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ å±€éƒ¨å˜é‡è¡¨å­˜å‚¨çš„æ˜¯æ–¹æ³•çš„å‚æ•°ä»¥åŠå†…éƒ¨å®šä¹‰çš„å˜é‡çš„å€¼ï¼Œæ“ä½œæ•°æ ˆä¹Ÿæ˜¯ä¸€ä¸ªæ ˆç»“æ„ï¼Œç”¨æ¥æ‰§è¡Œæ–¹æ³•ä¸­çš„æŒ‡ä»¤ã€‚ å¥½äº†ï¼Œæ¥çœ‹ä¸€ä¸ªä»£ç ç‰‡æ®µï¼š 12345678class Scratch { public static void main(String[] args) { int i=0,j=0,m=0; j = i++; m = ++i; }} ä¸ºäº†ä¸äº§ç”Ÿå…¶ä»–å¤šè¿‡ä¿¡æ¯ï¼Œè¿™é‡Œåªå†™äº†å…³é”®ä»£ç ã€‚é¦–å…ˆå¯ä»¥é€šè¿‡javac å°†æºç ç¼–è¯‘æˆclassï¼š 1javac scratch.java æ‰§è¡Œå®Œæˆåå°†çœ‹åˆ°Scratch.class æ–‡ä»¶ï¼Œé€šè¿‡javapå‘½ä»¤æŸ¥çœ‹å­—èŠ‚ç ï¼š 1javap -c Scratch &gt; scratch.txt ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹å°†ç»“æœè¾“å‡ºåˆ°äº†scratch.txtï¼Œæ‰“å¼€æ­¤æ–‡ä»¶å°†çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š 12345678910111213141516171819202122232425Compiled from &quot;scratch.java&quot;class Scratch { Scratch(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: iconst_0 1: istore_1 2: iconst_0 3: istore_2 4: iconst_0 5: istore_3 6: iload_1 7: iinc 1, 1 10: istore_2 11: iinc 1, 1 14: iload_1 15: istore_3 16: return} å…³æ³¨mainæ–¹æ³• 0-5ï¼Œå¯ä»¥å‘ç°å¯¹åº”çš„æ˜¯ï¼š 1int i=0,j=0,m=0; ä¸»è¦æ˜¯å£°æ˜å˜é‡å¹¶åˆå§‹åŒ–ä¸º0ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ä¸‹åˆ’çº¿åé¢è·Ÿäº†ä¸€ä¸ªæ•°å­—ï¼Œè¿™é‡Œåº”è¯¥ä»£è¡¨çš„æ˜¯å˜é‡åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„ä½ç½®ã€‚iï¼š1jï¼š2mï¼š3 å†å…³æ³¨mainæ–¹æ³•ï¼š6ã€7ã€10ï¼šiload_1 è¡¨ç¤ºå°†å±€éƒ¨å˜é‡è¡¨ä¸­ä½ç½®1çš„æ•°æ®æ”¾å…¥æ“ä½œæ•°æ ˆä¸­(è¿™é‡Œå¯¹åº”çš„æ˜¯iï¼Œæ­¤æ—¶içš„å€¼ä¸º0)ç„¶åpopå‡ºæ¥èµ‹å€¼ç»™jã€‚ç„¶åå†å°†iè‡ªå¢iincã€‚æœ€åistore_2å­˜å‚¨jåˆ°å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚æ“ä½œå®Œæˆåi=1ï¼Œj=1ã€‚æœ€åå…³æ³¨mainæ–¹æ³•ï¼š11ã€14ã€15ï¼šiincé¦–å…ˆè‡ªå¢iï¼Œç„¶åiload_1å°†å±€éƒ¨å˜é‡è¡¨ä¸­ä½ç½®1çš„æ•°æ®æ”¾å…¥æ“ä½œæ•°æ ˆä¸­(è¿™é‡Œå¯¹åº”çš„æ˜¯iï¼Œæ­¤æ—¶içš„å€¼ä¸º2)ç„¶åpopå‡ºæ¥èµ‹å€¼ç»™mã€‚æœ€åistore_3å­˜å‚¨måˆ°å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚æ“ä½œå®Œæˆåi=2ï¼Œj=1ï¼Œm=2ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å®¶éƒ½è¯´ï¼Œi++æ˜¯å…ˆèµ‹å€¼åè‡ªå¢ï¼Œè€Œ++iæ˜¯å…ˆè‡ªå¢åèµ‹å€¼çš„åŸå› ã€‚ è¿™é‡Œè¦è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœæ˜¯å•ç‹¬çš„i++ã€++iæ˜¯æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«çš„ã€‚","link":"/archives/ade4c276.html"},{"title":"UUIDä¼˜åŒ–æ–¹æ¡ˆ","text":"æ•°æ®IDç”Ÿæˆæ–¹æ¡ˆä¸­UUIDç›¸å¯¹æ¥è¯´æ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯å…¶ä¹Ÿæœ‰ä¸å°‘ç¼ºç‚¹ï¼š 1.æ²¡æœ‰æ’åºï¼Œæ— æ³•ä¿è¯è¶‹åŠ¿é€’å¢ã€‚2.UUIDå¾€å¾€æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡æ¯”è¾ƒä½ã€‚3.å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œå¦‚æœæ˜¯æµ·é‡æ•°æ®åº“ï¼Œå°±éœ€è¦è€ƒè™‘å­˜å‚¨é‡çš„é—®é¢˜ã€‚4.ä¼ è¾“æ•°æ®é‡å¤§5.ä¸å¯è¯»ã€‚ å¸¸è§ä¼˜åŒ–æ–¹æ¡ˆï¼š1.ä¼˜åŒ–å­—ç¬¦ä¸²ä¸ºBigInteger 12345678private static BigInteger pair() { UUID myuuid = UUID.randomUUID(); //UUIDé•¿åº¦ä¸º128ä½ ByteBuffer bb = ByteBuffer.wrap(new byte[16]); bb.putLong(myuuid .getMostSignificantBits()); bb.putLong(myuuid .getLeastSignificantBits()); return new BigInteger(bb.array());} 2.å»æ‰ç¬¦å·ï¼š 12345678private static BigInteger pair(UUID uuid) { BigInteger value1 = BigInteger.valueOf(uuid.getMostSignificantBits()); BigInteger value2 = BigInteger.valueOf(uuid.getLeastSignificantBits()); if (value1.compareTo(value2) &lt; 0) { return value2.multiply(value2).add(value1); } return value1.multiply(value1).add(value1).add(value2);}","link":"/archives/421cfd7c.html"},{"title":"ä½¿ç”¨Mybatisæ‰¹é‡æ›´æ–°çš„ä¸€ä¸ªå°é—®é¢˜","text":"æ‰¹é‡æ›´æ–°çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚update case whenï¼Œforeach updateç­‰ï¼Œä»Šå¤©åœ¨ä½¿ç”¨å…¶ä¸­ä¸€ç§foreach updateæ—¶ä¸€ç›´æŠ¥SQLè¯­æ³•é”™è¯¯ï¼Œçœ‹äº†åŠå¤©æ²¡çœ‹å‡ºå“ªé‡Œæœ‰é—®é¢˜: 1234567891011121314&lt;update id=&quot;updateBatch&quot; parameterType=&quot;list&quot;&gt; &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; separator=&quot;;&quot; index=&quot;index&quot;&gt; update test &lt;set&gt; status = #{item.status,jdbcType=BIGINT}, amount = #{item.amount,jdbcType=BIGINT}, version = version+1, gmt_modified = now(), &lt;/set&gt; &lt;where&gt; id = #{item.id} &lt;/where&gt; &lt;/foreach&gt; &lt;/update&gt; éå¸¸ç®€å•çš„update SQLï¼Œé€šè¿‡Mybatis foreach ç”Ÿæˆå¤šä¸ªupdate SQLåŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¸€ç›´æŠ¥ï¼š 123456### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'update test SET amount = -116534270, version' at line 10; bad SQL grammar []; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'update test SET amount = -116534270, version' at line 10 çœ‹åˆ°è¿™ä¸ªé”™è¯¯ä¸‹æ„è¯†çš„è®¤ä¸ºè‚¯å®šæ˜¯sqlå“ªé‡Œå†™çš„ä¸å¯¹æœ‰è¯­æ³•é”™è¯¯ï¼Œå¯æ˜¯æ£€æŸ¥äº†åŠå¤©æ²¡å‘ç°é—®é¢˜ï¼Œè€Œä¸”å°†æŠ¥é”™çš„sql é€šè¿‡navicatè¿è¡Œä¹Ÿå¯ä»¥é€šè¿‡ã€‚ åæ¥æŸ¥åˆ°å¦‚æœæ‰¹é‡æ‰§è¡Œè¯­å¥éœ€è¦å°†database connection urlä¸­åŠ ä¸Šå¦‚ä¸‹å‚æ•°ï¼š 1allowMultiQueries=true å®Œæ•´çš„urlä¾‹å¦‚ï¼š 1jdbc:mysql://x.x.x.x:3306/xxxx?allowMultiQueries=true&amp;amp;autoReconnect=true&amp;amp;useUnicode=true&amp;amp;characterset=utf8mb4 ä¸å¾—ä¸è¯´MySQLæŠ¥é”™ä¿¡æ¯å®åœ¨æ˜¯å¤ªæ¨¡ç³Šäº†ã€‚ğŸ˜“","link":"/archives/e8013d2a.html"},{"title":"åˆ©ç”¨mybatisæ ‡ç­¾æ›¿æ¢ç¡¬ç¼–ç ","text":"å»ºè®®åˆ©ç”¨mybatisæ ‡ç­¾æ›¿æ¢ç¡¬ç¼–ç  èƒŒæ™¯åœ¨é¡¹ç›®ä¸­å¶å°”çœ‹åˆ°è¿™æ ·çš„ä»£ç ï¼š 123456789&lt;sql id=&quot;querySqlString&quot;&gt; &lt;where&gt; 1=1 &lt;if test=&quot;fundsOrderIdList != null and fundsOrderIdList.size()&gt;0&quot;&gt; and funds_order_id IN &lt;foreach collection=&quot;fundsOrderIdList&quot; item=&quot;id&quot; index=&quot;index&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt; #{id} &lt;/foreach&gt; &lt;/if&gt; è¿™æ®µä»£ç ä¸­æœ‰ä¸ª1=1å¾ˆæ‰çœ¼ï¼Œè¿™ä¸ªä¸æ˜¯bugï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ€§èƒ½é—®é¢˜ï¼Œåªæ˜¯ç¨‹åºå‘˜ä¸–ä»£ä¼ æ‰¿ä¸‹æ¥çš„ä¸€ä¸ªä¹ æƒ¯ã€‚ æ•…äº‹åœ¨å¾ˆä¹…ä»¥å‰ï¼Œå……æ»¡æ™ºæ…§çš„ç¨‹åºå‘˜ä¸ºäº†è§£å†³åŠ¨æ€æ¡ä»¶æ‹¼æ¥çš„é—®é¢˜ï¼Œå‘æ˜äº†1=1è¿™ä¸ªå†™æ³•ï¼Œå¯¹åº”çš„è¿˜æœ‰1=0çš„å†™æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå†™æ³•åœ¨ä»¥å‰æ˜¯æ€ä¹ˆè§£å†³é—®é¢˜çš„ï¼š 1234567sql = &quot;select * from car_table where 1=1&quot;for(Condtion condition:conditions){ /**å‡å¦‚æ²¡æœ‰1=1ï¼Œç¬¬ä¸€ä¸ªæ¡ä»¶ç›´æ¥æ‹¼æ¥ä¸Šandè¯­æ³•å°±é”™è¯¯äº† *è¿˜å¾—åšå‡ºé¢å¤–åˆ¤æ–­æ‰è¡Œ */ sql = sql + &quot; and &quot; + condition.field + &quot; = &quot; + condition.value} ç¡®å®å¾ˆå·§å¦™ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰æ€§èƒ½é—®é¢˜ï¼Œä¸ä¿¡æˆ‘ç»™ä½ ä¸¾ä¸ªğŸŒ°: 1select * from pay_channel_with_bank where 1=1 and channel_code = '50008'; è¿™æ˜¯ä¸€æ¡å¾ˆç®€å•çš„SQLï¼Œå…¶ä¸­å°±æœ‰1=1çš„å†™æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹MySQLæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼˜åŒ–åå®é™…æ‰§è¡Œçš„SQL: 12345EXPLAINselect * from pay_channel_with_bank where 1=1 and channel_code = '50008';SHOW WARNINGS;å®é™…æ‰§è¡Œçš„SQL:/* select#1 */ select æ­¤å¤„çœç•¥å¾ˆå¤šcolumn from `online_paychannel`.`pay_channel_with_bank` where (`online_paychannel`.`pay_channel_with_bank`.`channel_code` = 50008) å¯ä»¥çœ‹åˆ°1=1å·²ç»è¢«ä¼˜åŒ–æ‰äº†ã€‚ ç»“è®ºè™½ç„¶è¿™ç§å†™æ³•æ²¡å•¥å¤§é—®é¢˜ï¼Œä½†æ˜¯ä»£ç æ˜¯ç»™äººçœ‹çš„ã€‚å¦‚æœä¸äº†è§£è¿™ç§å†™æ³•ï¼Œä¹ä¸€çœ¼çœ‹è¿‡å»è‚¯å®šæœ‰ç‚¹æ‡µã€‚ è€Œä¸”æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„Mybatisæä¾›çš„&lt;where&gt;æ ‡ç­¾æœ¬èº«å°±ä¼šå¸®æˆ‘ä»¬åšä¼˜åŒ–: 123456789101112131415161718private void applyPrefix(StringBuilder sql, String trimmedUppercaseSql) { if (!prefixApplied) { prefixApplied = true; if (prefixesToOverride != null) { for (String toRemove : prefixesToOverride) { //æ­¤å¤„ä¼šç§»é™¤ä¸€äº›å‰ç¼€ if (trimmedUppercaseSql.startsWith(toRemove)) { sql.delete(0, toRemove.trim().length()); break; } } } if (prefix != null) { sql.insert(0, &quot; &quot;); sql.insert(0, prefix); } } } WhereSqlNodeä¸­å®šä¹‰çš„prefixesToOverride: 1private static List&lt;String&gt; prefixList = Arrays.asList(&quot;AND &quot;,&quot;OR &quot;,&quot;AND\\n&quot;, &quot;OR\\n&quot;, &quot;AND\\r&quot;, &quot;OR\\r&quot;, &quot;AND\\t&quot;, &quot;OR\\t&quot;); æ‰€ä»¥ä½¿ç”¨äº†&lt;where&gt;æ ‡ç­¾åå¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„å»æ‰1=1ã€‚","link":"/archives/ad1a887a.html"},{"title":"MySQLå¯é‡å¤è¯»å’Œå¹»è¯»","text":"å¯é‡å¤è¯»æè¿°çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œå¤šæ¬¡æŸ¥è¯¢æ­¤æ•°æ®å¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚MySQLçš„InnoDBå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMulti_Version Concurrency Control, MVCCï¼‰æœºåˆ¶æ¥è§£å†³è¯¥é—®é¢˜ã€‚å¹»è¯»æè¿°çš„æ˜¯MVCCä¸èƒ½é˜»æ­¢æ’å…¥æ–°çš„æ•°æ®ï¼Œå¯¼è‡´å¤šæ¬¡æŸ¥è¯¢æ—¶æ•°æ®è®°å½•ä¸ä¸€è‡´ã€‚","link":"/archives/16902655.html"},{"title":"å„ç§åŠ å¯†æ–¹å¼çš„é—®é¢˜","text":"å¯¹ç§°åŠ å¯†æœ€å¤§çš„é—®é¢˜å°±æ˜¯å¯†é’¥çš„ä¼ è¾“é—®é¢˜ã€‚äºæ˜¯ä¹å‡ºç°äº†éå¯¹ç§°åŠ å¯†ã€‚å…¬é’¥å®Œå…¨å…¬å¼€ï¼Œè°éƒ½å¯ä»¥ä½¿ç”¨ã€‚éå¯¹ç§°åŠ å¯†æœ€å¤§çš„é—®é¢˜å°±æ˜¯èº«ä»½ç¡®è®¤çš„é—®é¢˜ã€‚æ€ä¹ˆèƒ½ç¡®è®¤æ˜¯ä¸æ˜¯æ­£ç¡®çš„äººä½¿ç”¨å…¬é’¥åŠ å¯†çš„ä¿¡æ¯å‘¢ã€‚äºæ˜¯ä¹å‡ºç°äº†æ•°å­—ç­¾åï¼Œä½¿ç”¨å¯¹æ–¹å…¬é’¥çš„äººï¼Œç”¨è‡ªå·±çš„ç§é’¥ç­¾åï¼Œç„¶åå¯¹æ–¹ç”¨ç­¾åçš„äººçš„å…¬é’¥è§£å¯†ã€‚","link":"/archives/d7f22001.html"},{"title":"å¯¹å˜é‡åŠ é”åæ˜¯å¦è¿˜éœ€è¦ä½¿ç”¨volatile","text":"å¤§å®¶éƒ½çŸ¥é“volatileä¿è¯äº†å˜é‡åœ¨çº¿ç¨‹é—´çš„å¯è§æ€§ï¼ˆä¸»å†…å­˜ä¸CPUç¼“å­˜ï¼ˆçº¿ç¨‹å†…å­˜ï¼‰é—´ï¼‰ã€‚Lockä¸synchronizedä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ï¼Œè¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚é‚£ä¹ˆä½¿ç”¨äº†Lockä¸synchronizedä¹‹åï¼Œå˜é‡æ˜¯å¦å°±ä¸ç”¨åŠ volatileäº†ï¼Ÿ 12345678910111213141516171819202122232425262728public class Test{ public boolean t=false;}main(){Test test = new Test();Thread a = new Thread(()-&gt;{ for(;;){ if(test.t){ sout(&quot;t is true&quot;) break; } }}).start();Thread b = new Thread(()-&gt;{ TimeUnit.MILLISECONDS.sleep(20) synchronized(test){ test.t=true; } }}).start();a.join();b.join();} åœ¨ä¸Šé¢ä¼ªä»£ç ä¸­ï¼Œaçº¿ç¨‹æ­»å¾ªç¯åˆ¤æ–­testä¸­çš„tä¸ºtrueæ—¶ç»“æŸã€‚bçº¿ç¨‹æ¨¡æ‹Ÿæ‰§è¡Œ20æ¯«ç§’çš„ä¸šåŠ¡åå°†testä¸­tæ›´æ”¹ä¸ºtrueã€‚æ­£å¸¸æƒ…å†µä¸‹açº¿ç¨‹åº”è¯¥ä¼šç»“æŸï¼ˆsynchronizedä¿è¯äº†å¯è§æ€§å’ŒåŸå­æ€§ï¼‰ï¼Œä½†äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚ è¿™æ˜¯å› ä¸ºè™½ç„¶bçº¿ç¨‹æ›´æ”¹tçš„å€¼å¹¶æ›´æ–°åˆ°äº†ä¸»å†…å­˜ï¼Œä½†æ˜¯açº¿ç¨‹cpuä¸€ç›´å¿™äºforæ­»å¾ªç¯ï¼Œæ²¡æœ‰ç©ºå»ä¸»å†…å­˜è·å–æœ€æ–°çš„å€¼ã€‚åšä¸ªè¯•éªŒï¼Œå°†açº¿ç¨‹æ”¹æˆå¦‚ä¸‹ï¼š 123456789Thread a = new Thread(()-&gt;{ for(;;){ TimeUnit.MILLISECONDS.sleep(2) if(test.t){ sout(&quot;t is true&quot;) break; } }}).start(); å†æ¬¡è¿è¡Œï¼Œå‘ç°ç¨‹åºæ­£å¸¸äº†ã€‚åŸå› åœ¨äºçº¿ç¨‹sleepåï¼Œcpuç©ºé—²ä¸‹æ¥ï¼Œæœ‰æ—¶é—´å»æ›´æ–°tçš„å€¼äº†ã€‚ å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼ˆæ­£ç¡®çš„åšæ³•ï¼‰ï¼š volatile private boolean t=false; å˜é‡å‰åŠ ä¸Švolatileï¼Œåˆ™å½“tçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¼ºåˆ¶æ›´æ–°ç¼“å­˜ä¸­çš„å€¼ã€‚æ‰€ä»¥ä¿é™©æƒ…å†µä¸‹ï¼Œè¯¥åŠ volatileè¿˜æ˜¯å¾—åŠ ã€‚ åŸåˆ›ï¼Œå¦‚æœ‰é›·åŒçº¯å±å·§åˆã€‚","link":"/archives/5cf0b88d.html"},{"title":"æ·±å…¥å¼€æºæ¡†æ¶åº•å±‚ä¹‹ASM","text":"ä»€ä¹ˆæ˜¯ ASM ï¼ŸASM æ˜¯ä¸€ä¸ª Java å­—èŠ‚ç æ“æ§æ¡†æ¶ã€‚å®ƒèƒ½è¢«ç”¨æ¥åŠ¨æ€ç”Ÿæˆç±»æˆ–è€…å¢å¼ºæ—¢æœ‰ç±»çš„åŠŸèƒ½ã€‚ASM å¯ä»¥ç›´æ¥äº§ç”ŸäºŒè¿›åˆ¶ class æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ Java è™šæ‹Ÿæœºä¹‹å‰åŠ¨æ€æ”¹å˜ç±»è¡Œä¸ºã€‚Java class è¢«å­˜å‚¨åœ¨ä¸¥æ ¼æ ¼å¼å®šä¹‰çš„ .class æ–‡ä»¶é‡Œï¼Œè¿™äº›ç±»æ–‡ä»¶æ‹¥æœ‰è¶³å¤Ÿçš„å…ƒæ•°æ®æ¥è§£æç±»ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼šç±»åç§°ã€æ–¹æ³•ã€å±æ€§ä»¥åŠ Java å­—èŠ‚ç ï¼ˆæŒ‡ä»¤ï¼‰ã€‚ASM ä»ç±»æ–‡ä»¶ä¸­è¯»å…¥ä¿¡æ¯åï¼Œèƒ½å¤Ÿæ”¹å˜ç±»è¡Œä¸ºï¼Œåˆ†æç±»ä¿¡æ¯ï¼Œç”šè‡³èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·è¦æ±‚ç”Ÿæˆæ–°ç±»ã€‚ ä¸ºä»€ä¹ˆè¦åŠ¨æ€ç”Ÿæˆ Java ç±»ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœå¼€æºæ¡†æ¶è¦æ±‚ä½ æ·»åŠ å„ç§Javaç±»æ¥å®ç°è¯¸å¦‚logã€cacheã€transactionç­‰åŠŸèƒ½ï¼Œæˆ‘æƒ³è¿™ä¸ªå¼€æºæ¡†æ¶ä½ è‚¯å®šä¸ä¼šç”¨å§ã€‚åŠ¨æ€ç”Ÿæˆç±»å¯ä»¥å‡å°‘å¯¹ä½ ä»£ç çš„ä¾µå…¥ï¼Œæé«˜ä½¿ç”¨è€…çš„æ•ˆç‡ã€‚ ä¸ºä»€ä¹ˆé€‰æ‹©ASMï¼Ÿæœ€ç›´æ¥çš„æ”¹é€  Java ç±»çš„æ–¹æ³•è«è¿‡äºç›´æ¥æ”¹å†™ class æ–‡ä»¶ã€‚Java è§„èŒƒè¯¦ç»†è¯´æ˜äº† class æ–‡ä»¶çš„æ ¼å¼ï¼Œç›´æ¥ç¼–è¾‘å­—èŠ‚ç ç¡®å®å¯ä»¥æ”¹å˜ Java ç±»çš„è¡Œä¸ºã€‚ç›´åˆ°ä»Šå¤©ï¼Œè¿˜æœ‰ä¸€äº› Java é«˜æ‰‹ä»¬ä½¿ç”¨æœ€åŸå§‹çš„å·¥å…·ï¼Œå¦‚ UltraEdit è¿™æ ·çš„ç¼–è¾‘å™¨å¯¹ class æ–‡ä»¶åŠ¨æ‰‹æœ¯ã€‚æ˜¯çš„ï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œä½†æ˜¯è¦æ±‚ä½¿ç”¨è€…å¯¹ Java class æ–‡ä»¶çš„æ ¼å¼äº†ç†Ÿäºå¿ƒï¼šå°å¿ƒåœ°æ¨ç®—å‡ºæƒ³æ”¹é€ çš„å‡½æ•°ç›¸å¯¹æ–‡ä»¶é¦–éƒ¨çš„åç§»é‡ï¼ŒåŒæ—¶é‡æ–°è®¡ç®— class æ–‡ä»¶çš„æ ¡éªŒç ä»¥é€šè¿‡ Java è™šæ‹Ÿæœºçš„å®‰å…¨æœºåˆ¶ã€‚ å¯ä»¥å‘ç°ï¼Œç›´æ¥æ“ä½œclassæ–‡ä»¶æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå°±è·Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬éƒ½é€‰æ‹©ä½¿ç”¨æ¡†æ¶ä¸€æ ·ï¼Œæ¡†æ¶å±è”½äº†åº•å±‚çš„å¤æ‚æ€§ã€‚ASMå°±æ˜¯æ“ä½œclassçš„ä¸€æŠŠåˆ©å™¨ã€‚ ä½¿ç”¨ ASM ç¼–ç¨‹ASMæä¾›äº†ä¸¤ç§APIï¼š CoreAPIï¼ˆClassVisitor ã€MethodVisitorç­‰ï¼‰ TreeAPIï¼ˆClassNodeï¼ŒMethodNodeç­‰ï¼‰ åŒºåˆ«æ˜¯CoreAPIåŸºäºäº‹ä»¶æ¨¡å‹ï¼Œå®šä¹‰äº†Classä¸­å„ä¸ªå…ƒç´ çš„Visitorï¼Œä¸éœ€è¦åŠ è½½æ•´ä¸ªClassåˆ°å†…å­˜ä¸­ã€‚è€ŒTreeAPIä»¥Treeç»“æ„å°†Classæ•´ä¸ªç»“æ„è¯»å–åˆ°å†…å­˜ä¸­ã€‚ä»ä½¿ç”¨è§’åº¦æ¥è¯´TreeAPIæ›´ä¸ºç®€å•ã€‚ ä»¥ä¸‹ç¤ºä¾‹é‡‡ç”¨çš„æ˜¯CoreAPIæ–¹å¼ã€‚ æ·»åŠ Mavenï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt; &lt;artifactId&gt;asm&lt;/artifactId&gt; &lt;version&gt;5.0.4&lt;/version&gt;&lt;/dependency&gt; ä½¿ç”¨çš„ç›¸å¯¹æ¯”è¾ƒç¨³å®šï¼Œä½¿ç”¨æ¯”è¾ƒå¤šçš„ç‰ˆæœ¬5.0.4ã€‚ é¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œä¿®æ”¹Classæœ‰å¤šç§æ–¹å¼ï¼Œä¾‹å¦‚ç›´æ¥ä¿®æ”¹å½“å‰Classï¼Œæˆ–è€…ç”ŸæˆClassçš„å­ç±»ï¼Œä»è€Œè¾¾åˆ°å¢å¼ºçš„æ•ˆæœã€‚ ä¸‹é¢çš„ç¤ºä¾‹å°±æ˜¯é€šè¿‡ç”ŸæˆæŒ‡å®šClassçš„å­ç±»ï¼Œä»è€Œè¾¾åˆ°å¢å¼ºçš„æ•ˆæœï¼Œå¥½å¤„æ˜¯å¯¹åŸæœ‰Classæ— ä¾µå…¥ï¼Œå¹¶ä¸”å¯ä»¥å®ç°å¤šæ€çš„æ•ˆæœã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ªæˆ‘ä»¬è¦å¢å¼ºçš„ç±»ï¼š 12345678910111213141516package com.zjz;import java.util.Random;/** * @author zhaojz created at 2019-08-22 10:49 */public class Student { public String name; public void studying() throws InterruptedException { System.out.println(this.name+&quot;æ­£åœ¨å­¦ä¹ ...&quot;); Thread.sleep(new Random().nextInt(5000)); }} æ¥ä¸‹æ¥é¦–å…ˆå®šä¹‰ä¸€ä¸ªClassReaderï¼š 1ClassReader classReader = new ClassReader(&quot;com.zjz.Student&quot;); ç„¶åå†å®šä¹‰ä¸€ä¸ªClassWriter: 1ClassWriter classWriter = new ClassWriter(classReader, ClassWriter.COMPUTE_MAXS); ClassWriter.COMPUTE_MAXS è¡¨ç¤ºè‡ªåŠ¨è®¡ç®—å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆå¤§å°ã€‚æ›´å¤šå…¶å®ƒé€‰é¡¹å¯å‚è€ƒï¼šasm.ow2.io æ¥ä¸‹æ¥å¼€å§‹æ­£å¼è®¿é—®Classï¼š 12345678910111213141516171819202122232425262728293031323334353637//é€šè¿‡ClassVisitorè®¿é—®Classï¼ˆåŒ¿åç±»çš„æ–¹å¼ï¼Œå¯ä»¥è‡ªè¡Œå®šä¹‰ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼‰//ASM5ä¸ºJVMå­—èŠ‚ç æŒ‡ä»¤æ“ä½œç ClassVisitor classVisitor = new ClassVisitor(Opcodes.ASM5, classWriter) { //å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè¡¨ç¤ºå¢å¼ºåç”Ÿæˆçš„å­ç±»çš„çˆ¶ç±» String enhancedSuperName; @Override public void visit(int version, int access, String name, String signature, String superName, String[] interfaces) { //æ‹¼æ¥éœ€è¦ç”Ÿæˆçš„å­ç±»çš„ç±»åï¼šStudent$EnhancedByASM String enhancedName = name+&quot;$EnhancedByASM&quot;; //å°†Studentè®¾ç½®ä¸ºçˆ¶ç±» enhancedSuperName = name; super.visit(version, access, enhancedName, signature, enhancedSuperName, interfaces); } @Override public FieldVisitor visitField(int access, String name, String desc, String signature, Object value) { //è¿™é‡Œæ˜¯æ¼”ç¤ºå­—æ®µè®¿é—® System.out.println(&quot;Field:&quot; + name); return super.visitField(access, name, desc, signature, value); } @Override public MethodVisitor visitMethod(int access, String name, String desc, String signature, String[] exceptions) { System.out.println(&quot;Method:&quot; + name); MethodVisitor mv = super.visitMethod(access, name, desc, signature, exceptions); MethodVisitor wrappedMv = mv; //åˆ¤æ–­å½“å‰è¯»å–çš„æ–¹æ³• if (name.equals(&quot;studying&quot;)) { //å¦‚æœæ˜¯studyingæ–¹æ³•ï¼Œåˆ™åŒ…è£…ä¸€ä¸ªæ–¹æ³•çš„Visitor wrappedMv = new StudentStudyingMethodVisitor(Opcodes.ASM5, mv); }else if(name.equals(&quot;&lt;init&gt;&quot;)){ //å¦‚æœæ˜¯æ„é€ æ–¹æ³•ï¼Œå¤„ç†å­ç±»ä¸­çˆ¶ç±»çš„æ„é€ å‡½æ•°è°ƒç”¨ wrappedMv = new StudentEnhancedConstructorMethodVisitor(Opcodes.ASM5, mv,enhancedSuperName); } return wrappedMv; }}; æ¥ä¸‹æ¥é‡ç‚¹çœ‹çœ‹MethodVisitorï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//Studyingæ–¹æ³•çš„Visitorstatic class StudentStudyingMethodVisitor extends MethodVisitor{ public StudentStudyingMethodVisitor(int i, MethodVisitor methodVisitor) { super(i, methodVisitor); } //MethodVisitor ä¸­å®šä¹‰äº†ä¸åŒçš„visitXXX()æ–¹æ³•ï¼Œä»£è¡¨çš„ä¸åŒçš„è®¿é—®é˜¶æ®µã€‚ //visitCodeè¡¨ç¤ºåˆšåˆšè¿›å…¥æ–¹æ³•ã€‚ @Override public void visitCode() { //æ·»åŠ ä¸€è¡ŒSystem.currentTimeMillis()è°ƒç”¨ visitMethodInsn(Opcodes.INVOKESTATIC, &quot;java/lang/System&quot;, &quot;currentTimeMillis&quot;, &quot;()J&quot;, false); //å¹¶ä¸”å°†å…¶å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨å†…ä½ç½®ä¸º1çš„åœ°æ–¹ visitVarInsn(Opcodes.LSTORE, 1); //ä¸Šé¢ä¸¤ä¸ªçš„ä½œç”¨å°±æ˜¯åœ¨Studyingæ–¹æ³•çš„ç¬¬ä¸€è¡Œæ·»åŠ  long start = System.currentTimeMillis() } //visitInsn è¡¨ç¤ºè®¿é—®è¿›å…¥äº†æ–¹æ³•å†…éƒ¨ @Override public void visitInsn(int opcode) { //é€šè¿‡opcodeå¯ä»¥å¾—çŸ¥å½“å‰è®¿é—®åˆ°äº†å“ªä¸€æ­¥ï¼Œå¦‚æœæ˜¯&gt;=Opcodes.IRETURN &amp;&amp; opcode &lt;= Opcodes.RETURN è¡¨æ˜æ–¹æ³•å³å°†é€€å‡º if ((opcode &gt;= Opcodes.IRETURN &amp;&amp; opcode &lt;= Opcodes.RETURN)){ //åŠ è½½å±€éƒ¨å˜é‡è¡¨ä¸­ä½ç½®ä¸º1çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯startçš„æ•°æ®ï¼Œå¹¶ä¼ å…¥ç»™ä¸‹é¢çš„æ–¹æ³• visitVarInsn(Opcodes.LLOAD, 1); //ç„¶åè°ƒç”¨è‡ªå®šä¹‰çš„ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œç”¨æ¥è¾“å‡ºè€—æ—¶ visitMethodInsn(Opcodes.INVOKESTATIC, &quot;com/zjz/Before&quot;, &quot;end&quot;, &quot;(J)V&quot;, false); } super.visitInsn(opcode); }}static class StudentEnhancedConstructorMethodVisitor extends MethodVisitor{ //å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•çˆ¶ç±»åç§° private String superClassName; public StudentEnhancedConstructorMethodVisitor(int i, MethodVisitor methodVisitor,String superClassName) { super(i, methodVisitor); this.superClassName = superClassName; } @Override public void visitMethodInsn(int opcode, String owner, String name, String desc, boolean b) { //å½“å¼€å§‹åˆå§‹åŒ–æ„é€ å‡½æ•°æ—¶ï¼Œå…ˆè®¿é—®çˆ¶ç±»æ„é€ å‡½æ•°,ç±»ä¼¼æºç ä¸­çš„super() if (opcode==Opcodes.INVOKESPECIAL &amp;&amp; name.equals(&quot;&lt;init&gt;&quot;)){ owner = superClassName; } super.visitMethodInsn(opcode, owner, name, desc, b); }} æ­¤æ—¶ClassVisitorè¿˜æ²¡æœ‰æ•°æ®çš„è¾“å…¥ï¼Œåªå®šä¹‰äº†æ•°æ®çš„è¾“å‡º new ClassVisitor(Opcodes.ASM5, classWriter)ï¼Œæ‰€ä»¥è¿˜éœ€è¦ï¼š 1classReader.accept(classVisitor, ClassReader.SKIP_DEBUG); åˆ°æ­¤å°±å®Œæˆäº†Classçš„è¯»å–ï¼Œè®¿é—®ä¿®æ”¹ï¼Œè¾“å‡ºçš„è¿‡ç¨‹ã€‚ ç»†å¿ƒçš„è§‚ä¼—å°±ä¼šå‘ç°äº†ï¼Œè¾“å‡ºåˆ°å“ªé‡Œäº†ï¼Ÿæ€ä¹ˆæ ·è®¿é—®æ–°ç”Ÿæˆçš„ç±»å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªClassLoaderæ¥åŠ è½½æˆ‘ä»¬ç”Ÿæˆçš„Classï¼š 12345static class StudentClassLoader extends ClassLoader{ public Class defineClassFromClassFile(String className,byte[] classFile) throws ClassFormatError{ return defineClass(className, classFile, 0, classFile.length); } } ç„¶åé€šè¿‡ClassWriterè·å–æ–°ç”Ÿæˆçš„ç±»çš„å­—èŠ‚æ•°ç»„ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ï¼š 12byte[] data = classWriter.toByteArray();Class subStudent = classLoader.defineClassFromClassFile(&quot;com.zjz.Student$EnhancedByASM&quot;, data); åˆ°æ­¤å°±å®Œæˆäº†ä¸€ä¸ªclassçš„ç”Ÿæˆï¼Œä¸Šé¢çš„ä»£ç å®Œæˆçš„æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„äº‹æƒ…ï¼šè®°å½•å­¦ä¹ æ—¶é—´ã€‚ æ€»ç»“ä¸€ä¸‹ï¼š ASM CoreAPI æ ¸å¿ƒçš„ä¸‰ä¸ªä¸œè¥¿å°±æ˜¯ClassReaderã€Visitorã€ClassWriterï¼Œé€šè¿‡è´£ä»»é“¾æ¨¡å¼å°†å…¶é“¾æ¥èµ·æ¥ã€‚ Visitoré€šè¿‡è®¿é—®è€…æ¨¡å¼è¿›è¡Œæ–¹æ³•ã€å­—æ®µç­‰ç­‰å±æ€§çš„è®¿é—®ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•å’Œå­—æ®µï¼Œåªéœ€è¦å°†å…¶åŸæœ¬çš„Visitorç»™Wrapä¸€ä¸‹å³å¯ã€‚ å…³äºå¦‚ä½•è¿›è¡Œä»£ç çš„hookéœ€è¦ç†è§£JVMç›¸å…³å­—èŠ‚ç æŒ‡ä»¤ï¼Œä»¥åŠASMçš„ç›¸å…³OpCodeã€‚ ASM Bytecode Outline 2017ä½†æ˜¯é‚£ä¹ˆå¤šæŒ‡ä»¤ã€OpCodeã€ç¬¦å·æ€ä¹ˆè®°å¾—ä½å‘¢ï¼Ÿæ¯”å¦‚ä¸Šé¢ä»£ç ä¸­çš„ï¼š 12visitMethodInsn(Opcodes.INVOKESTATIC, &quot;java/lang/System&quot;, &quot;currentTimeMillis&quot;, &quot;()J&quot;, false);visitVarInsn(Opcodes.LSTORE, 1); Opcodes.INVOKESTATIC ã€Opcodes.LSTOREã€()Jï¼Œæ˜¯ä¸æ˜¯çœ‹ç€å°±æ™•ï¼Ÿå…¶å®é™¤äº†ç†Ÿèƒ½ç”Ÿå·§å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å·¥å…·ã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯IDEAï¼Œé‚£ä¹ˆå¯ä»¥å®‰è£…ä¸ŠASM Bytecode Outline 2017æ’ä»¶ã€‚ç„¶ååœ¨æºæ–‡ä»¶ä¸Šå³é”®é€‰æ‹©Show Bytecode Outlineï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä¸‹è§†å›¾ï¼š åˆ‡æ¢çš„ASMifiedè§†å›¾ï¼Œä½ ä¼šçœ‹åˆ°è·Ÿæˆ‘ä»¬ä¸Šé¢å†™çš„ä¸€æ ·çš„ä»£ç ï¼Œç›´æ¥Copyè¿‡æ¥ä½¿ç”¨å³å¯ã€‚ æŸ¥çœ‹ç¤ºä¾‹å®Œæ•´æºä»£ç ï¼šasm_demo å‚è€ƒèµ„æ–™ï¼š https://asm.ow2.io/ https://www.ibm.com/developerworks/cn/java/j-lo-asm30/index.html https://juejin.im/post/5b549bcbe51d45169c1c8b66","link":"/archives/58ee9111.html"},{"title":"è·å–jarä¸­çš„æ–‡ä»¶æ³¨æ„äº‹é¡¹","text":"è·å–resourcesä¸‹çš„æ–‡ä»¶Javaæœ‰å¾ˆå¤šç§æ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœä½ çš„ç¨‹åºæœ€ç»ˆæ‰“æˆjarå‘å¸ƒã€‚é‚£ä¹ˆéœ€è¦æ³¨æ„ä½ æ˜¯å¦ä»¥æµinputstreamè¯»å–ã€‚å› ä¸ºjarä¸­çš„æ–‡ä»¶è·¯å¾„ä¸ºjar!xxxxxx ç®€å•çš„ä½¿ç”¨path æˆ–è€…getResoucesè‚¯å®šè·å–ä¸åˆ°ã€‚","link":"/archives/7f9f876c.html"},{"title":"è®°ä¸€ä¸ªSpring Data JPAè‡ªå®šä¹‰åˆ†é¡µæŸ¥è¯¢BUG","text":"å®˜æ–¹ç»™å‡ºçš„è‡ªå®šä¹‰åˆ†é¡µæŸ¥è¯¢çš„ç¤ºä¾‹æ˜¯è¿™æ ·çš„ï¼š 123456public interface UserRepository extends JpaRepository&lt;User, Long&gt; { @Query(value = &quot;SELECT * FROM USERS WHERE LASTNAME = ?1&quot;, countQuery = &quot;SELECT count(*) FROM USERS WHERE LASTNAME = ?1&quot;, nativeQuery = true) Page&lt;User&gt; findByLastname(String lastname, Pageable pageable);} https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.at-query ç„¶åå®é™…æ‰§è¡Œæ—¶æŠ¥é”™ï¼š 1org.springframework.data.jpa.repository.query.InvalidJpaQueryMethodException è¿™æ˜¯å› ä¸ºåœ¨ä½¿ç”¨NativeQueryæ—¶ï¼Œä¼šæœ‰è¿™æ ·ä¸€ä¸ªéªŒè¯ï¼š 123456789public NativeJpaQuery(JpaQueryMethod method, EntityManager em, String queryString, EvaluationContextProvider evaluationContextProvider, SpelExpressionParser parser) { super(method, em, queryString, evaluationContextProvider, parser); JpaParameters parameters = method.getParameters(); boolean hasPagingOrSortingParameter = parameters.hasPageableParameter() || parameters.hasSortParameter(); boolean containsPageableOrSortInQueryExpression = queryString.contains(&quot;#pageable&quot;) || queryString.contains(&quot;#sort&quot;); if(hasPagingOrSortingParameter &amp;&amp; !containsPageableOrSortInQueryExpression) { throw new InvalidJpaQueryMethodException(&quot;Cannot use native queries with dynamic sorting and/or pagination in method &quot; + method); }} å½“å‚æ•°ä¸­åŒ…å«Pageableæˆ–è€…Sortæ—¶ï¼ŒSQLè¯­å¥ä¸­å¿…é¡»åŒ…å« 12#pageable#sort å‚è€ƒäº†ä¼—å¤šè§£å†³æ–¹æ¡ˆéƒ½æ— æ•ˆã€‚ä¾‹å¦‚ 12?#{#pageable}\\n#pageable\\ https://stackoverflow.com/questions/38349930/spring-data-and-native-query-with-pagination æœ€ç»ˆå‘ç°ï¼Œå…¶å®åªéœ€è¦å°†#pageableåˆç†çš„ä½œä¸ºæ³¨é‡ŠåŒ…å«åœ¨SQLé‡Œå³å¯ã€‚æˆ‘ä½¿ç”¨çš„Mysqlï¼Œæœ€ç»ˆè§£å†³æ–¹æ¡ˆä¸ºï¼š 123456public interface UserRepository extends JpaRepository&lt;User, Long&gt; { @Query(value = &quot;SELECT * FROM USERS WHERE LASTNAME = ?1 /*#pageable*/&quot;, countQuery = &quot;SELECT count(*) FROM USERS WHERE LASTNAME = ?1&quot;, nativeQuery = true) Page&lt;User&gt; findByLastname(String lastname, Pageable pageable);} æˆ‘ä½¿ç”¨çš„æ˜¯Spring boot 1.5.4ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­åº”è¯¥æ­¤é—®é¢˜å·²ç»è¢«ä¿®å¤äº†ã€‚","link":"/archives/de80e1f4.html"},{"title":"è®°ä¸€æ¬¡çº¿ä¸Šæ­»é”æ’æŸ¥","text":"å‰æ®µæ—¶é—´å¶å°”ä¼šæ”¶åˆ°çº¿ä¸ŠMySQLæ­»é”å‘Šè­¦é€šçŸ¥ï¼Œç”±äºæœ‰è¡¥å¿æœºåˆ¶ï¼Œæœ€ç»ˆä¸šåŠ¡ä¼šå¤„ç†æˆåŠŸï¼Œæ‰€ä»¥æ²¡å¤ªå…³å¿ƒã€‚ 1Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction æœ€è¿‘åˆæ”¶åˆ°äº†ç›¸åŒçš„å‘Šè­¦ï¼Œå¯èƒ½ä¸æ˜¯å¶ç„¶äº‹ä»¶ï¼Œäºæ˜¯å¼€å§‹æ’æŸ¥ã€‚é¦–å…ˆç¿»çœ‹äº†æ—¥å¿—ï¼Œç»“åˆä»£ç ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆé—®é¢˜ã€‚äº‹å‘æ—¶åº”è¯¥ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§æ‰¹é‡å¹¶å‘äº‹ä»¶ã€‚ äºæ˜¯å‘DBAè¦æ¥äº†deadlock logï¼Œæ—¥å¿—å†…å®¹å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940LATEST DETECTED DEADLOCK------------------------2021-03-22 16:02:01 0x7f1cfc289700*** (1) TRANSACTION:TRANSACTION 153411874, ACTIVE 0 sec starting index readmysql tables in use 1, locked 1LOCK WAIT 8 lock struct(s), heap size 1136, 23 row lock(s), undo log entries 22MySQL thread id 8203444, OS thread handle 139762013996800, query id 766107488 updatingupdate testSET status = 4,version = version+1,gmt_modified = '2021-03-22 16:02:01' where id = 1and version=14*** (1) WAITING FOR THIS LOCK TO BE GRANTED:RECORD LOCKS space id 639 page no 2931 n bits 128 index PRIMARY of table `test` trx id 153411874 lock_mode X locks rec but not gap waitingRecord lock, heap no 40 PHYSICAL RECORD: n_fields 45; compact format; info bits 0*** (2) TRANSACTION:TRANSACTION 153411876, ACTIVE 0 sec starting index readmysql tables in use 1, locked 18 lock struct(s), heap size 1136, 7 row lock(s), undo log entries 6MySQL thread id 8204162, OS thread handle 139762466330368, query id 766107489 updatingupdate test SET approval_status = 5, biz_date = '2021-02-23 00:00:00', modified_id = 123, modified_name = 'xxx', contact_company_id = 456, contact_company_n*** (2) HOLDS THE LOCK(S):RECORD LOCKS space id 639 page no 2931 n bits 128 index PRIMARY of table `test` trx id 153411876 lock_mode X locks rec but not gapRecord lock, heap no 40 PHYSICAL RECORD: n_fields 45; compact format; info bits 0*** (2) WAITING FOR THIS LOCK TO BE GRANTED:RECORD LOCKS space id 639 page no 2931 n bits 128 index PRIMARY of table `test` trx id 153411876 lock_mode X locks rec but not gap waitingRecord lock, heap no 28 PHYSICAL RECORD: n_fields 45; compact format; info bits 0 ä¸Šé¢æ—¥å¿—åªä¿ç•™äº†å…³é”®éƒ¨åˆ†ï¼Œè¡¨åç­‰ä¹Ÿè¿›è¡Œäº†è„±æ•ã€‚å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªäº‹åŠ¡éƒ½åœ¨ç­‰å¾…PRIMARYä¹Ÿå°±æ˜¯ä¸»é”®ç´¢å¼• 1RECORD LOCKS space id 639 page no 2931 n bits 128 index PRIMARY of table `test` ç„¶åå†ç»“åˆæ—¥å¿—ä¸­çš„SQLå’Œä»£ç ï¼Œå‘ç°é—®é¢˜çš„åŸå› å¦‚ä¸‹: ä¸€å…±æ¶‰åŠ3ä¸ªç³»ç»Ÿï¼Œåˆ†åˆ«æ˜¯Sã€Cã€Fï¼Œåœ¨Sç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªä¸šåŠ¡æ“ä½œå®Œæˆåä¼šç»™Cï¼ŒFå‘æ¶ˆæ¯ï¼ŒCæ”¶åˆ°Sçš„æ¶ˆæ¯å¤„ç†å®Œæˆåä¹Ÿä¼šç»™Få‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¦‚å›¾æ‰€ç¤º: åœ¨Fä¸­å‡ ä¹åŒæ—¶å¼€å¯äº†ä¸¤ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”ä¸¤ä¸ªæ¶ˆæ¯åœ¨Fä¸­æ¶‰åŠçš„è®°å½•æ˜¯ç›¸åŒçš„ï¼Œidåˆ†åˆ«æ˜¯1ï¼Œ2ï¼Œè¡¨ä¸ºtestã€‚äºæ˜¯å‡ºç°äº†äº‹åŠ¡ä¸€: 12345SQL1:update test set status = 4 ...... where id=1SQL2:update test set status = 4 ...... where id=2 äº‹åŠ¡äºŒ: 12345SQL1:update test SET approval_status = 5 ...... where id =2SQL2:update test SET approval_status = 5 ...... where id =1 äº‹åŠ¡ä¸€å…ˆæŒæœ‰id=1çš„é”ï¼Œäº‹åŠ¡äºŒæŒæœ‰id=2çš„é”ï¼Œäº‹åŠ¡ä¸€å°è¯•è·å–id=2çš„é”ï¼Œäº‹åŠ¡äºŒå°è¯•è·å–id=1çš„é”ï¼Œæ‰€ä»¥æ­»é”äº†ã€‚æœ€åMySQLå›æ»šäº†äº‹åŠ¡äºŒã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯ç”±äºäº§å“å’Œç³»ç»Ÿè®¾è®¡ä¸åˆç†å¯¼è‡´çš„ï¼Œç›®å‰æ­£åœ¨é‡æ„ä¸­ã€‚ å¦‚æœä¸‹æ¬¡å†å‘ç”Ÿæ­»é”ç›´æ¥çœ‹deadlock logå§ï¼Œæ²¡å¿…è¦æµªè´¹æ—¶é—´ç¿»ä»£ç çœ‹ä¸šåŠ¡æ—¥å¿—äº†ã€‚","link":"/archives/9e47523f.html"},{"title":"è¯»å–Jarä¸­æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶","text":"è¯»å–Jarä¸­æ–‡ä»¶ä½¿ç”¨ç±»ä¼¼getResourceAsStreamç­‰ä»¥æµçš„æ–¹å¼è·å–å³å¯ã€‚ä½†æ˜¯æƒ³è¦è¯»å–Jarä¸­æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å´ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚ ç¬¬ä¸€ç§æ–¹å¼é¦–å…ˆè¦è¯»å–Jarä¸­çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¾—å…ˆææ¸…æ¥šJarä¸­çš„ç›®å½•ç»“æ„ï¼Œä¾‹å¦‚å¸¸è§çš„SpringBootæ‰“åŒ…åçš„Jarä¸­ç›®å½•å¦‚ä¸‹ï¼š å‡å¦‚æˆ‘ä»¬è¦è¯»å–çš„ç›®å½•æ˜¯BOOT-INF/classes/processesï¼ˆå¯¹åº”æºæ–‡ä»¶ç›®å½•æ˜¯resources/processesï¼‰ ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324//è·å–å½“å‰Jaræ–‡ä»¶è·¯å¾„URL url = this.getClass().getClassLoader().getResource(&quot;&quot;); String jarPath = url.toString().substring(0, url.toString().indexOf(&quot;!/&quot;) + 2); log.info(&quot;jarPath:{}&quot;, jarPath); URL jarURL = new URL(jarPath); JarURLConnection jarCon = (JarURLConnection) jarURL.openConnection(); JarFile jarFile = jarCon.getJarFile();//è·å–Jarä¸‹æ‰€æœ‰æ–‡ä»¶ Enumeration&lt;JarEntry&gt; entries = jarFile.entries();//éå†æ–‡ä»¶ while (entries.hasMoreElements()) { JarEntry jarEntry = entries.nextElement(); //è·å–æ–‡ä»¶è·¯å¾„ String innerPath = jarEntry.getName(); log.info(&quot;jarEntry Name:{}&quot;, innerPath); //åˆ¤æ–­æ˜¯å¦éœ€è¦å¤„ç†çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ŒPROCESSES=BOOT-INF/classes/processes if (innerPath.startsWith(PROCESSES) &amp;&amp; !jarEntry.isDirectory()) { //è·å–åˆ°æ–‡ä»¶æµ InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream(innerPath); //doSomething //...... } }} æ­¤æ–¹å¼ä¼˜ç¼ºç‚¹ï¼šæ— ç¬¬ä¸‰æ–¹åº“ä¾èµ–ï¼Œç”¨çš„éƒ½æ˜¯JDK ç›¸å…³APIã€‚ä½†æ˜¯åªèƒ½åœ¨jaræ¨¡å¼ä¸‹è¿è¡Œï¼Œæœ¬åœ°è°ƒè¯•ä¼šå‡ºé”™ã€‚ ç¬¬äºŒç§æ–¹å¼å¦‚æœæœ‰ä½¿ç”¨åˆ°Springï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯æ‰“æˆJarè¿è¡Œè¿˜æ˜¯æœ¬åœ°è¿è¡Œï¼Œè·å–æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å°±å¾ˆç®€å•äº†ã€‚ä¸»è¦æ˜¯åˆ©ç”¨äº†Spring çš„ResourcePatternResolverï¼Œè¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617 List&lt;Resource&gt; resourceList = new ArrayList&lt;&gt;();//PROCESS_DEFINITION_LOCATION_SUFFIXES = Arrays.asLIst(&quot;**.bpmn20.xml&quot;,&quot;**.bpmn&quot;) for (String suffix : PROCESS_DEFINITION_LOCATION_SUFFIXES) { //PROCESS_DEFINITION_LOCATION_SUFFIXES = classpath://processes/ //æ‹¼æ¥è·¯å¾„pattern String path = PROCESS_DEFINITION_LOCATION_PREFIX + suffix; //é€šè¿‡ResourcePatternResolverè·å–èµ„æºæ–‡ä»¶, //resourceLoader = @Autowired ResourcePatternResolver resourceLoader Resource[] resources = resourceLoader.getResources(path); if (resources != null &amp;&amp; resources.length &gt; 0) { resourceList.addAll(Arrays.asList(resources)); } }//é€šè¿‡resource.getInputStream()å³å¯è·å–æ–‡ä»¶æµ//doSomething//...... æ­¤æ–¹å¼ä¼˜ç¼ºç‚¹ï¼Œä¾èµ–äº†Springæ¡†æ¶ï¼Œä½†æ˜¯å¯¹è¿è¡Œç¯å¢ƒæ²¡æœ‰è¦æ±‚ã€‚ æ€»ç»“ï¼š æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œæ¯•ç«Ÿç°åœ¨åŸºæœ¬ä¸Šéƒ½ä¼šä½¿ç”¨åˆ°Springã€‚","link":"/archives/f728629b.html"},{"title":"è¢«éš”ç¦»çš„ç¬¬7å¤©","text":"è¢«éš”ç¦»çš„ç¬¬7å¤©ï¼Œæ¯å¤©æ¥åˆ°æ— æ•°ä¸ªéƒ¨é—¨çš„ç”µè¯ï¼Œé‡ä½“æ¸©ï¼ŒæŠ¥æƒ…å†µã€‚","link":"/archives/3eda1a9.html"},{"title":"ã€ŠJavaæ€§èƒ½-æƒå¨æŒ‡å—ã€‹ ç¬”è®°","text":"åœ¨åšæ€§èƒ½æµ‹è¯•æ—¶ï¼Œéœ€è¦ç¡®ä¿è¾“å…¥å‚æ•°æ˜¯ç¡®å®šçš„ï¼Œå¦åˆ™å¤„ç†å‚æ•°è¿˜ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚ JVMä¸»è¦æ¥å—ä¸¤ç±»æ ‡å¿—ï¼ˆå°‘æ•°ä¾‹å¤–ï¼‰ï¼šå¸ƒå°”æ ‡å¿—å’Œé™„å¸¦å‚æ•°æ ‡å¿—ã€‚ å¸ƒå°”æ ‡å¿—è¯­æ³•ï¼š-XX:+FlagNameè¡¨ç¤ºå¼€å¯ï¼Œ-XX:-FlagNameè¡¨ç¤ºå…³é—­ã€‚ é™„å¸¦å‚æ•°æ ‡å¿—è¯­æ³•ï¼š-XX:FlagName=somethingã€‚ä¾‹å¦‚-XX:NewRadio=Nã€‚ ç³»ç»Ÿçº§ç›‘æ§å‘½ä»¤ vmstatï¼Œå…³æ³¨cs ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œusç”¨æˆ·CPUæ—¶é—´ï¼Œsyç³»ç»ŸCPUæ—¶é—´ã€‚ JDKå¸¸ç”¨å°å·¥å…· å·¥å…· è¯´æ˜ å¸¸ç”¨ jcmd æ‰“å°Javaè¿›ç¨‹æ¶‰åŠçš„åŸºæœ¬ç±»ã€çº¿ç¨‹å’ŒVMä¿¡æ¯ æŸ¥çœ‹JVMç‰ˆæœ¬ï¼š jcmd process_id VM.version æŸ¥çœ‹JVMè°ƒä¼˜å‚æ•°ï¼šjcmd process_id VM.flags [-all] æŸ¥çœ‹ç¨‹åºæ‰€ä½¿ç”¨çš„å‘½ä»¤è¡Œï¼šjcmd process_id VM.command_line jstack çº¿ç¨‹æ ˆä¿¡æ¯è·å– ç»Ÿè®¡åˆ†æçº¿ç¨‹æƒ…å†µï¼šjstack pid &gt; jstack.out java ParseJStack jstack.out JIT ç¼–è¯‘å™¨Javaæ˜¯ä¸€ç§è§£é‡Šæ€§è¯­è¨€ï¼Œåªä¸è¿‡è§£é‡Šçš„æ˜¯classã€‚é€šå¸¸è®¤ä¸ºè§£é‡Šæ€§è¯­è¨€æ€§èƒ½è¾ƒå·®ï¼Œä½†æ˜¯JVMé€šè¿‡å³æ—¶ç¼–è¯‘è§£å†³è¿™ä¸ªé—®é¢˜ã€‚HotSpot JVMé€šè¿‡ç¼–è¯‘çƒ­ç‚¹ä»£ç ï¼ˆç»å¸¸æ‰§è¡Œçš„ä»£ç ï¼‰ä¸ºæœºå™¨ç æ¥æé«˜æ€§èƒ½ï¼Œå¯¹äºåªæ‰§è¡Œä¸€æ¬¡çš„ä»£ç ï¼Œç¼–è¯‘æ—¶é—´å¯èƒ½è¶…è¿‡äº†ç›´æ¥è§£é‡Šæ‰§è¡Œclassçš„æ—¶é—´ï¼ŒJVMä¸ä¼šç¼–è¯‘æ­¤ç±»ä»£ç ã€‚ JVMå¯¹æ‰§è¡Œæ¬¡æ•°è¶Šå¤šçš„ä»£ç è¶Šç†Ÿæ‚‰ï¼Œä¼˜åŒ–æ•ˆæœæ›´é«˜ã€‚ é€‰æ‹©ç¼–è¯‘å™¨ç±»å‹Javaè™šæ‹Ÿæœºåˆ†ä¸ºClient(C1)ã€Server(C2)ä¸¤ç±»è™šæ‹Ÿæœº(ç¼–è¯‘å™¨)ã€‚-XX:+Printflagsfinal å¼€å¯åèƒ½è·å¾—åŸºäºç¯å¢ƒçš„è‡ªåŠ¨è°ƒä¼˜ã€‚ JVM Server æ¨¡å¼ä¸ Client æ¨¡å¼å¯åŠ¨ï¼Œæœ€ä¸»è¦çš„å·®åˆ«åœ¨äºï¼š-server æ¨¡å¼å¯åŠ¨æ—¶ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œä½†æ˜¯ä¸€æ—¦è¿è¡Œèµ·æ¥åï¼Œæ€§èƒ½å°†ä¼šæœ‰å¾ˆå¤§çš„æå‡ã€‚åŸå› æ˜¯ï¼šå½“è™šæ‹Ÿæœºè¿è¡Œåœ¨-client æ¨¡å¼çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªä»£å·ä¸º C1 çš„è½»é‡çº§ç¼–è¯‘å™¨ï¼Œè€Œ-server æ¨¡å¼å¯åŠ¨çš„è™šæ‹Ÿæœºé‡‡ç”¨ç›¸å¯¹é‡é‡çº§ä»£å·ä¸º C2 çš„ç¼–è¯‘å™¨ã€‚C2 æ¯” C1 ç¼–è¯‘å™¨ç¼–è¯‘çš„ç›¸å¯¹å½»åº•ï¼ŒæœåŠ¡èµ·æ¥ä¹‹åï¼Œæ€§èƒ½æ›´é«˜ã€‚é€‰æ‹©ç¼–è¯‘å™¨çš„æ ‡å¿—ä¸å¤§å¤šæ•°æ ‡å¿—ä¸åŒï¼Œæ ‡å‡†çš„ç¼–è¯‘å™¨æ ‡å¿—æ˜¯ï¼š-client ã€-server æˆ–è€…-d64ã€‚åˆ†å±‚ç¼–è¯‘(tiered compilation)æ˜¯ä¸ªä¾‹å¤–ï¼Œå¸¸è§å¼€å¯æ–¹å¼ä¸ºï¼š-XX:+TieredCompilationã€‚åˆ†å±‚ç¼–è¯‘å¿…é¡»ä½¿ç”¨serverç¼–è¯‘å™¨ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œä»£ç ä¼šå…ˆè¢«è§£é‡Šå™¨æ‰§è¡Œï¼Œç§¯ç´¯åˆ°è¶³å¤Ÿçƒ­åº¦çš„æ—¶å€™ç”±client compilerï¼ˆC1ï¼‰ç¼–è¯‘ï¼Œç„¶åç»§ç»­ç§¯ç´¯çƒ­åº¦åˆ°ä¸€å®šç¨‹åº¦ä¼šè¿›ä¸€æ­¥è¢«server compilerï¼ˆC2ï¼‰é‡æ–°ä»¥æ›´é«˜çš„ä¼˜åŒ–ç¨‹åº¦ç¼–è¯‘ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨é€‰æ‹©åˆ†å±‚ç¼–è¯‘ï¼ŒçŸ­æš‚è¿è¡Œçš„åº”ç”¨é€‰æ‹©clientè¾ƒå¥½ï¼ˆç‰¹åˆ«æ˜¯è¦æ±‚å¯åŠ¨æ—¶é—´å¿«çš„ï¼‰ï¼ˆJAVA8ä¸­åˆ†å±‚ç¼–è¯‘æ˜¯é»˜è®¤å¼€å¯çš„ï¼‰ã€‚ è°ƒä¼˜ä»£ç ç¼“å­˜JVMåœ¨ç¼–è¯‘ä»£ç åï¼Œä¼šåœ¨ä»£ç ç¼“å­˜ä¸­ä¿å­˜ç¼–è¯‘ä¹‹åçš„æ±‡ç¼–è¯­è¨€æŒ‡ä»¤é›†ã€‚ä»£ç ç¼“å­˜çš„å¤§å°å›ºå®šï¼Œæ‰€ä»¥ä¸€æ—¦å¡«æ»¡ï¼ŒJVMå°±ä¸èƒ½ç¼–è¯‘æ›´å¤šçš„ä»£ç äº†ã€‚é€šå¸¸Serveræ¨¡å¼éœ€è¦çš„æ¯”Clientè¦å¤§ï¼ŒJVMé»˜è®¤çš„ä»£ç ç¼“å­˜å¤§å°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ²¡æœ‰åŠæ³•èƒ½å¤Ÿå‡†ç¡®çš„æµ‹å‡ºæ‰€éœ€è¦çš„ä»£ç ç¼“å­˜å¤§å°ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ç®€å•çš„å¢åŠ 1å€æˆ–è€…3å€ã€‚-XX:ReservedCodeCacheSize=Næ ‡å¿—å¯ä»¥è®¾ç½®ä»£ç ç¼“å­˜çš„æœ€å¤§å€¼ã€‚-XX:InitialCodeCacheSize=Næ ‡å¿—æŒ‡å®šåˆå§‹å¤§å°ã€‚é€šå¸¸åªéœ€è¦è®¾ç½®æœ€å¤§å€¼å³å¯ã€‚è¿™é‡Œè®¾ç½®çš„å¤§å°ä¿ç•™å†…å­˜ï¼Œå¹¶ä¸ä¼šç›´æ¥åˆ†é…ã€‚ ç¼–è¯‘é˜€å€¼åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼–è¯‘ï¼Œæ˜¯é€šè¿‡æ£€æŸ¥ä¸¤ç§è®¡æ•°å™¨ï¼ˆå›è¾¹è®¡æ•°å™¨ã€æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼‰æ€»æ•°ã€‚æ ‡å‡†ç¼–è¯‘ç”±-XX:CompileThreshold=Næ ‡å¿—è§¦å‘ã€‚clienté»˜è®¤å€¼æ˜¯1500ï¼Œserveré»˜è®¤å€¼æ˜¯10000ã€‚è®¡æ•°å™¨ä¼šéšç€æ—¶é—´è€Œå‡å°‘ï¼Œå¯¹äºå¶å°”æ‰§è¡Œçš„æ–¹æ³•å¯èƒ½æ°¸è¿œè¾¾ä¸åˆ°é˜€å€¼ã€‚ ç¼–è¯‘æ—¥å¿—é€šè¿‡-XX:+PrintCompilationå¯ä»¥å¯ç”¨ç¼–è¯‘æ—¥å¿—ã€‚ä¹Ÿå¯ä»¥é€šè¿‡jstat -compiler process_idäº†è§£ç¼–è¯‘æƒ…å†µã€‚å¦å¤–ä¹Ÿå¯ä»¥é€šè¿‡jstat -printcompilation process_id intevel_time(1000æ¯«ç§’)æ ‡å¿—æ¥è·å–æœ€è¿‘è¢«ç¼–è¯‘çš„æ–¹æ³•ã€‚ æ–¹æ³•å†…è”ï¼ŒJavaæ‰§è¡Œæ–¹æ³•å°±æ˜¯æ ˆå¸§çš„å…¥æ ˆå‡ºæ ˆï¼Œæ ˆå¸§åŒ…å«å±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æ¥ï¼Œè¿”å›å€¼ã€‚å…¥æ ˆå‡ºæ ˆç›¸å¯¹æ¥è¯´æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥å¯¹ä¸€äº›ç®€å•çš„æ–¹æ³•ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç›´æ¥ç”¨å‡½æ•°ä½“æ›¿æ¢è°ƒç”¨æ–¹æ³•ã€‚ å…³äºfinalï¼Œå‡ ä¹æ‰€æœ‰çš„äººéƒ½è¯´æ·»åŠ finalåæœ‰åˆ©äºJITåšæ–¹æ³•å†…è”å’Œå…¶ä»–ä¼˜åŒ–ã€‚ç¡®å®åœ¨å¾ˆä¹…å¾ˆä¹…ä»¥å‰æ˜¯è¿™æ ·çš„ã€‚ç°åœ¨åŠ ä¸åŠ finalå¯¹æ€§èƒ½éƒ½æ²¡æœ‰å½±å“ã€‚ä½†æ˜¯å¦‚æœç¡®å®æœ‰finalçš„è¯­ä¹‰è¦æ±‚è¿˜æ˜¯è¦åŠ ä¸Šçš„ã€‚ åƒåœ¾æ”¶é›†ç°åœ¨ä¸»æµçš„å››ä¸ªæ”¶é›†å™¨åˆ†åˆ«æ˜¯ï¼šSerial æ”¶é›†å™¨ï¼ˆå¸¸ç”¨äºå•CPUç¯å¢ƒï¼‰ã€Throughputï¼ˆæˆ–è€…Parallelï¼‰æ”¶é›†å™¨ã€Concurrent æ”¶é›†å™¨ï¼ˆCMSï¼‰å’ŒG1æ”¶é›†å™¨ã€‚ åƒåœ¾æ”¶é›†çš„åŸºæœ¬æ“ä½œæ˜¯æ‰¾åˆ°ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå›æ”¶å®ƒä»¬ä½¿ç”¨çš„å†…å­˜ï¼Œå¯¹å †çš„å†…å­˜å¸ƒå±€è¿›è¡Œå‹ç¼©ã€‚å®Œæˆè¿™äº›æ“ä½œä¸åŒçš„æ”¶é›†å™¨é‡‡ç”¨äº†ä¸åŒçš„æ–¹æ³•ã€‚ PSï¼šä¸å†ä½¿ç”¨çš„å¯¹è±¡é€šè¿‡å¼•ç”¨è®¡æ•°æ¥ç¡®å®šä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå…³äºå¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼Œé€šè¿‡éå†GC Rootï¼ˆçº¿ç¨‹ï¼ŒClassloaderç­‰ï¼‰å¼•ç”¨çš„å¯¹è±¡æ¥ç¡®å®šä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚ å¦‚æœè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œ å¿…é¡»ç¡®ä¿çº¿ç¨‹ä¸å†ä½¿ç”¨è¿™äº›å¯¹è±¡ï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹éƒ½åœæ­¢è¿è¡Œæ‰€äº§ç”Ÿçš„åœé¡¿è¢«ç§°ä¸ºæ—¶ç©ºåœé¡¿ï¼ˆstop-the-worldï¼‰ã€‚é€šå¸¸è¿™äº›åœé¡¿å¯¹åº”ç”¨çš„æ€§èƒ½å½±å“æœ€å¤§ï¼Œè°ƒä¼˜åƒåœ¾æ”¶é›†æ—¶ï¼Œå°½é‡å‡å°‘è¿™ç§åœé¡¿æ˜¯æœ€ä¸ºå…³é”®çš„è€ƒé‡å› ç´ ã€‚ åˆ†ä»£åƒåœ¾æ”¶é›†å™¨åœ¨Javaä¸­ä½¿ç”¨ä¸´æ—¶å¯¹è±¡çš„æƒ…å†µéå¸¸å¤š ï¼Œå¯¹è±¡è¢«å¿«é€Ÿçš„åˆ›å»ºå’Œä¸¢å¼ƒã€‚æ‰€ä»¥åƒåœ¾æ”¶é›†å™¨è®¾è®¡æ—¶å°±ç‰¹åˆ«è€ƒè™‘åˆ°è¿™ç‚¹ã€‚æ–°ç”Ÿä»£ï¼ˆEdenã€Survivorï¼‰æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹è±¡é¦–å…ˆåœ¨æ–°ç”Ÿä»£ä¸­åˆ†é…ã€‚æ–°ç”Ÿä»£å¡«æ»¡æ—¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæš‚åœæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ï¼Œå›æ”¶æ–°ç”Ÿä»£ç©ºé—´ã€‚ä¸å†ä½¿ç”¨çš„å¯¹è±¡è¢«å›æ”¶ï¼Œä»ç„¶ä½¿ç”¨çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹ã€‚è¿™ç§æ“ä½œç§°ä¸ºMinor GCã€‚é‡‡ç”¨è¿™ç§è®¾è®¡æœ‰ä¸¤ä¸ªæ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚å…¶ä¸€ï¼Œç”±äºæ–°ç”Ÿä»£ä»…ä»…æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œä¸å¤„ç†æ•´ä¸ªå †ç›¸æ¯”ï¼Œå¤„ç†æ–°ç”Ÿä»£é€Ÿåº¦æ›´å¿«ã€‚æ„å‘³ç€åº”ç”¨çº¿ç¨‹åœé¡¿çš„æ—¶é—´ä¼šæ›´çŸ­ã€‚ä½†æ˜¯ä¹Ÿæ„å‘³ç€æ›´é¢‘ç¹çš„å‘ç”Ÿåœé¡¿ã€‚ç„¶åå°±ç›®å‰è€Œè¨€ï¼Œæ›´çŸ­çš„åœé¡¿æ˜¾ç„¶èƒ½å¸¦æ¥æ›´å¤šçš„ä¼˜åŠ¿ï¼Œå³ä½¿å‘ç”Ÿçš„é¢‘ç‡æ›´é«˜ã€‚ç¬¬äºŒä¸ªä¼˜åŠ¿æºäºæ–°ç”Ÿä»£ä¸­å¯¹è±¡çš„åˆ†é…æ–¹å¼ã€‚å¯¹è±¡åˆ†é…äºEdenç©ºé—´ã€‚åƒåœ¾æ”¶é›†æ—¶ï¼ŒEdenç©ºé—´ä¸­çš„å¯¹è±¡è¦ä¹ˆè¢«ç§»èµ°ï¼Œè¦ä¹ˆè¢«å›æ”¶ã€‚æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡è¦ä¹ˆè¢«ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªSurvivorç©ºé—´ï¼Œè¦ä¹ˆè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚ç›¸å½“äºæ–°ç”Ÿä»£ç©ºé—´åœ¨åƒåœ¾æ”¶é›†æ—¶è‡ªåŠ¨è¿›è¡Œäº†ä¸€æ¬¡å‹ç¼©æ•´ç†ã€‚æ‰€æœ‰åƒåœ¾æ”¶é›†ç®—æ³•åœ¨å¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾å›æ”¶æ—¶éƒ½å­˜åœ¨â€œstop-the-worldâ€ç°è±¡ã€‚å¯¹è±¡ä¸æ–­çš„å¾€è€å¹´ä»£ç§»åŠ¨ï¼Œè€å¹´ä»£æ—©æ™šä¹Ÿä¼šæ»¡ï¼ŒJVMéœ€è¦æ‰¾å‡ºè€å¹´ä»£ä¸­ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ï¼Œè¿™æ—¶åƒåœ¾æ”¶é›†å™¨çš„å·®åˆ«å°±ä½“ç°å‡ºæ¥äº†ã€‚ç®€å•çš„ç®—æ³•ç›´æ¥åœæ‰æ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ï¼Œæ‰¾å‡ºä¸å†ä½¿ç”¨çš„å¯¹è±¡å›æ”¶æ‰ã€‚æ¥ç€å¯¹å †ç©ºé—´è¿›è¡Œæ•´ç†ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºFull GCã€‚é€šå¸¸å¯¼è‡´åº”ç”¨çº¿ç¨‹é•¿æ—¶é—´åœé¡¿ã€‚å¦ä¸€æ–¹é¢ï¼ŒCMSå’ŒG1æ”¶é›†å™¨å¯ä»¥åœ¨åº”ç”¨çº¿ç¨‹è¿è¡Œçš„åŒæ—¶æ‰¾å‡ºä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚ç”±äºè¿™ç§ç‰¹æ€§ï¼Œè¿™ä¸¤ç§æ”¶é›†å™¨ä¹Ÿè¢«ç§°ä¸ºConcurrentæ”¶é›†å™¨ã€‚å°†åœé¡¿é™åˆ°äº†æœ€ä½ï¼Œä¹Ÿç§°ä¸ºä½åœé¡¿ï¼ˆLow-pauseï¼‰æ”¶é›†å™¨ã€‚ä½†æ˜¯å…¶ä»£ä»·æ˜¯å¸¦æ¥æ›´å¤šçš„CPUæ¶ˆè€—ã€‚å½“ç„¶è¿™ä¸¤ç§æ”¶é›†å™¨ä¹Ÿå¯èƒ½é­é‡é•¿æ—¶é—´çš„Full GCã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯é¿å…è¿™æ ·çš„åœé¡¿ã€‚ æ”¶é›†å™¨ å¼€å¯æ–¹å¼ æè¿° Serial Clientå‹è™šæ‹Ÿæœºé»˜è®¤å¼€å¯ æœ€ç®€å•çš„æ”¶é›†å™¨ï¼Œä½¿ç”¨å•çº¿ç¨‹ï¼Œæ— è®ºå“ªç§GCï¼Œæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹éƒ½ä¼šè¢«æš‚åœã€‚é€šè¿‡å¼€å¯å…¶ä»–æ”¶é›†å™¨æ¥å…³é—­ Throughput Serverå‹è™šæ‹Ÿæœºé»˜è®¤å¼€å¯ï¼ˆJDK7u4+ï¼‰ï¼Œæœ‰éœ€è¦å¯ä»¥é€šè¿‡-XX:+UseParallelGCã€-XX:+UseParallelOldGCå¯ç”¨ ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä¹Ÿè¢«ç§°ä¸ºParallel æ”¶é›†å™¨ã€‚æ— è®ºå“ªç§GCï¼Œæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹éƒ½ä¼šè¢«æš‚åœã€‚ CMS -XX:+UseConcMarkSweepGCã€-XX:+UseParNewGC Minor GCæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼ŒFull GCä¸æš‚åœï¼Œä½¿ç”¨åå°çº¿ç¨‹æ‰«æè€å¹´ä»£å›æ”¶åƒåœ¾å¯¹è±¡ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯CPUä½¿ç”¨ç‡æ›´é«˜ï¼Œå †æ›´åŠ ç¢ç‰‡åŒ–ï¼Œç­‰åˆ°æ²¡æœ‰è¿ç»­çš„ç©ºé—´åˆ†é…å¯¹è±¡æ—¶ï¼Œä¼šèœ•åŒ–æˆSerialæ”¶é›†å™¨çš„è¡Œä¸ºã€‚ G1 -XX:+UseG1GC æ”¶é›†çš„æ–¹å¼åŒCMSï¼ŒåŒºåˆ«æ˜¯è€å¹´ä»£è¢«åˆ’åˆ†ä¸åŒçš„åŒºåŸŸï¼Œé€šè¿‡åŒºåŸŸé—´çš„å¤åˆ¶ç§»åŠ¨å®Œæˆå¯¹è±¡æ¸…ç†å·¥ä½œã€‚æ„å‘³ç€å®ç°äº†å †çš„éƒ¨åˆ†å‹ç¼©æ•´ç†ï¼Œå‡å°‘ç¢ç‰‡åŒ–å‘ç”Ÿã€‚ æ”¶é›†å™¨æ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œå–å†³äºåº”ç”¨ç¨‹åºçš„ç‰¹å¾ï¼Œä»¥åŠåº”ç”¨çš„æ€§èƒ½ç›®æ ‡ã€‚ å¦‚æœåº”ç”¨ç¨‹åºæ‰€éœ€çš„CPUå¹¶ä¸å¤šï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„CPUèµ„æºï¼Œè€ƒè™‘Concurrentï¼ˆCMSã€G1ï¼‰æ”¶é›†å™¨æ€§èƒ½æ›´é«˜ã€‚å¦åˆ™åªä¼šå¢åŠ åº”ç”¨ç¨‹åºè´Ÿæ‹…ã€‚CMSå’ŒG1ï¼Œå½“å †è¾ƒå°æ—¶(4G&lt;)é€‰æ‹©CMSï¼Œå› ä¸ºCMSä¼šæ‰«ææ•´ä¸ªè€å¹´ä»£ï¼Œè€ŒG1æ˜¯å¤šçº¿ç¨‹åˆ†åŒºåŸŸæ‰«æã€‚ GCè°ƒä¼˜ è°ƒæ•´å †çš„å¤§å°é€‰æ‹©å †çš„å¤§å°æ˜¯ä¸€ç§å¹³è¡¡ï¼Œåˆ†é…çš„è¿‡å°ï¼Œç¨‹åºçš„å¤§éƒ¨åˆ†æ¶ˆè€—å¯èƒ½éƒ½åœ¨GCä¸Šã€‚å¦‚æœç²—æš´çš„è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å †ï¼Œå°†ä¼šå¢åŠ GCåœé¡¿çš„æ—¶é—´ï¼ŒGCçš„é¢‘ç‡è™½ç„¶ä¸‹é™äº†ï¼Œä½†æ˜¯æŒç»­é•¿æ—¶é—´çš„åœé¡¿ä¹Ÿä¼šè®©ç¨‹åºçš„æ•´ä½“æ€§èƒ½å˜æ…¢ã€‚å¦å¤–è¶…å¤§å †è¿˜æœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿä½¿ç”¨è™šæ‹Ÿå†…å­˜ã€‚å› æ­¤ï¼Œè°ƒæ•´å †ï¼ˆæœºå™¨ä¸Šæ‰€æœ‰å †ï¼‰å¤§å°æ—¶é¦–å…ˆçš„åŸåˆ™å°±æ˜¯ä¸è¶…è¿‡ç‰©ç†å†…å­˜å¤§å°ã€‚ é™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦è€ƒè™‘ä¸ºJVMè‡ªèº«å’Œå…¶å®ƒåº”ç”¨é¢„ç•™å†…å­˜ã€‚å †çš„å¤§å°ç”±ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼šåˆå§‹å€¼ï¼ˆ-Xms Nï¼‰å’Œæœ€å¤§å€¼ï¼ˆ-Xmx Nï¼‰ã€‚JVMä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨è°ƒæ•´å †å¤§å°ï¼Œç›´è‡³è¾¾åˆ°æœ€å¤§å€¼ã€‚å¦‚æœå°†åˆå§‹å€¼ä¸æœ€å¤§å€¼è®¾ç½®ä¸ºç›¸åŒï¼ŒJVMä¸å†éœ€è¦æ¨ç®—éœ€è¦çš„å †å¤§å°ï¼Œå¯ä»¥ç¨å¾®æé«˜GCçš„è¿è¡Œæ•ˆç‡ã€‚ ä»£ç©ºé—´çš„è°ƒæ•´ä¸€æ—¦å †çš„å¤§å°ç¡®å®šä¸‹æ¥ï¼Œå°±éœ€è¦å†³å®šæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°ã€‚æ–°ç”Ÿä»£è¿‡å¤§ï¼Œåƒåœ¾æ”¶é›†ï¼ˆMinor GCï¼‰çš„é¢‘ç‡å°±ä½ï¼Œè½¬ç§»åˆ°è€å¹´ä»£çš„å¯¹è±¡å°±å°‘ã€‚ä½†æ˜¯è€å¹´ä»£å°±å®¹æ˜“æ»¡ï¼Œä¸€æ—¦è€å¹´ä»£æ»¡äº†å°±è§¦å‘Full GCã€‚ï¼ˆFull GCä»£ä»·æ›´å¤§ï¼‰-XX:NewRatio=Nï¼ˆé»˜è®¤2ï¼‰è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´çš„å ç”¨çš„æ¯”ä¾‹ã€‚-XX:NewSize=Nè®¾ç½®æ–°ç”Ÿä»£åˆå§‹å¤§å°ã€‚-XX:MaxNewSize=Nè®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å¤§å°ã€‚-XmnN åŒæ—¶è®¾ç½®æ–°ç”Ÿä»£åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°ã€‚NewRatioè®¡ç®—ç©ºé—´çš„å…¬å¼ï¼š Initial young Gen Size = Initial Heap Size / (1+NewRatio)å¯ä»¥çœ‹å‡ºé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ç”Ÿä»£å çš„æ¯”ä¾‹ä¸º33%ã€‚ æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´ JVMè½½å…¥ç±»çš„æ—¶å€™ï¼Œä»–éœ€è¦è®°å½•è¿™äº›ç±»çš„å…ƒæ•°æ®ã€‚è¿™éƒ¨åˆ†æ•°æ®è¢«ä¿å­˜åœ¨ä¸€ä¸ªå•ç‹¬çš„å †ç©ºé—´é‡Œã€‚åœ¨Java 7 ä¸­ç§°ä¸ºæ°¸ä¹…ä»£ï¼ˆPermgenï¼‰ï¼Œåœ¨Java 8 ä¸­ç§°ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚è®¾ç½®æ°¸ä¹…ä»£å¤§å°ï¼š-XX:PermSize=Nã€-XX:MaxPermSize=Nè®¾ç½®å…ƒç©ºé—´å¤§å°ï¼ˆé»˜è®¤æ²¡æœ‰é™åˆ¶ï¼‰ï¼š-XX:MetaspaceSize=Nã€-XX:MaxMetaspaceSize=N åƒåœ¾å›æ”¶å·¥å…·è§‚å¯Ÿåƒåœ¾å›æ”¶å¯¹æ€§èƒ½çš„å½±å“æœ€å¥½çš„æ–¹æ³•å°±æ˜¯ç†Ÿæ‚‰GCæ—¥å¿—ã€‚å¼€å¯GCæ—¥å¿—çš„æ–¹æ³•æœ‰å¤šç§ï¼ŒåŒ…æ‹¬-verbose:gcæˆ–è€…-XX:+PrintGCï¼Œè¿™ä¸¤ä¸ªéƒ½èƒ½åˆ›å»ºåŸºæœ¬çš„GCæ—¥å¿—ã€‚ä½¿ç”¨-XX:+PrintGCDetailsä¼šåˆ›å»ºæ›´è¯¦ç»†çš„GCæ—¥å¿—ï¼ˆæ¨èï¼‰ã€‚åŒæ—¶è¿˜å¯ä»¥ä½¿ç”¨-XX:+PrintGCTimeStampsæˆ–è€…-XX:+PrintGCDateStampsæŸ¥çœ‹å‡ æ¬¡GCæ“ä½œä¹‹é—´çš„æ—¶é—´ï¼ˆæ¨èï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹GCæ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œä¸è¿‡ä½¿ç”¨-Xloggc:filename æ ‡å¿—å¯ä»¥ä¿®æ”¹è¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ã€‚å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨æ¥è¯´ï¼Œé€šè¿‡-XX:+UseGCLogfileRotationã€-XX:NumberOfGCLogfiles=Nã€-XX:GCLogfileSize=Næ ‡å¿—å¯ä»¥æ§åˆ¶æ—¥å¿—å¾ªç¯ã€‚é¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ã€‚å¯ä»¥é€šè¿‡GC Histogram åˆ†ææ—¥å¿—ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬çš„æ–¹å¼è·å–GCæ•°æ®ï¼Œjstatæ˜¯ç†æƒ³çš„å·¥å…·ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„ä¸€ä¸ªé€‰é¡¹æ˜¯-gcutilã€‚ä¾‹å¦‚ï¼š jstat -gcutil process_id 1000 å‘½ä»¤å°†1ç§’è¾“å‡ºä¸€æ¬¡GCæƒ…å†µã€‚è¾“å‡ºçš„ç»“æœå¤§è‡´å¦‚ä¸‹ï¼š S0ï¼ˆSurvivor0ï¼‰ã€S1(Survivor1)ã€E(Eden)ã€O(Old)ã€P(Permgen)å€¼ä¸ºå„åŒºåŸŸæ‰€åœ¨å¤§å°æ¯”ä¾‹ã€‚YGCã€YGCTä¸ºYoung GCçš„æ¬¡æ•°å’ŒGCçš„æ—¶é—´ã€‚FGCã€FGCTä¸ºFull GCçš„æ¬¡æ•°å’Œæ—¶é—´ã€‚GCTä¸ºæ€»GCæ—¶é—´ã€‚ S0ã€S1åˆè¢«ç§°ä¸º To / From Spaceã€‚GCæ—¶ï¼Œé’ˆå¯¹ä¸€äº›åˆšè¢«åˆ›å»ºçš„æ´»è·ƒå¯¹è±¡ï¼Œå¦‚æœç›´æ¥ç§»åŠ¨åˆ°è€å¹´ä»£ï¼Œä¼¼ä¹ä¸å¤ªåˆç†ï¼Œä¼šå¯¼è‡´è€å¹´ä»£æ›´å®¹æ˜“å……æ»¡ï¼Œä»è€Œå¼•å‘Full GCã€‚äºæ˜¯å°±æœ‰äº†S0ã€S1ç©ºé—´ã€‚å½“å¹´è½»ä»£å‘ç”ŸGCæ—¶ï¼ŒEdenä¸­çš„æ´»è·ƒå¯¹è±¡ä¼šè¢«è½¬ç§»åˆ°S0ï¼Œä¸‹æ¬¡GCæ–°çš„å­˜æ´»å¯¹è±¡åˆ™ä¼šå’ŒS0ä¸­çš„æ´»è·ƒå¯¹è±¡ä¸€èµ·è¢«è½¬ç§»åˆ°S1ã€‚å½“S0æˆ–è€…S1ç©ºé—´ä¸è¶³ï¼Œå¯¹è±¡åˆ™ä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ã€‚æˆ–è€…S0ï¼ŒS1ä¸­å¯¹è±¡è½¬ç§»æ¬¡æ•°è¾¾åˆ°äº†é˜€å€¼ï¼ˆ-XX:InitialTenuringThreshold=Nï¼‰ï¼Œä¹Ÿä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ã€‚ GCæ—¥å¿—æ ¼å¼ï¼š 1[GC (Allocation Failure) [PSYoungGen: 89580K-&gt;12786K(89600K)] 147723K-&gt;88825K(183296K), 0.1986863 secs] [Times: user=0.33 sys=0.05, real=0.20 secs] 1[Full GC (Ergonomics) [PSYoungGen: 12786K-&gt;0K(89600K)] [ParOldGen: 76039K-&gt;86431K(187904K)] 88825K-&gt;86431K(277504K), [Metaspace: 3611K-&gt;3611K(1056768K)], 1.0945902 secs] [Times: user=2.36 sys=0.06, real=1.10 secs] å¯ä»¥è§‚å¯Ÿåˆ°å„ä¸ªç©ºé—´å›æ”¶æƒ…å†µä»¥åŠç”¨æ—¶ã€‚ å­˜æ´»å¯¹è±¡è¶Šå¤šGCçš„æ•ˆç‡è¶Šå·®ï¼Œæ„å‘³ç€è¦æ…é‡çš„ä½¿ç”¨å¯¹è±¡é‡ç”¨ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚JDBCè¿æ¥æ± ï¼Œåˆ›å»ºè¿æ¥çš„æˆæœ¬éå¸¸é«˜ï¼Œä¸å¢åŠ çš„GCæ—¶é—´æƒè¡¡ï¼Œé‡ç”¨æ›´ä¸ºé«˜æ•ˆã€‚ çº¿ç¨‹ä¸åŒæ­¥æ€§èƒ½æ‰€æœ‰çº¿ç¨‹æ± çš„å·¥ä½œæ–¹å¼æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼š æœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä»»åŠ¡è¢«æäº¤åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ï¼ˆå¯ä»¥ä¸æ­¢ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¦‚å¿µæ˜¯ä¸€æ ·çš„ï¼‰ã€‚ä¸€å®šæ•°é‡çš„çº¿ç¨‹ä¼šä»è¯¥é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œã€‚ æ‰§è¡Œå®Œä»»åŠ¡åï¼Œçº¿ç¨‹è¿”å›é˜Ÿåˆ—æ£€ç´¢å¦å¤–ä¸€ä¸ªä»»åŠ¡ã€‚ è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°å¹¶ä¸æ˜¯çº¿ç¨‹æ•°è¶Šå¤šè¶Šå¥½ï¼Œæœ€å¤§çº¿ç¨‹æ•°è®¾ç½®æ²¡æœ‰ä»€ä¹ˆè¯€çªï¼Œåªèƒ½é€šè¿‡å……åˆ†çš„æµ‹è¯•å¾—å‡ºï¼ˆå¦‚æœä¸æ˜¯CPUå¯†é›†å‹åº”ç”¨ï¼Œè€Œç³»ç»Ÿå‡ºç°çš„è´Ÿè½½æ˜¯ç”±å¤–éƒ¨å¯¼è‡´ï¼Œä¾‹å¦‚å¢å¤šçš„è¯·æ±‚æ•°ï¼Œæ­¤æ—¶å¢åŠ çº¿ç¨‹æ•°ä¹Ÿè®¸æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ï¼‰ã€‚ è®¾ç½®æœ€å°çº¿ç¨‹æ•°éœ€è¦è¯„ä¼°çº¿ç¨‹æ± å¹³å‡çš„ä»»åŠ¡æ•°é‡ï¼Œå¦‚æœå¹³å‡ä»»åŠ¡æ•°é‡åªæœ‰20ï¼Œè€Œæœ€å°çº¿ç¨‹æ•°å´æœ‰2000ï¼Œé‚£ä¹ˆ1980ä¸ªçº¿ç¨‹å°±ä¼šç©ºé—²ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚ä¹Ÿä¸èƒ½éå¸¸æ­¦æ–­çš„å°†æœ€å°çº¿ç¨‹æ•°è®¾ç½®ä¸º1ï¼Œè¿™æ ·ä¼šå¯¼è‡´çº¿ç¨‹é¢‘ç¹åˆ›å»ºï¼Œå½±å“æ€§èƒ½ã€‚ çº¿ç¨‹æ± ä»»åŠ¡å¤§å°çº¿ç¨‹æ± ä»»åŠ¡é˜Ÿåˆ—å¤§å°è®¾ç½®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆè¯€çªï¼Œåªèƒ½é€šè¿‡æµ‹é‡çœŸå®åº”ç”¨æ¥å¾—å‡ºå¤§å°ã€‚å¦‚æœè®¾ç½®çš„ç‰¹åˆ«å¤§ï¼Œä¾‹å¦‚Integer.MAX_VALUEï¼Œå½“ä»»åŠ¡æ•°é‡å¾ˆå¤§ï¼Œçº¿ç¨‹åˆæ¥ä¸åŠå¤„ç†ï¼Œåˆ™æœ‰å¯èƒ½å¯¼è‡´èµ„æºè€—å°½ã€‚ 3ç§çº¿ç¨‹æ± é˜Ÿåˆ—Java ThreadPoolExecutorçš„è¡Œä¸ºæ ¹æ®é˜Ÿåˆ—æ‰€ä½¿ç”¨çš„ç±»å‹è¡¨ç°æœ‰æ‰€ä¸åŒã€‚ SynchronousQueue ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯è¿™ç§ç±»å‹çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± çš„è¡¨ç°å’Œé€šç”¨çš„çº¿ç¨‹æ± è¡¨ç°ä¸€è‡´ï¼šåˆå§‹åˆ›å»ºä¸€å®šçš„çº¿ç¨‹ï¼ˆæœ€å°å€¼ï¼‰ï¼Œå¦‚æœæ­¤æ—¶æ¥äº†ä¸€ä¸ªæ–°çš„ä»»åŠ¡ï¼Œè€Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¦‚æœåˆ›å»ºçš„çº¿ç¨‹å·²ç»è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™æ–°çš„ä»»åŠ¡å°±ä¼šè¢«æ‹’ç»ã€‚ LinkedBlockedingQueueï¼Œæ— ç•Œé˜Ÿåˆ—ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯è¿™ç§ç±»å‹çš„é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ± ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œå› ä¸ºä»»åŠ¡é˜Ÿåˆ—çš„å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œæœ€å¤šä»…ä¼šæŒ‰ç…§æœ€å°å€¼åˆ›å»ºçº¿ç¨‹ã€‚æœ€å¤§å€¼è¢«å¿½ç•¥ã€‚ ArrayBlockedingQueueï¼Œæœ‰ç•Œé˜Ÿåˆ—ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯è¿™ç§ç±»å‹çš„é˜Ÿåˆ—ï¼Œé»˜è®¤æŒ‰ç…§æœ€å°å€¼è®¾ç½®åˆ›å»ºçº¿ç¨‹ï¼Œå½“æ–°çš„ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œåˆ™æ–°çš„ä»»åŠ¡ä¼šåŠ å…¥é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼ˆå¤„ç†é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼‰ã€‚å¦‚æœçº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§å€¼ï¼Œåˆ™æ–°çš„ä»»åŠ¡ä¼šè¢«æ‹’ç»ã€‚ ForkJoinPoolForkJoinPoolæ˜¯ ExecutorServiceçš„ä¸€ä¸ªå®ç°ï¼Œä¸æ˜¯ä¸ºäº†æ›¿ä»£ThreadPoolExecutorï¼Œè€Œæ˜¯ä¸€ä¸ªè¡¥å……ï¼Œåœ¨æŸäº›åº”ç”¨åœºæ™¯ï¼ˆé€’å½’ã€åˆ†è€Œæ²»ä¹‹ï¼‰ä¸‹æ€§èƒ½æ›´å¥½ã€‚Javaæœ¬èº«ä¹Ÿæœ‰å¾ˆå¤šå®ç°ç”¨åˆ°äº†ForkJoinPoolï¼Œä¾‹å¦‚ï¼šCompletableFutureã€‚ åŒæ­¥çš„ä»£ä»· â€œåŒæ­¥â€è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œä»£ç ä¸­ä¸€æ®µä»£ç ä¸²è¡Œåœ°è®¿é—®ä¸€ç»„å˜é‡ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å†…å­˜ã€‚åŒ…æ‹¬ä½¿ç”¨synchronized å…³é”®å­—ï¼Œä¹ŸåŒ…æ‹¬java.util.concurrent.lock.Lockå®ä¾‹ä¿æŠ¤çš„ä»£ç ï¼Œå†å°±æ˜¯java.util.concurrentåŒ…åŠå­åŒ…ä¸­å†…çš„ä»£ç ã€‚ä¸¥æ ¼æ¥è®²ï¼Œjava.util.concurrent.atomicä¸‹çš„ç±»å¹¶æ²¡æœ‰ä½¿ç”¨åŒæ­¥ï¼Œå®ƒä»¬åˆ©ç”¨äº†â€œæ¯”è¾ƒä¸äº¤æ¢â€(Compare And Swapï¼ŒCAS)CPUæŒ‡ä»¤ã€‚åˆ©ç”¨CASçº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯å¼€å‘è€…çœ‹ä¸Šå»æœ€ç»ˆè¿˜æ˜¯åªèƒ½ä¸²è¡Œåœ°è®¿é—®è¢«ä¿æŠ¤è¢«ä¿æŠ¤å†…å­˜ã€‚1.åŒæ­¥ä¸å¯ä¼¸ç¼©æ€§ï¼Œå¦‚æœç¨‹åºä¸­æ›´å¤šçš„æ˜¯ä¸²è¡Œä»£ç ï¼Œé‚£ä¹ˆå¼•å…¥æ›´å¤šçš„çº¿ç¨‹å¹¶ä¸ä¼šå¸¦æ¥æ€§èƒ½æå‡ã€‚2.é”å¯¹è±¡çš„å¼€é”€ï¼Œé”çš„ç«äº‰è¶Šå¤§ï¼Œæ€§èƒ½æ¶ˆè€—è¶Šé«˜ï¼ˆå¯å‚è€ƒsynchronizedé”å‡çº§ï¼‰ï¼Œå½“æŸä¸ªé”æ²¡æœ‰ç«äº‰æ—¶ï¼Œè·å–é”çš„æˆæœ¬éå¸¸å°ã€‚åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼Œå“ªæ€•æ˜¯CASå¼€é”€ä¹Ÿä¼šå˜å¤§ã€‚ é¿å…åŒæ­¥èƒ½å¤Ÿé¿å…åŒæ­¥å°½é‡é¿å…ï¼Œä¾‹å¦‚æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯ä¸åŒçš„å®ä¾‹ï¼Œåœ¨å®ä¾‹ä¸­æœ‰ä¸€ä¸ªvolatileå˜é‡ï¼Œé¢‘ç¹çš„è¯»å†™è¿™ä¸ªå˜é‡ï¼Œ è¿™æ¯«æ— æ„ä¹‰ï¼Œå› ä¸ºæ­¤å˜é‡ä¸å­˜åœ¨ç«äº‰ã€‚å¦‚æœçš„ç¡®æ— æ³•é¿å…åŒæ­¥ï¼ŒåŒæ­¥æ–¹æ¡ˆåœ¨è€ƒè™‘æ—¶åº”è¯¥å¦‚ä¸‹è§„åˆ™ï¼šå¦‚æœè®¿é—®çš„æ˜¯ä¸å­˜åœ¨ç«äº‰çš„èµ„æºï¼Œé‚£ä¹ˆåŸºäºCASçš„ä¿æŠ¤è¦ç¨å¿«äºä¼ ç»Ÿçš„åŒæ­¥ï¼ˆå®Œå…¨ä¸ç”¨æ›´å¿«ï¼‰å¦‚æœæ˜¯è½»åº¦æˆ–è€…é€‚åº¦çš„ç«äº‰ï¼Œé‚£ä¹ˆåŸºäºCASçš„ä¿æŠ¤è¦å¿«äºä¼ ç»Ÿçš„åŒæ­¥ï¼ˆè€Œä¸”å¾€å¾€æ˜¯å¿«å¾—å¤šï¼‰å¦‚æœç«äº‰æ¿€çƒˆï¼Œä¼ ç»Ÿçš„åŒæ­¥ä¼šæ˜¯æ›´é«˜æ•ˆçš„é€‰æ‹©ã€‚ JVM çº¿ç¨‹è°ƒä¼˜æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªåŸç”Ÿæ ˆï¼Œä¸åŒçš„JVMç‰ˆæœ¬ï¼Œçº¿ç¨‹æ ˆé»˜è®¤çš„å¤§å°ä¸åŒï¼Œè®¾ç½®è¾ƒå°çš„æ ˆå¯ä»¥é˜²æ­¢è€—å°½åŸç”Ÿå†…å­˜ï¼Œç¡®å®šæ˜¯ï¼Œå¦‚æœè°ƒç”¨æ ˆç‰¹åˆ«å¤§ï¼Œä¼šæŠ›å‡ºStackOverflowErrorã€‚å¦‚æœè®¾ç½®è¾ƒå¤§çš„æ ˆï¼Œä½†æ˜¯åˆæ²¡æœ‰è¶³å¤Ÿçš„åŸç”Ÿå†…å­˜æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½ä¼šæŠ›å‡ºOutOfMemoryErrorã€‚æ”¹å˜çº¿ç¨‹æ ˆå¤§å°ï¼Œå¯ä»¥ä½¿ç”¨-XssNæ ‡å¿—ï¼ˆä¾‹å¦‚ -Xss256kï¼‰ã€‚ Java EEæ€§èƒ½è°ƒä¼˜Webå®¹å™¨çš„åŸºæœ¬æ€§èƒ½ä¸€äº›é€‚ç”¨äºæ‰€æœ‰æœåŠ¡å™¨çš„æ¦‚å¿µï¼š1.å‡å°‘è¾“å‡ºï¼Œå‡å°‘æœåŠ¡å™¨äº§ç”Ÿçš„ç»“æœè¾“å‡ºå¯ä»¥åŠ å¿«Webé¡µé¢è¿”å›åˆ°æµè§ˆå™¨çš„é€Ÿåº¦ã€‚2.å‡å°‘ç©ºæ ¼ï¼Œç©ºæ ¼åœ¨ä¼ è¾“æ—¶åŒæ ·éœ€è¦æ—¶é—´ï¼Œé¿å…åœ¨è¿”å›çš„ç»“æœä¸­å†™å…¥åˆ¶è¡¨ç¬¦å’Œç©ºæ ¼ã€‚3.åˆå¹¶é™æ€èµ„æºï¼ŒCSSå’ŒJavaScriptèµ„æºä¿å­˜åœ¨ç‹¬ç«‹çš„æ–‡ä»¶ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä¾¿äºç»´æŠ¤ã€‚ä½†æ˜¯ä¼ è¾“ä¸€ä¸ªå¤§æ–‡ä»¶çš„æ•ˆç‡è¦é«˜äºä¼ è¾“å‡ ä¸ªå°æ–‡ä»¶ã€‚","link":"/archives/863caf0d.html"},{"title":"ä¸ºä»€ä¹ˆè‹¹æœä¸è‡ªå·±åˆ¶é€ èŠ¯ç‰‡","text":"è‹¹æœè¿‘æœŸå‘å¸ƒäº†æœ€æ–°çš„å¤„ç†å™¨Apple A13 Bionicï¼Œç”±å°ç§¯ç”µä»£å·¥ã€‚ä¸ºä»€ä¹ˆè‹¹æœä¸è‡ªå·±åˆ¶é€ è®¾è®¡å‡ºæ¥çš„èŠ¯ç‰‡å‘¢ï¼Ÿ åŸæ¥ä¸šå†…ä¹ æƒ¯æŠŠåŠå¯¼ä½“è¡Œä¸šçš„å…¬å¸åˆ†ä¸ºä¸‰ç±»ï¼š fablessï¼ˆæ— æ™¶åœ†èŠ¯ç‰‡è®¾è®¡å‚ï¼‰ï¼šè¿™æ ·çš„å…¬å¸åªè®¾è®¡èŠ¯ç‰‡ï¼Œä¸è‡ªå·±åˆ¶é€ èŠ¯ç‰‡ã€‚æœ€å¤§çš„fablessä¼ä¸šæœ‰é«˜é€šã€åšé€šã€AMDã€è”å‘ç§‘ã€æ­ä¸Šäººå·¥æ™ºèƒ½è¿™æ³¢çƒ­ç‚¹æœ€è¿‘ç«çš„ä¸è¡Œçš„Nvidiaç­‰ç­‰ã€‚å›½å†…çš„fablessä¼ä¸šæœ‰æ”¶è´­äº†å±•è®¯å’Œé”è¿ªç§‘çš„æ¸…åç´«å…‰ã€åä¸ºæµ·æ€ç­‰ã€‚Foundryï¼ˆä»£å·¥å‚ï¼‰ï¼šè¿™æ ·çš„å…¬å¸ä¸“é—¨ä¸ºåˆ«äººåˆ¶é€ èŠ¯ç‰‡ã€‚æœ€å¤§çš„Foundryä¼ä¸šæœ‰å°ç§¯ç”µï¼ˆTSMCï¼‰ã€GlobalFoundryã€UMCç­‰ã€‚å›½å†…æœ€å¤§çš„æ˜¯ä¸­èŠ¯å›½é™…ã€‚éšç€å·¥è‰ºè¿›æ­¥åˆ°20nmä»¥ä¸‹ï¼Œä»å¹³é¢æ™¶ä½“ç®¡å‘ä¸‰ç»´FinFETæ¼”åŒ–ï¼Œæ–°ä¸€ä»£å·¥è‰ºæ‰€éœ€è¦çš„æŠ•èµ„è¶Šæ¥è¶Šå¤§ï¼Œå·²ç»åªæœ‰å°‘æ•°å‡ ä¸ªç©å®¶èƒ½ç©å¾—èµ·äº†ï¼ˆå°ç§¯ç”µã€ä¸‰æ˜Ÿã€Intelï¼‰ã€‚å›½å†…çš„ä¸­èŠ¯å›½é™…è·Ÿå°ç§¯ç”µæœ‰å‡ ä»£çš„å·®è·ã€‚ä¸­èŠ¯å›½é™…ç›®å‰å•†ç”¨çš„æœ€å…ˆè¿›å·¥è‰ºæ˜¯28nmï¼Œå°ç§¯ç”µ16nmå·²ç»å¤§è§„æ¨¡å•†ç”¨ï¼Œ7nmä¹Ÿé©¬ä¸Šå°±è¦ç”¨èµ·æ¥ã€‚IDMï¼ˆåˆ¶é€ å‚ç›´æ•´åˆï¼‰ï¼šè¿™æ ·çš„å…¬å¸æ—¢è®¾è®¡èŠ¯ç‰‡ï¼Œä¹Ÿè‡ªå·±åˆ¶é€ èŠ¯ç‰‡ã€‚æœ€å¤§çš„æœ‰Intelå’Œä¸‰æ˜Ÿã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåˆ†æ‹…é£é™©ï¼Œè‹¹æœä¸ç”¨èŠ±è´¹å·¨å¤§æŠ•èµ„å»ºç«‹ç”Ÿäº§çº¿ï¼Œå› æ­¤è½»èµ„äº§ï¼Œçµæ´»æ€§é«˜ï¼Œå¯ä»¥å¯¹å¸‚åœºå¿«é€Ÿååº”ï¼Œæ´»åŠ›è¶³ã€‚ å†è¯´å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸»æµçš„æ‰‹æœºå¤„ç†å™¨å‚å•†ä¸­å¾ˆå°‘è§åˆ°è‹±ç‰¹å°”å‘¢ï¼Ÿé¦–å…ˆæä¸€ä¸‹CPUçš„ç®€å•æ„æˆï¼šALUï¼ˆç®—æœ¯é€»è¾‘å•å…ƒï¼‰ã€æ§åˆ¶å•å…ƒã€å¯„å­˜å™¨æ§åˆ¶å•å…ƒé€šè¿‡æ—¶é’Ÿæ§åˆ¶ç€æŒ‡ä»¤æ‰§è¡Œçš„èŠ‚å¥ï¼Œå°†æŒ‡ä»¤åŠ è½½å­˜æ”¾åœ¨å¯„å­˜å™¨ã€å¹¶é€šè¿‡ALUè®¡ç®—ã€‚è¿™é‡Œæåˆ°äº†æŒ‡ä»¤ï¼ŒæŒ‡ä»¤åŸºæœ¬ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼šRISCï¼ˆç²¾ç®€æŒ‡ä»¤é›†ï¼‰ ã€CISC ï¼ˆå¤æ‚æŒ‡ä»¤é›†ï¼‰ï¼ŒæŒ‡ä»¤è¶Šå¤æ‚æ„å‘³ç€èƒ½è€—è¶Šé«˜ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨ç›®å‰æ‰‹æœºç”µæ± æŠ€æœ¯è¿˜æœªçªç ´çš„æƒ…å†µä¸‹ï¼Œæ‰‹æœºCPUä¼šä¸ŠCISCå—ï¼Ÿä¸Šé¢è¯´çš„ä¸¤ä¸ªæŒ‡ä»¤é›†çš„å…¸å‹ä»£è¡¨å°±æ˜¯ARMå’Œx86ï¼ŒARMæ˜¯ç›®å‰ä¸»æµçš„æ‰‹æœºCPUæ¶æ„ï¼Œä¹Ÿå°±æ˜¯ç²¾ç®€æŒ‡ä»¤ã€‚è€Œx86æ‰æ˜¯è‹±ç‰¹å°”ç­‰å‚å•†çš„å¼ºé¡¹ã€‚ä¹Ÿè®¸æ˜¯è‹±ç‰¹å°”å‡ºäºæˆ˜ç•¥è€ƒè™‘æ”¾å¼ƒäº†ç§»åŠ¨å¤„ç†å™¨è¿™å—è›‹ç³•ï¼Œæˆ–è€…è¯´è‹±ç‰¹å°”æ²¡æœ‰æ„æ–™åˆ°è¿™å—è›‹ç³•è¿™ä¹ˆå¤§ã€‚ä¸è¿‡ï¼Œç›®å‰AppèƒŒåå¯¹åº”çš„è¿˜æ˜¯å„ç§Serverï¼ŒServerç¦»ä¸å¼€x86ã€‚ å‚è€ƒèµ„æ–™ï¼šhttps://www.zhihu.com/question/68283951/answer/262481048https://www.zhihu.com/question/20148756","link":"/archives/52360944.html"},{"title":"ä»€ä¹ˆæ˜¯IRIWå’ŒMCAï¼ˆmulti-copy atomicityï¼‰","text":"æœ€è¿‘åˆåœ¨å·å…«è‚¡æ–‡ï¼Œç›´å‘¼å·ä¸åŠ¨äº†å•Šã€‚è¿™ä¸ªè¡Œä¸šå•¥æ—¶å€™æ‰èƒ½ä¸è¿™ä¹ˆå·ï¼Ÿï¼Ÿï¼Ÿ Java volatileè¯´èµ·å…«è‚¡æ–‡ï¼Œvolatileç»å¯¹æ˜¯ä¸ªè€å…«è‚¡ï¼Œéšä¾¿æ‹‰ä¸ªäººæ¥éƒ½èƒ½è¯´ä¸Šä¸¤å¥ï¼Œä»€ä¹ˆå†…å­˜å¯è§æ€§ã€å†…å­˜å±éšœã€æŒ‡ä»¤é‡æ’åºã€‚ã€‚ã€‚çœŸæä¸æ‡‚è°ƒåŒ…ä¾ æ•´è¿™äº›ç©æ„æœ‰å•¥ç”¨ã€‚ æ—¢ç„¶å·å°±å·åˆ°åº•ï¼Œçœ‹çœ‹è¿™ç©æ„åº•å±‚åˆ°åº•æ˜¯åœ¨å¹²å•¥ã€‚ å­—èŠ‚ç å±‚å…ˆå®šä¹‰ä¸€ä¸ªJavaç±» 123456789101112131415public class Test { //å®šä¹‰ä¸€ä¸ªvolatile å˜é‡ private volatile int i; //å†™volatitle å˜é‡ public void set(int i) { this.i = i; } //è¯»volatitle å˜é‡ public int get() { return this.i; }} é€šè¿‡javac Test.java ,javap -c -p -v Test.classï¼Œå¾—åˆ°å¯è¯»çš„å­—èŠ‚ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class com.zhaojingzhou.Test minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPERConstant pool: #1 = Methodref #4.#17 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Fieldref #3.#18 // com/zhaojingzhou/Test.i:I #3 = Class #19 // com/zhaojingzhou/Test #4 = Class #20 // java/lang/Object #5 = Utf8 i #6 = Utf8 I #7 = Utf8 &lt;init&gt; #8 = Utf8 ()V #9 = Utf8 Code #10 = Utf8 LineNumberTable #11 = Utf8 set #12 = Utf8 (I)V #13 = Utf8 get #14 = Utf8 ()I #15 = Utf8 SourceFile #16 = Utf8 Test.java #17 = NameAndType #7:#8 // &quot;&lt;init&gt;&quot;:()V #18 = NameAndType #5:#6 // i:I #19 = Utf8 com/internet/zhaojingzhou/Test #20 = Utf8 java/lang/Object{ private volatile int i; descriptor: I flags: ACC_PRIVATE, ACC_VOLATILE public com.zhaojingzhou.Test(); descriptor: ()V flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 9: 0 public void set(int); descriptor: (I)V flags: ACC_PUBLIC Code: stack=2, locals=2, args_size=2 0: aload_0 1: iload_1 2: putfield #2 // Field i:I 5: return LineNumberTable: line 14: 0 line 15: 5 public int get(); descriptor: ()I flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: getfield #2 // Field i:I 4: ireturn LineNumberTable: line 18: 0}SourceFile: &quot;Test.java&quot; å¯ä»¥çœ‹åˆ°volatileå…³é”®å­—ä¿®é¥°çš„å˜é‡å¤šäº†ä¸€ä¸ªflag :ACC_VOLATILE 123private volatile int i; descriptor: I flags: ACC_PRIVATE, ACC_VOLATILE å¦å¤–å¯ä»¥çœ‹åˆ°å¯¹äºå˜é‡çš„è¯»å†™æŒ‡ä»¤æ˜¯ï¼š 122: putfield #2 // Field i:I1: getfield #2 // Field i:I CPPå±‚æ ¹æ®æˆ‘ä¸‰è„šçŒ«çš„åŠŸå¤«ï¼Œåœ¨æºç ä¸­æ‰¾åˆ°äº†è¿™ä¸¤ä¸ªæŒ‡ä»¤ç›¸å…³çš„å†…å®¹ï¼Œä½äºsrc/hotspot/share/interpreter/zero/bytecodeInterpreter.cpp ï¼ˆè¿™é‡Œè¯´ä¸€ä¸‹ï¼Œæˆ‘çœ‹çš„æ˜¯jdk8çš„æºç ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152CASE(_getfield): CASE(_getstatic): { u2 index; ConstantPoolCacheEntry* cache; index = Bytes::get_native_u2(pc+1); // QQQ Need to make this as inlined as possible. Probably need to // split all the bytecode cases out so c++ compiler has a chance // for constant prop to fold everything possible away. cache = cp-&gt;entry_at(index); // è¿™é‡Œçœç•¥äº†ä¸€äº›ä»£ç  if (cache-&gt;is_volatile()) { if (support_IRIW_for_not_multiple_copy_atomic_cpu) { OrderAccess::fence(); } switch (tos_type) { case btos: case ztos: SET_STACK_INT(obj-&gt;byte_field_acquire(field_offset), -1); break; case ctos: SET_STACK_INT(obj-&gt;char_field_acquire(field_offset), -1); break; case stos: SET_STACK_INT(obj-&gt;short_field_acquire(field_offset), -1); break; case itos: SET_STACK_INT(obj-&gt;int_field_acquire(field_offset), -1); break; case ftos: SET_STACK_FLOAT(obj-&gt;float_field_acquire(field_offset), -1); break; case ltos: SET_STACK_LONG(obj-&gt;long_field_acquire(field_offset), 0); MORE_STACK(1); break; case dtos: SET_STACK_DOUBLE(obj-&gt;double_field_acquire(field_offset), 0); MORE_STACK(1); break; case atos: { oop val = obj-&gt;obj_field_acquire(field_offset); VERIFY_OOP(val); SET_STACK_OBJECT(val, -1); break; } default: ShouldNotReachHere(); } } å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰å‡ è¡Œè¿™æ ·çš„ä»£ç ï¼š 1234if (cache-&gt;is_volatile()) { if (support_IRIW_for_not_multiple_copy_atomic_cpu) { OrderAccess::fence(); } é¦–å…ˆis_volatileåˆ¤æ–­æ˜¯å¦volatileå˜é‡ï¼š 123//src/hotspot/share/runtime/fieldDescriptor.hpp bool is_volatile() const { return access_flags().is_volatile(); }//è¿™é‡Œçš„access_flagså¯¹åº”çš„å°±æ˜¯ä¸Šé¢å­—èŠ‚ç ä¸­ACC_å¼€å¤´çš„å“ªäº›flagã€‚ å¥½äº†ï¼Œæ€»ç®—çœ‹åˆ°å…«è‚¡æ–‡é‡Œé¢è¯´çš„å†…å­˜å±éšœäº†OrderAccess::fence()ã€‚ å’¦ï¼Œå’‹è‚¥äº‹ï¼Œå’‹å¤–é¢è¿˜å¥—äº†ä¸ªifã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½åŠ äº†å†…å­˜å±éšœã€‚é‚£support_IRIW_for_not_multiple_copy_atomic_cpu è¿™ä¸ªç©æ„åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿä»è¿™ä¸ªå˜é‡é‡Œä¼¼ä¹å¯ä»¥æ‹†é™¤ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯multiple_copy_atomicï¼Œå¦ä¸€ä¸ªæ˜¯IRIWã€‚å…³äºè¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œåœ¨ä¸­æ–‡èµ„æºé‡Œèƒ½æŸ¥æ‰¾åˆ°çš„ä¸œè¥¿éå¸¸å°‘ï¼Œç‰¹åˆ«æ˜¯IRIWã€‚ MCAæ¨¡å‹ï¼ˆmulti-copy atomicityï¼‰ä»ä¸ºæ•°ä¸å¤šçš„ä¸­æ–‡èµ„æºä¸­æ‰¾åˆ°å¦‚ä¸‹è¯´æ³•ï¼š é‚£æ€ä¹ˆæ ·æ‰ç§°ä¸ºmulti-copy atomicityå‘¢ï¼Ÿä¸æ­£å¼ä½†æ˜“äºç†è§£çš„è¯´æ³•æ˜¯ When a write is visible to one thread other than its originating thread, it is visible to all other threads. ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šä¸€ä¸ªå­˜å‚¨å™¨å†™è¦ä¹ˆä¸è¢«å…¶ä»–ç¡¬ä»¶çº¿ç¨‹çœ‹åˆ°ï¼Œè¦æ˜¯æœ‰ä¸€ä¸ªçœ‹åˆ°äº†ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå…¶ä»–ç¡¬ä»¶çº¿ç¨‹éƒ½çœ‹åˆ°äº†ã€‚ è¿™ä¸ªå®šä¹‰å…¶å®å’ŒARMæ–‡æ¡£é‡Œçš„multi-copy atomicityä¸ä¸€è‡´ï¼ŒARMæ–‡æ¡£é‡ŒMCAçš„å®šä¹‰è¦æ›´ä¸¥æ ¼ï¼šå‘å‡ºå­˜å‚¨å™¨å†™çš„ç¡¬ä»¶çº¿ç¨‹è‡ªå·±ä¹Ÿçœ‹ä¸åˆ°è¿™ä¸ªå†™ï¼Œé™¤éå…¶ä»–ç¡¬ä»¶çº¿ç¨‹ä¹Ÿçœ‹åˆ°äº†ã€‚è¿™å…¶å®åŒºåˆ«å°±åœ¨äºæ˜¯ä¸æ˜¯å…è®¸è‡ªå·±çš„å†™forwardç»™è‡ªå·±çš„è¯»ã€‚å¦‚æœå…è®¸ï¼Œå°±æ˜¯é€šå¸¸çš„MCAå®šä¹‰ï¼Œå¦åˆ™å°±æ˜¯ARMæ–‡æ¡£é‡Œçš„å®šä¹‰ã€‚ARMæ–‡æ¡£æŠŠè¿™ç§çº¦æŸä¸ç”šä¸¥æ ¼çš„MCAç§°ä¸ºâ€œother-multicopy-atomicâ€ã€‚è¿™ä¹Ÿæ˜¯å›°æ‰°äº†æˆ‘å¾ˆä¹…çš„ä¸€ä¸ªé—®é¢˜ã€‚ å¯¹äºä¸Šå›¾è¿™ä¸ªä¾‹å­ï¼ŒMCAæ¨¡å‹ä¸å¯èƒ½æœ€åThread1å’ŒThread3æœ€åè¯»åˆ°çš„yå’Œxéƒ½æ˜¯0çš„ï¼Œå› ä¸ºè¿™ä¸ªç»“æœè¡¨æ˜Thread1çœ‹åˆ°aè€Œæ²¡çœ‹åˆ°dï¼›ä½†Thread3çœ‹åˆ°dè€Œæ²¡çœ‹åˆ°aï¼Œè¿™æ˜¯ä¸ç¬¦åˆMCAçš„å®šä¹‰çš„ã€‚è€Œå¯¹äºNon-MCAï¼Œä¸Šå›¾çš„ç»“æœæ˜¯å¯èƒ½çš„ã€‚ å§æ§½ï¼Œä¸Šé¢è¯´çš„ä¸å°±æ˜¯å†…å­˜å¯è§æ€§çš„é—®é¢˜å—ï¼Ÿï¼Ÿï¼Ÿ IRIWé‚£å•¥åˆæ˜¯IRIWå‘¢ï¼Ÿâ€œç™¾åº¦â€å‡ºæ¥çš„ç»“æœå¦‚ä¸‹ï¼š TOP5ï¼Œå”¯ä¸€ä¸€ä¸ªçœ‹ç€é è°±ä¸€ç‚¹çš„ç»“æœï¼Œç‚¹è¿›å»ä¸€çœ‹ï¼š è¿™å•¥å‘€ã€‚ã€‚ã€‚ã€‚ ä½†æ˜¯ä¹Ÿä¸æ˜¯ä¸€ç‚¹æ²¡ç”¨ï¼Œè‡³å°‘çŸ¥é“äº†è¿™ä¸ªç¼©å†™ä»£è¡¨çš„æ˜¯Independent Reads, Independent Writes ä½†è¿™ç©æ„åˆ°åº•æ˜¯ä¸ªå•¥å‘¢ï¼Ÿæœ€åæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªè®ºæ–‡ï¼Œé‡Œé¢æœ‰ä¸€æ®µå†…å®¹ï¼š é‡Œé¢è¯´åˆ°äº†ä¸€ä¸ªIRIW exampleï¼š æœ‰4ä¸ªprocï¼Œ0ã€1ã€2ã€3ã€‚proc0å°†x=1ï¼Œproc1å°†y=1ï¼Œproc2è¯»åˆ°x=1ï¼Œy=0ï¼Œproc3è¯»åˆ°y=1ï¼Œx=0ã€‚ æˆ‘å¯»æ€ï¼ŒIRIWéš¾é“å°±æ˜¯MCAçš„åä¹‰ï¼Ÿ åé¢åˆä¸¾äº†ä¸€ä¸ªJMMçš„ä¾‹å­ï¼š è¯´çš„å¤§æ¦‚å°±æ˜¯HotSpotä¹‹å†…çš„ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ä»£ç ï¼Œå°†x=(r2==1)?y:1 ä¼˜åŒ–ä¸ºx=1ï¼Œå¹¶ä¼˜åŒ–äº†ä¸¤ä¸ªæŒ‡ä»¤çš„ä½ç½®ï¼Œx=1è·‘r2=yå‰é¢å»äº†ã€‚ IRIWåˆæœ‰ç‹¬ç«‹æŒ‡ä»¤é‡æ’çš„æ„æ€ï¼Ÿï¼Ÿ è¯´å®è¯çœ‹å®Œæˆ‘è¿˜æ˜¯è¿·ç³Šçš„ï¼Œä½†æ˜¯å›åˆ°å‰é¢çš„é‚£ä¸ªæ¡ä»¶ï¼šsupport_IRIW_for_not_multiple_copy_atomic_cpuï¼Œå¤§æ¦‚èƒ½æ˜ç™½æ„æ€äº†ï¼Œåº”è¯¥æ˜¯æŒ‡æ”¯æŒIRIWè€Œä¸æ˜¯MCAçš„CPUå°±ä½¿ç”¨fenceã€‚ OrderAccess/src/hotspot/share/runtime/orderAccess.hppä¸­å®šä¹‰äº†ä¸€äº›å†…å­˜å±éšœï¼Œå…·ä½“çš„å®ç°ï¼Œä¸åŒçš„æ¶æ„åˆä¸ä¸€æ ·ï¼Œlinux_x86å¦‚ä¸‹ 12345678910111213141516171819202122//src/hotspot/os_cpu/linux_x86/orderAccess_linux_x86.hppstatic inline void compiler_barrier() { __asm__ volatile (&quot;&quot; : : : &quot;memory&quot;);}inline void OrderAccess::loadload() { compiler_barrier(); }inline void OrderAccess::storestore() { compiler_barrier(); }inline void OrderAccess::loadstore() { compiler_barrier(); }inline void OrderAccess::storeload() { fence(); }inline void OrderAccess::acquire() { compiler_barrier(); }inline void OrderAccess::release() { compiler_barrier(); }inline void OrderAccess::fence() { // always use locked addl since mfence is sometimes expensive#ifdef AMD64 __asm__ volatile (&quot;lock; addl $0,0(%%rsp)&quot; : : : &quot;cc&quot;, &quot;memory&quot;);#else __asm__ volatile (&quot;lock; addl $0,0(%%esp)&quot; : : : &quot;cc&quot;, &quot;memory&quot;);#endif compiler_barrier();} å…¶ä¸­lock; addlæ˜¯å…³é”® ã€‚ lockå‰ç¼€æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¿¡å·ï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š å¯¹æ€»çº¿å’Œç¼“å­˜ä¸Šé”ã€‚å¼ºåˆ¶æ‰€æœ‰lockä¿¡å·ä¹‹å‰çš„æŒ‡ä»¤ï¼Œéƒ½åœ¨æ­¤ä¹‹å‰è¢«æ‰§è¡Œï¼Œå¹¶åŒæ­¥ç›¸å…³ç¼“å­˜ã€‚æ‰§è¡Œlockåçš„æŒ‡ä»¤ï¼ˆå¦‚cmpxchgï¼‰ã€‚é‡Šæ”¾å¯¹æ€»çº¿å’Œç¼“å­˜ä¸Šçš„é”ã€‚å¼ºåˆ¶æ‰€æœ‰lockä¿¡å·ä¹‹åçš„æŒ‡ä»¤ï¼Œéƒ½åœ¨æ­¤ä¹‹åè¢«æ‰§è¡Œï¼Œå¹¶åŒæ­¥ç›¸å…³ç¼“å­˜ã€‚å› æ­¤ï¼Œlockä¿¡å·è™½ç„¶ä¸æ˜¯å†…å­˜å±éšœï¼Œä½†å…·æœ‰mfenceçš„è¯­ä¹‰ï¼ˆå½“ç„¶ï¼Œè¿˜æœ‰æ’ä»–æ€§çš„è¯­ä¹‰ï¼‰ã€‚ ä¸å†…å­˜å±éšœç›¸æ¯”ï¼Œlockä¿¡å·è¦é¢å¤–å¯¹æ€»çº¿å’Œç¼“å­˜ä¸Šé”ï¼Œæˆæœ¬æ›´é«˜ è€Œè¿™é‡Œlock åè·Ÿçš„æ˜¯addlæŒ‡ä»¤ï¼Œå¯¹ä¸€ä¸ªå¯„å­˜å™¨ä¸­çš„å€¼åŠ äº†0ã€‚ç„¶è€Œé€šè¿‡lockä¿¡å·çš„ä½œç”¨ï¼Œå®ç°äº†å†…å­˜å±éšœçš„æ•ˆæœã€‚ å¼•ç”¨https://zhuanlan.zhihu.com/p/150879932 http://www0.cs.ucl.ac.uk/staff/j.alglave/papers/ec209.pdf https://www.cnblogs.com/sunddenly/articles/14829255.html æœ€åå·å¾—è„‘å£³ç–¼ã€‚ã€‚ã€‚","link":"/archives/9489a17b.html"},{"title":"å…³äºPaxosé‚£äº›ç‚¹","text":"ä¸–ç•Œä¸Šåªæœ‰ä¸€ç§å…±è¯†åè®®ï¼Œå°±æ˜¯ Paxosï¼Œå…¶ä»–æ‰€æœ‰å…±è¯†ç®—æ³•éƒ½æ˜¯ Paxos çš„é€€åŒ–ç‰ˆæœ¬ã€‚ Paxosåˆ†ä¸ºBasic Paxosã€Multi Paxosã€å’Œå…¶å®ƒæ¼”è¿›ç‰ˆæœ¬ã€‚ Basic Paxoså‰æï¼šBasic Paxos åªèƒ½å¯¹å•ä¸ªå€¼å½¢æˆå†³è®®ã€‚ Paxos ç®—æ³•å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºä¸‰ç±»ï¼š ææ¡ˆèŠ‚ç‚¹ï¼šç§°ä¸º Proposerï¼Œæå‡ºå¯¹æŸä¸ªå€¼è¿›è¡Œè®¾ç½®æ“ä½œçš„èŠ‚ç‚¹ï¼Œè®¾ç½®å€¼è¿™ä¸ªè¡Œä¸ºå°±è¢«ç§°ä¹‹ä¸ºææ¡ˆï¼ˆProposalï¼‰ï¼Œå€¼ä¸€æ—¦è®¾ç½®æˆåŠŸï¼Œå°±æ˜¯ä¸ä¼šä¸¢å¤±ä¹Ÿä¸å¯å˜çš„ã€‚è¯·æ³¨æ„ï¼ŒPaxos æ˜¯å…¸å‹çš„åŸºäºæ“ä½œè½¬ç§»æ¨¡å‹è€ŒéçŠ¶æ€è½¬ç§»æ¨¡å‹æ¥è®¾è®¡çš„ç®—æ³•ï¼Œè¿™é‡Œçš„â€œè®¾ç½®å€¼â€ä¸è¦ç±»æ¯”æˆç¨‹åºä¸­å˜é‡èµ‹å€¼æ“ä½œï¼Œåº”è¯¥ç±»æ¯”æˆæ—¥å¿—è®°å½•æ“ä½œï¼Œåœ¨åé¢ä»‹ç»çš„ Raft ç®—æ³•ä¸­å°±ç›´æ¥æŠŠâ€œææ¡ˆâ€å«ä½œâ€œæ—¥å¿—â€äº†ã€‚ å†³ç­–èŠ‚ç‚¹ï¼šç§°ä¸º Acceptorï¼Œæ˜¯åº”ç­”ææ¡ˆçš„èŠ‚ç‚¹ï¼Œå†³å®šè¯¥ææ¡ˆæ˜¯å¦å¯è¢«æŠ•ç¥¨ã€æ˜¯å¦å¯è¢«æ¥å—ã€‚ææ¡ˆä¸€æ—¦å¾—åˆ°è¿‡åŠæ•°å†³ç­–èŠ‚ç‚¹çš„æ¥å—ï¼Œå³ç§°è¯¥ææ¡ˆè¢«æ‰¹å‡†ï¼ˆAcceptï¼‰ï¼Œææ¡ˆè¢«æ‰¹å‡†å³æ„å‘³ç€è¯¥å€¼ä¸èƒ½å†è¢«æ›´æ”¹ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œä¸”æœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šæ¥å—è¯¥å®ƒã€‚ è®°å½•èŠ‚ç‚¹ï¼šè¢«ç§°ä¸º Learnerï¼Œä¸å‚ä¸ææ¡ˆï¼Œä¹Ÿä¸å‚ä¸å†³ç­–ï¼Œåªæ˜¯å•çº¯åœ°ä»ææ¡ˆã€å†³ç­–èŠ‚ç‚¹ä¸­å­¦ä¹ å·²ç»è¾¾æˆå…±è¯†çš„ææ¡ˆï¼Œè­¬å¦‚å°‘æ•°æ´¾èŠ‚ç‚¹ä»ç½‘ç»œåˆ†åŒºä¸­æ¢å¤æ—¶ï¼Œå°†ä¼šè¿›å…¥è¿™ç§çŠ¶æ€ã€‚ Paxos ç®—æ³•åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼Œå…¶ä¸­ï¼Œç¬¬ä¸€é˜¶æ®µâ€œå‡†å¤‡â€ï¼ˆPrepareï¼‰å°±ç›¸å½“äºä¸Šé¢æŠ¢å é”çš„è¿‡ç¨‹ï¼ˆä¸æ˜¯åŸºäºäº’æ–¥é‡ï¼‰ã€‚å¦‚æœæŸä¸ªææ¡ˆèŠ‚ç‚¹å‡†å¤‡å‘èµ·ææ¡ˆï¼Œå¿…é¡»å…ˆå‘æ‰€æœ‰çš„å†³ç­–èŠ‚ç‚¹å¹¿æ’­ä¸€ä¸ªè®¸å¯ç”³è¯·ï¼ˆç§°ä¸º Prepare è¯·æ±‚ï¼‰ã€‚ææ¡ˆèŠ‚ç‚¹çš„ Prepare è¯·æ±‚ä¸­ä¼šé™„å¸¦ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ•°å­— n ä½œä¸ºææ¡ˆ IDï¼Œå†³ç­–èŠ‚ç‚¹æ”¶åˆ°åï¼Œå°†ä¼šç»™äºˆææ¡ˆèŠ‚ç‚¹ä¸¤ä¸ªæ‰¿è¯ºä¸ä¸€ä¸ªåº”ç­”ã€‚ ä¸¤ä¸ªæ‰¿è¯ºæ˜¯æŒ‡ï¼š æ‰¿è¯ºä¸ä¼šå†æ¥å—ææ¡ˆ ID å°äºæˆ–ç­‰äº n çš„ Prepare è¯·æ±‚ã€‚ æ‰¿è¯ºä¸ä¼šå†æ¥å—ææ¡ˆ ID å°äº n çš„ Accept è¯·æ±‚ã€‚ ä¸€ä¸ªåº”ç­”æ˜¯æŒ‡ï¼š ä¸è¿èƒŒä»¥å‰ä½œå‡ºçš„æ‰¿è¯ºçš„å‰æä¸‹ï¼Œå›å¤å·²ç»æ‰¹å‡†è¿‡çš„ææ¡ˆä¸­ ID æœ€å¤§çš„é‚£ä¸ªææ¡ˆæ‰€è®¾å®šçš„å€¼å’Œææ¡ˆ IDï¼Œå¦‚æœè¯¥å€¼ä»æ¥æ²¡æœ‰è¢«ä»»ä½•ææ¡ˆè®¾å®šè¿‡ï¼Œåˆ™è¿”å›ç©ºå€¼ã€‚å¦‚æœè¿åæ­¤å‰åšå‡ºçš„æ‰¿è¯ºï¼Œå³æ”¶åˆ°çš„ææ¡ˆ ID å¹¶ä¸æ˜¯å†³ç­–èŠ‚ç‚¹æ”¶åˆ°è¿‡çš„æœ€å¤§çš„ï¼Œé‚£å…è®¸ç›´æ¥å¯¹æ­¤ Prepare è¯·æ±‚ä¸äºˆç†ä¼šã€‚ å½“ææ¡ˆèŠ‚ç‚¹æ”¶åˆ°äº†å¤šæ•°æ´¾å†³ç­–èŠ‚ç‚¹çš„åº”ç­”ï¼ˆç§°ä¸º Promise åº”ç­”ï¼‰åï¼Œå¯ä»¥å¼€å§‹ç¬¬äºŒé˜¶æ®µâ€œæ‰¹å‡†â€ï¼ˆAcceptï¼‰è¿‡ç¨‹ï¼Œè¿™æ—¶æœ‰å¦‚ä¸‹ä¸¤ç§å¯èƒ½çš„ç»“æœï¼š å¦‚æœææ¡ˆèŠ‚ç‚¹å‘ç°æ‰€æœ‰å“åº”çš„å†³ç­–èŠ‚ç‚¹æ­¤å‰éƒ½æ²¡æœ‰æ‰¹å‡†è¿‡è¯¥å€¼ï¼ˆå³ä¸ºç©ºï¼‰ï¼Œé‚£è¯´æ˜å®ƒæ˜¯ç¬¬ä¸€ä¸ªè®¾ç½®å€¼çš„èŠ‚ç‚¹ï¼Œå¯ä»¥éšæ„åœ°å†³å®šè¦è®¾å®šçš„å€¼ï¼Œå°†è‡ªå·±é€‰å®šçš„å€¼ä¸ææ¡ˆ IDï¼Œæ„æˆä¸€ä¸ªäºŒå…ƒç»„â€œ(id, value)â€ï¼Œå†æ¬¡å¹¿æ’­ç»™å…¨éƒ¨çš„å†³ç­–èŠ‚ç‚¹ï¼ˆç§°ä¸º Accept è¯·æ±‚ï¼‰ã€‚ å¦‚æœææ¡ˆèŠ‚ç‚¹å‘ç°å“åº”çš„å†³ç­–èŠ‚ç‚¹ä¸­ï¼Œå·²ç»æœ‰è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹çš„åº”ç­”ä¸­åŒ…å«æœ‰å€¼äº†ï¼Œé‚£å®ƒå°±ä¸èƒ½å¤Ÿéšæ„å–å€¼äº†ï¼Œå¿…é¡»æ— æ¡ä»¶åœ°ä»åº”ç­”ä¸­æ‰¾å‡ºææ¡ˆ ID æœ€å¤§çš„é‚£ä¸ªå€¼å¹¶æ¥å—ï¼Œæ„æˆä¸€ä¸ªäºŒå…ƒç»„â€œ(id, maxAcceptValue)â€ï¼Œå†æ¬¡å¹¿æ’­ç»™å…¨éƒ¨çš„å†³ç­–èŠ‚ç‚¹ï¼ˆç§°ä¸º Accept è¯·æ±‚ï¼‰ã€‚ å½“æ¯ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹æ”¶åˆ° Accept è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šåœ¨ä¸è¿èƒŒä»¥å‰ä½œå‡ºçš„æ‰¿è¯ºçš„å‰æä¸‹ï¼Œæ¥æ”¶å¹¶æŒä¹…åŒ–å¯¹å½“å‰ææ¡ˆ ID å’Œææ¡ˆé™„å¸¦çš„å€¼ã€‚å¦‚æœè¿åæ­¤å‰åšå‡ºçš„æ‰¿è¯ºï¼Œå³æ”¶åˆ°çš„ææ¡ˆ ID å¹¶ä¸æ˜¯å†³ç­–èŠ‚ç‚¹æ”¶åˆ°è¿‡çš„æœ€å¤§çš„ï¼Œé‚£å…è®¸ç›´æ¥å¯¹æ­¤ Accept è¯·æ±‚ä¸äºˆç†ä¼šã€‚ å…³äºæ´»é”ï¼š ä¸¤ä¸ªææ¡ˆèŠ‚ç‚¹äº’ä¸ç›¸è®©åœ°äº‰ç›¸æå‡ºè‡ªå·±çš„ææ¡ˆï¼ŒæŠ¢å åŒä¸€ä¸ªå€¼çš„ä¿®æ”¹æƒé™ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿåœ¨æŒç»­æ€§åœ°â€œåå¤æ¨ªè·³â€ï¼Œå¤–éƒ¨çœ‹èµ·æ¥å°±åƒè¢«é”ä½äº†ä¸€æ · Multi PaxosMulti Paxos å¯¹ Basic Paxos çš„æ ¸å¿ƒæ”¹è¿›æ˜¯å¢åŠ äº†â€œé€‰ä¸»â€çš„è¿‡ç¨‹ï¼Œææ¡ˆèŠ‚ç‚¹ä¼šé€šè¿‡å®šæ—¶è½®è¯¢ï¼ˆå¿ƒè·³ï¼‰ï¼Œç¡®å®šå½“å‰ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹é‡Œæ˜¯å¦å­˜åœ¨æœ‰ä¸€ä¸ªä¸»ææ¡ˆèŠ‚ç‚¹ï¼Œä¸€æ—¦æ²¡æœ‰å‘ç°ä¸»èŠ‚ç‚¹å­˜åœ¨ï¼ŒèŠ‚ç‚¹å°±ä¼šåœ¨å¿ƒè·³è¶…æ—¶åä½¿ç”¨ Basic Paxos ä¸­å®šä¹‰çš„å‡†å¤‡ã€æ‰¹å‡†çš„ä¸¤è½®ç½‘ç»œäº¤äº’è¿‡ç¨‹ï¼Œå‘æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å¹¿æ’­è‡ªå·±å¸Œæœ›ç«é€‰ä¸»èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œå¸Œæœ›æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹â€œç”±æˆ‘ä½œä¸ºä¸»èŠ‚ç‚¹â€è¿™ä»¶äº‹æƒ…åå•†è¾¾æˆä¸€è‡´å…±è¯†ï¼Œå¦‚æœå¾—åˆ°äº†å†³ç­–èŠ‚ç‚¹ä¸­å¤šæ•°æ´¾çš„æ‰¹å‡†ï¼Œä¾¿å®£å‘Šç«é€‰æˆåŠŸã€‚å½“é€‰ä¸»å®Œæˆä¹‹åï¼Œé™¤éä¸»èŠ‚ç‚¹å¤±è”ä¹‹åå‘èµ·é‡æ–°ç«é€‰ï¼Œå¦åˆ™ä»æ­¤å¾€åï¼Œå°±åªæœ‰ä¸»èŠ‚ç‚¹æœ¬èº«æ‰èƒ½å¤Ÿæå‡ºææ¡ˆã€‚æ­¤æ—¶ï¼Œæ— è®ºå“ªä¸ªææ¡ˆèŠ‚ç‚¹æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ“ä½œè¯·æ±‚ï¼Œéƒ½ä¼šå°†è¯·æ±‚è½¬å‘ç»™ä¸»èŠ‚ç‚¹æ¥å®Œæˆææ¡ˆï¼Œè€Œä¸»èŠ‚ç‚¹ææ¡ˆçš„æ—¶å€™ï¼Œä¹Ÿå°±æ— éœ€å†æ¬¡ç»è¿‡å‡†å¤‡è¿‡ç¨‹ï¼Œå› ä¸ºå¯ä»¥è§†ä½œæ˜¯ç»è¿‡é€‰ä¸¾æ—¶çš„é‚£ä¸€æ¬¡å‡†å¤‡ä¹‹åï¼Œåç»­çš„ææ¡ˆéƒ½æ˜¯å¯¹ç›¸åŒææ¡ˆ ID çš„ä¸€è¿ä¸²çš„æ‰¹å‡†è¿‡ç¨‹ã€‚ä¹Ÿå¯ä»¥é€šä¿—ç†è§£ä¸ºé€‰ä¸»è¿‡åï¼Œå°±ä¸ä¼šå†æœ‰å…¶ä»–èŠ‚ç‚¹ä¸å®ƒç«äº‰ï¼Œç›¸å½“äºæ˜¯å¤„äºæ— å¹¶å‘çš„ç¯å¢ƒå½“ä¸­è¿›è¡Œçš„æœ‰åºæ“ä½œï¼Œæ‰€ä»¥æ­¤æ—¶ç³»ç»Ÿä¸­è¦å¯¹æŸä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Œåªéœ€è¦è¿›è¡Œä¸€æ¬¡æ‰¹å‡†çš„äº¤äº’å³å¯ å¯èƒ½æœ‰äººæ³¨æ„åˆ°è¿™æ—¶å€™çš„äºŒå…ƒç»„(id, value)å·²ç»å˜æˆäº†ä¸‰å…ƒç»„(id, i, value)ï¼Œè¿™æ˜¯å› ä¸ºéœ€è¦ç»™ä¸»èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªâ€œä»»æœŸç¼–å·â€ï¼Œè¿™ä¸ªç¼–å·å¿…é¡»æ˜¯ä¸¥æ ¼å•è°ƒé€’å¢çš„ï¼Œä»¥åº”ä»˜ä¸»èŠ‚ç‚¹é™·å…¥ç½‘ç»œåˆ†åŒºåé‡æ–°æ¢å¤ï¼Œä½†å¦å¤–ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä»ç„¶æœ‰å¤šæ•°æ´¾ï¼Œä¸”å·²ç»å®Œæˆäº†é‡æ–°é€‰ä¸»çš„æƒ…å†µï¼Œæ­¤æ—¶å¿…é¡»ä»¥ä»»æœŸç¼–å·å¤§çš„ä¸»èŠ‚ç‚¹ä¸ºå‡†ã€‚å½“èŠ‚ç‚¹æœ‰äº†é€‰ä¸»æœºåˆ¶çš„æ”¯æŒï¼Œåœ¨æ•´ä½“æ¥çœ‹ï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–èŠ‚ç‚¹è§’è‰²ï¼Œä¸å»åŒºåˆ†ææ¡ˆã€å†³ç­–å’Œè®°å½•èŠ‚ç‚¹äº†ï¼Œç»Ÿç»Ÿä»¥â€œèŠ‚ç‚¹â€æ¥ä»£æ›¿ï¼ŒèŠ‚ç‚¹åªæœ‰ä¸»ï¼ˆLeaderï¼‰å’Œä»ï¼ˆFollowerï¼‰çš„åŒºåˆ« æ¥æºhttp://icyfenix.cn/distribution/consensus/paxos.html http://icyfenix.cn/distribution/consensus/raft.html https://acehi.github.io/thesecretlivesofdata-cn/raft/","link":"/archives/e00e37d3.html"},{"title":"å‘½ä»¤æ”¶è—","text":"macå…³é—­SPI(è·å–æ ¹ç›®å½•å†™æƒé™) é‡å¯ command+R è¿›å…¥æ¢å¤ç•Œé¢ å®ç”¨å·¥å…· - ç»ˆç«¯ è¾“å…¥ï¼šcsrutil disable é‡å¯ï¼šreboot æ‰“å¼€ç»ˆç«¯ï¼ŒæŒ‚è½½æ ¹ç›®å½•ï¼šsudo mount -uw / æŸ¥çœ‹ç«¯å£ 1lsof -i:9999 brewæ›´æ–°app1brew cu -a -f jdkä¿å­˜å †å¿«ç…§1jmap -dump:format=b,file=heapdump.hprof pid","link":"/archives/afa41a9c.html"},{"title":"å¸¸è§é›†ç¾¤æ–¹å¼","text":"ä¸»ä»ï¼ˆmaster-slaveï¼‰å†™masterï¼ŒåŒæ­¥åˆ°slave ã€‚slaveå¯ç”¨äºè¯»ã€‚å¸¸è§mysqlï¼Œredisã€‚ å“¨å…µåœ¨ä¸»ä»çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†masterå®•æœºæ—¶ï¼Œslaveè‡ªåŠ¨åˆ‡æ¢ä¸ºmasterã€‚ clusteré›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯åˆ†ç‰‡ã€‚é€šè¿‡åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®æ²Ÿé€šã€‚ ä¾‹å¦‚redisï¼Œé€šè¿‡Gossip åè®®ï¼Œåœ¨é›†ç¾¤å†…åŒæ­¥ï¼Œå„ä¸ªåˆ†ç‰‡çš„å“ˆå¸Œæ§½ä¿¡æ¯ã€‚ ä¾¿äºé‡å®šå‘è¯·æ±‚ã€‚","link":"/archives/6a6e8ff1.html"},{"title":"elasticsearch æç¤ºParse Failure [No mapping found for [filed] in order to sort on]] çš„è§£å†³åŠæ³•","text":"æ’åºä»£ç å¦‚ä¸‹ï¼š{ &quot;sort&quot;: [ { &quot;timestamp&quot;: { &quot;order&quot;: &quot;desc&quot; } } ] } ä¿®æ”¹åï¼š{ &quot;sort&quot;: [ { &quot;timestamp&quot;: { &quot;order&quot;: &quot;desc&quot;, &quot;ignore_unmapped&quot;: true } } ] }","link":"/archives/2a3d9fc7.html"},{"title":"flumeåŒæ—¶ä½¿ç”¨KafkaSourceã€KafkaSinkå¯¼è‡´çš„é—®é¢˜","text":"KafkaSource é…ç½®topicï¼štopic1KafkaSink é…ç½®topicï¼štopic2ä»topic1æ‹‰å–æ•°æ®ï¼Œç»è¿‡ç®€å•å¤„ç†åå‘åˆ°topic2ä½†æ˜¯ä½ ä¼šå‘ç°flumeä¸€ç›´åœ¨å¾ªç¯è¯»å†™topic1åŸå› å°±æ˜¯KafkaSinkä¸­çš„è¿™æ®µä»£ç ï¼š 123if (eventTopic == null) { eventTopic = topic;} é¦–å…ˆä»headersä¸­è·å–TOPIC_HEADER(topic),ç„¶åä¼˜å…ˆä½¿ç”¨ã€‚ç„¶è€Œåœ¨KafkaSourceä¸­åˆ™ä¼šå°†topic1 PUTåˆ°Headerä¸­ï¼Œæ‰€ä»¥å¯¼è‡´å¾ªç¯è¯»å†™topic1ã€‚ å¦‚ä½•è§£å†³å‘¢ï¼Ÿ ä½ å¯ä»¥é‡æ–°KafkaSinkï¼Œæ”¹æ‰ä¸Šé¢é‚£æ®µä»£ç ã€‚ æˆ–è€…é…ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå°†KafkaSource å†™åˆ°Headerä¸­çš„topicç»™æ›¿æ¢æ‰ï¼š 1234agent.sources.so1.interceptors.i1.type = staticagent.sources.so1.interceptors.i1.key = topicagent.sources.so1.interceptors.i1.preserveExisting = falseagent.sources.so1.interceptors.i1.value = topic2","link":"/archives/545f6758.html"},{"title":"kafkaé‚£äº›å‘","text":"åƒä¸‡åˆ«ç”¨é«˜ç‰ˆæœ¬çš„kafka client å»è¿ä½ç‰ˆæœ¬çš„kafka serverã€‚å¦åˆ™å›æŠ¥ä¸€ç³»åˆ—çš„(n)ioå¼‚å¸¸ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¼‚å¸¸ java.nio.BufferUnderflowException ä¸ä¸¢æ¶ˆæ¯ï¼šproduceræœ‰ä¸ªackå‚æ•°ï¼Œæœ‰ä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«ä»£è¡¨ï¼šä¸åœ¨ä¹æ˜¯å¦å†™å…¥æˆåŠŸã€å†™å…¥leaderæˆåŠŸã€å†™å…¥leaderå’Œæ‰€æœ‰reclpicaæˆåŠŸï¼›è¦æ±‚éå¸¸å¯é çš„è¯å¯ä»¥ç‰ºç‰²æ€§èƒ½è®¾ç½®æˆæœ€åä¸€ç§ã€‚ä¸é‡å¤å‘é€ï¼šæ­£å¸¸å‘éƒ½ä¸ä¼šé‡å¤ï¼Œåªå¯èƒ½ä¸¢ï¼Œçœ‹ä½ è¿™è¾¹æ€ä¹ˆå®¹é”™é‡å‘äº†ï¼Œå‚è€ƒä¸Šä¸€æ¡ã€‚æ¶ˆæ¯åªè¯»ä¸€æ¬¡ï¼šåŒæ ·ï¼Œæ­£å¸¸è¯»ä¸ä¼šé‡å¤ï¼Œå¦‚æœåœ¨ä¸Šä¸€æ¬¡è¯»çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæ¶ˆæ¯å¯èƒ½è¢«æ¶ˆè´¹ï¼Œä½†æ˜¯offsetæ²¡æœ‰åŠæ—¶commitï¼›è¿™æœ¬èº«æ˜¯ä¸¤æ­¥ï¼Œå­˜åœ¨ä¸­é—´crashçš„é£é™©","link":"/archives/eb616fac.html"},{"title":"mongodb å¤‡ä»½æ•°æ®","text":"å¤‡ä»½[éƒ¨åˆ†]æ•°æ®ä¸ºdumpï¼Œç„¶åä»collectionä¸­å°†å·²å¤‡ä»½æ•°æ®åˆ é™¤ã€‚ ./mongodump -d trans -c test -h 192.168.190.128 -u trans -p 123456 -o /data/backup -h:æŒ‡æ˜æ•°æ®åº“å®¿ä¸»æœºçš„IP -u:æŒ‡æ˜æ•°æ®åº“çš„ç”¨æˆ·å -p:æŒ‡æ˜æ•°æ®åº“çš„å¯†ç  -d:æŒ‡æ˜æ•°æ®åº“çš„åå­— -c:æŒ‡æ˜collectionçš„åå­— -o:æŒ‡æ˜åˆ°è¦å¯¼å‡ºçš„æ–‡ä»¶å -q:æŒ‡æ˜å¯¼å‡ºæ•°æ®çš„è¿‡æ»¤æ¡ä»¶ æ¢å¤å¤‡ä»½çš„æ•°æ®./bin/mongorestore -h host -d test --drop data/backup/test/ -h:æŒ‡æ˜æ•°æ®åº“å®¿ä¸»æœºçš„IP -u:æŒ‡æ˜æ•°æ®åº“çš„ç”¨æˆ·å -p:æŒ‡æ˜æ•°æ®åº“çš„å¯†ç  -d:æŒ‡æ˜æ•°æ®åº“çš„åå­— â€“drop ä¸ºå…ˆåˆ é™¤collectionä¸­çš„æ•°æ®å†æ¢å¤","link":"/archives/5c2c1bbd.html"},{"title":"mongodb13äº¿æ•°æ®æ¸…ç†è®°å½•","text":"mongodbä¸Šä¸€ä¸ªcollectionæ•°æ®å·²ç»è†¨èƒ€åˆ°13äº¿ï¼Œä¹Ÿå°±æœ€è¿‘ä¸€ä¸¤ä¸ªæœˆçš„æ•°æ®é‡è¦ä¸€ç‚¹ã€‚äºæ˜¯è€ƒè™‘æ¸…é™¤ä¸€ä¸‹è¿™ä¸ªcollectionã€‚äºæ˜¯ï¼šç¬¬ä¸€æ­¥ï¼šå…ˆå°†åŸè¡¨å¤‡ä»½ 1db.test.renameCollection(&quot;test_bak&quot;) ç„¶åæ ¹æ®æ—¶é—´åˆ é™¤æ•°æ® 1db.test_bak.remove({&quot;createtime&quot;:{&quot;$lte&quot;:ISODate(&quot;2019-06-09T00:00:00.000Z&quot;)}}) å°†ä¸¤ä¸ªæœˆå‰çš„æ•°æ®å…¨éƒ¨æ¸…æ‰ã€‚æ‰§è¡Œåˆ°è¿™ä¸€æ­¥å‘ç°ï¼Œç°å®å¾ˆæ®‹é…·ï¼ŒåŸºæœ¬ä¸Šå‘½ä»¤æ˜¯å¡æ­»çŠ¶æ€ã€‚æŸ¥çœ‹collectionä¸Šçš„ç´¢å¼•ï¼š 1db.test_bak.getIndexes() å‘ç°createtimeæ²¡æœ‰ç´¢å¼•ï¼Œäºæ˜¯ä¹åŠ ä¸Šï¼š 1db.test_bak.createIndex({&quot;createtime&quot;:-1}) åŠ ç´¢å¼•è¿™ä¸€æ­¥ä¹Ÿè¦æ‰§è¡Œå¾ˆä¹…ï¼Œæ…¢æ…¢ç­‰å§ã€‚ç­‰åˆ°ç´¢å¼•æ·»åŠ æˆåŠŸå†æ¬¡æ‰§è¡Œåˆ é™¤æ•°æ®çš„å‘½ä»¤å³å¯ï¼Œä¹Ÿå°†æ‰§è¡Œå¾ˆä¹…ã€‚é€šè¿‡ï¼š 1db.test_bak.count() æŸ¥çœ‹è¿˜å‰©å¤šå°‘æ•°æ®ã€‚ç”±äºtest_bakå·²ç»æ²¡æœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œè¿˜éœ€è¦å°†æœ€è¿‘ä¸¤ä¸ªæœˆçš„æ•°æ®åŒæ­¥åˆ°testä¸­ï¼Œäºæ˜¯ï¼š 123db.test_bak.find({&quot;createtime&quot;:{&quot;$gte&quot;:ISODate(&quot;2019-06-09T00:00:00.000Z&quot;)}}).forEach(function(x){ db.test.insert(x);}) ç­‰å¾…æ…¢æ…¢æ‰§è¡Œå§â€¦.. ä»¥ä¸Šä¸ºå®æ“åˆ†äº«ã€‚ æ‰€åœ¨åœ¨ä¸€å¼€å§‹å°±åº”è¯¥è®¾ç½®ï¼Œæ— ç”¨çš„æ•°æ®è‡ªåŠ¨æ¸…ç†æ‰ã€‚ä¹Ÿå°±æ²¡æœ‰åé¢å¤´ç–¼çš„é—®é¢˜äº†ã€‚","link":"/archives/7fbe8b08.html"},{"title":"å…³é—­ä»£ç å—ç§»åŠ¨","text":"Mac å¼€å¯äº†ä¸‰æŒ‡æ‹–æ‹½ï¼Œå‘ç°åœ¨IDEAçš„æŸäº›Projectä¸­ï¼Œé€‰ä¸­ä»£ç å—æ—¶ï¼Œè€æ˜¯æ‹–åŠ¨ä»£ç ã€‚è§£å†³åŠæ³•ï¼š 1Editor â€“&gt; General -&gt; Enable Dragâ€™nâ€™Drop functionality in Editor å…³é—­å³å¯ã€‚","link":"/archives/7f244d3f.html"},{"title":"åšå®¢ç”¨çš„å›¾åºŠæŒ‚äº†","text":"ä¹‹å‰ä¸æƒ³æŠŠåšå®¢é‡Œé¢çš„å›¾ç‰‡ä¹Ÿä¸€åŒä¸Šä¼ ï¼Œç”¨äº†utoolsé‡Œé¢ä¸€ä¸ªé»˜è®¤çš„å…è´¹å›¾åºŠï¼Œç»“æœä»Šå¤©å‘ç°å¥½åƒå›¾åºŠæŒ‚æ‰äº†ã€‚ä¹‹å‰å†™çš„åšå®¢é‡Œé¢çš„å›¾ç‰‡å…¨æŒ‚äº†ã€‚ã€‚ã€‚æœæ–­æ¢äº†giteeåšæ–°çš„å›¾åºŠã€‚ è¿™ä¸ä¼šå†æŒ‚äº†å§ã€‚ã€‚ã€‚","link":"/archives/2baffaa5.html"},{"title":"åŒäº‹é—®äº†æˆ‘ä¸€ä¸ªå…³äºRocketMQçš„é—®é¢˜","text":"åŒäº‹çªç„¶é—®æˆ‘ï¼šRocketMQçš„ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¤šæ¬¡æ¶ˆè´¹é‡è¯•ï¼Œæ¶ˆæ¯çš„msgIdä¼šä¸ä¼šå˜ï¼Ÿå“ªæ€•å·²ç»è¿›äº†DLQã€‚ åˆšå¼€å§‹å‡ºäºç»éªŒï¼Œæˆ‘è¯´ä¸ä¼šå˜ã€‚å› ä¸ºæˆ‘ä¹‹å‰æ¯æ¬¡æ’æŸ¥é—®é¢˜çš„æ—¶å€™ï¼Œç”¨åŒä¸€ä¸ªmsgIdéƒ½èƒ½æ‰¾åˆ°å¤šæ¬¡é‡è¯•æ¶ˆè´¹çš„æ—¥å¿—ã€‚åæ¥ä¸ºäº†æ›´åŠ ç¡®å®šï¼Œæˆ‘å·äº†ä¸€ä¸‹æºç ï¼Œæˆ‘çœ‹çš„æ˜¯4.6.1ï¼Œä¸€æ˜¯å› ä¸ºå…¬å¸ç”¨çš„è¿™ä¸ªç‰ˆæœ¬ï¼ŒäºŒæ˜¯æˆ‘ä¸Šæ¬¡å·çš„å°±æ˜¯è¿™ä¸ªç‰ˆæœ¬ã€‚ã€‚ã€‚ æ¶ˆæ¯é‡è¯•æ—¢ç„¶è·Ÿé‡è¯•æœ‰å…³ï¼Œé‚£å°±ä»å®¢æˆ·ç«¯æ¶ˆè´¹å¤±è´¥çš„é€»è¾‘å¼€å§‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°è››ä¸é©¬è¿¹ï¼Œä¸‹é¢æ˜¯æ¶ˆè´¹å¤±è´¥å°†æ¶ˆæ¯å‘å›brokerçš„ä»£ç ï¼š 123456789101112org.apache.rocketmq.client.impl.consumer.ConsumeMessageConcurrentlyServicecase CLUSTERING: List&lt;MessageExt&gt; msgBackFailed = new ArrayList&lt;MessageExt&gt;(consumeRequest.getMsgs().size()); //æ¶ˆè´¹å¤±è´¥ackIndex=-1 for (int i = ackIndex + 1; i &lt; consumeRequest.getMsgs().size(); i++) { MessageExt msg = consumeRequest.getMsgs().get(i); boolean result = this.sendMessageBack(msg, context); if (!result) { msg.setReconsumeTimes(msg.getReconsumeTimes() + 1); msgBackFailed.add(msg); } } ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹å¤±è´¥ä¼šè°ƒç”¨sendMessageBack: 12345678910111213141516org.apache.rocketmq.client.impl.consumer.ConsumeMessageConcurrentlyService#sendMessageBackorg.apache.rocketmq.client.impl.consumer.DefaultMQPushConsumerImpl#sendMessageBackorg.apache.rocketmq.client.impl.MQClientAPIImpl#consumerSendMessageBack ConsumerSendMsgBackRequestHeader requestHeader = new ConsumerSendMsgBackRequestHeader(); RemotingCommand request = RemotingCommand.createRequestCommand(RequestCode.CONSUMER_SEND_MSG_BACK, requestHeader); requestHeader.setGroup(consumerGroup); requestHeader.setOriginTopic(msg.getTopic()); requestHeader.setOffset(msg.getCommitLogOffset()); //è¿™ä¸ªæ˜¯å»¶è¿Ÿçº§åˆ«å¯¹åº”brokerçš„é‚£16ä¸ªtaskï¼Œæ˜¯å¯ä»¥é€šè¿‡ConsumeConcurrentlyContext è®¾ç½®çš„ï¼Œé»˜è®¤æ˜¯æŒ‰Brokerçš„ç­–ç•¥ requestHeader.setDelayLevel(delayLevel); requestHeader.setOriginMsgId(msg.getMsgId()); requestHeader.setMaxReconsumeTimes(maxConsumeRetryTimes); RemotingCommand response = this.remotingClient.invokeSync(MixAll.brokerVIPChannel(this.clientConfig.isVipChannelEnabled(), addr), request, timeoutMillis); å¯ä»¥çœ‹åˆ°ç»™Brokerå‘äº†ä¸€ä¸ªRequestCode.CONSUMER_SEND_MSG_BACKï¼Œç„¶åé™„å¸¦äº†ä¸€äº›offsetï¼ŒoriginMsgIdç­‰ä¿¡æ¯ï¼Œå¼€å§‹æˆ‘ä»¥ä¸ºè·Ÿè¿™ä¸ªoriginMsgIdæœ‰å…³ï¼Œå› ä¸ºä»–è¿™é‡ŒæŠŠåŸå§‹çš„msgIdå‘å›å»äº†å‘€ï¼Œæ‰€ä»¥msgIdå°±ä¸ä¼šå˜ï¼Œç„¶è€Œäº‹å®ä¸æ˜¯è¿™æ ·çš„ã€‚ç»§ç»­çœ‹åˆ°brokerå¤„ç†éƒ¨åˆ†ï¼š 1234567891011// org.apache.rocketmq.broker.processor.SendMessageProcessor#asyncConsumerSendMsgBack String newTopic = MixAll.getRetryTopic(requestHeader.getGroup()); MessageExt msgExt = this.brokerController.getMessageStore().lookMessageByOffset(requestHeader.getOffset()); MessageExtBrokerInner msgInner = new MessageExtBrokerInner(); msgInner.setTopic(newTopic); String originMsgId = MessageAccessor.getOriginMessageId(msgExt); MessageAccessor.setOriginMessageId(msgInner, UtilAll.isBlank(originMsgId) ? msgExt.getMsgId() : originMsgId); CompletableFuture&lt;PutMessageResult&gt; putMessageResult = this.brokerController.getMessageStore().asyncPutMessage(msgInner); ç”±äºä»£ç å¤ªé•¿ï¼Œçœç•¥äº†ä¸€äº›ã€‚å¯ä»¥çœ‹åˆ°ä¸Šé¢è¯´çš„requestä¸­çš„originMsgIdå¹¶æ²¡æœ‰ç”¨ï¼Œè€Œæ˜¯é€šè¿‡offsetç›´æ¥å®šä½åˆ°æ¶ˆæ¯ç›´æ¥æ‹¿çš„msgIdï¼ˆå¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡é‚£ä¹ˆæ˜¯ä»Propertiesä¸­å–çš„PROPERTY_ORIGIN_MESSAGE_IDï¼‰ã€‚ä½†æ˜¯è¿™ä¸ªè·ŸmsgIdä¹Ÿæ²¡æœ‰å…³ç³»å‘€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘çŒœæµ‹ï¼Œæ˜¯ä¸æ˜¯åœ¨æäº¤åˆ°commitlogçš„æ—¶å€™å°†msgIdé‡ç½®ä¸ºäº†originMsgIdï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼š 12345678910111213141516171819//org.apache.rocketmq.store.CommitLog#putMessage if (msg.getDelayTimeLevel() &gt; 0) { if (msg.getDelayTimeLevel() &gt; this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()) { msg.setDelayTimeLevel(this.defaultMessageStore.getScheduleMessageService().getMaxDelayLevel()); } topic = ScheduleMessageService.SCHEDULE_TOPIC; queueId = ScheduleMessageService.delayLevel2QueueId(msg.getDelayTimeLevel()); // Backup real topic, queueId MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_TOPIC, msg.getTopic()); MessageAccessor.putProperty(msg, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msg.getQueueId())); msg.setPropertiesString(MessageDecoder.messageProperties2String(msg.getProperties())); msg.setTopic(topic); msg.setQueueId(queueId);.... result = mappedFile.appendMessage(msg, this.appendMessageCallback); ç”±äºé‡è¯•éœ€è¦å»¶è¿Ÿå¤„ç†ï¼Œæ‰€ä»¥æ¶ˆæ¯åˆè¢«æŠ•é€’åˆ°äº†SCHEDULE_TOPICï¼ˆSCHEDULE_TOPIC_XXXXï¼‰ï¼Œç»§ç»­çœ‹å†™å…¥commitlogéƒ¨åˆ†ï¼š 1234567//org.apache.rocketmq.store.CommitLog.DefaultAppendMessageCallback#doAppend(long, java.nio.ByteBuffer, int, org.apache.rocketmq.store.MessageExtBrokerInner) String msgId; if ((sysflag &amp; MessageSysFlag.STOREHOSTADDRESS_V6_FLAG) == 0) { msgId = MessageDecoder.createMessageId(this.msgIdMemory, msgInner.getStoreHostBytes(storeHostHolder), wroteOffset); } else { msgId = MessageDecoder.createMessageId(this.msgIdV6Memory, msgInner.getStoreHostBytes(storeHostHolder), wroteOffset); } ç„¶è€Œåˆä¸€æ¬¡é”™äº†ï¼ŒmsgIdå¹¶æ²¡æœ‰è¢«é‡ç½®ä¸ºoriginMsgIdï¼Œè€Œæ˜¯é€šè¿‡hostå’Œå†™å…¥çš„offsetç®—å‡ºæ¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€æ¬¡é‡è¯•ï¼Œé‡æ–°å†™å…¥commitlogï¼ŒmsgIdéƒ½ä¼šå˜ã€‚ã€‚ã€‚è¿™ä¸‹æˆ‘é¢“äº†ï¼Œéš¾é“æˆ‘è·ŸåŒäº‹è¯´é”™äº†ï¼Ÿå¯æ˜¯æˆ‘ä»¥å‰æ’æŸ¥é—®é¢˜çš„æ—¶å€™ï¼Œæ˜æ˜æ¯æ¬¡éƒ½æ˜¯ä¸€æ ·çš„å•Šï¼Ÿ å†æ¬¡æ¶ˆè´¹ä¸è¡Œï¼Œè¿˜å¾—ç»§ç»­å·ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘åœ¨æƒ³ï¼Œéš¾ä¸æˆæ˜¯åœ¨é‡æ–°æ¶ˆè´¹çš„æ—¶å€™åšäº†å•¥å¤„ç†ï¼Ÿæ¥çœ‹çœ‹æ¶ˆè´¹è€…çš„ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//org.apache.rocketmq.client.consumer.PullCallback#onSuccess//org.apache.rocketmq.client.impl.consumer.PullAPIWrapper#processPullResultpublic PullResult processPullResult(final MessageQueue mq, final PullResult pullResult, final SubscriptionData subscriptionData) { PullResultExt pullResultExt = (PullResultExt) pullResult; this.updatePullFromWhichNode(mq, pullResultExt.getSuggestWhichBrokerId()); if (PullStatus.FOUND == pullResult.getPullStatus()) { ByteBuffer byteBuffer = ByteBuffer.wrap(pullResultExt.getMessageBinary()); List&lt;MessageExt&gt; msgList = MessageDecoder.decodes(byteBuffer); List&lt;MessageExt&gt; msgListFilterAgain = msgList; if (!subscriptionData.getTagsSet().isEmpty() &amp;&amp; !subscriptionData.isClassFilterMode()) { msgListFilterAgain = new ArrayList&lt;MessageExt&gt;(msgList.size()); for (MessageExt msg : msgList) { if (msg.getTags() != null) { if (subscriptionData.getTagsSet().contains(msg.getTags())) { msgListFilterAgain.add(msg); } } } } if (this.hasHook()) { FilterMessageContext filterMessageContext = new FilterMessageContext(); filterMessageContext.setUnitMode(unitMode); filterMessageContext.setMsgList(msgListFilterAgain); this.executeHook(filterMessageContext); } for (MessageExt msg : msgListFilterAgain) { String traFlag = msg.getProperty(MessageConst.PROPERTY_TRANSACTION_PREPARED); if (Boolean.parseBoolean(traFlag)) { msg.setTransactionId(msg.getProperty(MessageConst.PROPERTY_UNIQ_CLIENT_MESSAGE_ID_KEYIDX)); } MessageAccessor.putProperty(msg, MessageConst.PROPERTY_MIN_OFFSET, Long.toString(pullResult.getMinOffset())); MessageAccessor.putProperty(msg, MessageConst.PROPERTY_MAX_OFFSET, Long.toString(pullResult.getMaxOffset())); msg.setBrokerName(mq.getBrokerName()); } pullResultExt.setMsgFoundList(msgListFilterAgain); } pullResultExt.setMessageBinary(null); return pullResult; } å¼€å§‹çœ‹åˆ°msg.setTransactionIdè¿™ä¸ªï¼Œè¿˜å¼€å¿ƒäº†ä¸€ä¸‹ï¼Œæƒ³ç€æ‰¾æ‰¾setMsgIdï¼Œç»“æœè¿˜æ˜¯æ²¡æœ‰ã€‚éš¾ä¸æˆåœ¨æ¶ˆè´¹æœåŠ¡ä¸­å¤„ç†çš„ï¼Ÿå¼€å§‹ç»§ç»­çœ‹ï¼š 1234567891011121314org.apache.rocketmq.client.impl.consumer.ConsumeMessageConcurrentlyService.ConsumeRequest#run @Override public void run() { if (this.processQueue.isDropped()) { log.info(&quot;the message queue not be able to consume, because it's dropped. group={} {}&quot;, ConsumeMessageConcurrentlyService.this.consumerGroup, this.messageQueue); return; } MessageListenerConcurrently listener = ConsumeMessageConcurrentlyService.this.messageListener; ConsumeConcurrentlyContext context = new ConsumeConcurrentlyContext(messageQueue); ConsumeConcurrentlyStatus status = null; defaultMQPushConsumerImpl.resetRetryAndNamespace(msgs, defaultMQPushConsumer.getConsumerGroup()); çœ‹åˆ°è¿™ä¸ªdefaultMQPushConsumerImpl.resetRetryAndNamespaceï¼Œæˆ‘æ¿€åŠ¨åäº†ï¼Œæ‰“å¼€ä¸€çœ‹ï¼š 1234567891011final String groupTopic = MixAll.getRetryTopic(consumerGroup); for (MessageExt msg : msgs) { String retryTopic = msg.getProperty(MessageConst.PROPERTY_RETRY_TOPIC); if (retryTopic != null &amp;&amp; groupTopic.equals(msg.getTopic())) { msg.setTopic(retryTopic); } if (StringUtils.isNotEmpty(this.defaultMQPushConsumer.getNamespace())) { msg.setTopic(NamespaceUtil.withoutNamespace(msg.getTopic(), this.defaultMQPushConsumer.getNamespace())); } } è¿™å•¥å‘€è¿™æ˜¯ï¼Œä¹Ÿä¸å¯¹ã€‚åæ¥ç›´åˆ°æˆ‘è¿›å…¥äº†MessageExt, ideaæ˜¾ç¤ºäº†è¿™ä¹ˆä¸€ä¸ªå›¾æ ‡ï¼šæˆ‘æ„è¯†åˆ°äº‹æƒ…ä¸å¯¹åŠ²ï¼Œæˆ‘å¯èƒ½åšäº†å¾ˆå¤šæ— ç”¨åŠŸï¼Œå¿˜è®°äº† Javaé¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€çš„ç»§æ‰¿:ç­”æ¡ˆå°±è—åœ¨MessageClientExtä¸­: 12345678910111213141516171819202122232425public class MessageClientExt extends MessageExt { public String getOffsetMsgId() { return super.getMsgId(); } public void setOffsetMsgId(String offsetMsgId) { super.setMsgId(offsetMsgId); } @Override public String getMsgId() { String uniqID = MessageClientIDSetter.getUniqID(this); if (uniqID == null) { return this.getOffsetMsgId(); } else { return uniqID; } } public void setMsgId(String msgId) { //DO NOTHING //MessageClientIDSetter.setUniqID(this); }} WTFï¼Œæˆ‘ä¸€ç›´ç›¯ç€setMsgIdï¼Œä»¥ä¸ºæ˜¯å“ªä¸ªåœ°æ–¹æŠŠmsgIdé‡ç½®äº†ï¼Œæ²¡æƒ³åˆ°ï¼Œä»–å¨˜çš„æ˜¯getMsgIdæ–¹æ³•è¢«é‡å†™äº†ã€‚ ä»è¿™é‡Œå¯ä»¥å¾—çŸ¥ä¸¤ä¸ªä¸œè¥¿ï¼š OffsetMsgIdï¼šå¯¹åº”commitLog offsetçš„ï¼Œæ¯æ¬¡éƒ½ä¼šå˜çš„ç‰©ç†msgId uniqIDï¼šå¯¹åº”Propertyä¸­çš„UNIQ_KEYï¼Œçœ‹æ¥ä¸å˜çš„æ˜¯è¿™ä¸ªã€‚ é‚£UNIQ_KEYåˆ°åº•æ˜¯å•¥ï¼š 123456789101112131415161718192021222324252627282930313233static { byte[] ip; try { ip = UtilAll.getIP(); } catch (Exception e) { ip = createFakeIP(); } LEN = ip.length + 2 + 4 + 4 + 2; ByteBuffer tempBuffer = ByteBuffer.allocate(ip.length + 2 + 4); tempBuffer.put(ip); tempBuffer.putShort((short) UtilAll.getPid()); tempBuffer.putInt(MessageClientIDSetter.class.getClassLoader().hashCode()); FIX_STRING = UtilAll.bytes2string(tempBuffer.array()); setStartTime(System.currentTimeMillis()); COUNTER = new AtomicInteger(0); } public static String createUniqID() { StringBuilder sb = new StringBuilder(LEN * 2); sb.append(FIX_STRING); sb.append(UtilAll.bytes2string(createUniqIDBuffer())); return sb.toString(); } private static byte[] createUniqIDBuffer() { ByteBuffer buffer = ByteBuffer.allocate(4 + 2); long current = System.currentTimeMillis(); if (current &gt;= nextStartTime) { setStartTime(current); } buffer.putInt((int) (System.currentTimeMillis() - startTime)); buffer.putShort((short) COUNTER.getAndIncrement()); return buffer.array(); } UNIQ_KEYæ˜¯åœ¨ç¬¬ä¸€æ¬¡å‘é€åˆ°Brokeræ—¶ï¼Œé€šè¿‡ipã€pidã€hashcodeã€æ—¶é—´å·®ã€è‡ªå¢åºå·ç»„æˆçš„ã€‚ æ€»ç»“æ¶ˆæ¯æœ¬èº«çš„idæ˜¯ä¸æ¶ˆæ¯offsetç›¸å…³çš„ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ä¸åŒçš„ï¼Œè€Œæˆ‘ä»¬å¸¸åœ¨clientä½¿ç”¨çš„msgIdæ˜¯åœ¨clientç”Ÿäº§æ¶ˆæ¯æ—¶èµ‹äºˆçš„å…·æœ‰é€»è¾‘å”¯ä¸€æ€§çš„idï¼ˆä¸è®ºæŠ•é€’å¤šå°‘æ¬¡ï¼‰ã€‚ æœ€åé™·å…¥å›°å¢ƒçš„æ—¶å€™ï¼Œä¸å¦¨å»çªä¸ªliaoã€‚ğŸ˜Š","link":"/archives/92571797.html"},{"title":"linux å¤§æ–‡ä»¶æ— æ³•æ¸…ç©º","text":"linux æ¸…ç©ºä¸€ä¸ªå¤§æ–‡ä»¶ï¼ˆä¸ŠGçš„ï¼‰ä¸€èˆ¬æœ‰è¿™ä¹ˆå‡ ç§æ–¹æ³•ï¼š cat /dev/null &gt; nohup.log cp /dev/null &gt; nohup.log echo â€œâ€ &gt; nohup.log ä½†æ˜¯ä»Šå¤©åœ¨å°è¯•è¿™å‡ ä¸ªå‘½ä»¤çš„æ—¶å€™å‘ç°å§‹ç»ˆæ— æ³•æ¸…ç©ºã€‚ æœ€ç»ˆå‘ç°é—®é¢˜åœ¨nohup.logçš„ç”Ÿæˆå‘½ä»¤é‚£é‡Œï¼šnohup xxx &gt; nohup.out &amp;é—®é¢˜å°±åœ¨ &gt; ï¼Œéœ€è¦ä½¿ç”¨ &gt;&gt; è¿½åŠ æ¨¡å¼æ‰èƒ½ä½¿ç”¨ä¸Šè¿°ä¸‰ä¸ªå‘½ä»¤æ¸…ç©ºã€‚æ­£ç¡®æ–¹å¼ï¼šnohup xxx &gt;&gt; nohup.out &amp; å…¶å®ï¼Œåº”è¯¥å°†nohup.outè¿›è¡Œæ‹†åˆ†ã€‚æˆ–è€…ä¸è¾“å…¥åˆ°nohup.outã€‚å› ä¸ºæ¯•ç«Ÿç¨‹åºé‡Œé¢å·²ç»ä½¿ç”¨äº†logåº“ã€‚","link":"/archives/5cc761d2.html"},{"title":"æ›´æ¢ç”µè„‘åhexo deployè®¿é—®å‡ºç°404çš„é—®é¢˜","text":"æ›´æ¢ç”µè„‘åé‡æ–°æ‹‰ä¸‹hexoç›¸å…³sourcesï¼Œå®‰è£…å®Œæˆhexo-cliä»¥åŠhexo-deployer-gitå’Œå…¶ä»–node_modulesã€‚ æ‰§è¡Œhexo clean &amp;&amp; hexo g ç„¶åæ‰§è¡Œhexo dã€‚ å®Œæˆåå‘ç°è®¿é—®å‡ºç°404ï¼Œæç¤ºThere isnâ€™t a GitHub Pages site here. å¹¶ä¸”githubå‘äº†å¤§é‡è­¦å‘Šé‚®ä»¶ï¼Œæœ‰å¾—æ²¡å¾—ï¼Œä¾‹å¦‚ï¼š 1You are attempting to use a Jekyll theme, &quot;icarus&quot;, which is not supported by GitHub Pages. å®šä½é—®é¢˜ï¼š æŸ¥çœ‹github pageså¯¹åº”repositoryï¼Œå‘ç°é‡Œé¢çš„æ–‡ä»¶å®Œå…¨ä¸æ­£ç¡®ï¼Œä¸æ˜¯hexo gç”Ÿæˆçš„æ–‡ä»¶ã€‚è€Œå˜æˆäº†åšå®¢å¯¹åº”çš„æºæ–‡ä»¶ã€‚ æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦æ­£ç¡®ç”Ÿæˆï¼Œpublicç›®å½•ä¸‹æ­£ç¡®ç”Ÿæˆã€‚ é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ï¼Œè¯´æ˜é—®é¢˜å‡ºåœ¨deployã€‚ è§£å†³é—®é¢˜ï¼š åˆ é™¤.deploy_gitï¼Œé‡æ–°hexo dï¼Œä¸€åˆ‡æ¢å¤æ­£å¸¸ã€‚","link":"/archives/32745de6.html"},{"title":"è¢«Chromeä¸€ä¸ªbugå‘äº†","text":"ç›¸ä¿¡Chromeæµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­çš„Previewä½ ä¸é™Œç”Ÿï¼Œä½†æ˜¯å°±è¿™ç©æ„æœ‰ä¸€ä¸ªbugã€‚ äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œå‰ç«¯è·Ÿæˆ‘è¯´ä½ æ¥å£æœ‰bugï¼Œè¿”å›çš„æ•°æ®ä¸æ­£ç¡®ã€‚å¬åˆ°bugï¼Œæˆ‘åæ‰‹å°±æ˜¯ä¸€ä¸ªä½ ä¼šä¸ä¼šç”¨ã€‚ ä»–å‘æ¥äº†ä¸€ä¸ªæˆªå›¾ï¼š æˆ‘ç»™ä»–è¿”å›çš„jsonä¸­æœ‰ä¸€ä¸ªmaxå­—æ®µï¼Œå€¼æ˜¯100000000000000 ,æ­£ç¡®çš„åº”è¯¥æ˜¯99999999999999.99999999999999999999,ä½ å…ˆåˆ«ç®¡ä¸ºä»€ä¹ˆæ˜¯è¿™ä¹ˆä¸ªå€¼ã€‚ å¥½äº†ï¼Œä»–æ‹¿å‡ºè¯æ®äº†ï¼Œæˆ‘å¼€å§‹æ€€ç–‘çœŸçš„æ˜¯å“ªé‡Œå†™çš„æœ‰é—®é¢˜äº†ï¼Œä¸€é¡¿æŸ¥æ‰¾ï¼Œå‘ç°TMDå“ªé‡Œéƒ½æ²¡æœ‰é—®é¢˜å•Šï¼Œæ€ä¹ˆå¯èƒ½ï¼Œæ€ä¹ˆä¼šå‘¢ï¼Ÿ ä¸­åˆçš„é¥­éƒ½ä¸é¦™äº†ã€‚ æˆ‘å¼€å§‹æ€€ç–‘æ˜¯ç½‘å…³çš„é—®é¢˜ï¼Œç½‘å…³å¤§ä½¬è¯´æ²¡é—®é¢˜ã€‚ã€‚ã€‚ã€‚ã€‚ äºæ˜¯æ‹¿ç€è¯·æ±‚åœ°å€ï¼Œcurläº†ä¸€ä¸‹ï¼Œmax:99999999999999.99999999999999999999ã€‚å§æ§½ã€‚ã€‚ã€‚åˆå¯¹äº†ï¼Ÿ äºæ˜¯æˆ‘å¼€å§‹æ€€ç–‘æœ€ä¸å¯èƒ½å‡ºé—®é¢˜çš„æµè§ˆå™¨ï¼Œç›´åˆ°æˆ‘ç‚¹å¼€äº†Response : ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ åæ‰‹å°±æ˜¯ç»™æäº†ä¸€ä¸ªbugï¼š","link":"/archives/6e43fa1b.html"}],"tags":[{"name":"Docker","slug":"Docker","link":"/tags/Docker/"},{"name":"Golang","slug":"Golang","link":"/tags/Golang/"},{"name":"VSCode","slug":"VSCode","link":"/tags/VSCode/"},{"name":"Python","slug":"Python","link":"/tags/Python/"},{"name":"OCR","slug":"OCR","link":"/tags/OCR/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","link":"/tags/%E7%88%AC%E8%99%AB/"},{"name":"å®šæ—¶ä»»åŠ¡","slug":"å®šæ—¶ä»»åŠ¡","link":"/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"},{"name":"launchctl","slug":"launchctl","link":"/tags/launchctl/"},{"name":"PDF","slug":"PDF","link":"/tags/PDF/"},{"name":"EPUB","slug":"EPUB","link":"/tags/EPUB/"},{"name":"ç”µå­ä¹¦","slug":"ç”µå­ä¹¦","link":"/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/"},{"name":"Java","slug":"Java","link":"/tags/Java/"},{"name":"CAP","slug":"CAP","link":"/tags/CAP/"},{"name":"Dubbo","slug":"Dubbo","link":"/tags/Dubbo/"},{"name":"RPC","slug":"RPC","link":"/tags/RPC/"},{"name":"IDEA","slug":"IDEA","link":"/tags/IDEA/"},{"name":"BUG","slug":"BUG","link":"/tags/BUG/"},{"name":"åŒäº²å§”æ´¾","slug":"åŒäº²å§”æ´¾","link":"/tags/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE/"},{"name":"Maven","slug":"Maven","link":"/tags/Maven/"},{"name":"MySQL","slug":"MySQL","link":"/tags/MySQL/"},{"name":"RocketMQ","slug":"RocketMQ","link":"/tags/RocketMQ/"},{"name":"Spring","slug":"Spring","link":"/tags/Spring/"},{"name":"Activiti","slug":"Activiti","link":"/tags/Activiti/"},{"name":"Mybatis","slug":"Mybatis","link":"/tags/Mybatis/"},{"name":"ASM","slug":"ASM","link":"/tags/ASM/"},{"name":"Deadlock","slug":"Deadlock","link":"/tags/Deadlock/"},{"name":"IRIW","slug":"IRIW","link":"/tags/IRIW/"},{"name":"CPU","slug":"CPU","link":"/tags/CPU/"},{"name":"volatile","slug":"volatile","link":"/tags/volatile/"},{"name":"Paxos","slug":"Paxos","link":"/tags/Paxos/"},{"name":"ä¸€è‡´æ€§","slug":"ä¸€è‡´æ€§","link":"/tags/%E4%B8%80%E8%87%B4%E6%80%A7/"},{"name":"elasticsearch","slug":"elasticsearch","link":"/tags/elasticsearch/"},{"name":"flume","slug":"flume","link":"/tags/flume/"},{"name":"kafka","slug":"kafka","link":"/tags/kafka/"},{"name":"MongodDB","slug":"MongodDB","link":"/tags/MongodDB/"},{"name":"å›¾åºŠ","slug":"å›¾åºŠ","link":"/tags/%E5%9B%BE%E5%BA%8A/"},{"name":"åšå®¢","slug":"åšå®¢","link":"/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"MessageId","slug":"MessageId","link":"/tags/MessageId/"},{"name":"UniqKey","slug":"UniqKey","link":"/tags/UniqKey/"},{"name":"linux","slug":"linux","link":"/tags/linux/"},{"name":"Chrome","slug":"Chrome","link":"/tags/Chrome/"}],"categories":[{"name":"Dockeréšè®°","slug":"Dockeréšè®°","link":"/categories/Docker%E9%9A%8F%E8%AE%B0/"},{"name":"Golangéšè®°","slug":"Golangéšè®°","link":"/categories/Golang%E9%9A%8F%E8%AE%B0/"},{"name":"Pythonéšè®°","slug":"Pythonéšè®°","link":"/categories/Python%E9%9A%8F%E8%AE%B0/"},{"name":"åŒºå—é“¾","slug":"åŒºå—é“¾","link":"/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"å·¥å…·åˆ†äº«","slug":"å·¥å…·åˆ†äº«","link":"/categories/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/"},{"name":"Javaéšè®°","slug":"Javaéšè®°","link":"/categories/Java%E9%9A%8F%E8%AE%B0/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","link":"/categories/%E7%94%9F%E6%B4%BB/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","link":"/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"name":"è¸©å‘è®°å½•","slug":"è¸©å‘è®°å½•","link":"/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"}]}