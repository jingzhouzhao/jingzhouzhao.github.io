<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>一张图说明Golang的并发模型MPG - larry&#039;s blog</title><meta description="Golang 天生支持并发，Goroutine是Go 最吸引人的地方，采用的是CSP并发通信模型。到底Go是怎么支持高并发的呢？这里就需要说一说Golang 的MPG模型。"><meta property="og:type" content="article"><meta property="og:title" content="一张图说明Golang的并发模型MPG"><meta property="og:url" content="https://qmbb.top/archives/79f4a57c.html"><meta property="og:site_name" content="larry&#039;s blog"><meta property="og:description" content="Golang 天生支持并发，Goroutine是Go 最吸引人的地方，采用的是CSP并发通信模型。到底Go是怎么支持高并发的呢？这里就需要说一说Golang 的MPG模型。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://qmbb.top/archives/79f4a57c/1.jpg"><meta property="og:image" content="https://qmbb.top/archives/79f4a57c/2.png"><meta property="article:published_time" content="2019-09-04T03:10:49.000Z"><meta property="article:modified_time" content="2019-10-16T09:05:40.004Z"><meta property="article:author" content="赵荆州"><meta property="article:tag" content="Golang"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/archives/79f4a57c/1.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://qmbb.top/archives/79f4a57c.html"},"headline":"larry's blog","image":["https://qmbb.top/archives/79f4a57c/1.jpg","https://qmbb.top/archives/79f4a57c/2.png"],"datePublished":"2019-09-04T03:10:49.000Z","dateModified":"2019-10-16T09:05:40.004Z","author":{"@type":"Person","name":"赵荆州"},"description":"Golang 天生支持并发，Goroutine是Go 最吸引人的地方，采用的是CSP并发通信模型。到底Go是怎么支持高并发的呢？这里就需要说一说Golang 的MPG模型。"}</script><link rel="canonical" href="https://qmbb.top/archives/79f4a57c.html"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/" alt="larry&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-04T03:10:49.000Z" title="2019-09-04T03:10:49.000Z">2019-09-04</time><span class="level-item"><a class="link-muted" href="/categories/Golang%E9%9A%8F%E8%AE%B0/">Golang随记</a></span></div></div><h1 class="title is-3 is-size-4-mobile">一张图说明Golang的并发模型MPG</h1><div class="content"><p>Golang 天生支持并发，Goroutine是Go 最吸引人的地方，采用的是CSP并发通信模型。到底Go是怎么支持高并发的呢？这里就需要说一说Golang 的MPG模型。</p>
<a id="more"></a>

<ol>
<li><strong>M</strong> 代表着一个内核线程 ，一个M就是一个内核线程，goroutine就是跑在M之上的</li>
<li><strong>P</strong> 代表着(Processor)处理器， 它的主要用途就是用来执行goroutine的，所以它也维护了一个可运行的goroutine队列，和自由的goroutine队列，里面存储了所有需要它来执行的goroutine。</li>
<li><strong>G</strong> 代表着goroutine 实际的数据结构，并维护者goroutine 需要的栈、程序计数器以及它所在的M等信息。</li>
<li><strong>Sched</strong> 代表着一个调度器 它维护有存储空闲的M队列和空闲的P队列，可运行的G队列，自由的G队列以及调度器的一些状态信息等。</li>
</ol>
<p>一张图就可以说明MPG模型：</p>
<p><img src="/archives/79f4a57c/1.jpg" alt="MPG"></p>
<p>图中的“土拨鼠”代表的就是<strong>M</strong>，“推车”代表的是<strong>P</strong>，“木块”代表的就是<strong>G</strong>。在这张图外还存在一个特殊的”土拨鼠“这个”土拨鼠“就是”包工头“<strong>Sched</strong>。</p>
<p><img src="/archives/79f4a57c/2.png" alt="Sched"></p>
<p>从图中我们可以看到“土拨鼠“不停地将“木块“搬运到“推车“上，然后推去烧。在这个过程中可能出现“土拨鼠“因为累坏了，而处理的速度变慢的情况，这个时候“包工头“就出现了，“包工头“非常体贴的将这个“土拨鼠“的“推车“交给其他“土拨鼠“去处理。如果一个“土拨鼠“的“推车“里面的“木块“装的太多，“包工头“也会让其它的“土拨鼠“去帮忙拿出一些来。当“包工头“发现现有的“土拨鼠“已经忙不过来的时候，就回去找一些新的“土拨鼠“过来，并给他们配发“推车“。直到所有的“木块“都烧完为止。</p>
<p>上面说到的几种情况：</p>
<ol>
<li>“土拨鼠”累坏了，形容的是IO等耗时的操作。</li>
<li>其他“土拨鼠”帮忙，形容的是工作窃取算法（work stealing），这个算法在很多语言中都有应用，例如Java中的Fork/Foin。</li>
</ol>
<p>在Golang中土拨鼠默认的数量是CPU的核数，土拨鼠通过CSP模型沟通。</p>
<p>参考资料：</p>
<p><a href="https://zhuanlan.zhihu.com/p/22352969">https://zhuanlan.zhihu.com/p/22352969</a></p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Golang/">Golang</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/archives/f11de5dd.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">跟着B站学Golang(admin-ep-saga)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/archives/c8d527a1.html"><span class="level-item">Go Module 引入本地自定义包</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/" alt="larry&#039;s blog" height="28"></a><p class="size-small"><span>&copy; 2020 赵荆州</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://qmbb.top',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><!--!--><script src="/js/main.js" defer></script><!--!--></body></html>